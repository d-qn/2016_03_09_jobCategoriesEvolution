<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<script src="data:application/x-javascript;base64,KGZ1bmN0aW9uKCkgewogIC8vIElmIHdpbmRvdy5IVE1MV2lkZ2V0cyBpcyBhbHJlYWR5IGRlZmluZWQsIHRoZW4gdXNlIGl0OyBvdGhlcndpc2UgY3JlYXRlIGEKICAvLyBuZXcgb2JqZWN0LiBUaGlzIGFsbG93cyBwcmVjZWRpbmcgY29kZSB0byBzZXQgb3B0aW9ucyB0aGF0IGFmZmVjdCB0aGUKICAvLyBpbml0aWFsaXphdGlvbiBwcm9jZXNzICh0aG91Z2ggbm9uZSBjdXJyZW50bHkgZXhpc3QpLgogIHdpbmRvdy5IVE1MV2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cyB8fCB7fTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gYSB2aWV3ZXIgcGFuZS4gSWYgbm90LCB3ZSdyZSBpbiBhIHdlYiBicm93c2VyLgogIHZhciB2aWV3ZXJNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnZpZXdlck1vZGUgPQogICAgICAvXGJ2aWV3ZXJfcGFuZT0xXGIvLnRlc3Qod2luZG93LmxvY2F0aW9uKTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gU2hpbnkgbW9kZS4gSWYgbm90LCBpdCdzIGEgc3RhdGljIGRvY3VtZW50LgogIC8vIE5vdGUgdGhhdCBzdGF0aWMgd2lkZ2V0cyBjYW4gYXBwZWFyIGluIGJvdGggU2hpbnkgYW5kIHN0YXRpYyBtb2RlcywgYnV0CiAgLy8gb2J2aW91c2x5LCBTaGlueSB3aWRnZXRzIGNhbiBvbmx5IGFwcGVhciBpbiBTaGlueSBhcHBzL2RvY3VtZW50cy4KICB2YXIgc2hpbnlNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnNoaW55TW9kZSA9CiAgICAgIHR5cGVvZih3aW5kb3cuU2hpbnkpICE9PSAidW5kZWZpbmVkIiAmJiAhIXdpbmRvdy5TaGlueS5vdXRwdXRCaW5kaW5nczsKCiAgLy8gV2UgY2FuJ3QgY291bnQgb24galF1ZXJ5IGJlaW5nIGF2YWlsYWJsZSwgc28gd2UgaW1wbGVtZW50IG91ciBvd24KICAvLyB2ZXJzaW9uIGlmIG5lY2Vzc2FyeS4KICBmdW5jdGlvbiBxdWVyeVNlbGVjdG9yQWxsKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKHR5cGVvZihqUXVlcnkpICE9PSAidW5kZWZpbmVkIiAmJiBzY29wZSBpbnN0YW5jZW9mIGpRdWVyeSkgewogICAgICByZXR1cm4gc2NvcGUuZmluZChzZWxlY3Rvcik7CiAgICB9CiAgICBpZiAoc2NvcGUucXVlcnlTZWxlY3RvckFsbCkgewogICAgICByZXR1cm4gc2NvcGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhc0FycmF5KHZhbHVlKSB7CiAgICBpZiAodmFsdWUgPT09IG51bGwpCiAgICAgIHJldHVybiBbXTsKICAgIGlmICgkLmlzQXJyYXkodmFsdWUpKQogICAgICByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gW3ZhbHVlXTsKICB9CgogIC8vIEltcGxlbWVudCBqUXVlcnkncyBleHRlbmQKICBmdW5jdGlvbiBleHRlbmQodGFyZ2V0IC8qLCAuLi4gKi8pIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CiAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKHNvdXJjZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgdGFyZ2V0W3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9CgogIC8vIElFOCBkb2Vzbid0IHN1cHBvcnQgQXJyYXkuZm9yRWFjaC4KICBmdW5jdGlvbiBmb3JFYWNoKHZhbHVlcywgY2FsbGJhY2ssIHRoaXNBcmcpIHsKICAgIGlmICh2YWx1ZXMuZm9yRWFjaCkgewogICAgICB2YWx1ZXMuZm9yRWFjaChjYWxsYmFjaywgdGhpc0FyZyk7CiAgICB9IGVsc2UgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNhbGxiYWNrLmNhbGwodGhpc0FyZywgdmFsdWVzW2ldLCBpLCB2YWx1ZXMpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZXBsYWNlcyB0aGUgc3BlY2lmaWVkIG1ldGhvZCB3aXRoIHRoZSByZXR1cm4gdmFsdWUgb2YgZnVuY1NvdXJjZS4KICAvLwogIC8vIE5vdGUgdGhhdCBmdW5jU291cmNlIHNob3VsZCBub3QgQkUgdGhlIG5ldyBtZXRob2QsIGl0IHNob3VsZCBiZSBhIGZ1bmN0aW9uCiAgLy8gdGhhdCBSRVRVUk5TIHRoZSBuZXcgbWV0aG9kLiBmdW5jU291cmNlIHJlY2VpdmVzIGEgc2luZ2xlIGFyZ3VtZW50IHRoYXQgaXMKICAvLyB0aGUgb3ZlcnJpZGRlbiBtZXRob2QsIGl0IGNhbiBiZSBjYWxsZWQgZnJvbSB0aGUgbmV3IG1ldGhvZC4gVGhlIG92ZXJyaWRkZW4KICAvLyBtZXRob2QgY2FuIGJlIGNhbGxlZCBsaWtlIGEgcmVndWxhciBmdW5jdGlvbiwgaXQgaGFzIHRoZSB0YXJnZXQgcGVybWFuZW50bHkKICAvLyBib3VuZCB0byBpdCBzbyAidGhpcyIgd2lsbCB3b3JrIGNvcnJlY3RseS4KICBmdW5jdGlvbiBvdmVycmlkZU1ldGhvZCh0YXJnZXQsIG1ldGhvZE5hbWUsIGZ1bmNTb3VyY2UpIHsKICAgIHZhciBzdXBlckZ1bmMgPSB0YXJnZXRbbWV0aG9kTmFtZV0gfHwgZnVuY3Rpb24oKSB7fTsKICAgIHZhciBzdXBlckZ1bmNCb3VuZCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gc3VwZXJGdW5jLmFwcGx5KHRhcmdldCwgYXJndW1lbnRzKTsKICAgIH07CiAgICB0YXJnZXRbbWV0aG9kTmFtZV0gPSBmdW5jU291cmNlKHN1cGVyRnVuY0JvdW5kKTsKICB9CgogIC8vIEFkZCBhIG1ldGhvZCB0byBkZWxlZ2F0b3IgdGhhdCwgd2hlbiBpbnZva2VkLCBjYWxscwogIC8vIGRlbGVnYXRlZS5tZXRob2ROYW1lLiBJZiB0aGVyZSBpcyBubyBzdWNoIG1ldGhvZCBvbgogIC8vIHRoZSBkZWxlZ2F0ZWUsIGJ1dCB0aGVyZSB3YXMgb25lIG9uIGRlbGVnYXRvciBiZWZvcmUKICAvLyBkZWxlZ2F0ZU1ldGhvZCB3YXMgY2FsbGVkLCB0aGVuIHRoZSBvcmlnaW5hbCB2ZXJzaW9uCiAgLy8gaXMgaW52b2tlZCBpbnN0ZWFkLgogIC8vIEZvciBleGFtcGxlOgogIC8vCiAgLy8gdmFyIGEgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2ExJyk7IH0KICAvLyAgIG1ldGhvZDI6IGZ1bmN0aW9uKCkgeyBjb25zb2xlLmxvZygnYTInKTsgfQogIC8vIH07CiAgLy8gdmFyIGIgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2IxJyk7IH0KICAvLyB9OwogIC8vIGRlbGVnYXRlTWV0aG9kKGEsIGIsICJtZXRob2QxIik7CiAgLy8gZGVsZWdhdGVNZXRob2QoYSwgYiwgIm1ldGhvZDIiKTsKICAvLyBhLm1ldGhvZDEoKTsKICAvLyBhLm1ldGhvZDIoKTsKICAvLwogIC8vIFRoZSBvdXRwdXQgd291bGQgYmUgImIxIiwgImEyIi4KICBmdW5jdGlvbiBkZWxlZ2F0ZU1ldGhvZChkZWxlZ2F0b3IsIGRlbGVnYXRlZSwgbWV0aG9kTmFtZSkgewogICAgdmFyIGluaGVyaXRlZCA9IGRlbGVnYXRvclttZXRob2ROYW1lXTsKICAgIGRlbGVnYXRvclttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdGFyZ2V0ID0gZGVsZWdhdGVlOwogICAgICB2YXIgbWV0aG9kID0gZGVsZWdhdGVlW21ldGhvZE5hbWVdOwoKICAgICAgLy8gVGhlIG1ldGhvZCBkb2Vzbid0IGV4aXN0IG9uIHRoZSBkZWxlZ2F0ZWUuIEluc3RlYWQsCiAgICAgIC8vIGNhbGwgdGhlIG1ldGhvZCBvbiB0aGUgZGVsZWdhdG9yLCBpZiBpdCBleGlzdHMuCiAgICAgIGlmICghbWV0aG9kKSB7CiAgICAgICAgdGFyZ2V0ID0gZGVsZWdhdG9yOwogICAgICAgIG1ldGhvZCA9IGluaGVyaXRlZDsKICAgICAgfQoKICAgICAgaWYgKG1ldGhvZCkgewogICAgICAgIHJldHVybiBtZXRob2QuYXBwbHkodGFyZ2V0LCBhcmd1bWVudHMpOwogICAgICB9CiAgICB9OwogIH0KCiAgLy8gSW1wbGVtZW50IGEgdmFndWUgZmFjc2ltaWxpZSBvZiBqUXVlcnkncyBkYXRhIG1ldGhvZAogIGZ1bmN0aW9uIGVsZW1lbnREYXRhKGVsLCBuYW1lLCB2YWx1ZSkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMikgewogICAgICByZXR1cm4gZWxbImh0bWx3aWRnZXRfZGF0YV8iICsgbmFtZV07CiAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMykgewogICAgICBlbFsiaHRtbHdpZGdldF9kYXRhXyIgKyBuYW1lXSA9IHZhbHVlOwogICAgICByZXR1cm4gZWw7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldyb25nIG51bWJlciBvZiBhcmd1bWVudHMgZm9yIGVsZW1lbnREYXRhOiAiICsKICAgICAgICBhcmd1bWVudHMubGVuZ3RoKTsKICAgIH0KICB9CgogIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzQ0NjE3MC9lc2NhcGUtc3RyaW5nLWZvci11c2UtaW4tamF2YXNjcmlwdC1yZWdleAogIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1wtXFtcXVwvXHtcfVwoXClcKlwrXD9cLlxcXF5cJFx8XS9nLCAiXFwkJiIpOwogIH0KCiAgZnVuY3Rpb24gaGFzQ2xhc3MoZWwsIGNsYXNzTmFtZSkgewogICAgdmFyIHJlID0gbmV3IFJlZ0V4cCgiXFxiIiArIGVzY2FwZVJlZ0V4cChjbGFzc05hbWUpICsgIlxcYiIpOwogICAgcmV0dXJuIHJlLnRlc3QoZWwuY2xhc3NOYW1lKTsKICB9CgogIC8vIGVsZW1lbnRzIC0gYXJyYXkgKG9yIGFycmF5LWxpa2Ugb2JqZWN0KSBvZiBIVE1MIGVsZW1lbnRzCiAgLy8gY2xhc3NOYW1lIC0gY2xhc3MgbmFtZSB0byB0ZXN0IGZvcgogIC8vIGluY2x1ZGUgLSBpZiB0cnVlLCBvbmx5IHJldHVybiBlbGVtZW50cyB3aXRoIGdpdmVuIGNsYXNzTmFtZTsKICAvLyAgIGlmIGZhbHNlLCBvbmx5IHJldHVybiBlbGVtZW50cyAqd2l0aG91dCogZ2l2ZW4gY2xhc3NOYW1lCiAgZnVuY3Rpb24gZmlsdGVyQnlDbGFzcyhlbGVtZW50cywgY2xhc3NOYW1lLCBpbmNsdWRlKSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICBpZiAoaGFzQ2xhc3MoZWxlbWVudHNbaV0sIGNsYXNzTmFtZSkgPT0gaW5jbHVkZSkKICAgICAgICByZXN1bHRzLnB1c2goZWxlbWVudHNbaV0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICBmdW5jdGlvbiBvbihvYmosIGV2ZW50TmFtZSwgZnVuYykgewogICAgaWYgKG9iai5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgIG9iai5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuYywgZmFsc2UpOwogICAgfSBlbHNlIGlmIChvYmouYXR0YWNoRXZlbnQpIHsKICAgICAgb2JqLmF0dGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBvZmYob2JqLCBldmVudE5hbWUsIGZ1bmMpIHsKICAgIGlmIChvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcikKICAgICAgb2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jLCBmYWxzZSk7CiAgICBlbHNlIGlmIChvYmouZGV0YWNoRXZlbnQpIHsKICAgICAgb2JqLmRldGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICAvLyBUcmFuc2xhdGUgYXJyYXkgb2YgdmFsdWVzIHRvIHRvcC9yaWdodC9ib3R0b20vbGVmdCwgYXMgdXN1YWwgd2l0aAogIC8vIHRoZSAicGFkZGluZyIgQ1NTIHByb3BlcnR5CiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL3BhZGRpbmcKICBmdW5jdGlvbiB1bnBhY2tQYWRkaW5nKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mKHZhbHVlKSA9PT0gIm51bWJlciIpCiAgICAgIHZhbHVlID0gW3ZhbHVlXTsKICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDEpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMF0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzBdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDIpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDMpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDQpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzNdfTsKICAgIH0KICB9CgogIC8vIENvbnZlcnQgYW4gdW5wYWNrZWQgcGFkZGluZyBvYmplY3QgdG8gYSBDU1MgdmFsdWUKICBmdW5jdGlvbiBwYWRkaW5nVG9Dc3MocGFkZGluZ09iaikgewogICAgcmV0dXJuIHBhZGRpbmdPYmoudG9wICsgInB4ICIgKyBwYWRkaW5nT2JqLnJpZ2h0ICsgInB4ICIgKyBwYWRkaW5nT2JqLmJvdHRvbSArICJweCAiICsgcGFkZGluZ09iai5sZWZ0ICsgInB4IjsKICB9CgogIC8vIE1ha2VzIGEgbnVtYmVyIHN1aXRhYmxlIGZvciBDU1MKICBmdW5jdGlvbiBweCh4KSB7CiAgICBpZiAodHlwZW9mKHgpID09PSAibnVtYmVyIikKICAgICAgcmV0dXJuIHggKyAicHgiOwogICAgZWxzZQogICAgICByZXR1cm4geDsKICB9CgogIC8vIFJldHJpZXZlcyBydW50aW1lIHdpZGdldCBzaXppbmcgaW5mb3JtYXRpb24gZm9yIGFuIGVsZW1lbnQuCiAgLy8gVGhlIHJldHVybiB2YWx1ZSBpcyBlaXRoZXIgbnVsbCwgb3IgYW4gb2JqZWN0IHdpdGggZmlsbCwgcGFkZGluZywKICAvLyBkZWZhdWx0V2lkdGgsIGRlZmF1bHRIZWlnaHQgZmllbGRzLgogIGZ1bmN0aW9uIHNpemluZ1BvbGljeShlbCkgewogICAgdmFyIHNpemluZ0VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W2RhdGEtZm9yPSciICsgZWwuaWQgKyAiJ11bdHlwZT0nYXBwbGljYXRpb24vaHRtbHdpZGdldC1zaXppbmcnXSIpOwogICAgaWYgKCFzaXppbmdFbCkKICAgICAgcmV0dXJuIG51bGw7CiAgICB2YXIgc3AgPSBKU09OLnBhcnNlKHNpemluZ0VsLnRleHRDb250ZW50IHx8IHNpemluZ0VsLnRleHQgfHwgInt9Iik7CiAgICBpZiAodmlld2VyTW9kZSkgewogICAgICByZXR1cm4gc3Audmlld2VyOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHNwLmJyb3dzZXI7CiAgICB9CiAgfQoKICAvLyBAcGFyYW0gdGFza3MgQXJyYXkgb2Ygc3RyaW5ncyAob3IgZmFsc3kgdmFsdWUsIGluIHdoaWNoIGNhc2Ugbm8tb3ApLgogIC8vICAgRWFjaCBlbGVtZW50IG11c3QgYmUgYSB2YWxpZCBKYXZhU2NyaXB0IGV4cHJlc3Npb24gdGhhdCB5aWVsZHMgYQogIC8vICAgZnVuY3Rpb24uCiAgLy8gQHBhcmFtIHRhcmdldCBUaGUgb2JqZWN0IHRoYXQgd2lsbCBiZSAidGhpcyIgZm9yIGVhY2ggZnVuY3Rpb24KICAvLyAgIGV4ZWN1dGlvbi4KICAvLyBAcGFyYW0gYXJncyBBcnJheSBvZiBhcmd1bWVudHMgdG8gYmUgcGFzc2VkIHRvIHRoZSBmdW5jdGlvbnMuIChUaGUKICAvLyAgIHNhbWUgYXJndW1lbnRzIHdpbGwgYmUgcGFzc2VkIHRvIGFsbCBmdW5jdGlvbnMuKQogIGZ1bmN0aW9uIGV2YWxBbmRSdW4odGFza3MsIHRhcmdldCwgYXJncykgewogICAgaWYgKHRhc2tzKSB7CiAgICAgIGZvckVhY2godGFza3MsIGZ1bmN0aW9uKHRhc2spIHsKICAgICAgICB2YXIgdGFza0Z1bmMgPSBldmFsKCIoIiArIHRhc2sgKyAiKSIpOwogICAgICAgIGlmICh0eXBlb2YodGFza0Z1bmMpICE9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRhc2sgbXVzdCBiZSBhIGZ1bmN0aW9uISBTb3VyY2U6XG4iICsgdGFzayk7CiAgICAgICAgfQogICAgICAgIHRhc2tGdW5jLmFwcGx5KHRhcmdldCwgYXJncyk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdFNpemluZyhlbCkgewogICAgdmFyIHNpemluZyA9IHNpemluZ1BvbGljeShlbCk7CiAgICBpZiAoIXNpemluZykKICAgICAgcmV0dXJuOwoKICAgIHZhciBjZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaHRtbHdpZGdldF9jb250YWluZXIiKTsKICAgIGlmICghY2VsKQogICAgICByZXR1cm47CgogICAgaWYgKHR5cGVvZihzaXppbmcucGFkZGluZykgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUubWFyZ2luID0gIjAiOwogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLnBhZGRpbmcgPSBwYWRkaW5nVG9Dc3ModW5wYWNrUGFkZGluZyhzaXppbmcucGFkZGluZykpOwogICAgfQoKICAgIGlmIChzaXppbmcuZmlsbCkgewogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7CiAgICAgIGlmIChjZWwpIHsKICAgICAgICBjZWwuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgICAgIHZhciBwYWQgPSB1bnBhY2tQYWRkaW5nKHNpemluZy5wYWRkaW5nKTsKICAgICAgICBjZWwuc3R5bGUudG9wID0gcGFkLnRvcCArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLnJpZ2h0ID0gcGFkLnJpZ2h0ICsgInB4IjsKICAgICAgICBjZWwuc3R5bGUuYm90dG9tID0gcGFkLmJvdHRvbSArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLmxlZnQgPSBwYWQubGVmdCArICJweCI7CiAgICAgICAgZWwuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGNlbC5vZmZzZXRXaWR0aDsgfSwKICAgICAgICBnZXRIZWlnaHQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gY2VsLm9mZnNldEhlaWdodDsgfQogICAgICB9OwoKICAgIH0gZWxzZSB7CiAgICAgIGVsLnN0eWxlLndpZHRoID0gcHgoc2l6aW5nLndpZHRoKTsKICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gcHgoc2l6aW5nLmhlaWdodCk7CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGVsLm9mZnNldFdpZHRoOyB9LAogICAgICAgIGdldEhlaWdodDogZnVuY3Rpb24oKSB7IHJldHVybiBlbC5vZmZzZXRIZWlnaHQ7IH0KICAgICAgfTsKICAgIH0KICB9CgogIC8vIERlZmF1bHQgaW1wbGVtZW50YXRpb25zIGZvciBtZXRob2RzCiAgdmFyIGRlZmF1bHRzID0gewogICAgZmluZDogZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgcmV0dXJuIHF1ZXJ5U2VsZWN0b3JBbGwoc2NvcGUsICIuIiArIHRoaXMubmFtZSk7CiAgICB9LAogICAgcmVuZGVyRXJyb3I6IGZ1bmN0aW9uKGVsLCBlcnIpIHsKICAgICAgdmFyICRlbCA9ICQoZWwpOwoKICAgICAgdGhpcy5jbGVhckVycm9yKGVsKTsKCiAgICAgIC8vIEFkZCBhbGwgdGhlc2UgZXJyb3IgY2xhc3NlcywgYXMgU2hpbnkgZG9lcwogICAgICB2YXIgZXJyQ2xhc3MgPSAic2hpbnktb3V0cHV0LWVycm9yIjsKICAgICAgaWYgKGVyci50eXBlICE9PSBudWxsKSB7CiAgICAgICAgLy8gdXNlIHRoZSBjbGFzc2VzIG9mIHRoZSBlcnJvciBjb25kaXRpb24gYXMgQ1NTIGNsYXNzIG5hbWVzCiAgICAgICAgZXJyQ2xhc3MgPSBlcnJDbGFzcyArICIgIiArICQubWFwKGFzQXJyYXkoZXJyLnR5cGUpLCBmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgICByZXR1cm4gZXJyQ2xhc3MgKyAiLSIgKyB0eXBlOwogICAgICAgIH0pLmpvaW4oIiAiKTsKICAgICAgfQogICAgICBlcnJDbGFzcyA9IGVyckNsYXNzICsgIiBodG1sd2lkZ2V0cy1lcnJvciI7CgogICAgICAvLyBJcyBlbCBpbmxpbmUgb3IgYmxvY2s/IElmIGlubGluZSBvciBpbmxpbmUtYmxvY2ssIGp1c3QgZGlzcGxheTpub25lIGl0CiAgICAgIC8vIGFuZCBhZGQgYW4gaW5saW5lIGVycm9yLgogICAgICB2YXIgZGlzcGxheSA9ICRlbC5jc3MoImRpc3BsYXkiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgZGlzcGxheSk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICAkZWwuaGlkZSgpOwogICAgICAgIGlmIChlcnIubWVzc2FnZSAhPT0gIiIpIHsKICAgICAgICAgIHZhciBlcnJvclNwYW4gPSAkKCI8c3Bhbj4iKS5hZGRDbGFzcyhlcnJDbGFzcyk7CiAgICAgICAgICBlcnJvclNwYW4udGV4dChlcnIubWVzc2FnZSk7CiAgICAgICAgICAkZWwuYWZ0ZXIoZXJyb3JTcGFuKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZGlzcGxheSA9PT0gImJsb2NrIikgewogICAgICAgIC8vIElmIGJsb2NrLCBhZGQgYW4gZXJyb3IganVzdCBhZnRlciB0aGUgZWwsIHNldCB2aXNpYmlsaXR5Om5vbmUgb24gdGhlCiAgICAgICAgLy8gZWwsIGFuZCBwb3NpdGlvbiB0aGUgZXJyb3IgdG8gYmUgb24gdG9wIG9mIHRoZSBlbC4KICAgICAgICAvLyBNYXJrIGl0IHdpdGggYSB1bmlxdWUgSUQgYW5kIENTUyBjbGFzcyBzbyB3ZSBjYW4gcmVtb3ZlIGl0IGxhdGVyLgogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaGlkZGVuIik7CiAgICAgICAgaWYgKGVyci5tZXNzYWdlICE9PSAiIikgewogICAgICAgICAgdmFyIGVycm9yRGl2ID0gJCgiPGRpdj4iKS5hZGRDbGFzcyhlcnJDbGFzcykuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpCiAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgLmNzcygibGVmdCIsIGVsLm9mZnNldExlZnQpCiAgICAgICAgICAgIC8vIHNldHRpbmcgd2lkdGggY2FuIHB1c2ggb3V0IHRoZSBwYWdlIHNpemUsIGZvcmNpbmcgb3RoZXJ3aXNlCiAgICAgICAgICAgIC8vIHVubmVjZXNzYXJ5IHNjcm9sbGJhcnMgdG8gYXBwZWFyIGFuZCBtYWtpbmcgaXQgaW1wb3NzaWJsZSBmb3IKICAgICAgICAgICAgLy8gdGhlIGVsZW1lbnQgdG8gc2hyaW5rOyBzbyB1c2UgbWF4LXdpZHRoIGluc3RlYWQKICAgICAgICAgICAgLmNzcygibWF4V2lkdGgiLCBlbC5vZmZzZXRXaWR0aCkKICAgICAgICAgICAgLmNzcygiaGVpZ2h0IiwgZWwub2Zmc2V0SGVpZ2h0KTsKICAgICAgICAgIGVycm9yRGl2LnRleHQoZXJyLm1lc3NhZ2UpOwogICAgICAgICAgJGVsLmFmdGVyKGVycm9yRGl2KTsKCiAgICAgICAgICAvLyBSZWFsbHkgZHVtYiB3YXkgdG8ga2VlcCB0aGUgc2l6ZS9wb3NpdGlvbiBvZiB0aGUgZXJyb3IgaW4gc3luYyB3aXRoCiAgICAgICAgICAvLyB0aGUgcGFyZW50IGVsZW1lbnQgYXMgdGhlIHdpbmRvdyBpcyByZXNpemVkIG9yIHdoYXRldmVyLgogICAgICAgICAgdmFyIGludElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICghZXJyb3JEaXZbMF0ucGFyZW50RWxlbWVudCkgewogICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50SWQpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvckRpdgogICAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgICAuY3NzKCJsZWZ0IiwgZWwub2Zmc2V0TGVmdCkKICAgICAgICAgICAgICAuY3NzKCJtYXhXaWR0aCIsIGVsLm9mZnNldFdpZHRoKQogICAgICAgICAgICAgIC5jc3MoImhlaWdodCIsIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNsZWFyRXJyb3I6IGZ1bmN0aW9uKGVsKSB7CiAgICAgIHZhciAkZWwgPSAkKGVsKTsKICAgICAgdmFyIGRpc3BsYXkgPSAkZWwuZGF0YSgicmVzdG9yZS1kaXNwbGF5LW1vZGUiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgbnVsbCk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICBpZiAoZGlzcGxheSkKICAgICAgICAgICRlbC5jc3MoImRpc3BsYXkiLCBkaXNwbGF5KTsKICAgICAgICAkKGVsLm5leHRTaWJsaW5nKS5maWx0ZXIoIi5odG1sd2lkZ2V0cy1lcnJvciIpLnJlbW92ZSgpOwogICAgICB9IGVsc2UgaWYgKGRpc3BsYXkgPT09ICJibG9jayIpewogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaW5oZXJpdCIpOwogICAgICAgICQoZWwubmV4dFNpYmxpbmcpLmZpbHRlcigiLmh0bWx3aWRnZXRzLWVycm9yIikucmVtb3ZlKCk7CiAgICAgIH0KICAgIH0sCiAgICBzaXppbmc6IHt9CiAgfTsKCiAgLy8gQ2FsbGVkIGJ5IHdpZGdldCBiaW5kaW5ncyB0byByZWdpc3RlciBhIG5ldyB0eXBlIG9mIHdpZGdldC4gVGhlIGRlZmluaXRpb24KICAvLyBvYmplY3QgY2FuIGNvbnRhaW4gdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgogIC8vIC0gbmFtZSAocmVxdWlyZWQpIC0gQSBzdHJpbmcgaW5kaWNhdGluZyB0aGUgYmluZGluZyBuYW1lLCB3aGljaCB3aWxsIGJlCiAgLy8gICB1c2VkIGJ5IGRlZmF1bHQgYXMgdGhlIENTUyBjbGFzc25hbWUgdG8gbG9vayBmb3IuCiAgLy8gLSBpbml0aWFsaXplIChvcHRpb25hbCkgLSBBIGZ1bmN0aW9uKGVsKSB0aGF0IHdpbGwgYmUgY2FsbGVkIG9uY2UgcGVyCiAgLy8gICB3aWRnZXQgZWxlbWVudDsgaWYgYSB2YWx1ZSBpcyByZXR1cm5lZCwgaXQgd2lsbCBiZSBwYXNzZWQgYXMgdGhlIHRoaXJkCiAgLy8gICB2YWx1ZSB0byByZW5kZXJWYWx1ZS4KICAvLyAtIHJlbmRlclZhbHVlIChyZXF1aXJlZCkgLSBBIGZ1bmN0aW9uKGVsLCBkYXRhLCBpbml0VmFsdWUpIHRoYXQgd2lsbCBiZQogIC8vICAgY2FsbGVkIHdpdGggZGF0YS4gU3RhdGljIGNvbnRleHRzIHdpbGwgY2F1c2UgdGhpcyB0byBiZSBjYWxsZWQgb25jZSBwZXIKICAvLyAgIGVsZW1lbnQ7IFNoaW55IGFwcHMgd2lsbCBjYXVzZSB0aGlzIHRvIGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyBwZXIKICAvLyAgIGVsZW1lbnQsIGFzIHRoZSBkYXRhIGNoYW5nZXMuCiAgd2luZG93LkhUTUxXaWRnZXRzLndpZGdldCA9IGZ1bmN0aW9uKGRlZmluaXRpb24pIHsKICAgIGlmICghZGVmaW5pdGlvbi5uYW1lKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIG5hbWUiKTsKICAgIH0KICAgIGlmICghZGVmaW5pdGlvbi50eXBlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHR5cGUiKTsKICAgIH0KICAgIC8vIEN1cnJlbnRseSB3ZSBvbmx5IHN1cHBvcnQgb3V0cHV0IHdpZGdldHMKICAgIGlmIChkZWZpbml0aW9uLnR5cGUgIT09ICJvdXRwdXQiKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiVW5yZWNvZ25pemVkIHdpZGdldCB0eXBlICciICsgZGVmaW5pdGlvbi50eXBlICsgIiciKTsKICAgIH0KICAgIC8vIFRPRE86IFZlcmlmeSB0aGF0IC5uYW1lIGlzIGEgdmFsaWQgQ1NTIGNsYXNzbmFtZQoKICAgIC8vIFN1cHBvcnQgbmV3LXN0eWxlIGluc3RhbmNlLWJvdW5kIGRlZmluaXRpb25zLiBPbGQtc3R5bGUgY2xhc3MtYm91bmQKICAgIC8vIGRlZmluaXRpb25zIGhhdmUgb25lIHdpZGdldCAib2JqZWN0IiBwZXIgd2lkZ2V0IHBlciB0eXBlL2NsYXNzIG9mCiAgICAvLyB3aWRnZXQ7IHRoZSByZW5kZXJWYWx1ZSBhbmQgcmVzaXplIG1ldGhvZHMgb24gc3VjaCB3aWRnZXQgb2JqZWN0cwogICAgLy8gdGFrZSBlbCBhbmQgaW5zdGFuY2UgYXJndW1lbnRzLCBiZWNhdXNlIHRoZSB3aWRnZXQgb2JqZWN0IGNhbid0CiAgICAvLyBzdG9yZSB0aGVtLiBOZXctc3R5bGUgaW5zdGFuY2UtYm91bmQgZGVmaW5pdGlvbnMgaGF2ZSBvbmUgd2lkZ2V0CiAgICAvLyBvYmplY3QgcGVyIHdpZGdldCBpbnN0YW5jZTsgdGhlIGRlZmluaXRpb24gdGhhdCdzIHBhc3NlZCBpbiBkb2Vzbid0CiAgICAvLyBwcm92aWRlIHJlbmRlclZhbHVlIG9yIHJlc2l6ZSBtZXRob2RzIGF0IGFsbCwganVzdCB0aGUgc2luZ2xlIG1ldGhvZAogICAgLy8gICBmYWN0b3J5KGVsLCB3aWR0aCwgaGVpZ2h0KQogICAgLy8gd2hpY2ggcmV0dXJucyBhbiBvYmplY3QgdGhhdCBoYXMgcmVuZGVyVmFsdWUoeCkgYW5kIHJlc2l6ZSh3LCBoKS4KICAgIC8vIFRoaXMgZW5hYmxlcyBhIGZhciBtb3JlIG5hdHVyYWwgcHJvZ3JhbW1pbmcgc3R5bGUgZm9yIHRoZSB3aWRnZXQKICAgIC8vIGF1dGhvciwgd2hvIGNhbiBzdG9yZSBwZXItaW5zdGFuY2Ugc3RhdGUgdXNpbmcgZWl0aGVyIE9PLXN0eWxlCiAgICAvLyBpbnN0YW5jZSBmaWVsZHMgb3IgZnVuY3Rpb25hbC1zdHlsZSBjbG9zdXJlIHZhcmlhYmxlcyAoSSBndWVzcyB0aGlzCiAgICAvLyBpcyBpbiBjb250cmFzdCB0byB3aGF0IGNhbiBvbmx5IGJlIGNhbGxlZCBDLXN0eWxlIHBzZXVkby1PTyB3aGljaCBpcwogICAgLy8gd2hhdCB3ZSByZXF1aXJlZCBiZWZvcmUpLgogICAgaWYgKGRlZmluaXRpb24uZmFjdG9yeSkgewogICAgICBkZWZpbml0aW9uID0gY3JlYXRlTGVnYWN5RGVmaW5pdGlvbkFkYXB0ZXIoZGVmaW5pdGlvbik7CiAgICB9CgogICAgaWYgKCFkZWZpbml0aW9uLnJlbmRlclZhbHVlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHJlbmRlclZhbHVlIGZ1bmN0aW9uIik7CiAgICB9CgogICAgLy8gRm9yIHN0YXRpYyByZW5kZXJpbmcgKG5vbi1TaGlueSksIHVzZSBhIHNpbXBsZSB3aWRnZXQgcmVnaXN0cmF0aW9uCiAgICAvLyBzY2hlbWUuIFdlIGFsc28gdXNlIHRoaXMgc2NoZW1lIGZvciBTaGlueSBhcHBzL2RvY3VtZW50cyB0aGF0IGFsc28KICAgIC8vIGNvbnRhaW4gc3RhdGljIHdpZGdldHMuCiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzIHx8IFtdOwogICAgLy8gTWVyZ2UgZGVmYXVsdHMgaW50byB0aGUgZGVmaW5pdGlvbjsgZG9uJ3QgbXV0YXRlIHRoZSBvcmlnaW5hbCBkZWZpbml0aW9uLgogICAgdmFyIHN0YXRpY0JpbmRpbmcgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBkZWZpbml0aW9uKTsKICAgIG92ZXJyaWRlTWV0aG9kKHN0YXRpY0JpbmRpbmcsICJmaW5kIiwgZnVuY3Rpb24oc3VwZXJmdW5jKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbihzY29wZSkgewogICAgICAgIHZhciByZXN1bHRzID0gc3VwZXJmdW5jKHNjb3BlKTsKICAgICAgICAvLyBGaWx0ZXIgb3V0IFNoaW55IG91dHB1dHMsIHdlIG9ubHkgd2FudCB0aGUgc3RhdGljIGtpbmQKICAgICAgICByZXR1cm4gZmlsdGVyQnlDbGFzcyhyZXN1bHRzLCAiaHRtbC13aWRnZXQtb3V0cHV0IiwgZmFsc2UpOwogICAgICB9OwogICAgfSk7CiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cy5wdXNoKHN0YXRpY0JpbmRpbmcpOwoKICAgIGlmIChzaGlueU1vZGUpIHsKICAgICAgLy8gU2hpbnkgaXMgcnVubmluZy4gUmVnaXN0ZXIgdGhlIGRlZmluaXRpb24gd2l0aCBhbiBvdXRwdXQgYmluZGluZy4KICAgICAgLy8gVGhlIGRlZmluaXRpb24gaXRzZWxmIHdpbGwgbm90IGJlIHRoZSBvdXRwdXQgYmluZGluZywgaW5zdGVhZAogICAgICAvLyB3ZSB3aWxsIG1ha2UgYW4gb3V0cHV0IGJpbmRpbmcgb2JqZWN0IHRoYXQgZGVsZWdhdGVzIHRvIHRoZQogICAgICAvLyBkZWZpbml0aW9uLiBUaGlzIGlzIGJlY2F1c2Ugd2UgZm9vbGlzaGx5IHVzZWQgdGhlIHNhbWUgbWV0aG9kCiAgICAgIC8vIG5hbWUgKHJlbmRlclZhbHVlKSBmb3IgaHRtbHdpZGdldHMgZGVmaW5pdGlvbiBhbmQgU2hpbnkgYmluZGluZ3MKICAgICAgLy8gYnV0IHRoZXkgYWN0dWFsbHkgaGF2ZSBxdWl0ZSBkaWZmZXJlbnQgc2VtYW50aWNzICh0aGUgU2hpbnkKICAgICAgLy8gYmluZGluZ3MgcmVjZWl2ZSBkYXRhIHRoYXQgaW5jbHVkZXMgbG90cyBvZiBtZXRhZGF0YSB0aGF0IGl0CiAgICAgIC8vIHN0cmlwcyBvZmYgYmVmb3JlIGNhbGxpbmcgaHRtbHdpZGdldHMgcmVuZGVyVmFsdWUpLiBXZSBjYW4ndAogICAgICAvLyBqdXN0IGlnbm9yZSB0aGUgZGlmZmVyZW5jZSBiZWNhdXNlIGluIHNvbWUgd2lkZ2V0cyBpdCdzIGhlbHBmdWwKICAgICAgLy8gdG8gY2FsbCB0aGlzLnJlbmRlclZhbHVlKCkgZnJvbSBpbnNpZGUgb2YgcmVzaXplKCksIGFuZCBpZgogICAgICAvLyB3ZSdyZSBub3QgZGVsZWdhdGluZywgdGhlbiB0aGF0IGNhbGwgd2lsbCBnbyB0byB0aGUgU2hpbnkKICAgICAgLy8gdmVyc2lvbiBpbnN0ZWFkIG9mIHRoZSBodG1sd2lkZ2V0cyB2ZXJzaW9uLgoKICAgICAgLy8gTWVyZ2UgZGVmYXVsdHMgd2l0aCBkZWZpbml0aW9uLCB3aXRob3V0IG11dGF0aW5nIGVpdGhlci4KICAgICAgdmFyIGJpbmRpbmdEZWYgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBkZWZpbml0aW9uKTsKCiAgICAgIC8vIFRoaXMgb2JqZWN0IHdpbGwgYmUgb3VyIGFjdHVhbCBTaGlueSBiaW5kaW5nLgogICAgICB2YXIgc2hpbnlCaW5kaW5nID0gbmV3IFNoaW55Lk91dHB1dEJpbmRpbmcoKTsKCiAgICAgIC8vIFdpdGggYSBmZXcgZXhjZXB0aW9ucywgd2UnbGwgd2FudCB0byBzaW1wbHkgdXNlIHRoZSBiaW5kaW5nRGVmJ3MKICAgICAgLy8gdmVyc2lvbiBvZiBtZXRob2RzIGlmIHRoZXkgYXJlIGF2YWlsYWJsZSwgb3RoZXJ3aXNlIGZhbGwgYmFjayB0bwogICAgICAvLyBTaGlueSdzIGRlZmF1bHRzLiBOT1RFOiBJZiBTaGlueSdzIG91dHB1dCBiaW5kaW5ncyBnYWluIGFkZGl0aW9uYWwKICAgICAgLy8gbWV0aG9kcyBpbiB0aGUgZnV0dXJlLCBhbmQgd2Ugd2FudCB0aGVtIHRvIGJlIG92ZXJyaWRlYWJsZSBieQogICAgICAvLyBIVE1MV2lkZ2V0IGJpbmRpbmcgZGVmaW5pdGlvbnMsIHRoZW4gd2UnbGwgbmVlZCB0byBhZGQgdGhlbSB0byB0aGlzCiAgICAgIC8vIGxpc3QuCiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgImdldElkIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgIm9uVmFsdWVDaGFuZ2UiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAib25WYWx1ZUVycm9yIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgInJlbmRlckVycm9yIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgImNsZWFyRXJyb3IiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAic2hvd1Byb2dyZXNzIik7CgogICAgICAvLyBUaGUgZmluZCwgcmVuZGVyVmFsdWUsIGFuZCByZXNpemUgYXJlIGhhbmRsZWQgZGlmZmVyZW50bHksIGJlY2F1c2Ugd2UKICAgICAgLy8gd2FudCB0byBhY3R1YWxseSBkZWNvcmF0ZSB0aGUgYmVoYXZpb3Igb2YgdGhlIGJpbmRpbmdEZWYgbWV0aG9kcy4KCiAgICAgIHNoaW55QmluZGluZy5maW5kID0gZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgICB2YXIgcmVzdWx0cyA9IGJpbmRpbmdEZWYuZmluZChzY29wZSk7CgogICAgICAgIC8vIE9ubHkgcmV0dXJuIGVsZW1lbnRzIHRoYXQgYXJlIFNoaW55IG91dHB1dHMsIG5vdCBzdGF0aWMgb25lcwogICAgICAgIHZhciBkeW5hbWljUmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKCIuaHRtbC13aWRnZXQtb3V0cHV0Iik7CgogICAgICAgIC8vIEl0J3MgcG9zc2libGUgdGhhdCB3aGF0ZXZlciBjYXVzZWQgU2hpbnkgdG8gdGhpbmsgdGhlcmUgbWlnaHQgYmUKICAgICAgICAvLyBuZXcgZHluYW1pYyBvdXRwdXRzLCBhbHNvIGNhdXNlZCB0aGVyZSB0byBiZSBuZXcgc3RhdGljIG91dHB1dHMuCiAgICAgICAgLy8gU2luY2UgdGhlcmUgbWlnaHQgYmUgbG90cyBvZiBkaWZmZXJlbnQgaHRtbHdpZGdldHMgYmluZGluZ3MsIHdlCiAgICAgICAgLy8gc2NoZWR1bGUgZXhlY3V0aW9uIGZvciBsYXRlci0tbm8gbmVlZCB0byBzdGF0aWNSZW5kZXIgbXVsdGlwbGUKICAgICAgICAvLyB0aW1lcy4KICAgICAgICBpZiAocmVzdWx0cy5sZW5ndGggIT09IGR5bmFtaWNSZXN1bHRzLmxlbmd0aCkKICAgICAgICAgIHNjaGVkdWxlU3RhdGljUmVuZGVyKCk7CgogICAgICAgIHJldHVybiBkeW5hbWljUmVzdWx0czsKICAgICAgfTsKCiAgICAgIC8vIFdyYXAgcmVuZGVyVmFsdWUgdG8gaGFuZGxlIGluaXRpYWxpemF0aW9uLCB3aGljaCB1bmZvcnR1bmF0ZWx5IGlzbid0CiAgICAgIC8vIHN1cHBvcnRlZCBuYXRpdmVseSBieSBTaGlueSBhdCB0aGUgdGltZSBvZiB0aGlzIHdyaXRpbmcuCgogICAgICBzaGlueUJpbmRpbmcucmVuZGVyVmFsdWUgPSBmdW5jdGlvbihlbCwgZGF0YSkgewogICAgICAgIC8vIFJlc29sdmUgc3RyaW5ncyBtYXJrZWQgYXMgamF2YXNjcmlwdCBsaXRlcmFscyB0byBvYmplY3RzCiAgICAgICAgaWYgKCEoZGF0YS5ldmFscyBpbnN0YW5jZW9mIEFycmF5KSkgZGF0YS5ldmFscyA9IFtkYXRhLmV2YWxzXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgZGF0YS5ldmFscyAmJiBpIDwgZGF0YS5ldmFscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLmV2YWx1YXRlU3RyaW5nTWVtYmVyKGRhdGEueCwgZGF0YS5ldmFsc1tpXSk7CiAgICAgICAgfQogICAgICAgIGlmICghYmluZGluZ0RlZi5yZW5kZXJPbk51bGxWYWx1ZSkgewogICAgICAgICAgaWYgKGRhdGEueCA9PT0gbnVsbCkgewogICAgICAgICAgICBlbC5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVsLnN0eWxlLnZpc2liaWxpdHkgPSAiaW5oZXJpdCI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghZWxlbWVudERhdGEoZWwsICJpbml0aWFsaXplZCIpKSB7CiAgICAgICAgICBpbml0U2l6aW5nKGVsKTsKCiAgICAgICAgICBlbGVtZW50RGF0YShlbCwgImluaXRpYWxpemVkIiwgdHJ1ZSk7CiAgICAgICAgICBpZiAoYmluZGluZ0RlZi5pbml0aWFsaXplKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBiaW5kaW5nRGVmLmluaXRpYWxpemUoZWwsIGVsLm9mZnNldFdpZHRoLAogICAgICAgICAgICAgIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICAgIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiLCByZXN1bHQpOwogICAgICAgICAgfQogICAgICAgICAgZXZhbEFuZFJ1bihkYXRhLmpzSG9va3MucmVuZGVyLCBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IiksIFtlbCwgZGF0YS54XSk7CiAgICAgICAgfQogICAgICAgIFNoaW55LnJlbmRlckRlcGVuZGVuY2llcyhkYXRhLmRlcHMpOwogICAgICAgIGJpbmRpbmdEZWYucmVuZGVyVmFsdWUoZWwsIGRhdGEueCwgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpKTsKICAgICAgfTsKCiAgICAgIC8vIE9ubHkgb3ZlcnJpZGUgcmVzaXplIGlmIGJpbmRpbmdEZWYgaW1wbGVtZW50cyBpdAogICAgICBpZiAoYmluZGluZ0RlZi5yZXNpemUpIHsKICAgICAgICBzaGlueUJpbmRpbmcucmVzaXplID0gZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgIC8vIFNoaW55IGNhbiBjYWxsIHJlc2l6ZSBiZWZvcmUgaW5pdGlhbGl6ZS9yZW5kZXJWYWx1ZSBoYXZlIGJlZW4KICAgICAgICAgIC8vIGNhbGxlZCwgd2hpY2ggZG9lc24ndCBtYWtlIHNlbnNlIGZvciB3aWRnZXRzLgogICAgICAgICAgaWYgKGVsZW1lbnREYXRhKGVsLCAiaW5pdGlhbGl6ZWQiKSkgewogICAgICAgICAgICBiaW5kaW5nRGVmLnJlc2l6ZShlbCwgd2lkdGgsIGhlaWdodCwgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CgogICAgICBTaGlueS5vdXRwdXRCaW5kaW5ncy5yZWdpc3RlcihzaGlueUJpbmRpbmcsIGJpbmRpbmdEZWYubmFtZSk7CiAgICB9CiAgfTsKCiAgdmFyIHNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCA9IG51bGw7CiAgZnVuY3Rpb24gc2NoZWR1bGVTdGF0aWNSZW5kZXIoKSB7CiAgICBpZiAoIXNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCkgewogICAgICBzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIHNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCA9IG51bGw7CiAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpOwogICAgICB9LCAxKTsKICAgIH0KICB9CgogIC8vIFJlbmRlciBzdGF0aWMgd2lkZ2V0cyBhZnRlciB0aGUgZG9jdW1lbnQgZmluaXNoZXMgbG9hZGluZwogIC8vIFN0YXRpY2FsbHkgcmVuZGVyIGFsbCBlbGVtZW50cyB0aGF0IGFyZSBvZiB0aGlzIHdpZGdldCdzIGNsYXNzCiAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlciA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGJpbmRpbmdzID0gd2luZG93LkhUTUxXaWRnZXRzLndpZGdldHMgfHwgW107CiAgICBmb3JFYWNoKGJpbmRpbmdzLCBmdW5jdGlvbihiaW5kaW5nKSB7CiAgICAgIHZhciBtYXRjaGVzID0gYmluZGluZy5maW5kKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7CiAgICAgIGZvckVhY2gobWF0Y2hlcywgZnVuY3Rpb24oZWwpIHsKICAgICAgICB2YXIgc2l6ZU9iaiA9IGluaXRTaXppbmcoZWwsIGJpbmRpbmcpOwoKICAgICAgICBpZiAoaGFzQ2xhc3MoZWwsICJodG1sLXdpZGdldC1zdGF0aWMtYm91bmQiKSkKICAgICAgICAgIHJldHVybjsKICAgICAgICBlbC5jbGFzc05hbWUgPSBlbC5jbGFzc05hbWUgKyAiIGh0bWwtd2lkZ2V0LXN0YXRpYy1ib3VuZCI7CgogICAgICAgIHZhciBpbml0UmVzdWx0OwogICAgICAgIGlmIChiaW5kaW5nLmluaXRpYWxpemUpIHsKICAgICAgICAgIGluaXRSZXN1bHQgPSBiaW5kaW5nLmluaXRpYWxpemUoZWwsCiAgICAgICAgICAgIHNpemVPYmogPyBzaXplT2JqLmdldFdpZHRoKCkgOiBlbC5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgc2l6ZU9iaiA/IHNpemVPYmouZ2V0SGVpZ2h0KCkgOiBlbC5vZmZzZXRIZWlnaHQKICAgICAgICAgICk7CiAgICAgICAgICBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IiwgaW5pdFJlc3VsdCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYmluZGluZy5yZXNpemUpIHsKICAgICAgICAgIHZhciBsYXN0U2l6ZSA9IHt9OwogICAgICAgICAgdmFyIHJlc2l6ZUhhbmRsZXIgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciBzaXplID0gewogICAgICAgICAgICAgIHc6IHNpemVPYmogPyBzaXplT2JqLmdldFdpZHRoKCkgOiBlbC5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgICBoOiBzaXplT2JqID8gc2l6ZU9iai5nZXRIZWlnaHQoKSA6IGVsLm9mZnNldEhlaWdodAogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoc2l6ZS53ID09PSAwICYmIHNpemUuaCA9PT0gMCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChzaXplLncgPT09IGxhc3RTaXplLncgJiYgc2l6ZS5oID09PSBsYXN0U2l6ZS5oKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgbGFzdFNpemUgPSBzaXplOwogICAgICAgICAgICBiaW5kaW5nLnJlc2l6ZShlbCwgc2l6ZS53LCBzaXplLmgsIGluaXRSZXN1bHQpOwogICAgICAgICAgfTsKCiAgICAgICAgICBvbih3aW5kb3csICJyZXNpemUiLCByZXNpemVIYW5kbGVyKTsKCiAgICAgICAgICAvLyBUaGlzIGlzIG5lZWRlZCBmb3IgY2FzZXMgd2hlcmUgd2UncmUgcnVubmluZyBpbiBhIFNoaW55CiAgICAgICAgICAvLyBhcHAsIGJ1dCB0aGUgd2lkZ2V0IGl0c2VsZiBpcyBub3QgYSBTaGlueSBvdXRwdXQsIGJ1dAogICAgICAgICAgLy8gcmF0aGVyIGEgc2ltcGxlIHN0YXRpYyB3aWRnZXQuIE9uZSBleGFtcGxlIG9mIHRoaXMgaXMKICAgICAgICAgIC8vIGFuIHJtYXJrZG93biBkb2N1bWVudCB0aGF0IGhhcyBydW50aW1lOnNoaW55IGFuZCB3aWRnZXQKICAgICAgICAgIC8vIHRoYXQgaXNuJ3QgaW4gYSByZW5kZXIgZnVuY3Rpb24uIFNoaW55IG9ubHkga25vd3MgdG8KICAgICAgICAgIC8vIGNhbGwgcmVzaXplIGhhbmRsZXJzIGZvciBTaGlueSBvdXRwdXRzLCBub3QgZm9yIHN0YXRpYwogICAgICAgICAgLy8gd2lkZ2V0cywgc28gd2UgZG8gaXQgb3Vyc2VsdmVzLgogICAgICAgICAgaWYgKHdpbmRvdy5qUXVlcnkpIHsKICAgICAgICAgICAgd2luZG93LmpRdWVyeShkb2N1bWVudCkub24oInNob3duLmh0bWx3aWRnZXRzIHNob3duLmJzLnRhYi5odG1sd2lkZ2V0cyIsIHJlc2l6ZUhhbmRsZXIpOwogICAgICAgICAgICB3aW5kb3cualF1ZXJ5KGRvY3VtZW50KS5vbigiaGlkZGVuLmh0bWx3aWRnZXRzIGhpZGRlbi5icy50YWIuaHRtbHdpZGdldHMiLCByZXNpemVIYW5kbGVyKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBUaGlzIGlzIG5lZWRlZCBmb3IgdGhlIHNwZWNpZmljIGNhc2Ugb2YgaW9zbGlkZXMsIHdoaWNoCiAgICAgICAgICAvLyBmbGlwcyBzbGlkZXMgYmV0d2VlbiBkaXNwbGF5Om5vbmUgYW5kIGRpc3BsYXk6YmxvY2suCiAgICAgICAgICAvLyBJZGVhbGx5IHdlIHdvdWxkIG5vdCBoYXZlIHRvIGhhdmUgaW9zbGlkZS1zcGVjaWZpYyBjb2RlCiAgICAgICAgICAvLyBoZXJlLCBidXQgcmF0aGVyIGhhdmUgaW9zbGlkZXMgcmFpc2UgYSBnZW5lcmljIGV2ZW50LAogICAgICAgICAgLy8gYnV0IHRoZSBybWFya2Rvd24gcGFja2FnZSBqdXN0IHdlbnQgdG8gQ1JBTiBzbyB0aGUKICAgICAgICAgIC8vIHdpbmRvdyB0byBnZXR0aW5nIHRoYXQgZml4ZWQgbWF5IGJlIGxvbmcuCiAgICAgICAgICBpZiAod2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgICAgICAgLy8gSXQncyBPSyB0byBsaW1pdCB0aGlzIHRvIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyCiAgICAgICAgICAgIC8vIGJyb3dzZXJzIGJlY2F1c2UgaW9zbGlkZXMgaXRzZWxmIG9ubHkgc3VwcG9ydHMKICAgICAgICAgICAgLy8gc3VjaCBicm93c2Vycy4KICAgICAgICAgICAgb24oZG9jdW1lbnQsICJzbGlkZWVudGVyIiwgcmVzaXplSGFuZGxlcik7CiAgICAgICAgICAgIG9uKGRvY3VtZW50LCAic2xpZGVsZWF2ZSIsIHJlc2l6ZUhhbmRsZXIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIHNjcmlwdERhdGEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJzY3JpcHRbZGF0YS1mb3I9JyIgKyBlbC5pZCArICInXVt0eXBlPSdhcHBsaWNhdGlvbi9qc29uJ10iKTsKICAgICAgICBpZiAoc2NyaXB0RGF0YSkgewogICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKHNjcmlwdERhdGEudGV4dENvbnRlbnQgfHwgc2NyaXB0RGF0YS50ZXh0KTsKICAgICAgICAgIC8vIFJlc29sdmUgc3RyaW5ncyBtYXJrZWQgYXMgamF2YXNjcmlwdCBsaXRlcmFscyB0byBvYmplY3RzCiAgICAgICAgICBpZiAoIShkYXRhLmV2YWxzIGluc3RhbmNlb2YgQXJyYXkpKSBkYXRhLmV2YWxzID0gW2RhdGEuZXZhbHNdOwogICAgICAgICAgZm9yICh2YXIgayA9IDA7IGRhdGEuZXZhbHMgJiYgayA8IGRhdGEuZXZhbHMubGVuZ3RoOyBrKyspIHsKICAgICAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLmV2YWx1YXRlU3RyaW5nTWVtYmVyKGRhdGEueCwgZGF0YS5ldmFsc1trXSk7CiAgICAgICAgICB9CiAgICAgICAgICBiaW5kaW5nLnJlbmRlclZhbHVlKGVsLCBkYXRhLngsIGluaXRSZXN1bHQpOwogICAgICAgICAgZXZhbEFuZFJ1bihkYXRhLmpzSG9va3MucmVuZGVyLCBpbml0UmVzdWx0LCBbZWwsIGRhdGEueF0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKCiAgICBpbnZva2VQb3N0UmVuZGVySGFuZGxlcnMoKTsKICB9CgogIC8vIFdhaXQgdW50aWwgYWZ0ZXIgdGhlIGRvY3VtZW50IGhhcyBsb2FkZWQgdG8gcmVuZGVyIHRoZSB3aWRnZXRzLgogIGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgZnVuY3Rpb24oKSB7CiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBhcmd1bWVudHMuY2FsbGVlLCBmYWxzZSk7CiAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTsKICAgIH0sIGZhbHNlKTsKICB9IGVsc2UgaWYgKGRvY3VtZW50LmF0dGFjaEV2ZW50KSB7CiAgICBkb2N1bWVudC5hdHRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIiwgZnVuY3Rpb24oKSB7CiAgICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiKSB7CiAgICAgICAgZG9jdW1lbnQuZGV0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGFyZ3VtZW50cy5jYWxsZWUpOwogICAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTsKICAgICAgfQogICAgfSk7CiAgfQoKCiAgd2luZG93LkhUTUxXaWRnZXRzLmdldEF0dGFjaG1lbnRVcmwgPSBmdW5jdGlvbihkZXBuYW1lLCBrZXkpIHsKICAgIC8vIElmIG5vIGtleSwgZGVmYXVsdCB0byB0aGUgZmlyc3QgaXRlbQogICAgaWYgKHR5cGVvZihrZXkpID09PSAidW5kZWZpbmVkIikKICAgICAga2V5ID0gMTsKCiAgICB2YXIgbGluayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRlcG5hbWUgKyAiLSIgKyBrZXkgKyAiLWF0dGFjaG1lbnQiKTsKICAgIGlmICghbGluaykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkF0dGFjaG1lbnQgIiArIGRlcG5hbWUgKyAiLyIgKyBrZXkgKyAiIG5vdCBmb3VuZCBpbiBkb2N1bWVudCIpOwogICAgfQogICAgcmV0dXJuIGxpbmsuZ2V0QXR0cmlidXRlKCJocmVmIik7CiAgfTsKCiAgd2luZG93LkhUTUxXaWRnZXRzLmRhdGFmcmFtZVRvRDMgPSBmdW5jdGlvbihkZikgewogICAgdmFyIG5hbWVzID0gW107CiAgICB2YXIgbGVuZ3RoOwogICAgZm9yICh2YXIgbmFtZSBpbiBkZikgewogICAgICAgIGlmIChkZi5oYXNPd25Qcm9wZXJ0eShuYW1lKSkKICAgICAgICAgICAgbmFtZXMucHVzaChuYW1lKTsKICAgICAgICBpZiAodHlwZW9mKGRmW25hbWVdKSAhPT0gIm9iamVjdCIgfHwgdHlwZW9mKGRmW25hbWVdLmxlbmd0aCkgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQWxsIGZpZWxkcyBtdXN0IGJlIGFycmF5cyIpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mKGxlbmd0aCkgIT09ICJ1bmRlZmluZWQiICYmIGxlbmd0aCAhPT0gZGZbbmFtZV0ubGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQWxsIGZpZWxkcyBtdXN0IGJlIGFycmF5cyBvZiB0aGUgc2FtZSBsZW5ndGgiKTsKICAgICAgICB9CiAgICAgICAgbGVuZ3RoID0gZGZbbmFtZV0ubGVuZ3RoOwogICAgfQogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHZhciBpdGVtOwogICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgbGVuZ3RoOyByb3crKykgewogICAgICAgIGl0ZW0gPSB7fTsKICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCBuYW1lcy5sZW5ndGg7IGNvbCsrKSB7CiAgICAgICAgICAgIGl0ZW1bbmFtZXNbY29sXV0gPSBkZltuYW1lc1tjb2xdXVtyb3ddOwogICAgICAgIH0KICAgICAgICByZXN1bHRzLnB1c2goaXRlbSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICB3aW5kb3cuSFRNTFdpZGdldHMudHJhbnNwb3NlQXJyYXkyRCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICAgIGlmIChhcnJheS5sZW5ndGggPT09IDApIHJldHVybiBhcnJheTsKICAgICAgdmFyIG5ld0FycmF5ID0gYXJyYXlbMF0ubWFwKGZ1bmN0aW9uKGNvbCwgaSkgewogICAgICAgICAgcmV0dXJuIGFycmF5Lm1hcChmdW5jdGlvbihyb3cpIHsKICAgICAgICAgICAgICByZXR1cm4gcm93W2ldCiAgICAgICAgICB9KQogICAgICB9KTsKICAgICAgcmV0dXJuIG5ld0FycmF5OwogIH07CiAgLy8gU3BsaXQgdmFsdWUgYXQgc3BsaXRDaGFyLCBidXQgYWxsb3cgc3BsaXRDaGFyIHRvIGJlIGVzY2FwZWQKICAvLyB1c2luZyBlc2NhcGVDaGFyLiBBbnkgb3RoZXIgY2hhcmFjdGVycyBlc2NhcGVkIGJ5IGVzY2FwZUNoYXIKICAvLyB3aWxsIGJlIGluY2x1ZGVkIGFzIHVzdWFsIChpbmNsdWRpbmcgZXNjYXBlQ2hhciBpdHNlbGYpLgogIGZ1bmN0aW9uIHNwbGl0V2l0aEVzY2FwZSh2YWx1ZSwgc3BsaXRDaGFyLCBlc2NhcGVDaGFyKSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgdmFyIGVzY2FwZU1vZGUgPSBmYWxzZTsKICAgIHZhciBjdXJyZW50UmVzdWx0ID0gIiI7CiAgICBmb3IgKHZhciBwb3MgPSAwOyBwb3MgPCB2YWx1ZS5sZW5ndGg7IHBvcysrKSB7CiAgICAgIGlmICghZXNjYXBlTW9kZSkgewogICAgICAgIGlmICh2YWx1ZVtwb3NdID09PSBzcGxpdENoYXIpIHsKICAgICAgICAgIHJlc3VsdHMucHVzaChjdXJyZW50UmVzdWx0KTsKICAgICAgICAgIGN1cnJlbnRSZXN1bHQgPSAiIjsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlW3Bvc10gPT09IGVzY2FwZUNoYXIpIHsKICAgICAgICAgIGVzY2FwZU1vZGUgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdXJyZW50UmVzdWx0ICs9IHZhbHVlW3Bvc107CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGN1cnJlbnRSZXN1bHQgKz0gdmFsdWVbcG9zXTsKICAgICAgICBlc2NhcGVNb2RlID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGlmIChjdXJyZW50UmVzdWx0ICE9PSAiIikgewogICAgICByZXN1bHRzLnB1c2goY3VycmVudFJlc3VsdCk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9CiAgLy8gRnVuY3Rpb24gYXV0aG9yZWQgYnkgWWlodWkvSkogQWxsYWlyZQogIHdpbmRvdy5IVE1MV2lkZ2V0cy5ldmFsdWF0ZVN0cmluZ01lbWJlciA9IGZ1bmN0aW9uKG8sIG1lbWJlcikgewogICAgdmFyIHBhcnRzID0gc3BsaXRXaXRoRXNjYXBlKG1lbWJlciwgJy4nLCAnXFwnKTsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gcGFydHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIHZhciBwYXJ0ID0gcGFydHNbaV07CiAgICAgIC8vIHBhcnQgbWF5IGJlIGEgY2hhcmFjdGVyIG9yICdudW1lcmljJyBtZW1iZXIgbmFtZQogICAgICBpZiAobyAhPT0gbnVsbCAmJiB0eXBlb2YgbyA9PT0gIm9iamVjdCIgJiYgcGFydCBpbiBvKSB7CiAgICAgICAgaWYgKGkgPT0gKGwgLSAxKSkgeyAvLyBpZiB3ZSBhcmUgYXQgdGhlIGVuZCBvZiB0aGUgbGluZSB0aGVuIGV2YWx1bGF0ZQogICAgICAgICAgaWYgKHR5cGVvZiBvW3BhcnRdID09PSAic3RyaW5nIikKICAgICAgICAgICAgb1twYXJ0XSA9IGV2YWwoIigiICsgb1twYXJ0XSArICIpIik7CiAgICAgICAgfSBlbHNlIHsgLy8gb3RoZXJ3aXNlIGNvbnRpbnVlIHRvIG5leHQgZW1iZWRkZWQgb2JqZWN0CiAgICAgICAgICBvID0gb1twYXJ0XTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvLyBSZXRyaWV2ZSB0aGUgSFRNTFdpZGdldCBpbnN0YW5jZSAoaS5lLiB0aGUgcmV0dXJuIHZhbHVlIG9mIGFuCiAgLy8gSFRNTFdpZGdldCBiaW5kaW5nJ3MgaW5pdGlhbGl6ZSgpIG9yIGZhY3RvcnkoKSBmdW5jdGlvbikKICAvLyBhc3NvY2lhdGVkIHdpdGggYW4gZWxlbWVudCwgb3IgbnVsbCBpZiBub25lLgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKGVsKSB7CiAgICByZXR1cm4gZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpOwogIH07CgogIC8vIEZpbmRzIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBzY29wZSB0aGF0IG1hdGNoZXMgdGhlIHNlbGVjdG9yLAogIC8vIGFuZCByZXR1cm5zIHRoZSBIVE1MV2lkZ2V0IGluc3RhbmNlIChpLmUuIHRoZSByZXR1cm4gdmFsdWUgb2YKICAvLyBhbiBIVE1MV2lkZ2V0IGJpbmRpbmcncyBpbml0aWFsaXplKCkgb3IgZmFjdG9yeSgpIGZ1bmN0aW9uKQogIC8vIGFzc29jaWF0ZWQgd2l0aCB0aGF0IGVsZW1lbnQsIGlmIGFueS4gSWYgbm8gZWxlbWVudCBtYXRjaGVzIHRoZQogIC8vIHNlbGVjdG9yLCBvciB0aGUgZmlyc3QgbWF0Y2hpbmcgZWxlbWVudCBoYXMgbm8gSFRNTFdpZGdldAogIC8vIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCBpdCwgdGhlbiBudWxsIGlzIHJldHVybmVkLgogIC8vCiAgLy8gVGhlIHNjb3BlIGFyZ3VtZW50IGlzIG9wdGlvbmFsLCBhbmQgZGVmYXVsdHMgdG8gd2luZG93LmRvY3VtZW50LgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5maW5kID0gZnVuY3Rpb24oc2NvcGUsIHNlbGVjdG9yKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7CiAgICAgIHNlbGVjdG9yID0gc2NvcGU7CiAgICAgIHNjb3BlID0gZG9jdW1lbnQ7CiAgICB9CgogICAgdmFyIGVsID0gc2NvcGUucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7CiAgICBpZiAoZWwgPT09IG51bGwpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gd2luZG93LkhUTUxXaWRnZXRzLmdldEluc3RhbmNlKGVsKTsKICAgIH0KICB9OwoKICAvLyBGaW5kcyBhbGwgZWxlbWVudHMgaW4gdGhlIHNjb3BlIHRoYXQgbWF0Y2ggdGhlIHNlbGVjdG9yLCBhbmQKICAvLyByZXR1cm5zIHRoZSBIVE1MV2lkZ2V0IGluc3RhbmNlcyAoaS5lLiB0aGUgcmV0dXJuIHZhbHVlcyBvZgogIC8vIGFuIEhUTUxXaWRnZXQgYmluZGluZydzIGluaXRpYWxpemUoKSBvciBmYWN0b3J5KCkgZnVuY3Rpb24pCiAgLy8gYXNzb2NpYXRlZCB3aXRoIHRoZSBlbGVtZW50cywgaW4gYW4gYXJyYXkuIElmIGVsZW1lbnRzIHRoYXQKICAvLyBtYXRjaCB0aGUgc2VsZWN0b3IgZG9uJ3QgaGF2ZSBhbiBhc3NvY2lhdGVkIEhUTUxXaWRnZXQKICAvLyBpbnN0YW5jZSwgdGhlIHJldHVybmVkIGFycmF5IHdpbGwgY29udGFpbiBudWxscy4KICAvLwogIC8vIFRoZSBzY29wZSBhcmd1bWVudCBpcyBvcHRpb25hbCwgYW5kIGRlZmF1bHRzIHRvIHdpbmRvdy5kb2N1bWVudC4KICB3aW5kb3cuSFRNTFdpZGdldHMuZmluZEFsbCA9IGZ1bmN0aW9uKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSkgewogICAgICBzZWxlY3RvciA9IHNjb3BlOwogICAgICBzY29wZSA9IGRvY3VtZW50OwogICAgfQoKICAgIHZhciBub2RlcyA9IHNjb3BlLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgcmVzdWx0cy5wdXNoKHdpbmRvdy5IVE1MV2lkZ2V0cy5nZXRJbnN0YW5jZShub2Rlc1tpXSkpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgdmFyIHBvc3RSZW5kZXJIYW5kbGVycyA9IFtdOwogIGZ1bmN0aW9uIGludm9rZVBvc3RSZW5kZXJIYW5kbGVycygpIHsKICAgIHdoaWxlIChwb3N0UmVuZGVySGFuZGxlcnMubGVuZ3RoKSB7CiAgICAgIHZhciBoYW5kbGVyID0gcG9zdFJlbmRlckhhbmRsZXJzLnNoaWZ0KCk7CiAgICAgIGlmIChoYW5kbGVyKSB7CiAgICAgICAgaGFuZGxlcigpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZWdpc3RlciB0aGUgZ2l2ZW4gY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgaW52b2tlZCBhZnRlciB0aGUKICAvLyBuZXh0IHRpbWUgc3RhdGljIHdpZGdldHMgYXJlIHJlbmRlcmVkLgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5hZGRQb3N0UmVuZGVySGFuZGxlciA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICBwb3N0UmVuZGVySGFuZGxlcnMucHVzaChjYWxsYmFjayk7CiAgfTsKCiAgLy8gVGFrZXMgYSBuZXctc3R5bGUgaW5zdGFuY2UtYm91bmQgZGVmaW5pdGlvbiwgYW5kIHJldHVybnMgYW4KICAvLyBvbGQtc3R5bGUgY2xhc3MtYm91bmQgZGVmaW5pdGlvbi4gVGhpcyBzYXZlcyB1cyBmcm9tIGhhdmluZwogIC8vIHRvIHJld3JpdGUgYWxsIHRoZSBsb2dpYyBpbiB0aGlzIGZpbGUgdG8gYWNjb21vZGF0ZSBib3RoCiAgLy8gdHlwZXMgb2YgZGVmaW5pdGlvbnMuCiAgZnVuY3Rpb24gY3JlYXRlTGVnYWN5RGVmaW5pdGlvbkFkYXB0ZXIoZGVmbikgewogICAgdmFyIHJlc3VsdCA9IHsKICAgICAgbmFtZTogZGVmbi5uYW1lLAogICAgICB0eXBlOiBkZWZuLnR5cGUsCiAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKGVsLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgcmV0dXJuIGRlZm4uZmFjdG9yeShlbCwgd2lkdGgsIGhlaWdodCk7CiAgICAgIH0sCiAgICAgIHJlbmRlclZhbHVlOiBmdW5jdGlvbihlbCwgeCwgaW5zdGFuY2UpIHsKICAgICAgICByZXR1cm4gaW5zdGFuY2UucmVuZGVyVmFsdWUoeCk7CiAgICAgIH0sCiAgICAgIHJlc2l6ZTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQsIGluc3RhbmNlKSB7CiAgICAgICAgcmV0dXJuIGluc3RhbmNlLnJlc2l6ZSh3aWR0aCwgaGVpZ2h0KTsKICAgICAgfQogICAgfTsKCiAgICBpZiAoZGVmbi5maW5kKQogICAgICByZXN1bHQuZmluZCA9IGRlZm4uZmluZDsKICAgIGlmIChkZWZuLnJlbmRlckVycm9yKQogICAgICByZXN1bHQucmVuZGVyRXJyb3IgPSBkZWZuLnJlbmRlckVycm9yOwogICAgaWYgKGRlZm4uY2xlYXJFcnJvcikKICAgICAgcmVzdWx0LmNsZWFyRXJyb3IgPSBkZWZuLmNsZWFyRXJyb3I7CgogICAgcmV0dXJuIHJlc3VsdDsKICB9Cn0pKCk7Cgo="></script>
<script src="data:application/x-javascript;base64,IWZ1bmN0aW9uKCkgewogIHZhciBkMyA9IHsKICAgIHZlcnNpb246ICIzLjUuMyIKICB9OwogIGlmICghRGF0ZS5ub3cpIERhdGUubm93ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gK25ldyBEYXRlKCk7CiAgfTsKICB2YXIgZDNfYXJyYXlTbGljZSA9IFtdLnNsaWNlLCBkM19hcnJheSA9IGZ1bmN0aW9uKGxpc3QpIHsKICAgIHJldHVybiBkM19hcnJheVNsaWNlLmNhbGwobGlzdCk7CiAgfTsKICB2YXIgZDNfZG9jdW1lbnQgPSBkb2N1bWVudCwgZDNfZG9jdW1lbnRFbGVtZW50ID0gZDNfZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCBkM193aW5kb3cgPSB3aW5kb3c7CiAgdHJ5IHsKICAgIGQzX2FycmF5KGQzX2RvY3VtZW50RWxlbWVudC5jaGlsZE5vZGVzKVswXS5ub2RlVHlwZTsKICB9IGNhdGNoIChlKSB7CiAgICBkM19hcnJheSA9IGZ1bmN0aW9uKGxpc3QpIHsKICAgICAgdmFyIGkgPSBsaXN0Lmxlbmd0aCwgYXJyYXkgPSBuZXcgQXJyYXkoaSk7CiAgICAgIHdoaWxlIChpLS0pIGFycmF5W2ldID0gbGlzdFtpXTsKICAgICAgcmV0dXJuIGFycmF5OwogICAgfTsKICB9CiAgdHJ5IHsKICAgIGQzX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLnN0eWxlLnNldFByb3BlcnR5KCJvcGFjaXR5IiwgMCwgIiIpOwogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICB2YXIgZDNfZWxlbWVudF9wcm90b3R5cGUgPSBkM193aW5kb3cuRWxlbWVudC5wcm90b3R5cGUsIGQzX2VsZW1lbnRfc2V0QXR0cmlidXRlID0gZDNfZWxlbWVudF9wcm90b3R5cGUuc2V0QXR0cmlidXRlLCBkM19lbGVtZW50X3NldEF0dHJpYnV0ZU5TID0gZDNfZWxlbWVudF9wcm90b3R5cGUuc2V0QXR0cmlidXRlTlMsIGQzX3N0eWxlX3Byb3RvdHlwZSA9IGQzX3dpbmRvdy5DU1NTdHlsZURlY2xhcmF0aW9uLnByb3RvdHlwZSwgZDNfc3R5bGVfc2V0UHJvcGVydHkgPSBkM19zdHlsZV9wcm90b3R5cGUuc2V0UHJvcGVydHk7CiAgICBkM19lbGVtZW50X3Byb3RvdHlwZS5zZXRBdHRyaWJ1dGUgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAgICBkM19lbGVtZW50X3NldEF0dHJpYnV0ZS5jYWxsKHRoaXMsIG5hbWUsIHZhbHVlICsgIiIpOwogICAgfTsKICAgIGQzX2VsZW1lbnRfcHJvdG90eXBlLnNldEF0dHJpYnV0ZU5TID0gZnVuY3Rpb24oc3BhY2UsIGxvY2FsLCB2YWx1ZSkgewogICAgICBkM19lbGVtZW50X3NldEF0dHJpYnV0ZU5TLmNhbGwodGhpcywgc3BhY2UsIGxvY2FsLCB2YWx1ZSArICIiKTsKICAgIH07CiAgICBkM19zdHlsZV9wcm90b3R5cGUuc2V0UHJvcGVydHkgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSwgcHJpb3JpdHkpIHsKICAgICAgZDNfc3R5bGVfc2V0UHJvcGVydHkuY2FsbCh0aGlzLCBuYW1lLCB2YWx1ZSArICIiLCBwcmlvcml0eSk7CiAgICB9OwogIH0KICBkMy5hc2NlbmRpbmcgPSBkM19hc2NlbmRpbmc7CiAgZnVuY3Rpb24gZDNfYXNjZW5kaW5nKGEsIGIpIHsKICAgIHJldHVybiBhIDwgYiA/IC0xIDogYSA+IGIgPyAxIDogYSA+PSBiID8gMCA6IE5hTjsKICB9CiAgZDMuZGVzY2VuZGluZyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiBiIDwgYSA/IC0xIDogYiA+IGEgPyAxIDogYiA+PSBhID8gMCA6IE5hTjsKICB9OwogIGQzLm1pbiA9IGZ1bmN0aW9uKGFycmF5LCBmKSB7CiAgICB2YXIgaSA9IC0xLCBuID0gYXJyYXkubGVuZ3RoLCBhLCBiOwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHsKICAgICAgd2hpbGUgKCsraSA8IG4pIGlmICgoYiA9IGFycmF5W2ldKSAhPSBudWxsICYmIGIgPj0gYikgewogICAgICAgIGEgPSBiOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHdoaWxlICgrK2kgPCBuKSBpZiAoKGIgPSBhcnJheVtpXSkgIT0gbnVsbCAmJiBhID4gYikgYSA9IGI7CiAgICB9IGVsc2UgewogICAgICB3aGlsZSAoKytpIDwgbikgaWYgKChiID0gZi5jYWxsKGFycmF5LCBhcnJheVtpXSwgaSkpICE9IG51bGwgJiYgYiA+PSBiKSB7CiAgICAgICAgYSA9IGI7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgd2hpbGUgKCsraSA8IG4pIGlmICgoYiA9IGYuY2FsbChhcnJheSwgYXJyYXlbaV0sIGkpKSAhPSBudWxsICYmIGEgPiBiKSBhID0gYjsKICAgIH0KICAgIHJldHVybiBhOwogIH07CiAgZDMubWF4ID0gZnVuY3Rpb24oYXJyYXksIGYpIHsKICAgIHZhciBpID0gLTEsIG4gPSBhcnJheS5sZW5ndGgsIGEsIGI7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgewogICAgICB3aGlsZSAoKytpIDwgbikgaWYgKChiID0gYXJyYXlbaV0pICE9IG51bGwgJiYgYiA+PSBiKSB7CiAgICAgICAgYSA9IGI7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgd2hpbGUgKCsraSA8IG4pIGlmICgoYiA9IGFycmF5W2ldKSAhPSBudWxsICYmIGIgPiBhKSBhID0gYjsKICAgIH0gZWxzZSB7CiAgICAgIHdoaWxlICgrK2kgPCBuKSBpZiAoKGIgPSBmLmNhbGwoYXJyYXksIGFycmF5W2ldLCBpKSkgIT0gbnVsbCAmJiBiID49IGIpIHsKICAgICAgICBhID0gYjsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICB3aGlsZSAoKytpIDwgbikgaWYgKChiID0gZi5jYWxsKGFycmF5LCBhcnJheVtpXSwgaSkpICE9IG51bGwgJiYgYiA+IGEpIGEgPSBiOwogICAgfQogICAgcmV0dXJuIGE7CiAgfTsKICBkMy5leHRlbnQgPSBmdW5jdGlvbihhcnJheSwgZikgewogICAgdmFyIGkgPSAtMSwgbiA9IGFycmF5Lmxlbmd0aCwgYSwgYiwgYzsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgIHdoaWxlICgrK2kgPCBuKSBpZiAoKGIgPSBhcnJheVtpXSkgIT0gbnVsbCAmJiBiID49IGIpIHsKICAgICAgICBhID0gYyA9IGI7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgd2hpbGUgKCsraSA8IG4pIGlmICgoYiA9IGFycmF5W2ldKSAhPSBudWxsKSB7CiAgICAgICAgaWYgKGEgPiBiKSBhID0gYjsKICAgICAgICBpZiAoYyA8IGIpIGMgPSBiOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB3aGlsZSAoKytpIDwgbikgaWYgKChiID0gZi5jYWxsKGFycmF5LCBhcnJheVtpXSwgaSkpICE9IG51bGwgJiYgYiA+PSBiKSB7CiAgICAgICAgYSA9IGMgPSBiOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHdoaWxlICgrK2kgPCBuKSBpZiAoKGIgPSBmLmNhbGwoYXJyYXksIGFycmF5W2ldLCBpKSkgIT0gbnVsbCkgewogICAgICAgIGlmIChhID4gYikgYSA9IGI7CiAgICAgICAgaWYgKGMgPCBiKSBjID0gYjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIFsgYSwgYyBdOwogIH07CiAgZnVuY3Rpb24gZDNfbnVtYmVyKHgpIHsKICAgIHJldHVybiB4ID09PSBudWxsID8gTmFOIDogK3g7CiAgfQogIGZ1bmN0aW9uIGQzX251bWVyaWMoeCkgewogICAgcmV0dXJuICFpc05hTih4KTsKICB9CiAgZDMuc3VtID0gZnVuY3Rpb24oYXJyYXksIGYpIHsKICAgIHZhciBzID0gMCwgbiA9IGFycmF5Lmxlbmd0aCwgYSwgaSA9IC0xOwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHsKICAgICAgd2hpbGUgKCsraSA8IG4pIGlmIChkM19udW1lcmljKGEgPSArYXJyYXlbaV0pKSBzICs9IGE7CiAgICB9IGVsc2UgewogICAgICB3aGlsZSAoKytpIDwgbikgaWYgKGQzX251bWVyaWMoYSA9ICtmLmNhbGwoYXJyYXksIGFycmF5W2ldLCBpKSkpIHMgKz0gYTsKICAgIH0KICAgIHJldHVybiBzOwogIH07CiAgZDMubWVhbiA9IGZ1bmN0aW9uKGFycmF5LCBmKSB7CiAgICB2YXIgcyA9IDAsIG4gPSBhcnJheS5sZW5ndGgsIGEsIGkgPSAtMSwgaiA9IG47CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgewogICAgICB3aGlsZSAoKytpIDwgbikgaWYgKGQzX251bWVyaWMoYSA9IGQzX251bWJlcihhcnJheVtpXSkpKSBzICs9IGE7IGVsc2UgLS1qOwogICAgfSBlbHNlIHsKICAgICAgd2hpbGUgKCsraSA8IG4pIGlmIChkM19udW1lcmljKGEgPSBkM19udW1iZXIoZi5jYWxsKGFycmF5LCBhcnJheVtpXSwgaSkpKSkgcyArPSBhOyBlbHNlIC0tajsKICAgIH0KICAgIGlmIChqKSByZXR1cm4gcyAvIGo7CiAgfTsKICBkMy5xdWFudGlsZSA9IGZ1bmN0aW9uKHZhbHVlcywgcCkgewogICAgdmFyIEggPSAodmFsdWVzLmxlbmd0aCAtIDEpICogcCArIDEsIGggPSBNYXRoLmZsb29yKEgpLCB2ID0gK3ZhbHVlc1toIC0gMV0sIGUgPSBIIC0gaDsKICAgIHJldHVybiBlID8gdiArIGUgKiAodmFsdWVzW2hdIC0gdikgOiB2OwogIH07CiAgZDMubWVkaWFuID0gZnVuY3Rpb24oYXJyYXksIGYpIHsKICAgIHZhciBudW1iZXJzID0gW10sIG4gPSBhcnJheS5sZW5ndGgsIGEsIGkgPSAtMTsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgIHdoaWxlICgrK2kgPCBuKSBpZiAoZDNfbnVtZXJpYyhhID0gZDNfbnVtYmVyKGFycmF5W2ldKSkpIG51bWJlcnMucHVzaChhKTsKICAgIH0gZWxzZSB7CiAgICAgIHdoaWxlICgrK2kgPCBuKSBpZiAoZDNfbnVtZXJpYyhhID0gZDNfbnVtYmVyKGYuY2FsbChhcnJheSwgYXJyYXlbaV0sIGkpKSkpIG51bWJlcnMucHVzaChhKTsKICAgIH0KICAgIGlmIChudW1iZXJzLmxlbmd0aCkgcmV0dXJuIGQzLnF1YW50aWxlKG51bWJlcnMuc29ydChkM19hc2NlbmRpbmcpLCAuNSk7CiAgfTsKICBkMy52YXJpYW5jZSA9IGZ1bmN0aW9uKGFycmF5LCBmKSB7CiAgICB2YXIgbiA9IGFycmF5Lmxlbmd0aCwgbSA9IDAsIGEsIGQsIHMgPSAwLCBpID0gLTEsIGogPSAwOwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHsKICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICBpZiAoZDNfbnVtZXJpYyhhID0gZDNfbnVtYmVyKGFycmF5W2ldKSkpIHsKICAgICAgICAgIGQgPSBhIC0gbTsKICAgICAgICAgIG0gKz0gZCAvICsrajsKICAgICAgICAgIHMgKz0gZCAqIChhIC0gbSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgIGlmIChkM19udW1lcmljKGEgPSBkM19udW1iZXIoZi5jYWxsKGFycmF5LCBhcnJheVtpXSwgaSkpKSkgewogICAgICAgICAgZCA9IGEgLSBtOwogICAgICAgICAgbSArPSBkIC8gKytqOwogICAgICAgICAgcyArPSBkICogKGEgLSBtKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChqID4gMSkgcmV0dXJuIHMgLyAoaiAtIDEpOwogIH07CiAgZDMuZGV2aWF0aW9uID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgdiA9IGQzLnZhcmlhbmNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICByZXR1cm4gdiA/IE1hdGguc3FydCh2KSA6IHY7CiAgfTsKICBmdW5jdGlvbiBkM19iaXNlY3Rvcihjb21wYXJlKSB7CiAgICByZXR1cm4gewogICAgICBsZWZ0OiBmdW5jdGlvbihhLCB4LCBsbywgaGkpIHsKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDMpIGxvID0gMDsKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDQpIGhpID0gYS5sZW5ndGg7CiAgICAgICAgd2hpbGUgKGxvIDwgaGkpIHsKICAgICAgICAgIHZhciBtaWQgPSBsbyArIGhpID4+PiAxOwogICAgICAgICAgaWYgKGNvbXBhcmUoYVttaWRdLCB4KSA8IDApIGxvID0gbWlkICsgMTsgZWxzZSBoaSA9IG1pZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxvOwogICAgICB9LAogICAgICByaWdodDogZnVuY3Rpb24oYSwgeCwgbG8sIGhpKSB7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAzKSBsbyA9IDA7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCA0KSBoaSA9IGEubGVuZ3RoOwogICAgICAgIHdoaWxlIChsbyA8IGhpKSB7CiAgICAgICAgICB2YXIgbWlkID0gbG8gKyBoaSA+Pj4gMTsKICAgICAgICAgIGlmIChjb21wYXJlKGFbbWlkXSwgeCkgPiAwKSBoaSA9IG1pZDsgZWxzZSBsbyA9IG1pZCArIDE7CiAgICAgICAgfQogICAgICAgIHJldHVybiBsbzsKICAgICAgfQogICAgfTsKICB9CiAgdmFyIGQzX2Jpc2VjdCA9IGQzX2Jpc2VjdG9yKGQzX2FzY2VuZGluZyk7CiAgZDMuYmlzZWN0TGVmdCA9IGQzX2Jpc2VjdC5sZWZ0OwogIGQzLmJpc2VjdCA9IGQzLmJpc2VjdFJpZ2h0ID0gZDNfYmlzZWN0LnJpZ2h0OwogIGQzLmJpc2VjdG9yID0gZnVuY3Rpb24oZikgewogICAgcmV0dXJuIGQzX2Jpc2VjdG9yKGYubGVuZ3RoID09PSAxID8gZnVuY3Rpb24oZCwgeCkgewogICAgICByZXR1cm4gZDNfYXNjZW5kaW5nKGYoZCksIHgpOwogICAgfSA6IGYpOwogIH07CiAgZDMuc2h1ZmZsZSA9IGZ1bmN0aW9uKGFycmF5LCBpMCwgaTEpIHsKICAgIGlmICgobSA9IGFyZ3VtZW50cy5sZW5ndGgpIDwgMykgewogICAgICBpMSA9IGFycmF5Lmxlbmd0aDsKICAgICAgaWYgKG0gPCAyKSBpMCA9IDA7CiAgICB9CiAgICB2YXIgbSA9IGkxIC0gaTAsIHQsIGk7CiAgICB3aGlsZSAobSkgewogICAgICBpID0gTWF0aC5yYW5kb20oKSAqIG0tLSB8IDA7CiAgICAgIHQgPSBhcnJheVttICsgaTBdLCBhcnJheVttICsgaTBdID0gYXJyYXlbaSArIGkwXSwgYXJyYXlbaSArIGkwXSA9IHQ7CiAgICB9CiAgICByZXR1cm4gYXJyYXk7CiAgfTsKICBkMy5wZXJtdXRlID0gZnVuY3Rpb24oYXJyYXksIGluZGV4ZXMpIHsKICAgIHZhciBpID0gaW5kZXhlcy5sZW5ndGgsIHBlcm11dGVzID0gbmV3IEFycmF5KGkpOwogICAgd2hpbGUgKGktLSkgcGVybXV0ZXNbaV0gPSBhcnJheVtpbmRleGVzW2ldXTsKICAgIHJldHVybiBwZXJtdXRlczsKICB9OwogIGQzLnBhaXJzID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgIHZhciBpID0gMCwgbiA9IGFycmF5Lmxlbmd0aCAtIDEsIHAwLCBwMSA9IGFycmF5WzBdLCBwYWlycyA9IG5ldyBBcnJheShuIDwgMCA/IDAgOiBuKTsKICAgIHdoaWxlIChpIDwgbikgcGFpcnNbaV0gPSBbIHAwID0gcDEsIHAxID0gYXJyYXlbKytpXSBdOwogICAgcmV0dXJuIHBhaXJzOwogIH07CiAgZDMuemlwID0gZnVuY3Rpb24oKSB7CiAgICBpZiAoIShuID0gYXJndW1lbnRzLmxlbmd0aCkpIHJldHVybiBbXTsKICAgIGZvciAodmFyIGkgPSAtMSwgbSA9IGQzLm1pbihhcmd1bWVudHMsIGQzX3ppcExlbmd0aCksIHppcHMgPSBuZXcgQXJyYXkobSk7ICsraSA8IG07ICkgewogICAgICBmb3IgKHZhciBqID0gLTEsIG4sIHppcCA9IHppcHNbaV0gPSBuZXcgQXJyYXkobik7ICsraiA8IG47ICkgewogICAgICAgIHppcFtqXSA9IGFyZ3VtZW50c1tqXVtpXTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHppcHM7CiAgfTsKICBmdW5jdGlvbiBkM196aXBMZW5ndGgoZCkgewogICAgcmV0dXJuIGQubGVuZ3RoOwogIH0KICBkMy50cmFuc3Bvc2UgPSBmdW5jdGlvbihtYXRyaXgpIHsKICAgIHJldHVybiBkMy56aXAuYXBwbHkoZDMsIG1hdHJpeCk7CiAgfTsKICBkMy5rZXlzID0gZnVuY3Rpb24obWFwKSB7CiAgICB2YXIga2V5cyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG1hcCkga2V5cy5wdXNoKGtleSk7CiAgICByZXR1cm4ga2V5czsKICB9OwogIGQzLnZhbHVlcyA9IGZ1bmN0aW9uKG1hcCkgewogICAgdmFyIHZhbHVlcyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG1hcCkgdmFsdWVzLnB1c2gobWFwW2tleV0pOwogICAgcmV0dXJuIHZhbHVlczsKICB9OwogIGQzLmVudHJpZXMgPSBmdW5jdGlvbihtYXApIHsKICAgIHZhciBlbnRyaWVzID0gW107CiAgICBmb3IgKHZhciBrZXkgaW4gbWFwKSBlbnRyaWVzLnB1c2goewogICAgICBrZXk6IGtleSwKICAgICAgdmFsdWU6IG1hcFtrZXldCiAgICB9KTsKICAgIHJldHVybiBlbnRyaWVzOwogIH07CiAgZDMubWVyZ2UgPSBmdW5jdGlvbihhcnJheXMpIHsKICAgIHZhciBuID0gYXJyYXlzLmxlbmd0aCwgbSwgaSA9IC0xLCBqID0gMCwgbWVyZ2VkLCBhcnJheTsKICAgIHdoaWxlICgrK2kgPCBuKSBqICs9IGFycmF5c1tpXS5sZW5ndGg7CiAgICBtZXJnZWQgPSBuZXcgQXJyYXkoaik7CiAgICB3aGlsZSAoLS1uID49IDApIHsKICAgICAgYXJyYXkgPSBhcnJheXNbbl07CiAgICAgIG0gPSBhcnJheS5sZW5ndGg7CiAgICAgIHdoaWxlICgtLW0gPj0gMCkgewogICAgICAgIG1lcmdlZFstLWpdID0gYXJyYXlbbV07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBtZXJnZWQ7CiAgfTsKICB2YXIgYWJzID0gTWF0aC5hYnM7CiAgZDMucmFuZ2UgPSBmdW5jdGlvbihzdGFydCwgc3RvcCwgc3RlcCkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAzKSB7CiAgICAgIHN0ZXAgPSAxOwogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHsKICAgICAgICBzdG9wID0gc3RhcnQ7CiAgICAgICAgc3RhcnQgPSAwOwogICAgICB9CiAgICB9CiAgICBpZiAoKHN0b3AgLSBzdGFydCkgLyBzdGVwID09PSBJbmZpbml0eSkgdGhyb3cgbmV3IEVycm9yKCJpbmZpbml0ZSByYW5nZSIpOwogICAgdmFyIHJhbmdlID0gW10sIGsgPSBkM19yYW5nZV9pbnRlZ2VyU2NhbGUoYWJzKHN0ZXApKSwgaSA9IC0xLCBqOwogICAgc3RhcnQgKj0gaywgc3RvcCAqPSBrLCBzdGVwICo9IGs7CiAgICBpZiAoc3RlcCA8IDApIHdoaWxlICgoaiA9IHN0YXJ0ICsgc3RlcCAqICsraSkgPiBzdG9wKSByYW5nZS5wdXNoKGogLyBrKTsgZWxzZSB3aGlsZSAoKGogPSBzdGFydCArIHN0ZXAgKiArK2kpIDwgc3RvcCkgcmFuZ2UucHVzaChqIC8gayk7CiAgICByZXR1cm4gcmFuZ2U7CiAgfTsKICBmdW5jdGlvbiBkM19yYW5nZV9pbnRlZ2VyU2NhbGUoeCkgewogICAgdmFyIGsgPSAxOwogICAgd2hpbGUgKHggKiBrICUgMSkgayAqPSAxMDsKICAgIHJldHVybiBrOwogIH0KICBmdW5jdGlvbiBkM19jbGFzcyhjdG9yLCBwcm9wZXJ0aWVzKSB7CiAgICBmb3IgKHZhciBrZXkgaW4gcHJvcGVydGllcykgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoY3Rvci5wcm90b3R5cGUsIGtleSwgewogICAgICAgIHZhbHVlOiBwcm9wZXJ0aWVzW2tleV0sCiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UKICAgICAgfSk7CiAgICB9CiAgfQogIGQzLm1hcCA9IGZ1bmN0aW9uKG9iamVjdCwgZikgewogICAgdmFyIG1hcCA9IG5ldyBkM19NYXAoKTsKICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBkM19NYXApIHsKICAgICAgb2JqZWN0LmZvckVhY2goZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgICAgIG1hcC5zZXQoa2V5LCB2YWx1ZSk7CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iamVjdCkpIHsKICAgICAgdmFyIGkgPSAtMSwgbiA9IG9iamVjdC5sZW5ndGgsIG87CiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB3aGlsZSAoKytpIDwgbikgbWFwLnNldChpLCBvYmplY3RbaV0pOyBlbHNlIHdoaWxlICgrK2kgPCBuKSBtYXAuc2V0KGYuY2FsbChvYmplY3QsIG8gPSBvYmplY3RbaV0sIGkpLCBvKTsKICAgIH0gZWxzZSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBvYmplY3QpIG1hcC5zZXQoa2V5LCBvYmplY3Rba2V5XSk7CiAgICB9CiAgICByZXR1cm4gbWFwOwogIH07CiAgZnVuY3Rpb24gZDNfTWFwKCkgewogICAgdGhpcy5fID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICB9CiAgdmFyIGQzX21hcF9wcm90byA9ICJfX3Byb3RvX18iLCBkM19tYXBfemVybyA9ICJceDAwIjsKICBkM19jbGFzcyhkM19NYXAsIHsKICAgIGhhczogZDNfbWFwX2hhcywKICAgIGdldDogZnVuY3Rpb24oa2V5KSB7CiAgICAgIHJldHVybiB0aGlzLl9bZDNfbWFwX2VzY2FwZShrZXkpXTsKICAgIH0sCiAgICBzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgICAgcmV0dXJuIHRoaXMuX1tkM19tYXBfZXNjYXBlKGtleSldID0gdmFsdWU7CiAgICB9LAogICAgcmVtb3ZlOiBkM19tYXBfcmVtb3ZlLAogICAga2V5czogZDNfbWFwX2tleXMsCiAgICB2YWx1ZXM6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdmFsdWVzID0gW107CiAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLl8pIHZhbHVlcy5wdXNoKHRoaXMuX1trZXldKTsKICAgICAgcmV0dXJuIHZhbHVlczsKICAgIH0sCiAgICBlbnRyaWVzOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGVudHJpZXMgPSBbXTsKICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMuXykgZW50cmllcy5wdXNoKHsKICAgICAgICBrZXk6IGQzX21hcF91bmVzY2FwZShrZXkpLAogICAgICAgIHZhbHVlOiB0aGlzLl9ba2V5XQogICAgICB9KTsKICAgICAgcmV0dXJuIGVudHJpZXM7CiAgICB9LAogICAgc2l6ZTogZDNfbWFwX3NpemUsCiAgICBlbXB0eTogZDNfbWFwX2VtcHR5LAogICAgZm9yRWFjaDogZnVuY3Rpb24oZikgewogICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5fKSBmLmNhbGwodGhpcywgZDNfbWFwX3VuZXNjYXBlKGtleSksIHRoaXMuX1trZXldKTsKICAgIH0KICB9KTsKICBmdW5jdGlvbiBkM19tYXBfZXNjYXBlKGtleSkgewogICAgcmV0dXJuIChrZXkgKz0gIiIpID09PSBkM19tYXBfcHJvdG8gfHwga2V5WzBdID09PSBkM19tYXBfemVybyA/IGQzX21hcF96ZXJvICsga2V5IDoga2V5OwogIH0KICBmdW5jdGlvbiBkM19tYXBfdW5lc2NhcGUoa2V5KSB7CiAgICByZXR1cm4gKGtleSArPSAiIilbMF0gPT09IGQzX21hcF96ZXJvID8ga2V5LnNsaWNlKDEpIDoga2V5OwogIH0KICBmdW5jdGlvbiBkM19tYXBfaGFzKGtleSkgewogICAgcmV0dXJuIGQzX21hcF9lc2NhcGUoa2V5KSBpbiB0aGlzLl87CiAgfQogIGZ1bmN0aW9uIGQzX21hcF9yZW1vdmUoa2V5KSB7CiAgICByZXR1cm4gKGtleSA9IGQzX21hcF9lc2NhcGUoa2V5KSkgaW4gdGhpcy5fICYmIGRlbGV0ZSB0aGlzLl9ba2V5XTsKICB9CiAgZnVuY3Rpb24gZDNfbWFwX2tleXMoKSB7CiAgICB2YXIga2V5cyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIHRoaXMuXykga2V5cy5wdXNoKGQzX21hcF91bmVzY2FwZShrZXkpKTsKICAgIHJldHVybiBrZXlzOwogIH0KICBmdW5jdGlvbiBkM19tYXBfc2l6ZSgpIHsKICAgIHZhciBzaXplID0gMDsKICAgIGZvciAodmFyIGtleSBpbiB0aGlzLl8pICsrc2l6ZTsKICAgIHJldHVybiBzaXplOwogIH0KICBmdW5jdGlvbiBkM19tYXBfZW1wdHkoKSB7CiAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5fKSByZXR1cm4gZmFsc2U7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZDMubmVzdCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIG5lc3QgPSB7fSwga2V5cyA9IFtdLCBzb3J0S2V5cyA9IFtdLCBzb3J0VmFsdWVzLCByb2xsdXA7CiAgICBmdW5jdGlvbiBtYXAobWFwVHlwZSwgYXJyYXksIGRlcHRoKSB7CiAgICAgIGlmIChkZXB0aCA+PSBrZXlzLmxlbmd0aCkgcmV0dXJuIHJvbGx1cCA/IHJvbGx1cC5jYWxsKG5lc3QsIGFycmF5KSA6IHNvcnRWYWx1ZXMgPyBhcnJheS5zb3J0KHNvcnRWYWx1ZXMpIDogYXJyYXk7CiAgICAgIHZhciBpID0gLTEsIG4gPSBhcnJheS5sZW5ndGgsIGtleSA9IGtleXNbZGVwdGgrK10sIGtleVZhbHVlLCBvYmplY3QsIHNldHRlciwgdmFsdWVzQnlLZXkgPSBuZXcgZDNfTWFwKCksIHZhbHVlczsKICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICBpZiAodmFsdWVzID0gdmFsdWVzQnlLZXkuZ2V0KGtleVZhbHVlID0ga2V5KG9iamVjdCA9IGFycmF5W2ldKSkpIHsKICAgICAgICAgIHZhbHVlcy5wdXNoKG9iamVjdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhbHVlc0J5S2V5LnNldChrZXlWYWx1ZSwgWyBvYmplY3QgXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChtYXBUeXBlKSB7CiAgICAgICAgb2JqZWN0ID0gbWFwVHlwZSgpOwogICAgICAgIHNldHRlciA9IGZ1bmN0aW9uKGtleVZhbHVlLCB2YWx1ZXMpIHsKICAgICAgICAgIG9iamVjdC5zZXQoa2V5VmFsdWUsIG1hcChtYXBUeXBlLCB2YWx1ZXMsIGRlcHRoKSk7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvYmplY3QgPSB7fTsKICAgICAgICBzZXR0ZXIgPSBmdW5jdGlvbihrZXlWYWx1ZSwgdmFsdWVzKSB7CiAgICAgICAgICBvYmplY3Rba2V5VmFsdWVdID0gbWFwKG1hcFR5cGUsIHZhbHVlcywgZGVwdGgpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgdmFsdWVzQnlLZXkuZm9yRWFjaChzZXR0ZXIpOwogICAgICByZXR1cm4gb2JqZWN0OwogICAgfQogICAgZnVuY3Rpb24gZW50cmllcyhtYXAsIGRlcHRoKSB7CiAgICAgIGlmIChkZXB0aCA+PSBrZXlzLmxlbmd0aCkgcmV0dXJuIG1hcDsKICAgICAgdmFyIGFycmF5ID0gW10sIHNvcnRLZXkgPSBzb3J0S2V5c1tkZXB0aCsrXTsKICAgICAgbWFwLmZvckVhY2goZnVuY3Rpb24oa2V5LCBrZXlNYXApIHsKICAgICAgICBhcnJheS5wdXNoKHsKICAgICAgICAgIGtleToga2V5LAogICAgICAgICAgdmFsdWVzOiBlbnRyaWVzKGtleU1hcCwgZGVwdGgpCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gc29ydEtleSA/IGFycmF5LnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgIHJldHVybiBzb3J0S2V5KGEua2V5LCBiLmtleSk7CiAgICAgIH0pIDogYXJyYXk7CiAgICB9CiAgICBuZXN0Lm1hcCA9IGZ1bmN0aW9uKGFycmF5LCBtYXBUeXBlKSB7CiAgICAgIHJldHVybiBtYXAobWFwVHlwZSwgYXJyYXksIDApOwogICAgfTsKICAgIG5lc3QuZW50cmllcyA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICAgIHJldHVybiBlbnRyaWVzKG1hcChkMy5tYXAsIGFycmF5LCAwKSwgMCk7CiAgICB9OwogICAgbmVzdC5rZXkgPSBmdW5jdGlvbihkKSB7CiAgICAgIGtleXMucHVzaChkKTsKICAgICAgcmV0dXJuIG5lc3Q7CiAgICB9OwogICAgbmVzdC5zb3J0S2V5cyA9IGZ1bmN0aW9uKG9yZGVyKSB7CiAgICAgIHNvcnRLZXlzW2tleXMubGVuZ3RoIC0gMV0gPSBvcmRlcjsKICAgICAgcmV0dXJuIG5lc3Q7CiAgICB9OwogICAgbmVzdC5zb3J0VmFsdWVzID0gZnVuY3Rpb24ob3JkZXIpIHsKICAgICAgc29ydFZhbHVlcyA9IG9yZGVyOwogICAgICByZXR1cm4gbmVzdDsKICAgIH07CiAgICBuZXN0LnJvbGx1cCA9IGZ1bmN0aW9uKGYpIHsKICAgICAgcm9sbHVwID0gZjsKICAgICAgcmV0dXJuIG5lc3Q7CiAgICB9OwogICAgcmV0dXJuIG5lc3Q7CiAgfTsKICBkMy5zZXQgPSBmdW5jdGlvbihhcnJheSkgewogICAgdmFyIHNldCA9IG5ldyBkM19TZXQoKTsKICAgIGlmIChhcnJheSkgZm9yICh2YXIgaSA9IDAsIG4gPSBhcnJheS5sZW5ndGg7IGkgPCBuOyArK2kpIHNldC5hZGQoYXJyYXlbaV0pOwogICAgcmV0dXJuIHNldDsKICB9OwogIGZ1bmN0aW9uIGQzX1NldCgpIHsKICAgIHRoaXMuXyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgfQogIGQzX2NsYXNzKGQzX1NldCwgewogICAgaGFzOiBkM19tYXBfaGFzLAogICAgYWRkOiBmdW5jdGlvbihrZXkpIHsKICAgICAgdGhpcy5fW2QzX21hcF9lc2NhcGUoa2V5ICs9ICIiKV0gPSB0cnVlOwogICAgICByZXR1cm4ga2V5OwogICAgfSwKICAgIHJlbW92ZTogZDNfbWFwX3JlbW92ZSwKICAgIHZhbHVlczogZDNfbWFwX2tleXMsCiAgICBzaXplOiBkM19tYXBfc2l6ZSwKICAgIGVtcHR5OiBkM19tYXBfZW1wdHksCiAgICBmb3JFYWNoOiBmdW5jdGlvbihmKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLl8pIGYuY2FsbCh0aGlzLCBkM19tYXBfdW5lc2NhcGUoa2V5KSk7CiAgICB9CiAgfSk7CiAgZDMuYmVoYXZpb3IgPSB7fTsKICBkMy5yZWJpbmQgPSBmdW5jdGlvbih0YXJnZXQsIHNvdXJjZSkgewogICAgdmFyIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aCwgbWV0aG9kOwogICAgd2hpbGUgKCsraSA8IG4pIHRhcmdldFttZXRob2QgPSBhcmd1bWVudHNbaV1dID0gZDNfcmViaW5kKHRhcmdldCwgc291cmNlLCBzb3VyY2VbbWV0aG9kXSk7CiAgICByZXR1cm4gdGFyZ2V0OwogIH07CiAgZnVuY3Rpb24gZDNfcmViaW5kKHRhcmdldCwgc291cmNlLCBtZXRob2QpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHZhbHVlID0gbWV0aG9kLmFwcGx5KHNvdXJjZSwgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIHZhbHVlID09PSBzb3VyY2UgPyB0YXJnZXQgOiB2YWx1ZTsKICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX3ZlbmRvclN5bWJvbChvYmplY3QsIG5hbWUpIHsKICAgIGlmIChuYW1lIGluIG9iamVjdCkgcmV0dXJuIG5hbWU7CiAgICBuYW1lID0gbmFtZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIG5hbWUuc2xpY2UoMSk7CiAgICBmb3IgKHZhciBpID0gMCwgbiA9IGQzX3ZlbmRvclByZWZpeGVzLmxlbmd0aDsgaSA8IG47ICsraSkgewogICAgICB2YXIgcHJlZml4TmFtZSA9IGQzX3ZlbmRvclByZWZpeGVzW2ldICsgbmFtZTsKICAgICAgaWYgKHByZWZpeE5hbWUgaW4gb2JqZWN0KSByZXR1cm4gcHJlZml4TmFtZTsKICAgIH0KICB9CiAgdmFyIGQzX3ZlbmRvclByZWZpeGVzID0gWyAid2Via2l0IiwgIm1zIiwgIm1veiIsICJNb3oiLCAibyIsICJPIiBdOwogIGZ1bmN0aW9uIGQzX25vb3AoKSB7fQogIGQzLmRpc3BhdGNoID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgZGlzcGF0Y2ggPSBuZXcgZDNfZGlzcGF0Y2goKSwgaSA9IC0xLCBuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgIHdoaWxlICgrK2kgPCBuKSBkaXNwYXRjaFthcmd1bWVudHNbaV1dID0gZDNfZGlzcGF0Y2hfZXZlbnQoZGlzcGF0Y2gpOwogICAgcmV0dXJuIGRpc3BhdGNoOwogIH07CiAgZnVuY3Rpb24gZDNfZGlzcGF0Y2goKSB7fQogIGQzX2Rpc3BhdGNoLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKHR5cGUsIGxpc3RlbmVyKSB7CiAgICB2YXIgaSA9IHR5cGUuaW5kZXhPZigiLiIpLCBuYW1lID0gIiI7CiAgICBpZiAoaSA+PSAwKSB7CiAgICAgIG5hbWUgPSB0eXBlLnNsaWNlKGkgKyAxKTsKICAgICAgdHlwZSA9IHR5cGUuc2xpY2UoMCwgaSk7CiAgICB9CiAgICBpZiAodHlwZSkgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPCAyID8gdGhpc1t0eXBlXS5vbihuYW1lKSA6IHRoaXNbdHlwZV0ub24obmFtZSwgbGlzdGVuZXIpOwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHsKICAgICAgaWYgKGxpc3RlbmVyID09IG51bGwpIGZvciAodHlwZSBpbiB0aGlzKSB7CiAgICAgICAgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkodHlwZSkpIHRoaXNbdHlwZV0ub24obmFtZSwgbnVsbCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBmdW5jdGlvbiBkM19kaXNwYXRjaF9ldmVudChkaXNwYXRjaCkgewogICAgdmFyIGxpc3RlbmVycyA9IFtdLCBsaXN0ZW5lckJ5TmFtZSA9IG5ldyBkM19NYXAoKTsKICAgIGZ1bmN0aW9uIGV2ZW50KCkgewogICAgICB2YXIgeiA9IGxpc3RlbmVycywgaSA9IC0xLCBuID0gei5sZW5ndGgsIGw7CiAgICAgIHdoaWxlICgrK2kgPCBuKSBpZiAobCA9IHpbaV0ub24pIGwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIGRpc3BhdGNoOwogICAgfQogICAgZXZlbnQub24gPSBmdW5jdGlvbihuYW1lLCBsaXN0ZW5lcikgewogICAgICB2YXIgbCA9IGxpc3RlbmVyQnlOYW1lLmdldChuYW1lKSwgaTsKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSByZXR1cm4gbCAmJiBsLm9uOwogICAgICBpZiAobCkgewogICAgICAgIGwub24gPSBudWxsOwogICAgICAgIGxpc3RlbmVycyA9IGxpc3RlbmVycy5zbGljZSgwLCBpID0gbGlzdGVuZXJzLmluZGV4T2YobCkpLmNvbmNhdChsaXN0ZW5lcnMuc2xpY2UoaSArIDEpKTsKICAgICAgICBsaXN0ZW5lckJ5TmFtZS5yZW1vdmUobmFtZSk7CiAgICAgIH0KICAgICAgaWYgKGxpc3RlbmVyKSBsaXN0ZW5lcnMucHVzaChsaXN0ZW5lckJ5TmFtZS5zZXQobmFtZSwgewogICAgICAgIG9uOiBsaXN0ZW5lcgogICAgICB9KSk7CiAgICAgIHJldHVybiBkaXNwYXRjaDsKICAgIH07CiAgICByZXR1cm4gZXZlbnQ7CiAgfQogIGQzLmV2ZW50ID0gbnVsbDsKICBmdW5jdGlvbiBkM19ldmVudFByZXZlbnREZWZhdWx0KCkgewogICAgZDMuZXZlbnQucHJldmVudERlZmF1bHQoKTsKICB9CiAgZnVuY3Rpb24gZDNfZXZlbnRTb3VyY2UoKSB7CiAgICB2YXIgZSA9IGQzLmV2ZW50LCBzOwogICAgd2hpbGUgKHMgPSBlLnNvdXJjZUV2ZW50KSBlID0gczsKICAgIHJldHVybiBlOwogIH0KICBmdW5jdGlvbiBkM19ldmVudERpc3BhdGNoKHRhcmdldCkgewogICAgdmFyIGRpc3BhdGNoID0gbmV3IGQzX2Rpc3BhdGNoKCksIGkgPSAwLCBuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgIHdoaWxlICgrK2kgPCBuKSBkaXNwYXRjaFthcmd1bWVudHNbaV1dID0gZDNfZGlzcGF0Y2hfZXZlbnQoZGlzcGF0Y2gpOwogICAgZGlzcGF0Y2gub2YgPSBmdW5jdGlvbih0aGl6LCBhcmd1bWVudHopIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUxKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciBlMCA9IGUxLnNvdXJjZUV2ZW50ID0gZDMuZXZlbnQ7CiAgICAgICAgICBlMS50YXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgICBkMy5ldmVudCA9IGUxOwogICAgICAgICAgZGlzcGF0Y2hbZTEudHlwZV0uYXBwbHkodGhpeiwgYXJndW1lbnR6KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgZDMuZXZlbnQgPSBlMDsKICAgICAgICB9CiAgICAgIH07CiAgICB9OwogICAgcmV0dXJuIGRpc3BhdGNoOwogIH0KICBkMy5yZXF1b3RlID0gZnVuY3Rpb24ocykgewogICAgcmV0dXJuIHMucmVwbGFjZShkM19yZXF1b3RlX3JlLCAiXFwkJiIpOwogIH07CiAgdmFyIGQzX3JlcXVvdGVfcmUgPSAvW1xcXF5cJFwqXCtcP1x8XFtcXVwoXClcLlx7XH1dL2c7CiAgdmFyIGQzX3N1YmNsYXNzID0ge30uX19wcm90b19fID8gZnVuY3Rpb24ob2JqZWN0LCBwcm90b3R5cGUpIHsKICAgIG9iamVjdC5fX3Byb3RvX18gPSBwcm90b3R5cGU7CiAgfSA6IGZ1bmN0aW9uKG9iamVjdCwgcHJvdG90eXBlKSB7CiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBwcm90b3R5cGUpIG9iamVjdFtwcm9wZXJ0eV0gPSBwcm90b3R5cGVbcHJvcGVydHldOwogIH07CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uKGdyb3VwcykgewogICAgZDNfc3ViY2xhc3MoZ3JvdXBzLCBkM19zZWxlY3Rpb25Qcm90b3R5cGUpOwogICAgcmV0dXJuIGdyb3VwczsKICB9CiAgdmFyIGQzX3NlbGVjdCA9IGZ1bmN0aW9uKHMsIG4pIHsKICAgIHJldHVybiBuLnF1ZXJ5U2VsZWN0b3Iocyk7CiAgfSwgZDNfc2VsZWN0QWxsID0gZnVuY3Rpb24ocywgbikgewogICAgcmV0dXJuIG4ucXVlcnlTZWxlY3RvckFsbChzKTsKICB9LCBkM19zZWxlY3RNYXRjaGVyID0gZDNfZG9jdW1lbnRFbGVtZW50Lm1hdGNoZXMgfHwgZDNfZG9jdW1lbnRFbGVtZW50W2QzX3ZlbmRvclN5bWJvbChkM19kb2N1bWVudEVsZW1lbnQsICJtYXRjaGVzU2VsZWN0b3IiKV0sIGQzX3NlbGVjdE1hdGNoZXMgPSBmdW5jdGlvbihuLCBzKSB7CiAgICByZXR1cm4gZDNfc2VsZWN0TWF0Y2hlci5jYWxsKG4sIHMpOwogIH07CiAgaWYgKHR5cGVvZiBTaXp6bGUgPT09ICJmdW5jdGlvbiIpIHsKICAgIGQzX3NlbGVjdCA9IGZ1bmN0aW9uKHMsIG4pIHsKICAgICAgcmV0dXJuIFNpenpsZShzLCBuKVswXSB8fCBudWxsOwogICAgfTsKICAgIGQzX3NlbGVjdEFsbCA9IFNpenpsZTsKICAgIGQzX3NlbGVjdE1hdGNoZXMgPSBTaXp6bGUubWF0Y2hlc1NlbGVjdG9yOwogIH0KICBkMy5zZWxlY3Rpb24gPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM19zZWxlY3Rpb25Sb290OwogIH07CiAgdmFyIGQzX3NlbGVjdGlvblByb3RvdHlwZSA9IGQzLnNlbGVjdGlvbi5wcm90b3R5cGUgPSBbXTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuc2VsZWN0ID0gZnVuY3Rpb24oc2VsZWN0b3IpIHsKICAgIHZhciBzdWJncm91cHMgPSBbXSwgc3ViZ3JvdXAsIHN1Ym5vZGUsIGdyb3VwLCBub2RlOwogICAgc2VsZWN0b3IgPSBkM19zZWxlY3Rpb25fc2VsZWN0b3Ioc2VsZWN0b3IpOwogICAgZm9yICh2YXIgaiA9IC0xLCBtID0gdGhpcy5sZW5ndGg7ICsraiA8IG07ICkgewogICAgICBzdWJncm91cHMucHVzaChzdWJncm91cCA9IFtdKTsKICAgICAgc3ViZ3JvdXAucGFyZW50Tm9kZSA9IChncm91cCA9IHRoaXNbal0pLnBhcmVudE5vZGU7CiAgICAgIGZvciAodmFyIGkgPSAtMSwgbiA9IGdyb3VwLmxlbmd0aDsgKytpIDwgbjsgKSB7CiAgICAgICAgaWYgKG5vZGUgPSBncm91cFtpXSkgewogICAgICAgICAgc3ViZ3JvdXAucHVzaChzdWJub2RlID0gc2VsZWN0b3IuY2FsbChub2RlLCBub2RlLl9fZGF0YV9fLCBpLCBqKSk7CiAgICAgICAgICBpZiAoc3Vibm9kZSAmJiAiX19kYXRhX18iIGluIG5vZGUpIHN1Ym5vZGUuX19kYXRhX18gPSBub2RlLl9fZGF0YV9fOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdWJncm91cC5wdXNoKG51bGwpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGQzX3NlbGVjdGlvbihzdWJncm91cHMpOwogIH07CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uX3NlbGVjdG9yKHNlbGVjdG9yKSB7CiAgICByZXR1cm4gdHlwZW9mIHNlbGVjdG9yID09PSAiZnVuY3Rpb24iID8gc2VsZWN0b3IgOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX3NlbGVjdChzZWxlY3RvciwgdGhpcyk7CiAgICB9OwogIH0KICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuc2VsZWN0QWxsID0gZnVuY3Rpb24oc2VsZWN0b3IpIHsKICAgIHZhciBzdWJncm91cHMgPSBbXSwgc3ViZ3JvdXAsIG5vZGU7CiAgICBzZWxlY3RvciA9IGQzX3NlbGVjdGlvbl9zZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICBmb3IgKHZhciBqID0gLTEsIG0gPSB0aGlzLmxlbmd0aDsgKytqIDwgbTsgKSB7CiAgICAgIGZvciAodmFyIGdyb3VwID0gdGhpc1tqXSwgaSA9IC0xLCBuID0gZ3JvdXAubGVuZ3RoOyArK2kgPCBuOyApIHsKICAgICAgICBpZiAobm9kZSA9IGdyb3VwW2ldKSB7CiAgICAgICAgICBzdWJncm91cHMucHVzaChzdWJncm91cCA9IGQzX2FycmF5KHNlbGVjdG9yLmNhbGwobm9kZSwgbm9kZS5fX2RhdGFfXywgaSwgaikpKTsKICAgICAgICAgIHN1Ymdyb3VwLnBhcmVudE5vZGUgPSBub2RlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGQzX3NlbGVjdGlvbihzdWJncm91cHMpOwogIH07CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uX3NlbGVjdG9yQWxsKHNlbGVjdG9yKSB7CiAgICByZXR1cm4gdHlwZW9mIHNlbGVjdG9yID09PSAiZnVuY3Rpb24iID8gc2VsZWN0b3IgOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX3NlbGVjdEFsbChzZWxlY3RvciwgdGhpcyk7CiAgICB9OwogIH0KICB2YXIgZDNfbnNQcmVmaXggPSB7CiAgICBzdmc6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsCiAgICB4aHRtbDogImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiLAogICAgeGxpbms6ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiwKICAgIHhtbDogImh0dHA6Ly93d3cudzMub3JnL1hNTC8xOTk4L25hbWVzcGFjZSIsCiAgICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAveG1sbnMvIgogIH07CiAgZDMubnMgPSB7CiAgICBwcmVmaXg6IGQzX25zUHJlZml4LAogICAgcXVhbGlmeTogZnVuY3Rpb24obmFtZSkgewogICAgICB2YXIgaSA9IG5hbWUuaW5kZXhPZigiOiIpLCBwcmVmaXggPSBuYW1lOwogICAgICBpZiAoaSA+PSAwKSB7CiAgICAgICAgcHJlZml4ID0gbmFtZS5zbGljZSgwLCBpKTsKICAgICAgICBuYW1lID0gbmFtZS5zbGljZShpICsgMSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGQzX25zUHJlZml4Lmhhc093blByb3BlcnR5KHByZWZpeCkgPyB7CiAgICAgICAgc3BhY2U6IGQzX25zUHJlZml4W3ByZWZpeF0sCiAgICAgICAgbG9jYWw6IG5hbWUKICAgICAgfSA6IG5hbWU7CiAgICB9CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuYXR0ciA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHsKICAgICAgaWYgKHR5cGVvZiBuYW1lID09PSAic3RyaW5nIikgewogICAgICAgIHZhciBub2RlID0gdGhpcy5ub2RlKCk7CiAgICAgICAgbmFtZSA9IGQzLm5zLnF1YWxpZnkobmFtZSk7CiAgICAgICAgcmV0dXJuIG5hbWUubG9jYWwgPyBub2RlLmdldEF0dHJpYnV0ZU5TKG5hbWUuc3BhY2UsIG5hbWUubG9jYWwpIDogbm9kZS5nZXRBdHRyaWJ1dGUobmFtZSk7CiAgICAgIH0KICAgICAgZm9yICh2YWx1ZSBpbiBuYW1lKSB0aGlzLmVhY2goZDNfc2VsZWN0aW9uX2F0dHIodmFsdWUsIG5hbWVbdmFsdWVdKSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgcmV0dXJuIHRoaXMuZWFjaChkM19zZWxlY3Rpb25fYXR0cihuYW1lLCB2YWx1ZSkpOwogIH07CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uX2F0dHIobmFtZSwgdmFsdWUpIHsKICAgIG5hbWUgPSBkMy5ucy5xdWFsaWZ5KG5hbWUpOwogICAgZnVuY3Rpb24gYXR0ck51bGwoKSB7CiAgICAgIHRoaXMucmVtb3ZlQXR0cmlidXRlKG5hbWUpOwogICAgfQogICAgZnVuY3Rpb24gYXR0ck51bGxOUygpIHsKICAgICAgdGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyhuYW1lLnNwYWNlLCBuYW1lLmxvY2FsKTsKICAgIH0KICAgIGZ1bmN0aW9uIGF0dHJDb25zdGFudCgpIHsKICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUobmFtZSwgdmFsdWUpOwogICAgfQogICAgZnVuY3Rpb24gYXR0ckNvbnN0YW50TlMoKSB7CiAgICAgIHRoaXMuc2V0QXR0cmlidXRlTlMobmFtZS5zcGFjZSwgbmFtZS5sb2NhbCwgdmFsdWUpOwogICAgfQogICAgZnVuY3Rpb24gYXR0ckZ1bmN0aW9uKCkgewogICAgICB2YXIgeCA9IHZhbHVlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIGlmICh4ID09IG51bGwpIHRoaXMucmVtb3ZlQXR0cmlidXRlKG5hbWUpOyBlbHNlIHRoaXMuc2V0QXR0cmlidXRlKG5hbWUsIHgpOwogICAgfQogICAgZnVuY3Rpb24gYXR0ckZ1bmN0aW9uTlMoKSB7CiAgICAgIHZhciB4ID0gdmFsdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgaWYgKHggPT0gbnVsbCkgdGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyhuYW1lLnNwYWNlLCBuYW1lLmxvY2FsKTsgZWxzZSB0aGlzLnNldEF0dHJpYnV0ZU5TKG5hbWUuc3BhY2UsIG5hbWUubG9jYWwsIHgpOwogICAgfQogICAgcmV0dXJuIHZhbHVlID09IG51bGwgPyBuYW1lLmxvY2FsID8gYXR0ck51bGxOUyA6IGF0dHJOdWxsIDogdHlwZW9mIHZhbHVlID09PSAiZnVuY3Rpb24iID8gbmFtZS5sb2NhbCA/IGF0dHJGdW5jdGlvbk5TIDogYXR0ckZ1bmN0aW9uIDogbmFtZS5sb2NhbCA/IGF0dHJDb25zdGFudE5TIDogYXR0ckNvbnN0YW50OwogIH0KICBmdW5jdGlvbiBkM19jb2xsYXBzZShzKSB7CiAgICByZXR1cm4gcy50cmltKCkucmVwbGFjZSgvXHMrL2csICIgIik7CiAgfQogIGQzX3NlbGVjdGlvblByb3RvdHlwZS5jbGFzc2VkID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgewogICAgICBpZiAodHlwZW9mIG5hbWUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgdmFyIG5vZGUgPSB0aGlzLm5vZGUoKSwgbiA9IChuYW1lID0gZDNfc2VsZWN0aW9uX2NsYXNzZXMobmFtZSkpLmxlbmd0aCwgaSA9IC0xOwogICAgICAgIGlmICh2YWx1ZSA9IG5vZGUuY2xhc3NMaXN0KSB7CiAgICAgICAgICB3aGlsZSAoKytpIDwgbikgaWYgKCF2YWx1ZS5jb250YWlucyhuYW1lW2ldKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YWx1ZSA9IG5vZGUuZ2V0QXR0cmlidXRlKCJjbGFzcyIpOwogICAgICAgICAgd2hpbGUgKCsraSA8IG4pIGlmICghZDNfc2VsZWN0aW9uX2NsYXNzZWRSZShuYW1lW2ldKS50ZXN0KHZhbHVlKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmb3IgKHZhbHVlIGluIG5hbWUpIHRoaXMuZWFjaChkM19zZWxlY3Rpb25fY2xhc3NlZCh2YWx1ZSwgbmFtZVt2YWx1ZV0pKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICByZXR1cm4gdGhpcy5lYWNoKGQzX3NlbGVjdGlvbl9jbGFzc2VkKG5hbWUsIHZhbHVlKSk7CiAgfTsKICBmdW5jdGlvbiBkM19zZWxlY3Rpb25fY2xhc3NlZFJlKG5hbWUpIHsKICAgIHJldHVybiBuZXcgUmVnRXhwKCIoPzpefFxccyspIiArIGQzLnJlcXVvdGUobmFtZSkgKyAiKD86XFxzK3wkKSIsICJnIik7CiAgfQogIGZ1bmN0aW9uIGQzX3NlbGVjdGlvbl9jbGFzc2VzKG5hbWUpIHsKICAgIHJldHVybiAobmFtZSArICIiKS50cmltKCkuc3BsaXQoL158XHMrLyk7CiAgfQogIGZ1bmN0aW9uIGQzX3NlbGVjdGlvbl9jbGFzc2VkKG5hbWUsIHZhbHVlKSB7CiAgICBuYW1lID0gZDNfc2VsZWN0aW9uX2NsYXNzZXMobmFtZSkubWFwKGQzX3NlbGVjdGlvbl9jbGFzc2VkTmFtZSk7CiAgICB2YXIgbiA9IG5hbWUubGVuZ3RoOwogICAgZnVuY3Rpb24gY2xhc3NlZENvbnN0YW50KCkgewogICAgICB2YXIgaSA9IC0xOwogICAgICB3aGlsZSAoKytpIDwgbikgbmFtZVtpXSh0aGlzLCB2YWx1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiBjbGFzc2VkRnVuY3Rpb24oKSB7CiAgICAgIHZhciBpID0gLTEsIHggPSB2YWx1ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB3aGlsZSAoKytpIDwgbikgbmFtZVtpXSh0aGlzLCB4KTsKICAgIH0KICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIgPyBjbGFzc2VkRnVuY3Rpb24gOiBjbGFzc2VkQ29uc3RhbnQ7CiAgfQogIGZ1bmN0aW9uIGQzX3NlbGVjdGlvbl9jbGFzc2VkTmFtZShuYW1lKSB7CiAgICB2YXIgcmUgPSBkM19zZWxlY3Rpb25fY2xhc3NlZFJlKG5hbWUpOwogICAgcmV0dXJuIGZ1bmN0aW9uKG5vZGUsIHZhbHVlKSB7CiAgICAgIGlmIChjID0gbm9kZS5jbGFzc0xpc3QpIHJldHVybiB2YWx1ZSA/IGMuYWRkKG5hbWUpIDogYy5yZW1vdmUobmFtZSk7CiAgICAgIHZhciBjID0gbm9kZS5nZXRBdHRyaWJ1dGUoImNsYXNzIikgfHwgIiI7CiAgICAgIGlmICh2YWx1ZSkgewogICAgICAgIHJlLmxhc3RJbmRleCA9IDA7CiAgICAgICAgaWYgKCFyZS50ZXN0KGMpKSBub2RlLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCBkM19jb2xsYXBzZShjICsgIiAiICsgbmFtZSkpOwogICAgICB9IGVsc2UgewogICAgICAgIG5vZGUuc2V0QXR0cmlidXRlKCJjbGFzcyIsIGQzX2NvbGxhcHNlKGMucmVwbGFjZShyZSwgIiAiKSkpOwogICAgICB9CiAgICB9OwogIH0KICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuc3R5bGUgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSwgcHJpb3JpdHkpIHsKICAgIHZhciBuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgIGlmIChuIDwgMykgewogICAgICBpZiAodHlwZW9mIG5hbWUgIT09ICJzdHJpbmciKSB7CiAgICAgICAgaWYgKG4gPCAyKSB2YWx1ZSA9ICIiOwogICAgICAgIGZvciAocHJpb3JpdHkgaW4gbmFtZSkgdGhpcy5lYWNoKGQzX3NlbGVjdGlvbl9zdHlsZShwcmlvcml0eSwgbmFtZVtwcmlvcml0eV0sIHZhbHVlKSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgaWYgKG4gPCAyKSByZXR1cm4gZDNfd2luZG93LmdldENvbXB1dGVkU3R5bGUodGhpcy5ub2RlKCksIG51bGwpLmdldFByb3BlcnR5VmFsdWUobmFtZSk7CiAgICAgIHByaW9yaXR5ID0gIiI7CiAgICB9CiAgICByZXR1cm4gdGhpcy5lYWNoKGQzX3NlbGVjdGlvbl9zdHlsZShuYW1lLCB2YWx1ZSwgcHJpb3JpdHkpKTsKICB9OwogIGZ1bmN0aW9uIGQzX3NlbGVjdGlvbl9zdHlsZShuYW1lLCB2YWx1ZSwgcHJpb3JpdHkpIHsKICAgIGZ1bmN0aW9uIHN0eWxlTnVsbCgpIHsKICAgICAgdGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuYW1lKTsKICAgIH0KICAgIGZ1bmN0aW9uIHN0eWxlQ29uc3RhbnQoKSB7CiAgICAgIHRoaXMuc3R5bGUuc2V0UHJvcGVydHkobmFtZSwgdmFsdWUsIHByaW9yaXR5KTsKICAgIH0KICAgIGZ1bmN0aW9uIHN0eWxlRnVuY3Rpb24oKSB7CiAgICAgIHZhciB4ID0gdmFsdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgaWYgKHggPT0gbnVsbCkgdGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuYW1lKTsgZWxzZSB0aGlzLnN0eWxlLnNldFByb3BlcnR5KG5hbWUsIHgsIHByaW9yaXR5KTsKICAgIH0KICAgIHJldHVybiB2YWx1ZSA9PSBudWxsID8gc3R5bGVOdWxsIDogdHlwZW9mIHZhbHVlID09PSAiZnVuY3Rpb24iID8gc3R5bGVGdW5jdGlvbiA6IHN0eWxlQ29uc3RhbnQ7CiAgfQogIGQzX3NlbGVjdGlvblByb3RvdHlwZS5wcm9wZXJ0eSA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHsKICAgICAgaWYgKHR5cGVvZiBuYW1lID09PSAic3RyaW5nIikgcmV0dXJuIHRoaXMubm9kZSgpW25hbWVdOwogICAgICBmb3IgKHZhbHVlIGluIG5hbWUpIHRoaXMuZWFjaChkM19zZWxlY3Rpb25fcHJvcGVydHkodmFsdWUsIG5hbWVbdmFsdWVdKSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgcmV0dXJuIHRoaXMuZWFjaChkM19zZWxlY3Rpb25fcHJvcGVydHkobmFtZSwgdmFsdWUpKTsKICB9OwogIGZ1bmN0aW9uIGQzX3NlbGVjdGlvbl9wcm9wZXJ0eShuYW1lLCB2YWx1ZSkgewogICAgZnVuY3Rpb24gcHJvcGVydHlOdWxsKCkgewogICAgICBkZWxldGUgdGhpc1tuYW1lXTsKICAgIH0KICAgIGZ1bmN0aW9uIHByb3BlcnR5Q29uc3RhbnQoKSB7CiAgICAgIHRoaXNbbmFtZV0gPSB2YWx1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHByb3BlcnR5RnVuY3Rpb24oKSB7CiAgICAgIHZhciB4ID0gdmFsdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgaWYgKHggPT0gbnVsbCkgZGVsZXRlIHRoaXNbbmFtZV07IGVsc2UgdGhpc1tuYW1lXSA9IHg7CiAgICB9CiAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/IHByb3BlcnR5TnVsbCA6IHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIiA/IHByb3BlcnR5RnVuY3Rpb24gOiBwcm9wZXJ0eUNvbnN0YW50OwogIH0KICBkM19zZWxlY3Rpb25Qcm90b3R5cGUudGV4dCA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IHRoaXMuZWFjaCh0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIgPyBmdW5jdGlvbigpIHsKICAgICAgdmFyIHYgPSB2YWx1ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB0aGlzLnRleHRDb250ZW50ID0gdiA9PSBudWxsID8gIiIgOiB2OwogICAgfSA6IHZhbHVlID09IG51bGwgPyBmdW5jdGlvbigpIHsKICAgICAgdGhpcy50ZXh0Q29udGVudCA9ICIiOwogICAgfSA6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnRleHRDb250ZW50ID0gdmFsdWU7CiAgICB9KSA6IHRoaXMubm9kZSgpLnRleHRDb250ZW50OwogIH07CiAgZDNfc2VsZWN0aW9uUHJvdG90eXBlLmh0bWwgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyB0aGlzLmVhY2godHlwZW9mIHZhbHVlID09PSAiZnVuY3Rpb24iID8gZnVuY3Rpb24oKSB7CiAgICAgIHZhciB2ID0gdmFsdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgdGhpcy5pbm5lckhUTUwgPSB2ID09IG51bGwgPyAiIiA6IHY7CiAgICB9IDogdmFsdWUgPT0gbnVsbCA/IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmlubmVySFRNTCA9ICIiOwogICAgfSA6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmlubmVySFRNTCA9IHZhbHVlOwogICAgfSkgOiB0aGlzLm5vZGUoKS5pbm5lckhUTUw7CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuYXBwZW5kID0gZnVuY3Rpb24obmFtZSkgewogICAgbmFtZSA9IGQzX3NlbGVjdGlvbl9jcmVhdG9yKG5hbWUpOwogICAgcmV0dXJuIHRoaXMuc2VsZWN0KGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5hcHBlbmRDaGlsZChuYW1lLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgfSk7CiAgfTsKICBmdW5jdGlvbiBkM19zZWxlY3Rpb25fY3JlYXRvcihuYW1lKSB7CiAgICByZXR1cm4gdHlwZW9mIG5hbWUgPT09ICJmdW5jdGlvbiIgPyBuYW1lIDogKG5hbWUgPSBkMy5ucy5xdWFsaWZ5KG5hbWUpKS5sb2NhbCA/IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5vd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhuYW1lLnNwYWNlLCBuYW1lLmxvY2FsKTsKICAgIH0gOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50TlModGhpcy5uYW1lc3BhY2VVUkksIG5hbWUpOwogICAgfTsKICB9CiAgZDNfc2VsZWN0aW9uUHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uKG5hbWUsIGJlZm9yZSkgewogICAgbmFtZSA9IGQzX3NlbGVjdGlvbl9jcmVhdG9yKG5hbWUpOwogICAgYmVmb3JlID0gZDNfc2VsZWN0aW9uX3NlbGVjdG9yKGJlZm9yZSk7CiAgICByZXR1cm4gdGhpcy5zZWxlY3QoZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLmluc2VydEJlZm9yZShuYW1lLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIGJlZm9yZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IG51bGwpOwogICAgfSk7CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5lYWNoKGQzX3NlbGVjdGlvblJlbW92ZSk7CiAgfTsKICBmdW5jdGlvbiBkM19zZWxlY3Rpb25SZW1vdmUoKSB7CiAgICB2YXIgcGFyZW50ID0gdGhpcy5wYXJlbnROb2RlOwogICAgaWYgKHBhcmVudCkgcGFyZW50LnJlbW92ZUNoaWxkKHRoaXMpOwogIH0KICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuZGF0YSA9IGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHsKICAgIHZhciBpID0gLTEsIG4gPSB0aGlzLmxlbmd0aCwgZ3JvdXAsIG5vZGU7CiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgdmFsdWUgPSBuZXcgQXJyYXkobiA9IChncm91cCA9IHRoaXNbMF0pLmxlbmd0aCk7CiAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgaWYgKG5vZGUgPSBncm91cFtpXSkgewogICAgICAgICAgdmFsdWVbaV0gPSBub2RlLl9fZGF0YV9fOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICBmdW5jdGlvbiBiaW5kKGdyb3VwLCBncm91cERhdGEpIHsKICAgICAgdmFyIGksIG4gPSBncm91cC5sZW5ndGgsIG0gPSBncm91cERhdGEubGVuZ3RoLCBuMCA9IE1hdGgubWluKG4sIG0pLCB1cGRhdGVOb2RlcyA9IG5ldyBBcnJheShtKSwgZW50ZXJOb2RlcyA9IG5ldyBBcnJheShtKSwgZXhpdE5vZGVzID0gbmV3IEFycmF5KG4pLCBub2RlLCBub2RlRGF0YTsKICAgICAgaWYgKGtleSkgewogICAgICAgIHZhciBub2RlQnlLZXlWYWx1ZSA9IG5ldyBkM19NYXAoKSwga2V5VmFsdWVzID0gbmV3IEFycmF5KG4pLCBrZXlWYWx1ZTsKICAgICAgICBmb3IgKGkgPSAtMTsgKytpIDwgbjsgKSB7CiAgICAgICAgICBpZiAobm9kZUJ5S2V5VmFsdWUuaGFzKGtleVZhbHVlID0ga2V5LmNhbGwobm9kZSA9IGdyb3VwW2ldLCBub2RlLl9fZGF0YV9fLCBpKSkpIHsKICAgICAgICAgICAgZXhpdE5vZGVzW2ldID0gbm9kZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5vZGVCeUtleVZhbHVlLnNldChrZXlWYWx1ZSwgbm9kZSk7CiAgICAgICAgICB9CiAgICAgICAgICBrZXlWYWx1ZXNbaV0gPSBrZXlWYWx1ZTsKICAgICAgICB9CiAgICAgICAgZm9yIChpID0gLTE7ICsraSA8IG07ICkgewogICAgICAgICAgaWYgKCEobm9kZSA9IG5vZGVCeUtleVZhbHVlLmdldChrZXlWYWx1ZSA9IGtleS5jYWxsKGdyb3VwRGF0YSwgbm9kZURhdGEgPSBncm91cERhdGFbaV0sIGkpKSkpIHsKICAgICAgICAgICAgZW50ZXJOb2Rlc1tpXSA9IGQzX3NlbGVjdGlvbl9kYXRhTm9kZShub2RlRGF0YSk7CiAgICAgICAgICB9IGVsc2UgaWYgKG5vZGUgIT09IHRydWUpIHsKICAgICAgICAgICAgdXBkYXRlTm9kZXNbaV0gPSBub2RlOwogICAgICAgICAgICBub2RlLl9fZGF0YV9fID0gbm9kZURhdGE7CiAgICAgICAgICB9CiAgICAgICAgICBub2RlQnlLZXlWYWx1ZS5zZXQoa2V5VmFsdWUsIHRydWUpOwogICAgICAgIH0KICAgICAgICBmb3IgKGkgPSAtMTsgKytpIDwgbjsgKSB7CiAgICAgICAgICBpZiAobm9kZUJ5S2V5VmFsdWUuZ2V0KGtleVZhbHVlc1tpXSkgIT09IHRydWUpIHsKICAgICAgICAgICAgZXhpdE5vZGVzW2ldID0gZ3JvdXBbaV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAoaSA9IC0xOyArK2kgPCBuMDsgKSB7CiAgICAgICAgICBub2RlID0gZ3JvdXBbaV07CiAgICAgICAgICBub2RlRGF0YSA9IGdyb3VwRGF0YVtpXTsKICAgICAgICAgIGlmIChub2RlKSB7CiAgICAgICAgICAgIG5vZGUuX19kYXRhX18gPSBub2RlRGF0YTsKICAgICAgICAgICAgdXBkYXRlTm9kZXNbaV0gPSBub2RlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZW50ZXJOb2Rlc1tpXSA9IGQzX3NlbGVjdGlvbl9kYXRhTm9kZShub2RlRGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAoO2kgPCBtOyArK2kpIHsKICAgICAgICAgIGVudGVyTm9kZXNbaV0gPSBkM19zZWxlY3Rpb25fZGF0YU5vZGUoZ3JvdXBEYXRhW2ldKTsKICAgICAgICB9CiAgICAgICAgZm9yICg7aSA8IG47ICsraSkgewogICAgICAgICAgZXhpdE5vZGVzW2ldID0gZ3JvdXBbaV07CiAgICAgICAgfQogICAgICB9CiAgICAgIGVudGVyTm9kZXMudXBkYXRlID0gdXBkYXRlTm9kZXM7CiAgICAgIGVudGVyTm9kZXMucGFyZW50Tm9kZSA9IHVwZGF0ZU5vZGVzLnBhcmVudE5vZGUgPSBleGl0Tm9kZXMucGFyZW50Tm9kZSA9IGdyb3VwLnBhcmVudE5vZGU7CiAgICAgIGVudGVyLnB1c2goZW50ZXJOb2Rlcyk7CiAgICAgIHVwZGF0ZS5wdXNoKHVwZGF0ZU5vZGVzKTsKICAgICAgZXhpdC5wdXNoKGV4aXROb2Rlcyk7CiAgICB9CiAgICB2YXIgZW50ZXIgPSBkM19zZWxlY3Rpb25fZW50ZXIoW10pLCB1cGRhdGUgPSBkM19zZWxlY3Rpb24oW10pLCBleGl0ID0gZDNfc2VsZWN0aW9uKFtdKTsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICBiaW5kKGdyb3VwID0gdGhpc1tpXSwgdmFsdWUuY2FsbChncm91cCwgZ3JvdXAucGFyZW50Tm9kZS5fX2RhdGFfXywgaSkpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgIGJpbmQoZ3JvdXAgPSB0aGlzW2ldLCB2YWx1ZSk7CiAgICAgIH0KICAgIH0KICAgIHVwZGF0ZS5lbnRlciA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZW50ZXI7CiAgICB9OwogICAgdXBkYXRlLmV4aXQgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGV4aXQ7CiAgICB9OwogICAgcmV0dXJuIHVwZGF0ZTsKICB9OwogIGZ1bmN0aW9uIGQzX3NlbGVjdGlvbl9kYXRhTm9kZShkYXRhKSB7CiAgICByZXR1cm4gewogICAgICBfX2RhdGFfXzogZGF0YQogICAgfTsKICB9CiAgZDNfc2VsZWN0aW9uUHJvdG90eXBlLmRhdHVtID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gdGhpcy5wcm9wZXJ0eSgiX19kYXRhX18iLCB2YWx1ZSkgOiB0aGlzLnByb3BlcnR5KCJfX2RhdGFfXyIpOwogIH07CiAgZDNfc2VsZWN0aW9uUHJvdG90eXBlLmZpbHRlciA9IGZ1bmN0aW9uKGZpbHRlcikgewogICAgdmFyIHN1Ymdyb3VwcyA9IFtdLCBzdWJncm91cCwgZ3JvdXAsIG5vZGU7CiAgICBpZiAodHlwZW9mIGZpbHRlciAhPT0gImZ1bmN0aW9uIikgZmlsdGVyID0gZDNfc2VsZWN0aW9uX2ZpbHRlcihmaWx0ZXIpOwogICAgZm9yICh2YXIgaiA9IDAsIG0gPSB0aGlzLmxlbmd0aDsgaiA8IG07IGorKykgewogICAgICBzdWJncm91cHMucHVzaChzdWJncm91cCA9IFtdKTsKICAgICAgc3ViZ3JvdXAucGFyZW50Tm9kZSA9IChncm91cCA9IHRoaXNbal0pLnBhcmVudE5vZGU7CiAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gZ3JvdXAubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgaWYgKChub2RlID0gZ3JvdXBbaV0pICYmIGZpbHRlci5jYWxsKG5vZGUsIG5vZGUuX19kYXRhX18sIGksIGopKSB7CiAgICAgICAgICBzdWJncm91cC5wdXNoKG5vZGUpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGQzX3NlbGVjdGlvbihzdWJncm91cHMpOwogIH07CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uX2ZpbHRlcihzZWxlY3RvcikgewogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZDNfc2VsZWN0TWF0Y2hlcyh0aGlzLCBzZWxlY3Rvcik7CiAgICB9OwogIH0KICBkM19zZWxlY3Rpb25Qcm90b3R5cGUub3JkZXIgPSBmdW5jdGlvbigpIHsKICAgIGZvciAodmFyIGogPSAtMSwgbSA9IHRoaXMubGVuZ3RoOyArK2ogPCBtOyApIHsKICAgICAgZm9yICh2YXIgZ3JvdXAgPSB0aGlzW2pdLCBpID0gZ3JvdXAubGVuZ3RoIC0gMSwgbmV4dCA9IGdyb3VwW2ldLCBub2RlOyAtLWkgPj0gMDsgKSB7CiAgICAgICAgaWYgKG5vZGUgPSBncm91cFtpXSkgewogICAgICAgICAgaWYgKG5leHQgJiYgbmV4dCAhPT0gbm9kZS5uZXh0U2libGluZykgbmV4dC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShub2RlLCBuZXh0KTsKICAgICAgICAgIG5leHQgPSBub2RlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuc29ydCA9IGZ1bmN0aW9uKGNvbXBhcmF0b3IpIHsKICAgIGNvbXBhcmF0b3IgPSBkM19zZWxlY3Rpb25fc29ydENvbXBhcmF0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIGZvciAodmFyIGogPSAtMSwgbSA9IHRoaXMubGVuZ3RoOyArK2ogPCBtOyApIHRoaXNbal0uc29ydChjb21wYXJhdG9yKTsKICAgIHJldHVybiB0aGlzLm9yZGVyKCk7CiAgfTsKICBmdW5jdGlvbiBkM19zZWxlY3Rpb25fc29ydENvbXBhcmF0b3IoY29tcGFyYXRvcikgewogICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSBjb21wYXJhdG9yID0gZDNfYXNjZW5kaW5nOwogICAgcmV0dXJuIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgcmV0dXJuIGEgJiYgYiA/IGNvbXBhcmF0b3IoYS5fX2RhdGFfXywgYi5fX2RhdGFfXykgOiAhYSAtICFiOwogICAgfTsKICB9CiAgZDNfc2VsZWN0aW9uUHJvdG90eXBlLmVhY2ggPSBmdW5jdGlvbihjYWxsYmFjaykgewogICAgcmV0dXJuIGQzX3NlbGVjdGlvbl9lYWNoKHRoaXMsIGZ1bmN0aW9uKG5vZGUsIGksIGopIHsKICAgICAgY2FsbGJhY2suY2FsbChub2RlLCBub2RlLl9fZGF0YV9fLCBpLCBqKTsKICAgIH0pOwogIH07CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uX2VhY2goZ3JvdXBzLCBjYWxsYmFjaykgewogICAgZm9yICh2YXIgaiA9IDAsIG0gPSBncm91cHMubGVuZ3RoOyBqIDwgbTsgaisrKSB7CiAgICAgIGZvciAodmFyIGdyb3VwID0gZ3JvdXBzW2pdLCBpID0gMCwgbiA9IGdyb3VwLmxlbmd0aCwgbm9kZTsgaSA8IG47IGkrKykgewogICAgICAgIGlmIChub2RlID0gZ3JvdXBbaV0pIGNhbGxiYWNrKG5vZGUsIGksIGopOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZ3JvdXBzOwogIH0KICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICB2YXIgYXJncyA9IGQzX2FycmF5KGFyZ3VtZW50cyk7CiAgICBjYWxsYmFjay5hcHBseShhcmdzWzBdID0gdGhpcywgYXJncyk7CiAgICByZXR1cm4gdGhpczsKICB9OwogIGQzX3NlbGVjdGlvblByb3RvdHlwZS5lbXB0eSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuICF0aGlzLm5vZGUoKTsKICB9OwogIGQzX3NlbGVjdGlvblByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24oKSB7CiAgICBmb3IgKHZhciBqID0gMCwgbSA9IHRoaXMubGVuZ3RoOyBqIDwgbTsgaisrKSB7CiAgICAgIGZvciAodmFyIGdyb3VwID0gdGhpc1tqXSwgaSA9IDAsIG4gPSBncm91cC5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICB2YXIgbm9kZSA9IGdyb3VwW2ldOwogICAgICAgIGlmIChub2RlKSByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuc2l6ZSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIG4gPSAwOwogICAgZDNfc2VsZWN0aW9uX2VhY2godGhpcywgZnVuY3Rpb24oKSB7CiAgICAgICsrbjsKICAgIH0pOwogICAgcmV0dXJuIG47CiAgfTsKICBmdW5jdGlvbiBkM19zZWxlY3Rpb25fZW50ZXIoc2VsZWN0aW9uKSB7CiAgICBkM19zdWJjbGFzcyhzZWxlY3Rpb24sIGQzX3NlbGVjdGlvbl9lbnRlclByb3RvdHlwZSk7CiAgICByZXR1cm4gc2VsZWN0aW9uOwogIH0KICB2YXIgZDNfc2VsZWN0aW9uX2VudGVyUHJvdG90eXBlID0gW107CiAgZDMuc2VsZWN0aW9uLmVudGVyID0gZDNfc2VsZWN0aW9uX2VudGVyOwogIGQzLnNlbGVjdGlvbi5lbnRlci5wcm90b3R5cGUgPSBkM19zZWxlY3Rpb25fZW50ZXJQcm90b3R5cGU7CiAgZDNfc2VsZWN0aW9uX2VudGVyUHJvdG90eXBlLmFwcGVuZCA9IGQzX3NlbGVjdGlvblByb3RvdHlwZS5hcHBlbmQ7CiAgZDNfc2VsZWN0aW9uX2VudGVyUHJvdG90eXBlLmVtcHR5ID0gZDNfc2VsZWN0aW9uUHJvdG90eXBlLmVtcHR5OwogIGQzX3NlbGVjdGlvbl9lbnRlclByb3RvdHlwZS5ub2RlID0gZDNfc2VsZWN0aW9uUHJvdG90eXBlLm5vZGU7CiAgZDNfc2VsZWN0aW9uX2VudGVyUHJvdG90eXBlLmNhbGwgPSBkM19zZWxlY3Rpb25Qcm90b3R5cGUuY2FsbDsKICBkM19zZWxlY3Rpb25fZW50ZXJQcm90b3R5cGUuc2l6ZSA9IGQzX3NlbGVjdGlvblByb3RvdHlwZS5zaXplOwogIGQzX3NlbGVjdGlvbl9lbnRlclByb3RvdHlwZS5zZWxlY3QgPSBmdW5jdGlvbihzZWxlY3RvcikgewogICAgdmFyIHN1Ymdyb3VwcyA9IFtdLCBzdWJncm91cCwgc3Vibm9kZSwgdXBncm91cCwgZ3JvdXAsIG5vZGU7CiAgICBmb3IgKHZhciBqID0gLTEsIG0gPSB0aGlzLmxlbmd0aDsgKytqIDwgbTsgKSB7CiAgICAgIHVwZ3JvdXAgPSAoZ3JvdXAgPSB0aGlzW2pdKS51cGRhdGU7CiAgICAgIHN1Ymdyb3Vwcy5wdXNoKHN1Ymdyb3VwID0gW10pOwogICAgICBzdWJncm91cC5wYXJlbnROb2RlID0gZ3JvdXAucGFyZW50Tm9kZTsKICAgICAgZm9yICh2YXIgaSA9IC0xLCBuID0gZ3JvdXAubGVuZ3RoOyArK2kgPCBuOyApIHsKICAgICAgICBpZiAobm9kZSA9IGdyb3VwW2ldKSB7CiAgICAgICAgICBzdWJncm91cC5wdXNoKHVwZ3JvdXBbaV0gPSBzdWJub2RlID0gc2VsZWN0b3IuY2FsbChncm91cC5wYXJlbnROb2RlLCBub2RlLl9fZGF0YV9fLCBpLCBqKSk7CiAgICAgICAgICBzdWJub2RlLl9fZGF0YV9fID0gbm9kZS5fX2RhdGFfXzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3ViZ3JvdXAucHVzaChudWxsKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkM19zZWxlY3Rpb24oc3ViZ3JvdXBzKTsKICB9OwogIGQzX3NlbGVjdGlvbl9lbnRlclByb3RvdHlwZS5pbnNlcnQgPSBmdW5jdGlvbihuYW1lLCBiZWZvcmUpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgYmVmb3JlID0gZDNfc2VsZWN0aW9uX2VudGVySW5zZXJ0QmVmb3JlKHRoaXMpOwogICAgcmV0dXJuIGQzX3NlbGVjdGlvblByb3RvdHlwZS5pbnNlcnQuY2FsbCh0aGlzLCBuYW1lLCBiZWZvcmUpOwogIH07CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uX2VudGVySW5zZXJ0QmVmb3JlKGVudGVyKSB7CiAgICB2YXIgaTAsIGowOwogICAgcmV0dXJuIGZ1bmN0aW9uKGQsIGksIGopIHsKICAgICAgdmFyIGdyb3VwID0gZW50ZXJbal0udXBkYXRlLCBuID0gZ3JvdXAubGVuZ3RoLCBub2RlOwogICAgICBpZiAoaiAhPSBqMCkgajAgPSBqLCBpMCA9IDA7CiAgICAgIGlmIChpID49IGkwKSBpMCA9IGkgKyAxOwogICAgICB3aGlsZSAoIShub2RlID0gZ3JvdXBbaTBdKSAmJiArK2kwIDwgbikgOwogICAgICByZXR1cm4gbm9kZTsKICAgIH07CiAgfQogIGQzLnNlbGVjdCA9IGZ1bmN0aW9uKG5vZGUpIHsKICAgIHZhciBncm91cCA9IFsgdHlwZW9mIG5vZGUgPT09ICJzdHJpbmciID8gZDNfc2VsZWN0KG5vZGUsIGQzX2RvY3VtZW50KSA6IG5vZGUgXTsKICAgIGdyb3VwLnBhcmVudE5vZGUgPSBkM19kb2N1bWVudEVsZW1lbnQ7CiAgICByZXR1cm4gZDNfc2VsZWN0aW9uKFsgZ3JvdXAgXSk7CiAgfTsKICBkMy5zZWxlY3RBbGwgPSBmdW5jdGlvbihub2RlcykgewogICAgdmFyIGdyb3VwID0gZDNfYXJyYXkodHlwZW9mIG5vZGVzID09PSAic3RyaW5nIiA/IGQzX3NlbGVjdEFsbChub2RlcywgZDNfZG9jdW1lbnQpIDogbm9kZXMpOwogICAgZ3JvdXAucGFyZW50Tm9kZSA9IGQzX2RvY3VtZW50RWxlbWVudDsKICAgIHJldHVybiBkM19zZWxlY3Rpb24oWyBncm91cCBdKTsKICB9OwogIHZhciBkM19zZWxlY3Rpb25Sb290ID0gZDMuc2VsZWN0KGQzX2RvY3VtZW50RWxlbWVudCk7CiAgZDNfc2VsZWN0aW9uUHJvdG90eXBlLm9uID0gZnVuY3Rpb24odHlwZSwgbGlzdGVuZXIsIGNhcHR1cmUpIHsKICAgIHZhciBuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgIGlmIChuIDwgMykgewogICAgICBpZiAodHlwZW9mIHR5cGUgIT09ICJzdHJpbmciKSB7CiAgICAgICAgaWYgKG4gPCAyKSBsaXN0ZW5lciA9IGZhbHNlOwogICAgICAgIGZvciAoY2FwdHVyZSBpbiB0eXBlKSB0aGlzLmVhY2goZDNfc2VsZWN0aW9uX29uKGNhcHR1cmUsIHR5cGVbY2FwdHVyZV0sIGxpc3RlbmVyKSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgaWYgKG4gPCAyKSByZXR1cm4gKG4gPSB0aGlzLm5vZGUoKVsiX19vbiIgKyB0eXBlXSkgJiYgbi5fOwogICAgICBjYXB0dXJlID0gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gdGhpcy5lYWNoKGQzX3NlbGVjdGlvbl9vbih0eXBlLCBsaXN0ZW5lciwgY2FwdHVyZSkpOwogIH07CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uX29uKHR5cGUsIGxpc3RlbmVyLCBjYXB0dXJlKSB7CiAgICB2YXIgbmFtZSA9ICJfX29uIiArIHR5cGUsIGkgPSB0eXBlLmluZGV4T2YoIi4iKSwgd3JhcCA9IGQzX3NlbGVjdGlvbl9vbkxpc3RlbmVyOwogICAgaWYgKGkgPiAwKSB0eXBlID0gdHlwZS5zbGljZSgwLCBpKTsKICAgIHZhciBmaWx0ZXIgPSBkM19zZWxlY3Rpb25fb25GaWx0ZXJzLmdldCh0eXBlKTsKICAgIGlmIChmaWx0ZXIpIHR5cGUgPSBmaWx0ZXIsIHdyYXAgPSBkM19zZWxlY3Rpb25fb25GaWx0ZXI7CiAgICBmdW5jdGlvbiBvblJlbW92ZSgpIHsKICAgICAgdmFyIGwgPSB0aGlzW25hbWVdOwogICAgICBpZiAobCkgewogICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsLCBsLiQpOwogICAgICAgIGRlbGV0ZSB0aGlzW25hbWVdOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBvbkFkZCgpIHsKICAgICAgdmFyIGwgPSB3cmFwKGxpc3RlbmVyLCBkM19hcnJheShhcmd1bWVudHMpKTsKICAgICAgb25SZW1vdmUuY2FsbCh0aGlzKTsKICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsIHRoaXNbbmFtZV0gPSBsLCBsLiQgPSBjYXB0dXJlKTsKICAgICAgbC5fID0gbGlzdGVuZXI7CiAgICB9CiAgICBmdW5jdGlvbiByZW1vdmVBbGwoKSB7CiAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAoIl5fX29uKFteLl0rKSIgKyBkMy5yZXF1b3RlKHR5cGUpICsgIiQiKSwgbWF0Y2g7CiAgICAgIGZvciAodmFyIG5hbWUgaW4gdGhpcykgewogICAgICAgIGlmIChtYXRjaCA9IG5hbWUubWF0Y2gocmUpKSB7CiAgICAgICAgICB2YXIgbCA9IHRoaXNbbmFtZV07CiAgICAgICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIobWF0Y2hbMV0sIGwsIGwuJCk7CiAgICAgICAgICBkZWxldGUgdGhpc1tuYW1lXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBpID8gbGlzdGVuZXIgPyBvbkFkZCA6IG9uUmVtb3ZlIDogbGlzdGVuZXIgPyBkM19ub29wIDogcmVtb3ZlQWxsOwogIH0KICB2YXIgZDNfc2VsZWN0aW9uX29uRmlsdGVycyA9IGQzLm1hcCh7CiAgICBtb3VzZWVudGVyOiAibW91c2VvdmVyIiwKICAgIG1vdXNlbGVhdmU6ICJtb3VzZW91dCIKICB9KTsKICBkM19zZWxlY3Rpb25fb25GaWx0ZXJzLmZvckVhY2goZnVuY3Rpb24oaykgewogICAgaWYgKCJvbiIgKyBrIGluIGQzX2RvY3VtZW50KSBkM19zZWxlY3Rpb25fb25GaWx0ZXJzLnJlbW92ZShrKTsKICB9KTsKICBmdW5jdGlvbiBkM19zZWxlY3Rpb25fb25MaXN0ZW5lcihsaXN0ZW5lciwgYXJndW1lbnR6KSB7CiAgICByZXR1cm4gZnVuY3Rpb24oZSkgewogICAgICB2YXIgbyA9IGQzLmV2ZW50OwogICAgICBkMy5ldmVudCA9IGU7CiAgICAgIGFyZ3VtZW50elswXSA9IHRoaXMuX19kYXRhX187CiAgICAgIHRyeSB7CiAgICAgICAgbGlzdGVuZXIuYXBwbHkodGhpcywgYXJndW1lbnR6KTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBkMy5ldmVudCA9IG87CiAgICAgIH0KICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX3NlbGVjdGlvbl9vbkZpbHRlcihsaXN0ZW5lciwgYXJndW1lbnR6KSB7CiAgICB2YXIgbCA9IGQzX3NlbGVjdGlvbl9vbkxpc3RlbmVyKGxpc3RlbmVyLCBhcmd1bWVudHopOwogICAgcmV0dXJuIGZ1bmN0aW9uKGUpIHsKICAgICAgdmFyIHRhcmdldCA9IHRoaXMsIHJlbGF0ZWQgPSBlLnJlbGF0ZWRUYXJnZXQ7CiAgICAgIGlmICghcmVsYXRlZCB8fCByZWxhdGVkICE9PSB0YXJnZXQgJiYgIShyZWxhdGVkLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKHRhcmdldCkgJiA4KSkgewogICAgICAgIGwuY2FsbCh0YXJnZXQsIGUpOwogICAgICB9CiAgICB9OwogIH0KICB2YXIgZDNfZXZlbnRfZHJhZ1NlbGVjdCA9ICJvbnNlbGVjdHN0YXJ0IiBpbiBkM19kb2N1bWVudCA/IG51bGwgOiBkM192ZW5kb3JTeW1ib2woZDNfZG9jdW1lbnRFbGVtZW50LnN0eWxlLCAidXNlclNlbGVjdCIpLCBkM19ldmVudF9kcmFnSWQgPSAwOwogIGZ1bmN0aW9uIGQzX2V2ZW50X2RyYWdTdXBwcmVzcygpIHsKICAgIHZhciBuYW1lID0gIi5kcmFnc3VwcHJlc3MtIiArICsrZDNfZXZlbnRfZHJhZ0lkLCBjbGljayA9ICJjbGljayIgKyBuYW1lLCB3ID0gZDMuc2VsZWN0KGQzX3dpbmRvdykub24oInRvdWNobW92ZSIgKyBuYW1lLCBkM19ldmVudFByZXZlbnREZWZhdWx0KS5vbigiZHJhZ3N0YXJ0IiArIG5hbWUsIGQzX2V2ZW50UHJldmVudERlZmF1bHQpLm9uKCJzZWxlY3RzdGFydCIgKyBuYW1lLCBkM19ldmVudFByZXZlbnREZWZhdWx0KTsKICAgIGlmIChkM19ldmVudF9kcmFnU2VsZWN0KSB7CiAgICAgIHZhciBzdHlsZSA9IGQzX2RvY3VtZW50RWxlbWVudC5zdHlsZSwgc2VsZWN0ID0gc3R5bGVbZDNfZXZlbnRfZHJhZ1NlbGVjdF07CiAgICAgIHN0eWxlW2QzX2V2ZW50X2RyYWdTZWxlY3RdID0gIm5vbmUiOwogICAgfQogICAgcmV0dXJuIGZ1bmN0aW9uKHN1cHByZXNzQ2xpY2spIHsKICAgICAgdy5vbihuYW1lLCBudWxsKTsKICAgICAgaWYgKGQzX2V2ZW50X2RyYWdTZWxlY3QpIHN0eWxlW2QzX2V2ZW50X2RyYWdTZWxlY3RdID0gc2VsZWN0OwogICAgICBpZiAoc3VwcHJlc3NDbGljaykgewogICAgICAgIHZhciBvZmYgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHcub24oY2xpY2ssIG51bGwpOwogICAgICAgIH07CiAgICAgICAgdy5vbihjbGljaywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBkM19ldmVudFByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBvZmYoKTsKICAgICAgICB9LCB0cnVlKTsKICAgICAgICBzZXRUaW1lb3V0KG9mZiwgMCk7CiAgICAgIH0KICAgIH07CiAgfQogIGQzLm1vdXNlID0gZnVuY3Rpb24oY29udGFpbmVyKSB7CiAgICByZXR1cm4gZDNfbW91c2VQb2ludChjb250YWluZXIsIGQzX2V2ZW50U291cmNlKCkpOwogIH07CiAgdmFyIGQzX21vdXNlX2J1ZzQ0MDgzID0gL1dlYktpdC8udGVzdChkM193aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCkgPyAtMSA6IDA7CiAgZnVuY3Rpb24gZDNfbW91c2VQb2ludChjb250YWluZXIsIGUpIHsKICAgIGlmIChlLmNoYW5nZWRUb3VjaGVzKSBlID0gZS5jaGFuZ2VkVG91Y2hlc1swXTsKICAgIHZhciBzdmcgPSBjb250YWluZXIub3duZXJTVkdFbGVtZW50IHx8IGNvbnRhaW5lcjsKICAgIGlmIChzdmcuY3JlYXRlU1ZHUG9pbnQpIHsKICAgICAgdmFyIHBvaW50ID0gc3ZnLmNyZWF0ZVNWR1BvaW50KCk7CiAgICAgIGlmIChkM19tb3VzZV9idWc0NDA4MyA8IDAgJiYgKGQzX3dpbmRvdy5zY3JvbGxYIHx8IGQzX3dpbmRvdy5zY3JvbGxZKSkgewogICAgICAgIHN2ZyA9IGQzLnNlbGVjdCgiYm9keSIpLmFwcGVuZCgic3ZnIikuc3R5bGUoewogICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsCiAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICBsZWZ0OiAwLAogICAgICAgICAgbWFyZ2luOiAwLAogICAgICAgICAgcGFkZGluZzogMCwKICAgICAgICAgIGJvcmRlcjogIm5vbmUiCiAgICAgICAgfSwgImltcG9ydGFudCIpOwogICAgICAgIHZhciBjdG0gPSBzdmdbMF1bMF0uZ2V0U2NyZWVuQ1RNKCk7CiAgICAgICAgZDNfbW91c2VfYnVnNDQwODMgPSAhKGN0bS5mIHx8IGN0bS5lKTsKICAgICAgICBzdmcucmVtb3ZlKCk7CiAgICAgIH0KICAgICAgaWYgKGQzX21vdXNlX2J1ZzQ0MDgzKSBwb2ludC54ID0gZS5wYWdlWCwgcG9pbnQueSA9IGUucGFnZVk7IGVsc2UgcG9pbnQueCA9IGUuY2xpZW50WCwgCiAgICAgIHBvaW50LnkgPSBlLmNsaWVudFk7CiAgICAgIHBvaW50ID0gcG9pbnQubWF0cml4VHJhbnNmb3JtKGNvbnRhaW5lci5nZXRTY3JlZW5DVE0oKS5pbnZlcnNlKCkpOwogICAgICByZXR1cm4gWyBwb2ludC54LCBwb2ludC55IF07CiAgICB9CiAgICB2YXIgcmVjdCA9IGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIHJldHVybiBbIGUuY2xpZW50WCAtIHJlY3QubGVmdCAtIGNvbnRhaW5lci5jbGllbnRMZWZ0LCBlLmNsaWVudFkgLSByZWN0LnRvcCAtIGNvbnRhaW5lci5jbGllbnRUb3AgXTsKICB9CiAgZDMudG91Y2ggPSBmdW5jdGlvbihjb250YWluZXIsIHRvdWNoZXMsIGlkZW50aWZpZXIpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMykgaWRlbnRpZmllciA9IHRvdWNoZXMsIHRvdWNoZXMgPSBkM19ldmVudFNvdXJjZSgpLmNoYW5nZWRUb3VjaGVzOwogICAgaWYgKHRvdWNoZXMpIGZvciAodmFyIGkgPSAwLCBuID0gdG91Y2hlcy5sZW5ndGgsIHRvdWNoOyBpIDwgbjsgKytpKSB7CiAgICAgIGlmICgodG91Y2ggPSB0b3VjaGVzW2ldKS5pZGVudGlmaWVyID09PSBpZGVudGlmaWVyKSB7CiAgICAgICAgcmV0dXJuIGQzX21vdXNlUG9pbnQoY29udGFpbmVyLCB0b3VjaCk7CiAgICAgIH0KICAgIH0KICB9OwogIGQzLmJlaGF2aW9yLmRyYWcgPSBmdW5jdGlvbigpIHsKICAgIHZhciBldmVudCA9IGQzX2V2ZW50RGlzcGF0Y2goZHJhZywgImRyYWciLCAiZHJhZ3N0YXJ0IiwgImRyYWdlbmQiKSwgb3JpZ2luID0gbnVsbCwgbW91c2Vkb3duID0gZHJhZ3N0YXJ0KGQzX25vb3AsIGQzLm1vdXNlLCBkM19iZWhhdmlvcl9kcmFnTW91c2VTdWJqZWN0LCAibW91c2Vtb3ZlIiwgIm1vdXNldXAiKSwgdG91Y2hzdGFydCA9IGRyYWdzdGFydChkM19iZWhhdmlvcl9kcmFnVG91Y2hJZCwgZDMudG91Y2gsIGQzX2JlaGF2aW9yX2RyYWdUb3VjaFN1YmplY3QsICJ0b3VjaG1vdmUiLCAidG91Y2hlbmQiKTsKICAgIGZ1bmN0aW9uIGRyYWcoKSB7CiAgICAgIHRoaXMub24oIm1vdXNlZG93bi5kcmFnIiwgbW91c2Vkb3duKS5vbigidG91Y2hzdGFydC5kcmFnIiwgdG91Y2hzdGFydCk7CiAgICB9CiAgICBmdW5jdGlvbiBkcmFnc3RhcnQoaWQsIHBvc2l0aW9uLCBzdWJqZWN0LCBtb3ZlLCBlbmQpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB0aGF0ID0gdGhpcywgdGFyZ2V0ID0gZDMuZXZlbnQudGFyZ2V0LCBwYXJlbnQgPSB0aGF0LnBhcmVudE5vZGUsIGRpc3BhdGNoID0gZXZlbnQub2YodGhhdCwgYXJndW1lbnRzKSwgZHJhZ2dlZCA9IDAsIGRyYWdJZCA9IGlkKCksIGRyYWdOYW1lID0gIi5kcmFnIiArIChkcmFnSWQgPT0gbnVsbCA/ICIiIDogIi0iICsgZHJhZ0lkKSwgZHJhZ09mZnNldCwgZHJhZ1N1YmplY3QgPSBkMy5zZWxlY3Qoc3ViamVjdCgpKS5vbihtb3ZlICsgZHJhZ05hbWUsIG1vdmVkKS5vbihlbmQgKyBkcmFnTmFtZSwgZW5kZWQpLCBkcmFnUmVzdG9yZSA9IGQzX2V2ZW50X2RyYWdTdXBwcmVzcygpLCBwb3NpdGlvbjAgPSBwb3NpdGlvbihwYXJlbnQsIGRyYWdJZCk7CiAgICAgICAgaWYgKG9yaWdpbikgewogICAgICAgICAgZHJhZ09mZnNldCA9IG9yaWdpbi5hcHBseSh0aGF0LCBhcmd1bWVudHMpOwogICAgICAgICAgZHJhZ09mZnNldCA9IFsgZHJhZ09mZnNldC54IC0gcG9zaXRpb24wWzBdLCBkcmFnT2Zmc2V0LnkgLSBwb3NpdGlvbjBbMV0gXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZHJhZ09mZnNldCA9IFsgMCwgMCBdOwogICAgICAgIH0KICAgICAgICBkaXNwYXRjaCh7CiAgICAgICAgICB0eXBlOiAiZHJhZ3N0YXJ0IgogICAgICAgIH0pOwogICAgICAgIGZ1bmN0aW9uIG1vdmVkKCkgewogICAgICAgICAgdmFyIHBvc2l0aW9uMSA9IHBvc2l0aW9uKHBhcmVudCwgZHJhZ0lkKSwgZHgsIGR5OwogICAgICAgICAgaWYgKCFwb3NpdGlvbjEpIHJldHVybjsKICAgICAgICAgIGR4ID0gcG9zaXRpb24xWzBdIC0gcG9zaXRpb24wWzBdOwogICAgICAgICAgZHkgPSBwb3NpdGlvbjFbMV0gLSBwb3NpdGlvbjBbMV07CiAgICAgICAgICBkcmFnZ2VkIHw9IGR4IHwgZHk7CiAgICAgICAgICBwb3NpdGlvbjAgPSBwb3NpdGlvbjE7CiAgICAgICAgICBkaXNwYXRjaCh7CiAgICAgICAgICAgIHR5cGU6ICJkcmFnIiwKICAgICAgICAgICAgeDogcG9zaXRpb24xWzBdICsgZHJhZ09mZnNldFswXSwKICAgICAgICAgICAgeTogcG9zaXRpb24xWzFdICsgZHJhZ09mZnNldFsxXSwKICAgICAgICAgICAgZHg6IGR4LAogICAgICAgICAgICBkeTogZHkKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBlbmRlZCgpIHsKICAgICAgICAgIGlmICghcG9zaXRpb24ocGFyZW50LCBkcmFnSWQpKSByZXR1cm47CiAgICAgICAgICBkcmFnU3ViamVjdC5vbihtb3ZlICsgZHJhZ05hbWUsIG51bGwpLm9uKGVuZCArIGRyYWdOYW1lLCBudWxsKTsKICAgICAgICAgIGRyYWdSZXN0b3JlKGRyYWdnZWQgJiYgZDMuZXZlbnQudGFyZ2V0ID09PSB0YXJnZXQpOwogICAgICAgICAgZGlzcGF0Y2goewogICAgICAgICAgICB0eXBlOiAiZHJhZ2VuZCIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKICAgIH0KICAgIGRyYWcub3JpZ2luID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBvcmlnaW47CiAgICAgIG9yaWdpbiA9IHg7CiAgICAgIHJldHVybiBkcmFnOwogICAgfTsKICAgIHJldHVybiBkMy5yZWJpbmQoZHJhZywgZXZlbnQsICJvbiIpOwogIH07CiAgZnVuY3Rpb24gZDNfYmVoYXZpb3JfZHJhZ1RvdWNoSWQoKSB7CiAgICByZXR1cm4gZDMuZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uaWRlbnRpZmllcjsKICB9CiAgZnVuY3Rpb24gZDNfYmVoYXZpb3JfZHJhZ1RvdWNoU3ViamVjdCgpIHsKICAgIHJldHVybiBkMy5ldmVudC50YXJnZXQ7CiAgfQogIGZ1bmN0aW9uIGQzX2JlaGF2aW9yX2RyYWdNb3VzZVN1YmplY3QoKSB7CiAgICByZXR1cm4gZDNfd2luZG93OwogIH0KICBkMy50b3VjaGVzID0gZnVuY3Rpb24oY29udGFpbmVyLCB0b3VjaGVzKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHRvdWNoZXMgPSBkM19ldmVudFNvdXJjZSgpLnRvdWNoZXM7CiAgICByZXR1cm4gdG91Y2hlcyA/IGQzX2FycmF5KHRvdWNoZXMpLm1hcChmdW5jdGlvbih0b3VjaCkgewogICAgICB2YXIgcG9pbnQgPSBkM19tb3VzZVBvaW50KGNvbnRhaW5lciwgdG91Y2gpOwogICAgICBwb2ludC5pZGVudGlmaWVyID0gdG91Y2guaWRlbnRpZmllcjsKICAgICAgcmV0dXJuIHBvaW50OwogICAgfSkgOiBbXTsKICB9OwogIHZhciDOtSA9IDFlLTYsIM61MiA9IM61ICogzrUsIM+AID0gTWF0aC5QSSwgz4QgPSAyICogz4AsIM+EzrUgPSDPhCAtIM61LCBoYWxmz4AgPSDPgCAvIDIsIGQzX3JhZGlhbnMgPSDPgCAvIDE4MCwgZDNfZGVncmVlcyA9IDE4MCAvIM+AOwogIGZ1bmN0aW9uIGQzX3Nnbih4KSB7CiAgICByZXR1cm4geCA+IDAgPyAxIDogeCA8IDAgPyAtMSA6IDA7CiAgfQogIGZ1bmN0aW9uIGQzX2Nyb3NzMmQoYSwgYiwgYykgewogICAgcmV0dXJuIChiWzBdIC0gYVswXSkgKiAoY1sxXSAtIGFbMV0pIC0gKGJbMV0gLSBhWzFdKSAqIChjWzBdIC0gYVswXSk7CiAgfQogIGZ1bmN0aW9uIGQzX2Fjb3MoeCkgewogICAgcmV0dXJuIHggPiAxID8gMCA6IHggPCAtMSA/IM+AIDogTWF0aC5hY29zKHgpOwogIH0KICBmdW5jdGlvbiBkM19hc2luKHgpIHsKICAgIHJldHVybiB4ID4gMSA/IGhhbGbPgCA6IHggPCAtMSA/IC1oYWxmz4AgOiBNYXRoLmFzaW4oeCk7CiAgfQogIGZ1bmN0aW9uIGQzX3NpbmgoeCkgewogICAgcmV0dXJuICgoeCA9IE1hdGguZXhwKHgpKSAtIDEgLyB4KSAvIDI7CiAgfQogIGZ1bmN0aW9uIGQzX2Nvc2goeCkgewogICAgcmV0dXJuICgoeCA9IE1hdGguZXhwKHgpKSArIDEgLyB4KSAvIDI7CiAgfQogIGZ1bmN0aW9uIGQzX3RhbmgoeCkgewogICAgcmV0dXJuICgoeCA9IE1hdGguZXhwKDIgKiB4KSkgLSAxKSAvICh4ICsgMSk7CiAgfQogIGZ1bmN0aW9uIGQzX2hhdmVyc2luKHgpIHsKICAgIHJldHVybiAoeCA9IE1hdGguc2luKHggLyAyKSkgKiB4OwogIH0KICB2YXIgz4EgPSBNYXRoLlNRUlQyLCDPgTIgPSAyLCDPgTQgPSA0OwogIGQzLmludGVycG9sYXRlWm9vbSA9IGZ1bmN0aW9uKHAwLCBwMSkgewogICAgdmFyIHV4MCA9IHAwWzBdLCB1eTAgPSBwMFsxXSwgdzAgPSBwMFsyXSwgdXgxID0gcDFbMF0sIHV5MSA9IHAxWzFdLCB3MSA9IHAxWzJdOwogICAgdmFyIGR4ID0gdXgxIC0gdXgwLCBkeSA9IHV5MSAtIHV5MCwgZDIgPSBkeCAqIGR4ICsgZHkgKiBkeSwgZDEgPSBNYXRoLnNxcnQoZDIpLCBiMCA9ICh3MSAqIHcxIC0gdzAgKiB3MCArIM+BNCAqIGQyKSAvICgyICogdzAgKiDPgTIgKiBkMSksIGIxID0gKHcxICogdzEgLSB3MCAqIHcwIC0gz4E0ICogZDIpIC8gKDIgKiB3MSAqIM+BMiAqIGQxKSwgcjAgPSBNYXRoLmxvZyhNYXRoLnNxcnQoYjAgKiBiMCArIDEpIC0gYjApLCByMSA9IE1hdGgubG9nKE1hdGguc3FydChiMSAqIGIxICsgMSkgLSBiMSksIGRyID0gcjEgLSByMCwgUyA9IChkciB8fCBNYXRoLmxvZyh3MSAvIHcwKSkgLyDPgTsKICAgIGZ1bmN0aW9uIGludGVycG9sYXRlKHQpIHsKICAgICAgdmFyIHMgPSB0ICogUzsKICAgICAgaWYgKGRyKSB7CiAgICAgICAgdmFyIGNvc2hyMCA9IGQzX2Nvc2gocjApLCB1ID0gdzAgLyAoz4EyICogZDEpICogKGNvc2hyMCAqIGQzX3Rhbmgoz4EgKiBzICsgcjApIC0gZDNfc2luaChyMCkpOwogICAgICAgIHJldHVybiBbIHV4MCArIHUgKiBkeCwgdXkwICsgdSAqIGR5LCB3MCAqIGNvc2hyMCAvIGQzX2Nvc2goz4EgKiBzICsgcjApIF07CiAgICAgIH0KICAgICAgcmV0dXJuIFsgdXgwICsgdCAqIGR4LCB1eTAgKyB0ICogZHksIHcwICogTWF0aC5leHAoz4EgKiBzKSBdOwogICAgfQogICAgaW50ZXJwb2xhdGUuZHVyYXRpb24gPSBTICogMWUzOwogICAgcmV0dXJuIGludGVycG9sYXRlOwogIH07CiAgZDMuYmVoYXZpb3Iuem9vbSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHZpZXcgPSB7CiAgICAgIHg6IDAsCiAgICAgIHk6IDAsCiAgICAgIGs6IDEKICAgIH0sIHRyYW5zbGF0ZTAsIGNlbnRlcjAsIGNlbnRlciwgc2l6ZSA9IFsgOTYwLCA1MDAgXSwgc2NhbGVFeHRlbnQgPSBkM19iZWhhdmlvcl96b29tSW5maW5pdHksIGR1cmF0aW9uID0gMjUwLCB6b29taW5nID0gMCwgbW91c2Vkb3duID0gIm1vdXNlZG93bi56b29tIiwgbW91c2Vtb3ZlID0gIm1vdXNlbW92ZS56b29tIiwgbW91c2V1cCA9ICJtb3VzZXVwLnpvb20iLCBtb3VzZXdoZWVsVGltZXIsIHRvdWNoc3RhcnQgPSAidG91Y2hzdGFydC56b29tIiwgdG91Y2h0aW1lLCBldmVudCA9IGQzX2V2ZW50RGlzcGF0Y2goem9vbSwgInpvb21zdGFydCIsICJ6b29tIiwgInpvb21lbmQiKSwgeDAsIHgxLCB5MCwgeTE7CiAgICBmdW5jdGlvbiB6b29tKGcpIHsKICAgICAgZy5vbihtb3VzZWRvd24sIG1vdXNlZG93bmVkKS5vbihkM19iZWhhdmlvcl96b29tV2hlZWwgKyAiLnpvb20iLCBtb3VzZXdoZWVsZWQpLm9uKCJkYmxjbGljay56b29tIiwgZGJsY2xpY2tlZCkub24odG91Y2hzdGFydCwgdG91Y2hzdGFydGVkKTsKICAgIH0KICAgIHpvb20uZXZlbnQgPSBmdW5jdGlvbihnKSB7CiAgICAgIGcuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZGlzcGF0Y2ggPSBldmVudC5vZih0aGlzLCBhcmd1bWVudHMpLCB2aWV3MSA9IHZpZXc7CiAgICAgICAgaWYgKGQzX3RyYW5zaXRpb25Jbmhlcml0SWQpIHsKICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKS50cmFuc2l0aW9uKCkuZWFjaCgic3RhcnQuem9vbSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2aWV3ID0gdGhpcy5fX2NoYXJ0X18gfHwgewogICAgICAgICAgICAgIHg6IDAsCiAgICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgICBrOiAxCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHpvb21zdGFydGVkKGRpc3BhdGNoKTsKICAgICAgICAgIH0pLnR3ZWVuKCJ6b29tOnpvb20iLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGR4ID0gc2l6ZVswXSwgZHkgPSBzaXplWzFdLCBjeCA9IGNlbnRlcjAgPyBjZW50ZXIwWzBdIDogZHggLyAyLCBjeSA9IGNlbnRlcjAgPyBjZW50ZXIwWzFdIDogZHkgLyAyLCBpID0gZDMuaW50ZXJwb2xhdGVab29tKFsgKGN4IC0gdmlldy54KSAvIHZpZXcuaywgKGN5IC0gdmlldy55KSAvIHZpZXcuaywgZHggLyB2aWV3LmsgXSwgWyAoY3ggLSB2aWV3MS54KSAvIHZpZXcxLmssIChjeSAtIHZpZXcxLnkpIC8gdmlldzEuaywgZHggLyB2aWV3MS5rIF0pOwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgICAgICAgICAgIHZhciBsID0gaSh0KSwgayA9IGR4IC8gbFsyXTsKICAgICAgICAgICAgICB0aGlzLl9fY2hhcnRfXyA9IHZpZXcgPSB7CiAgICAgICAgICAgICAgICB4OiBjeCAtIGxbMF0gKiBrLAogICAgICAgICAgICAgICAgeTogY3kgLSBsWzFdICogaywKICAgICAgICAgICAgICAgIGs6IGsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHpvb21lZChkaXNwYXRjaCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KS5lYWNoKCJpbnRlcnJ1cHQuem9vbSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICB6b29tZW5kZWQoZGlzcGF0Y2gpOwogICAgICAgICAgfSkuZWFjaCgiZW5kLnpvb20iLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgem9vbWVuZGVkKGRpc3BhdGNoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLl9fY2hhcnRfXyA9IHZpZXc7CiAgICAgICAgICB6b29tc3RhcnRlZChkaXNwYXRjaCk7CiAgICAgICAgICB6b29tZWQoZGlzcGF0Y2gpOwogICAgICAgICAgem9vbWVuZGVkKGRpc3BhdGNoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKICAgIHpvb20udHJhbnNsYXRlID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBbIHZpZXcueCwgdmlldy55IF07CiAgICAgIHZpZXcgPSB7CiAgICAgICAgeDogK19bMF0sCiAgICAgICAgeTogK19bMV0sCiAgICAgICAgazogdmlldy5rCiAgICAgIH07CiAgICAgIHJlc2NhbGUoKTsKICAgICAgcmV0dXJuIHpvb207CiAgICB9OwogICAgem9vbS5zY2FsZSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdmlldy5rOwogICAgICB2aWV3ID0gewogICAgICAgIHg6IHZpZXcueCwKICAgICAgICB5OiB2aWV3LnksCiAgICAgICAgazogK18KICAgICAgfTsKICAgICAgcmVzY2FsZSgpOwogICAgICByZXR1cm4gem9vbTsKICAgIH07CiAgICB6b29tLnNjYWxlRXh0ZW50ID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzY2FsZUV4dGVudDsKICAgICAgc2NhbGVFeHRlbnQgPSBfID09IG51bGwgPyBkM19iZWhhdmlvcl96b29tSW5maW5pdHkgOiBbICtfWzBdLCArX1sxXSBdOwogICAgICByZXR1cm4gem9vbTsKICAgIH07CiAgICB6b29tLmNlbnRlciA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gY2VudGVyOwogICAgICBjZW50ZXIgPSBfICYmIFsgK19bMF0sICtfWzFdIF07CiAgICAgIHJldHVybiB6b29tOwogICAgfTsKICAgIHpvb20uc2l6ZSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2l6ZTsKICAgICAgc2l6ZSA9IF8gJiYgWyArX1swXSwgK19bMV0gXTsKICAgICAgcmV0dXJuIHpvb207CiAgICB9OwogICAgem9vbS5kdXJhdGlvbiA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gZHVyYXRpb247CiAgICAgIGR1cmF0aW9uID0gK187CiAgICAgIHJldHVybiB6b29tOwogICAgfTsKICAgIHpvb20ueCA9IGZ1bmN0aW9uKHopIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4geDE7CiAgICAgIHgxID0gejsKICAgICAgeDAgPSB6LmNvcHkoKTsKICAgICAgdmlldyA9IHsKICAgICAgICB4OiAwLAogICAgICAgIHk6IDAsCiAgICAgICAgazogMQogICAgICB9OwogICAgICByZXR1cm4gem9vbTsKICAgIH07CiAgICB6b29tLnkgPSBmdW5jdGlvbih6KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHkxOwogICAgICB5MSA9IHo7CiAgICAgIHkwID0gei5jb3B5KCk7CiAgICAgIHZpZXcgPSB7CiAgICAgICAgeDogMCwKICAgICAgICB5OiAwLAogICAgICAgIGs6IDEKICAgICAgfTsKICAgICAgcmV0dXJuIHpvb207CiAgICB9OwogICAgZnVuY3Rpb24gbG9jYXRpb24ocCkgewogICAgICByZXR1cm4gWyAocFswXSAtIHZpZXcueCkgLyB2aWV3LmssIChwWzFdIC0gdmlldy55KSAvIHZpZXcuayBdOwogICAgfQogICAgZnVuY3Rpb24gcG9pbnQobCkgewogICAgICByZXR1cm4gWyBsWzBdICogdmlldy5rICsgdmlldy54LCBsWzFdICogdmlldy5rICsgdmlldy55IF07CiAgICB9CiAgICBmdW5jdGlvbiBzY2FsZVRvKHMpIHsKICAgICAgdmlldy5rID0gTWF0aC5tYXgoc2NhbGVFeHRlbnRbMF0sIE1hdGgubWluKHNjYWxlRXh0ZW50WzFdLCBzKSk7CiAgICB9CiAgICBmdW5jdGlvbiB0cmFuc2xhdGVUbyhwLCBsKSB7CiAgICAgIGwgPSBwb2ludChsKTsKICAgICAgdmlldy54ICs9IHBbMF0gLSBsWzBdOwogICAgICB2aWV3LnkgKz0gcFsxXSAtIGxbMV07CiAgICB9CiAgICBmdW5jdGlvbiB6b29tVG8odGhhdCwgcCwgbCwgaykgewogICAgICB0aGF0Ll9fY2hhcnRfXyA9IHsKICAgICAgICB4OiB2aWV3LngsCiAgICAgICAgeTogdmlldy55LAogICAgICAgIGs6IHZpZXcuawogICAgICB9OwogICAgICBzY2FsZVRvKE1hdGgucG93KDIsIGspKTsKICAgICAgdHJhbnNsYXRlVG8oY2VudGVyMCA9IHAsIGwpOwogICAgICB0aGF0ID0gZDMuc2VsZWN0KHRoYXQpOwogICAgICBpZiAoZHVyYXRpb24gPiAwKSB0aGF0ID0gdGhhdC50cmFuc2l0aW9uKCkuZHVyYXRpb24oZHVyYXRpb24pOwogICAgICB0aGF0LmNhbGwoem9vbS5ldmVudCk7CiAgICB9CiAgICBmdW5jdGlvbiByZXNjYWxlKCkgewogICAgICBpZiAoeDEpIHgxLmRvbWFpbih4MC5yYW5nZSgpLm1hcChmdW5jdGlvbih4KSB7CiAgICAgICAgcmV0dXJuICh4IC0gdmlldy54KSAvIHZpZXcuazsKICAgICAgfSkubWFwKHgwLmludmVydCkpOwogICAgICBpZiAoeTEpIHkxLmRvbWFpbih5MC5yYW5nZSgpLm1hcChmdW5jdGlvbih5KSB7CiAgICAgICAgcmV0dXJuICh5IC0gdmlldy55KSAvIHZpZXcuazsKICAgICAgfSkubWFwKHkwLmludmVydCkpOwogICAgfQogICAgZnVuY3Rpb24gem9vbXN0YXJ0ZWQoZGlzcGF0Y2gpIHsKICAgICAgaWYgKCF6b29taW5nKyspIGRpc3BhdGNoKHsKICAgICAgICB0eXBlOiAiem9vbXN0YXJ0IgogICAgICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIHpvb21lZChkaXNwYXRjaCkgewogICAgICByZXNjYWxlKCk7CiAgICAgIGRpc3BhdGNoKHsKICAgICAgICB0eXBlOiAiem9vbSIsCiAgICAgICAgc2NhbGU6IHZpZXcuaywKICAgICAgICB0cmFuc2xhdGU6IFsgdmlldy54LCB2aWV3LnkgXQogICAgICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIHpvb21lbmRlZChkaXNwYXRjaCkgewogICAgICBpZiAoIS0tem9vbWluZykgZGlzcGF0Y2goewogICAgICAgIHR5cGU6ICJ6b29tZW5kIgogICAgICB9KTsKICAgICAgY2VudGVyMCA9IG51bGw7CiAgICB9CiAgICBmdW5jdGlvbiBtb3VzZWRvd25lZCgpIHsKICAgICAgdmFyIHRoYXQgPSB0aGlzLCB0YXJnZXQgPSBkMy5ldmVudC50YXJnZXQsIGRpc3BhdGNoID0gZXZlbnQub2YodGhhdCwgYXJndW1lbnRzKSwgZHJhZ2dlZCA9IDAsIHN1YmplY3QgPSBkMy5zZWxlY3QoZDNfd2luZG93KS5vbihtb3VzZW1vdmUsIG1vdmVkKS5vbihtb3VzZXVwLCBlbmRlZCksIGxvY2F0aW9uMCA9IGxvY2F0aW9uKGQzLm1vdXNlKHRoYXQpKSwgZHJhZ1Jlc3RvcmUgPSBkM19ldmVudF9kcmFnU3VwcHJlc3MoKTsKICAgICAgZDNfc2VsZWN0aW9uX2ludGVycnVwdC5jYWxsKHRoYXQpOwogICAgICB6b29tc3RhcnRlZChkaXNwYXRjaCk7CiAgICAgIGZ1bmN0aW9uIG1vdmVkKCkgewogICAgICAgIGRyYWdnZWQgPSAxOwogICAgICAgIHRyYW5zbGF0ZVRvKGQzLm1vdXNlKHRoYXQpLCBsb2NhdGlvbjApOwogICAgICAgIHpvb21lZChkaXNwYXRjaCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZW5kZWQoKSB7CiAgICAgICAgc3ViamVjdC5vbihtb3VzZW1vdmUsIG51bGwpLm9uKG1vdXNldXAsIG51bGwpOwogICAgICAgIGRyYWdSZXN0b3JlKGRyYWdnZWQgJiYgZDMuZXZlbnQudGFyZ2V0ID09PSB0YXJnZXQpOwogICAgICAgIHpvb21lbmRlZChkaXNwYXRjaCk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHRvdWNoc3RhcnRlZCgpIHsKICAgICAgdmFyIHRoYXQgPSB0aGlzLCBkaXNwYXRjaCA9IGV2ZW50Lm9mKHRoYXQsIGFyZ3VtZW50cyksIGxvY2F0aW9uczAgPSB7fSwgZGlzdGFuY2UwID0gMCwgc2NhbGUwLCB6b29tTmFtZSA9ICIuem9vbS0iICsgZDMuZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uaWRlbnRpZmllciwgdG91Y2htb3ZlID0gInRvdWNobW92ZSIgKyB6b29tTmFtZSwgdG91Y2hlbmQgPSAidG91Y2hlbmQiICsgem9vbU5hbWUsIHRhcmdldHMgPSBbXSwgc3ViamVjdCA9IGQzLnNlbGVjdCh0aGF0KSwgZHJhZ1Jlc3RvcmUgPSBkM19ldmVudF9kcmFnU3VwcHJlc3MoKTsKICAgICAgc3RhcnRlZCgpOwogICAgICB6b29tc3RhcnRlZChkaXNwYXRjaCk7CiAgICAgIHN1YmplY3Qub24obW91c2Vkb3duLCBudWxsKS5vbih0b3VjaHN0YXJ0LCBzdGFydGVkKTsKICAgICAgZnVuY3Rpb24gcmVsb2NhdGUoKSB7CiAgICAgICAgdmFyIHRvdWNoZXMgPSBkMy50b3VjaGVzKHRoYXQpOwogICAgICAgIHNjYWxlMCA9IHZpZXcuazsKICAgICAgICB0b3VjaGVzLmZvckVhY2goZnVuY3Rpb24odCkgewogICAgICAgICAgaWYgKHQuaWRlbnRpZmllciBpbiBsb2NhdGlvbnMwKSBsb2NhdGlvbnMwW3QuaWRlbnRpZmllcl0gPSBsb2NhdGlvbih0KTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gdG91Y2hlczsKICAgICAgfQogICAgICBmdW5jdGlvbiBzdGFydGVkKCkgewogICAgICAgIHZhciB0YXJnZXQgPSBkMy5ldmVudC50YXJnZXQ7CiAgICAgICAgZDMuc2VsZWN0KHRhcmdldCkub24odG91Y2htb3ZlLCBtb3ZlZCkub24odG91Y2hlbmQsIGVuZGVkKTsKICAgICAgICB0YXJnZXRzLnB1c2godGFyZ2V0KTsKICAgICAgICB2YXIgY2hhbmdlZCA9IGQzLmV2ZW50LmNoYW5nZWRUb3VjaGVzOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gY2hhbmdlZC5sZW5ndGg7IGkgPCBuOyArK2kpIHsKICAgICAgICAgIGxvY2F0aW9uczBbY2hhbmdlZFtpXS5pZGVudGlmaWVyXSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHZhciB0b3VjaGVzID0gcmVsb2NhdGUoKSwgbm93ID0gRGF0ZS5ub3coKTsKICAgICAgICBpZiAodG91Y2hlcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgIGlmIChub3cgLSB0b3VjaHRpbWUgPCA1MDApIHsKICAgICAgICAgICAgdmFyIHAgPSB0b3VjaGVzWzBdOwogICAgICAgICAgICB6b29tVG8odGhhdCwgcCwgbG9jYXRpb25zMFtwLmlkZW50aWZpZXJdLCBNYXRoLmZsb29yKE1hdGgubG9nKHZpZXcuaykgLyBNYXRoLkxOMikgKyAxKTsKICAgICAgICAgICAgZDNfZXZlbnRQcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgfQogICAgICAgICAgdG91Y2h0aW1lID0gbm93OwogICAgICAgIH0gZWxzZSBpZiAodG91Y2hlcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICB2YXIgcCA9IHRvdWNoZXNbMF0sIHEgPSB0b3VjaGVzWzFdLCBkeCA9IHBbMF0gLSBxWzBdLCBkeSA9IHBbMV0gLSBxWzFdOwogICAgICAgICAgZGlzdGFuY2UwID0gZHggKiBkeCArIGR5ICogZHk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIG1vdmVkKCkgewogICAgICAgIHZhciB0b3VjaGVzID0gZDMudG91Y2hlcyh0aGF0KSwgcDAsIGwwLCBwMSwgbDE7CiAgICAgICAgZDNfc2VsZWN0aW9uX2ludGVycnVwdC5jYWxsKHRoYXQpOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gdG91Y2hlcy5sZW5ndGg7IGkgPCBuOyArK2ksIGwxID0gbnVsbCkgewogICAgICAgICAgcDEgPSB0b3VjaGVzW2ldOwogICAgICAgICAgaWYgKGwxID0gbG9jYXRpb25zMFtwMS5pZGVudGlmaWVyXSkgewogICAgICAgICAgICBpZiAobDApIGJyZWFrOwogICAgICAgICAgICBwMCA9IHAxLCBsMCA9IGwxOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAobDEpIHsKICAgICAgICAgIHZhciBkaXN0YW5jZTEgPSAoZGlzdGFuY2UxID0gcDFbMF0gLSBwMFswXSkgKiBkaXN0YW5jZTEgKyAoZGlzdGFuY2UxID0gcDFbMV0gLSBwMFsxXSkgKiBkaXN0YW5jZTEsIHNjYWxlMSA9IGRpc3RhbmNlMCAmJiBNYXRoLnNxcnQoZGlzdGFuY2UxIC8gZGlzdGFuY2UwKTsKICAgICAgICAgIHAwID0gWyAocDBbMF0gKyBwMVswXSkgLyAyLCAocDBbMV0gKyBwMVsxXSkgLyAyIF07CiAgICAgICAgICBsMCA9IFsgKGwwWzBdICsgbDFbMF0pIC8gMiwgKGwwWzFdICsgbDFbMV0pIC8gMiBdOwogICAgICAgICAgc2NhbGVUbyhzY2FsZTEgKiBzY2FsZTApOwogICAgICAgIH0KICAgICAgICB0b3VjaHRpbWUgPSBudWxsOwogICAgICAgIHRyYW5zbGF0ZVRvKHAwLCBsMCk7CiAgICAgICAgem9vbWVkKGRpc3BhdGNoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBlbmRlZCgpIHsKICAgICAgICBpZiAoZDMuZXZlbnQudG91Y2hlcy5sZW5ndGgpIHsKICAgICAgICAgIHZhciBjaGFuZ2VkID0gZDMuZXZlbnQuY2hhbmdlZFRvdWNoZXM7CiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbiA9IGNoYW5nZWQubGVuZ3RoOyBpIDwgbjsgKytpKSB7CiAgICAgICAgICAgIGRlbGV0ZSBsb2NhdGlvbnMwW2NoYW5nZWRbaV0uaWRlbnRpZmllcl07CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKHZhciBpZGVudGlmaWVyIGluIGxvY2F0aW9uczApIHsKICAgICAgICAgICAgcmV0dXJuIHZvaWQgcmVsb2NhdGUoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZDMuc2VsZWN0QWxsKHRhcmdldHMpLm9uKHpvb21OYW1lLCBudWxsKTsKICAgICAgICBzdWJqZWN0Lm9uKG1vdXNlZG93biwgbW91c2Vkb3duZWQpLm9uKHRvdWNoc3RhcnQsIHRvdWNoc3RhcnRlZCk7CiAgICAgICAgZHJhZ1Jlc3RvcmUoKTsKICAgICAgICB6b29tZW5kZWQoZGlzcGF0Y2gpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBtb3VzZXdoZWVsZWQoKSB7CiAgICAgIHZhciBkaXNwYXRjaCA9IGV2ZW50Lm9mKHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIGlmIChtb3VzZXdoZWVsVGltZXIpIGNsZWFyVGltZW91dChtb3VzZXdoZWVsVGltZXIpOyBlbHNlIHRyYW5zbGF0ZTAgPSBsb2NhdGlvbihjZW50ZXIwID0gY2VudGVyIHx8IGQzLm1vdXNlKHRoaXMpKSwgCiAgICAgIGQzX3NlbGVjdGlvbl9pbnRlcnJ1cHQuY2FsbCh0aGlzKSwgem9vbXN0YXJ0ZWQoZGlzcGF0Y2gpOwogICAgICBtb3VzZXdoZWVsVGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIG1vdXNld2hlZWxUaW1lciA9IG51bGw7CiAgICAgICAgem9vbWVuZGVkKGRpc3BhdGNoKTsKICAgICAgfSwgNTApOwogICAgICBkM19ldmVudFByZXZlbnREZWZhdWx0KCk7CiAgICAgIHNjYWxlVG8oTWF0aC5wb3coMiwgZDNfYmVoYXZpb3Jfem9vbURlbHRhKCkgKiAuMDAyKSAqIHZpZXcuayk7CiAgICAgIHRyYW5zbGF0ZVRvKGNlbnRlcjAsIHRyYW5zbGF0ZTApOwogICAgICB6b29tZWQoZGlzcGF0Y2gpOwogICAgfQogICAgZnVuY3Rpb24gZGJsY2xpY2tlZCgpIHsKICAgICAgdmFyIHAgPSBkMy5tb3VzZSh0aGlzKSwgayA9IE1hdGgubG9nKHZpZXcuaykgLyBNYXRoLkxOMjsKICAgICAgem9vbVRvKHRoaXMsIHAsIGxvY2F0aW9uKHApLCBkMy5ldmVudC5zaGlmdEtleSA/IE1hdGguY2VpbChrKSAtIDEgOiBNYXRoLmZsb29yKGspICsgMSk7CiAgICB9CiAgICByZXR1cm4gZDMucmViaW5kKHpvb20sIGV2ZW50LCAib24iKTsKICB9OwogIHZhciBkM19iZWhhdmlvcl96b29tSW5maW5pdHkgPSBbIDAsIEluZmluaXR5IF07CiAgdmFyIGQzX2JlaGF2aW9yX3pvb21EZWx0YSwgZDNfYmVoYXZpb3Jfem9vbVdoZWVsID0gIm9ud2hlZWwiIGluIGQzX2RvY3VtZW50ID8gKGQzX2JlaGF2aW9yX3pvb21EZWx0YSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIC1kMy5ldmVudC5kZWx0YVkgKiAoZDMuZXZlbnQuZGVsdGFNb2RlID8gMTIwIDogMSk7CiAgfSwgIndoZWVsIikgOiAib25tb3VzZXdoZWVsIiBpbiBkM19kb2N1bWVudCA/IChkM19iZWhhdmlvcl96b29tRGVsdGEgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkMy5ldmVudC53aGVlbERlbHRhOwogIH0sICJtb3VzZXdoZWVsIikgOiAoZDNfYmVoYXZpb3Jfem9vbURlbHRhID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gLWQzLmV2ZW50LmRldGFpbDsKICB9LCAiTW96TW91c2VQaXhlbFNjcm9sbCIpOwogIGQzLmNvbG9yID0gZDNfY29sb3I7CiAgZnVuY3Rpb24gZDNfY29sb3IoKSB7fQogIGQzX2NvbG9yLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMucmdiKCkgKyAiIjsKICB9OwogIGQzLmhzbCA9IGQzX2hzbDsKICBmdW5jdGlvbiBkM19oc2woaCwgcywgbCkgewogICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBkM19oc2wgPyB2b2lkICh0aGlzLmggPSAraCwgdGhpcy5zID0gK3MsIHRoaXMubCA9ICtsKSA6IGFyZ3VtZW50cy5sZW5ndGggPCAyID8gaCBpbnN0YW5jZW9mIGQzX2hzbCA/IG5ldyBkM19oc2woaC5oLCBoLnMsIGgubCkgOiBkM19yZ2JfcGFyc2UoIiIgKyBoLCBkM19yZ2JfaHNsLCBkM19oc2wpIDogbmV3IGQzX2hzbChoLCBzLCBsKTsKICB9CiAgdmFyIGQzX2hzbFByb3RvdHlwZSA9IGQzX2hzbC5wcm90b3R5cGUgPSBuZXcgZDNfY29sb3IoKTsKICBkM19oc2xQcm90b3R5cGUuYnJpZ2h0ZXIgPSBmdW5jdGlvbihrKSB7CiAgICBrID0gTWF0aC5wb3coLjcsIGFyZ3VtZW50cy5sZW5ndGggPyBrIDogMSk7CiAgICByZXR1cm4gbmV3IGQzX2hzbCh0aGlzLmgsIHRoaXMucywgdGhpcy5sIC8gayk7CiAgfTsKICBkM19oc2xQcm90b3R5cGUuZGFya2VyID0gZnVuY3Rpb24oaykgewogICAgayA9IE1hdGgucG93KC43LCBhcmd1bWVudHMubGVuZ3RoID8gayA6IDEpOwogICAgcmV0dXJuIG5ldyBkM19oc2wodGhpcy5oLCB0aGlzLnMsIGsgKiB0aGlzLmwpOwogIH07CiAgZDNfaHNsUHJvdG90eXBlLnJnYiA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX2hzbF9yZ2IodGhpcy5oLCB0aGlzLnMsIHRoaXMubCk7CiAgfTsKICBmdW5jdGlvbiBkM19oc2xfcmdiKGgsIHMsIGwpIHsKICAgIHZhciBtMSwgbTI7CiAgICBoID0gaXNOYU4oaCkgPyAwIDogKGggJT0gMzYwKSA8IDAgPyBoICsgMzYwIDogaDsKICAgIHMgPSBpc05hTihzKSA/IDAgOiBzIDwgMCA/IDAgOiBzID4gMSA/IDEgOiBzOwogICAgbCA9IGwgPCAwID8gMCA6IGwgPiAxID8gMSA6IGw7CiAgICBtMiA9IGwgPD0gLjUgPyBsICogKDEgKyBzKSA6IGwgKyBzIC0gbCAqIHM7CiAgICBtMSA9IDIgKiBsIC0gbTI7CiAgICBmdW5jdGlvbiB2KGgpIHsKICAgICAgaWYgKGggPiAzNjApIGggLT0gMzYwOyBlbHNlIGlmIChoIDwgMCkgaCArPSAzNjA7CiAgICAgIGlmIChoIDwgNjApIHJldHVybiBtMSArIChtMiAtIG0xKSAqIGggLyA2MDsKICAgICAgaWYgKGggPCAxODApIHJldHVybiBtMjsKICAgICAgaWYgKGggPCAyNDApIHJldHVybiBtMSArIChtMiAtIG0xKSAqICgyNDAgLSBoKSAvIDYwOwogICAgICByZXR1cm4gbTE7CiAgICB9CiAgICBmdW5jdGlvbiB2dihoKSB7CiAgICAgIHJldHVybiBNYXRoLnJvdW5kKHYoaCkgKiAyNTUpOwogICAgfQogICAgcmV0dXJuIG5ldyBkM19yZ2IodnYoaCArIDEyMCksIHZ2KGgpLCB2dihoIC0gMTIwKSk7CiAgfQogIGQzLmhjbCA9IGQzX2hjbDsKICBmdW5jdGlvbiBkM19oY2woaCwgYywgbCkgewogICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBkM19oY2wgPyB2b2lkICh0aGlzLmggPSAraCwgdGhpcy5jID0gK2MsIHRoaXMubCA9ICtsKSA6IGFyZ3VtZW50cy5sZW5ndGggPCAyID8gaCBpbnN0YW5jZW9mIGQzX2hjbCA/IG5ldyBkM19oY2woaC5oLCBoLmMsIGgubCkgOiBoIGluc3RhbmNlb2YgZDNfbGFiID8gZDNfbGFiX2hjbChoLmwsIGguYSwgaC5iKSA6IGQzX2xhYl9oY2woKGggPSBkM19yZ2JfbGFiKChoID0gZDMucmdiKGgpKS5yLCBoLmcsIGguYikpLmwsIGguYSwgaC5iKSA6IG5ldyBkM19oY2woaCwgYywgbCk7CiAgfQogIHZhciBkM19oY2xQcm90b3R5cGUgPSBkM19oY2wucHJvdG90eXBlID0gbmV3IGQzX2NvbG9yKCk7CiAgZDNfaGNsUHJvdG90eXBlLmJyaWdodGVyID0gZnVuY3Rpb24oaykgewogICAgcmV0dXJuIG5ldyBkM19oY2wodGhpcy5oLCB0aGlzLmMsIE1hdGgubWluKDEwMCwgdGhpcy5sICsgZDNfbGFiX0sgKiAoYXJndW1lbnRzLmxlbmd0aCA/IGsgOiAxKSkpOwogIH07CiAgZDNfaGNsUHJvdG90eXBlLmRhcmtlciA9IGZ1bmN0aW9uKGspIHsKICAgIHJldHVybiBuZXcgZDNfaGNsKHRoaXMuaCwgdGhpcy5jLCBNYXRoLm1heCgwLCB0aGlzLmwgLSBkM19sYWJfSyAqIChhcmd1bWVudHMubGVuZ3RoID8gayA6IDEpKSk7CiAgfTsKICBkM19oY2xQcm90b3R5cGUucmdiID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZDNfaGNsX2xhYih0aGlzLmgsIHRoaXMuYywgdGhpcy5sKS5yZ2IoKTsKICB9OwogIGZ1bmN0aW9uIGQzX2hjbF9sYWIoaCwgYywgbCkgewogICAgaWYgKGlzTmFOKGgpKSBoID0gMDsKICAgIGlmIChpc05hTihjKSkgYyA9IDA7CiAgICByZXR1cm4gbmV3IGQzX2xhYihsLCBNYXRoLmNvcyhoICo9IGQzX3JhZGlhbnMpICogYywgTWF0aC5zaW4oaCkgKiBjKTsKICB9CiAgZDMubGFiID0gZDNfbGFiOwogIGZ1bmN0aW9uIGQzX2xhYihsLCBhLCBiKSB7CiAgICByZXR1cm4gdGhpcyBpbnN0YW5jZW9mIGQzX2xhYiA/IHZvaWQgKHRoaXMubCA9ICtsLCB0aGlzLmEgPSArYSwgdGhpcy5iID0gK2IpIDogYXJndW1lbnRzLmxlbmd0aCA8IDIgPyBsIGluc3RhbmNlb2YgZDNfbGFiID8gbmV3IGQzX2xhYihsLmwsIGwuYSwgbC5iKSA6IGwgaW5zdGFuY2VvZiBkM19oY2wgPyBkM19oY2xfbGFiKGwuaCwgbC5jLCBsLmwpIDogZDNfcmdiX2xhYigobCA9IGQzX3JnYihsKSkuciwgbC5nLCBsLmIpIDogbmV3IGQzX2xhYihsLCBhLCBiKTsKICB9CiAgdmFyIGQzX2xhYl9LID0gMTg7CiAgdmFyIGQzX2xhYl9YID0gLjk1MDQ3LCBkM19sYWJfWSA9IDEsIGQzX2xhYl9aID0gMS4wODg4MzsKICB2YXIgZDNfbGFiUHJvdG90eXBlID0gZDNfbGFiLnByb3RvdHlwZSA9IG5ldyBkM19jb2xvcigpOwogIGQzX2xhYlByb3RvdHlwZS5icmlnaHRlciA9IGZ1bmN0aW9uKGspIHsKICAgIHJldHVybiBuZXcgZDNfbGFiKE1hdGgubWluKDEwMCwgdGhpcy5sICsgZDNfbGFiX0sgKiAoYXJndW1lbnRzLmxlbmd0aCA/IGsgOiAxKSksIHRoaXMuYSwgdGhpcy5iKTsKICB9OwogIGQzX2xhYlByb3RvdHlwZS5kYXJrZXIgPSBmdW5jdGlvbihrKSB7CiAgICByZXR1cm4gbmV3IGQzX2xhYihNYXRoLm1heCgwLCB0aGlzLmwgLSBkM19sYWJfSyAqIChhcmd1bWVudHMubGVuZ3RoID8gayA6IDEpKSwgdGhpcy5hLCB0aGlzLmIpOwogIH07CiAgZDNfbGFiUHJvdG90eXBlLnJnYiA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX2xhYl9yZ2IodGhpcy5sLCB0aGlzLmEsIHRoaXMuYik7CiAgfTsKICBmdW5jdGlvbiBkM19sYWJfcmdiKGwsIGEsIGIpIHsKICAgIHZhciB5ID0gKGwgKyAxNikgLyAxMTYsIHggPSB5ICsgYSAvIDUwMCwgeiA9IHkgLSBiIC8gMjAwOwogICAgeCA9IGQzX2xhYl94eXooeCkgKiBkM19sYWJfWDsKICAgIHkgPSBkM19sYWJfeHl6KHkpICogZDNfbGFiX1k7CiAgICB6ID0gZDNfbGFiX3h5eih6KSAqIGQzX2xhYl9aOwogICAgcmV0dXJuIG5ldyBkM19yZ2IoZDNfeHl6X3JnYigzLjI0MDQ1NDIgKiB4IC0gMS41MzcxMzg1ICogeSAtIC40OTg1MzE0ICogeiksIGQzX3h5el9yZ2IoLS45NjkyNjYgKiB4ICsgMS44NzYwMTA4ICogeSArIC4wNDE1NTYgKiB6KSwgZDNfeHl6X3JnYiguMDU1NjQzNCAqIHggLSAuMjA0MDI1OSAqIHkgKyAxLjA1NzIyNTIgKiB6KSk7CiAgfQogIGZ1bmN0aW9uIGQzX2xhYl9oY2wobCwgYSwgYikgewogICAgcmV0dXJuIGwgPiAwID8gbmV3IGQzX2hjbChNYXRoLmF0YW4yKGIsIGEpICogZDNfZGVncmVlcywgTWF0aC5zcXJ0KGEgKiBhICsgYiAqIGIpLCBsKSA6IG5ldyBkM19oY2woTmFOLCBOYU4sIGwpOwogIH0KICBmdW5jdGlvbiBkM19sYWJfeHl6KHgpIHsKICAgIHJldHVybiB4ID4gLjIwNjg5MzAzNCA/IHggKiB4ICogeCA6ICh4IC0gNCAvIDI5KSAvIDcuNzg3MDM3OwogIH0KICBmdW5jdGlvbiBkM194eXpfbGFiKHgpIHsKICAgIHJldHVybiB4ID4gLjAwODg1NiA/IE1hdGgucG93KHgsIDEgLyAzKSA6IDcuNzg3MDM3ICogeCArIDQgLyAyOTsKICB9CiAgZnVuY3Rpb24gZDNfeHl6X3JnYihyKSB7CiAgICByZXR1cm4gTWF0aC5yb3VuZCgyNTUgKiAociA8PSAuMDAzMDQgPyAxMi45MiAqIHIgOiAxLjA1NSAqIE1hdGgucG93KHIsIDEgLyAyLjQpIC0gLjA1NSkpOwogIH0KICBkMy5yZ2IgPSBkM19yZ2I7CiAgZnVuY3Rpb24gZDNfcmdiKHIsIGcsIGIpIHsKICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgZDNfcmdiID8gdm9pZCAodGhpcy5yID0gfn5yLCB0aGlzLmcgPSB+fmcsIHRoaXMuYiA9IH5+YikgOiBhcmd1bWVudHMubGVuZ3RoIDwgMiA/IHIgaW5zdGFuY2VvZiBkM19yZ2IgPyBuZXcgZDNfcmdiKHIuciwgci5nLCByLmIpIDogZDNfcmdiX3BhcnNlKCIiICsgciwgZDNfcmdiLCBkM19oc2xfcmdiKSA6IG5ldyBkM19yZ2IociwgZywgYik7CiAgfQogIGZ1bmN0aW9uIGQzX3JnYk51bWJlcih2YWx1ZSkgewogICAgcmV0dXJuIG5ldyBkM19yZ2IodmFsdWUgPj4gMTYsIHZhbHVlID4+IDggJiAyNTUsIHZhbHVlICYgMjU1KTsKICB9CiAgZnVuY3Rpb24gZDNfcmdiU3RyaW5nKHZhbHVlKSB7CiAgICByZXR1cm4gZDNfcmdiTnVtYmVyKHZhbHVlKSArICIiOwogIH0KICB2YXIgZDNfcmdiUHJvdG90eXBlID0gZDNfcmdiLnByb3RvdHlwZSA9IG5ldyBkM19jb2xvcigpOwogIGQzX3JnYlByb3RvdHlwZS5icmlnaHRlciA9IGZ1bmN0aW9uKGspIHsKICAgIGsgPSBNYXRoLnBvdyguNywgYXJndW1lbnRzLmxlbmd0aCA/IGsgOiAxKTsKICAgIHZhciByID0gdGhpcy5yLCBnID0gdGhpcy5nLCBiID0gdGhpcy5iLCBpID0gMzA7CiAgICBpZiAoIXIgJiYgIWcgJiYgIWIpIHJldHVybiBuZXcgZDNfcmdiKGksIGksIGkpOwogICAgaWYgKHIgJiYgciA8IGkpIHIgPSBpOwogICAgaWYgKGcgJiYgZyA8IGkpIGcgPSBpOwogICAgaWYgKGIgJiYgYiA8IGkpIGIgPSBpOwogICAgcmV0dXJuIG5ldyBkM19yZ2IoTWF0aC5taW4oMjU1LCByIC8gayksIE1hdGgubWluKDI1NSwgZyAvIGspLCBNYXRoLm1pbigyNTUsIGIgLyBrKSk7CiAgfTsKICBkM19yZ2JQcm90b3R5cGUuZGFya2VyID0gZnVuY3Rpb24oaykgewogICAgayA9IE1hdGgucG93KC43LCBhcmd1bWVudHMubGVuZ3RoID8gayA6IDEpOwogICAgcmV0dXJuIG5ldyBkM19yZ2IoayAqIHRoaXMuciwgayAqIHRoaXMuZywgayAqIHRoaXMuYik7CiAgfTsKICBkM19yZ2JQcm90b3R5cGUuaHNsID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZDNfcmdiX2hzbCh0aGlzLnIsIHRoaXMuZywgdGhpcy5iKTsKICB9OwogIGQzX3JnYlByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuICIjIiArIGQzX3JnYl9oZXgodGhpcy5yKSArIGQzX3JnYl9oZXgodGhpcy5nKSArIGQzX3JnYl9oZXgodGhpcy5iKTsKICB9OwogIGZ1bmN0aW9uIGQzX3JnYl9oZXgodikgewogICAgcmV0dXJuIHYgPCAxNiA/ICIwIiArIE1hdGgubWF4KDAsIHYpLnRvU3RyaW5nKDE2KSA6IE1hdGgubWluKDI1NSwgdikudG9TdHJpbmcoMTYpOwogIH0KICBmdW5jdGlvbiBkM19yZ2JfcGFyc2UoZm9ybWF0LCByZ2IsIGhzbCkgewogICAgdmFyIHIgPSAwLCBnID0gMCwgYiA9IDAsIG0xLCBtMiwgY29sb3I7CiAgICBtMSA9IC8oW2Etel0rKVwoKC4qKVwpL2kuZXhlYyhmb3JtYXQpOwogICAgaWYgKG0xKSB7CiAgICAgIG0yID0gbTFbMl0uc3BsaXQoIiwiKTsKICAgICAgc3dpdGNoIChtMVsxXSkgewogICAgICAgY2FzZSAiaHNsIjoKICAgICAgICB7CiAgICAgICAgICByZXR1cm4gaHNsKHBhcnNlRmxvYXQobTJbMF0pLCBwYXJzZUZsb2F0KG0yWzFdKSAvIDEwMCwgcGFyc2VGbG9hdChtMlsyXSkgLyAxMDApOwogICAgICAgIH0KCiAgICAgICBjYXNlICJyZ2IiOgogICAgICAgIHsKICAgICAgICAgIHJldHVybiByZ2IoZDNfcmdiX3BhcnNlTnVtYmVyKG0yWzBdKSwgZDNfcmdiX3BhcnNlTnVtYmVyKG0yWzFdKSwgZDNfcmdiX3BhcnNlTnVtYmVyKG0yWzJdKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoY29sb3IgPSBkM19yZ2JfbmFtZXMuZ2V0KGZvcm1hdCkpIHJldHVybiByZ2IoY29sb3IuciwgY29sb3IuZywgY29sb3IuYik7CiAgICBpZiAoZm9ybWF0ICE9IG51bGwgJiYgZm9ybWF0LmNoYXJBdCgwKSA9PT0gIiMiICYmICFpc05hTihjb2xvciA9IHBhcnNlSW50KGZvcm1hdC5zbGljZSgxKSwgMTYpKSkgewogICAgICBpZiAoZm9ybWF0Lmxlbmd0aCA9PT0gNCkgewogICAgICAgIHIgPSAoY29sb3IgJiAzODQwKSA+PiA0OwogICAgICAgIHIgPSByID4+IDQgfCByOwogICAgICAgIGcgPSBjb2xvciAmIDI0MDsKICAgICAgICBnID0gZyA+PiA0IHwgZzsKICAgICAgICBiID0gY29sb3IgJiAxNTsKICAgICAgICBiID0gYiA8PCA0IHwgYjsKICAgICAgfSBlbHNlIGlmIChmb3JtYXQubGVuZ3RoID09PSA3KSB7CiAgICAgICAgciA9IChjb2xvciAmIDE2NzExNjgwKSA+PiAxNjsKICAgICAgICBnID0gKGNvbG9yICYgNjUyODApID4+IDg7CiAgICAgICAgYiA9IGNvbG9yICYgMjU1OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmdiKHIsIGcsIGIpOwogIH0KICBmdW5jdGlvbiBkM19yZ2JfaHNsKHIsIGcsIGIpIHsKICAgIHZhciBtaW4gPSBNYXRoLm1pbihyIC89IDI1NSwgZyAvPSAyNTUsIGIgLz0gMjU1KSwgbWF4ID0gTWF0aC5tYXgociwgZywgYiksIGQgPSBtYXggLSBtaW4sIGgsIHMsIGwgPSAobWF4ICsgbWluKSAvIDI7CiAgICBpZiAoZCkgewogICAgICBzID0gbCA8IC41ID8gZCAvIChtYXggKyBtaW4pIDogZCAvICgyIC0gbWF4IC0gbWluKTsKICAgICAgaWYgKHIgPT0gbWF4KSBoID0gKGcgLSBiKSAvIGQgKyAoZyA8IGIgPyA2IDogMCk7IGVsc2UgaWYgKGcgPT0gbWF4KSBoID0gKGIgLSByKSAvIGQgKyAyOyBlbHNlIGggPSAociAtIGcpIC8gZCArIDQ7CiAgICAgIGggKj0gNjA7CiAgICB9IGVsc2UgewogICAgICBoID0gTmFOOwogICAgICBzID0gbCA+IDAgJiYgbCA8IDEgPyAwIDogaDsKICAgIH0KICAgIHJldHVybiBuZXcgZDNfaHNsKGgsIHMsIGwpOwogIH0KICBmdW5jdGlvbiBkM19yZ2JfbGFiKHIsIGcsIGIpIHsKICAgIHIgPSBkM19yZ2JfeHl6KHIpOwogICAgZyA9IGQzX3JnYl94eXooZyk7CiAgICBiID0gZDNfcmdiX3h5eihiKTsKICAgIHZhciB4ID0gZDNfeHl6X2xhYigoLjQxMjQ1NjQgKiByICsgLjM1NzU3NjEgKiBnICsgLjE4MDQzNzUgKiBiKSAvIGQzX2xhYl9YKSwgeSA9IGQzX3h5el9sYWIoKC4yMTI2NzI5ICogciArIC43MTUxNTIyICogZyArIC4wNzIxNzUgKiBiKSAvIGQzX2xhYl9ZKSwgeiA9IGQzX3h5el9sYWIoKC4wMTkzMzM5ICogciArIC4xMTkxOTIgKiBnICsgLjk1MDMwNDEgKiBiKSAvIGQzX2xhYl9aKTsKICAgIHJldHVybiBkM19sYWIoMTE2ICogeSAtIDE2LCA1MDAgKiAoeCAtIHkpLCAyMDAgKiAoeSAtIHopKTsKICB9CiAgZnVuY3Rpb24gZDNfcmdiX3h5eihyKSB7CiAgICByZXR1cm4gKHIgLz0gMjU1KSA8PSAuMDQwNDUgPyByIC8gMTIuOTIgOiBNYXRoLnBvdygociArIC4wNTUpIC8gMS4wNTUsIDIuNCk7CiAgfQogIGZ1bmN0aW9uIGQzX3JnYl9wYXJzZU51bWJlcihjKSB7CiAgICB2YXIgZiA9IHBhcnNlRmxvYXQoYyk7CiAgICByZXR1cm4gYy5jaGFyQXQoYy5sZW5ndGggLSAxKSA9PT0gIiUiID8gTWF0aC5yb3VuZChmICogMi41NSkgOiBmOwogIH0KICB2YXIgZDNfcmdiX25hbWVzID0gZDMubWFwKHsKICAgIGFsaWNlYmx1ZTogMTU3OTIzODMsCiAgICBhbnRpcXVld2hpdGU6IDE2NDQ0Mzc1LAogICAgYXF1YTogNjU1MzUsCiAgICBhcXVhbWFyaW5lOiA4Mzg4NTY0LAogICAgYXp1cmU6IDE1Nzk0MTc1LAogICAgYmVpZ2U6IDE2MTE5MjYwLAogICAgYmlzcXVlOiAxNjc3MDI0NCwKICAgIGJsYWNrOiAwLAogICAgYmxhbmNoZWRhbG1vbmQ6IDE2NzcyMDQ1LAogICAgYmx1ZTogMjU1LAogICAgYmx1ZXZpb2xldDogOTA1NTIwMiwKICAgIGJyb3duOiAxMDgyNDIzNCwKICAgIGJ1cmx5d29vZDogMTQ1OTYyMzEsCiAgICBjYWRldGJsdWU6IDYyNjY1MjgsCiAgICBjaGFydHJldXNlOiA4Mzg4MzUyLAogICAgY2hvY29sYXRlOiAxMzc4OTQ3MCwKICAgIGNvcmFsOiAxNjc0NDI3MiwKICAgIGNvcm5mbG93ZXJibHVlOiA2NTkxOTgxLAogICAgY29ybnNpbGs6IDE2Nzc1Mzg4LAogICAgY3JpbXNvbjogMTQ0MjMxMDAsCiAgICBjeWFuOiA2NTUzNSwKICAgIGRhcmtibHVlOiAxMzksCiAgICBkYXJrY3lhbjogMzU3MjMsCiAgICBkYXJrZ29sZGVucm9kOiAxMjA5MjkzOSwKICAgIGRhcmtncmF5OiAxMTExOTAxNywKICAgIGRhcmtncmVlbjogMjU2MDAsCiAgICBkYXJrZ3JleTogMTExMTkwMTcsCiAgICBkYXJra2hha2k6IDEyNDMzMjU5LAogICAgZGFya21hZ2VudGE6IDkxMDk2NDMsCiAgICBkYXJrb2xpdmVncmVlbjogNTU5Nzk5OSwKICAgIGRhcmtvcmFuZ2U6IDE2NzQ3NTIwLAogICAgZGFya29yY2hpZDogMTAwNDAwMTIsCiAgICBkYXJrcmVkOiA5MTA5NTA0LAogICAgZGFya3NhbG1vbjogMTUzMDg0MTAsCiAgICBkYXJrc2VhZ3JlZW46IDk0MTk5MTksCiAgICBkYXJrc2xhdGVibHVlOiA0NzM0MzQ3LAogICAgZGFya3NsYXRlZ3JheTogMzEwMDQ5NSwKICAgIGRhcmtzbGF0ZWdyZXk6IDMxMDA0OTUsCiAgICBkYXJrdHVycXVvaXNlOiA1Mjk0NSwKICAgIGRhcmt2aW9sZXQ6IDk2OTk1MzksCiAgICBkZWVwcGluazogMTY3MTY5NDcsCiAgICBkZWVwc2t5Ymx1ZTogNDkxNTEsCiAgICBkaW1ncmF5OiA2OTA4MjY1LAogICAgZGltZ3JleTogNjkwODI2NSwKICAgIGRvZGdlcmJsdWU6IDIwMDMxOTksCiAgICBmaXJlYnJpY2s6IDExNjc0MTQ2LAogICAgZmxvcmFsd2hpdGU6IDE2Nzc1OTIwLAogICAgZm9yZXN0Z3JlZW46IDIyNjM4NDIsCiAgICBmdWNoc2lhOiAxNjcxMTkzNSwKICAgIGdhaW5zYm9ybzogMTQ0NzQ0NjAsCiAgICBnaG9zdHdoaXRlOiAxNjMxNjY3MSwKICAgIGdvbGQ6IDE2NzY2NzIwLAogICAgZ29sZGVucm9kOiAxNDMyOTEyMCwKICAgIGdyYXk6IDg0MjE1MDQsCiAgICBncmVlbjogMzI3NjgsCiAgICBncmVlbnllbGxvdzogMTE0MDMwNTUsCiAgICBncmV5OiA4NDIxNTA0LAogICAgaG9uZXlkZXc6IDE1Nzk0MTYwLAogICAgaG90cGluazogMTY3Mzg3NDAsCiAgICBpbmRpYW5yZWQ6IDEzNDU4NTI0LAogICAgaW5kaWdvOiA0OTE1MzMwLAogICAgaXZvcnk6IDE2Nzc3MjAwLAogICAga2hha2k6IDE1Nzg3NjYwLAogICAgbGF2ZW5kZXI6IDE1MTMyNDEwLAogICAgbGF2ZW5kZXJibHVzaDogMTY3NzMzNjUsCiAgICBsYXduZ3JlZW46IDgxOTA5NzYsCiAgICBsZW1vbmNoaWZmb246IDE2Nzc1ODg1LAogICAgbGlnaHRibHVlOiAxMTM5MzI1NCwKICAgIGxpZ2h0Y29yYWw6IDE1NzYxNTM2LAogICAgbGlnaHRjeWFuOiAxNDc0NTU5OSwKICAgIGxpZ2h0Z29sZGVucm9keWVsbG93OiAxNjQ0ODIxMCwKICAgIGxpZ2h0Z3JheTogMTM4ODIzMjMsCiAgICBsaWdodGdyZWVuOiA5NDk4MjU2LAogICAgbGlnaHRncmV5OiAxMzg4MjMyMywKICAgIGxpZ2h0cGluazogMTY3NTg0NjUsCiAgICBsaWdodHNhbG1vbjogMTY3NTI3NjIsCiAgICBsaWdodHNlYWdyZWVuOiAyMTQyODkwLAogICAgbGlnaHRza3libHVlOiA4OTAwMzQ2LAogICAgbGlnaHRzbGF0ZWdyYXk6IDc4MzM3NTMsCiAgICBsaWdodHNsYXRlZ3JleTogNzgzMzc1MywKICAgIGxpZ2h0c3RlZWxibHVlOiAxMTU4NDczNCwKICAgIGxpZ2h0eWVsbG93OiAxNjc3NzE4NCwKICAgIGxpbWU6IDY1MjgwLAogICAgbGltZWdyZWVuOiAzMzI5MzMwLAogICAgbGluZW46IDE2NDQ1NjcwLAogICAgbWFnZW50YTogMTY3MTE5MzUsCiAgICBtYXJvb246IDgzODg2MDgsCiAgICBtZWRpdW1hcXVhbWFyaW5lOiA2NzM3MzIyLAogICAgbWVkaXVtYmx1ZTogMjA1LAogICAgbWVkaXVtb3JjaGlkOiAxMjIxMTY2NywKICAgIG1lZGl1bXB1cnBsZTogOTY2MjY4MywKICAgIG1lZGl1bXNlYWdyZWVuOiAzOTc4MDk3LAogICAgbWVkaXVtc2xhdGVibHVlOiA4MDg3NzkwLAogICAgbWVkaXVtc3ByaW5nZ3JlZW46IDY0MTU0LAogICAgbWVkaXVtdHVycXVvaXNlOiA0NzcyMzAwLAogICAgbWVkaXVtdmlvbGV0cmVkOiAxMzA0NzE3MywKICAgIG1pZG5pZ2h0Ymx1ZTogMTY0NDkxMiwKICAgIG1pbnRjcmVhbTogMTYxMjE4NTAsCiAgICBtaXN0eXJvc2U6IDE2NzcwMjczLAogICAgbW9jY2FzaW46IDE2NzcwMjI5LAogICAgbmF2YWpvd2hpdGU6IDE2NzY4Njg1LAogICAgbmF2eTogMTI4LAogICAgb2xkbGFjZTogMTY2NDM1NTgsCiAgICBvbGl2ZTogODQyMTM3NiwKICAgIG9saXZlZHJhYjogNzA0ODczOSwKICAgIG9yYW5nZTogMTY3NTM5MjAsCiAgICBvcmFuZ2VyZWQ6IDE2NzI5MzQ0LAogICAgb3JjaGlkOiAxNDMxNTczNCwKICAgIHBhbGVnb2xkZW5yb2Q6IDE1NjU3MTMwLAogICAgcGFsZWdyZWVuOiAxMDAyNTg4MCwKICAgIHBhbGV0dXJxdW9pc2U6IDExNTI5OTY2LAogICAgcGFsZXZpb2xldHJlZDogMTQzODEyMDMsCiAgICBwYXBheWF3aGlwOiAxNjc3MzA3NywKICAgIHBlYWNocHVmZjogMTY3Njc2NzMsCiAgICBwZXJ1OiAxMzQ2ODk5MSwKICAgIHBpbms6IDE2NzYxMDM1LAogICAgcGx1bTogMTQ1MjQ2MzcsCiAgICBwb3dkZXJibHVlOiAxMTU5MTkxMCwKICAgIHB1cnBsZTogODM4ODczNiwKICAgIHJlZDogMTY3MTE2ODAsCiAgICByb3N5YnJvd246IDEyMzU3NTE5LAogICAgcm95YWxibHVlOiA0Mjg2OTQ1LAogICAgc2FkZGxlYnJvd246IDkxMjcxODcsCiAgICBzYWxtb246IDE2NDE2ODgyLAogICAgc2FuZHlicm93bjogMTYwMzI4NjQsCiAgICBzZWFncmVlbjogMzA1MDMyNywKICAgIHNlYXNoZWxsOiAxNjc3NDYzOCwKICAgIHNpZW5uYTogMTA1MDY3OTcsCiAgICBzaWx2ZXI6IDEyNjMyMjU2LAogICAgc2t5Ymx1ZTogODkwMDMzMSwKICAgIHNsYXRlYmx1ZTogNjk3MDA2MSwKICAgIHNsYXRlZ3JheTogNzM3Mjk0NCwKICAgIHNsYXRlZ3JleTogNzM3Mjk0NCwKICAgIHNub3c6IDE2Nzc1OTMwLAogICAgc3ByaW5nZ3JlZW46IDY1NDA3LAogICAgc3RlZWxibHVlOiA0NjIwOTgwLAogICAgdGFuOiAxMzgwODc4MCwKICAgIHRlYWw6IDMyODk2LAogICAgdGhpc3RsZTogMTQyMDQ4ODgsCiAgICB0b21hdG86IDE2NzM3MDk1LAogICAgdHVycXVvaXNlOiA0MjUxODU2LAogICAgdmlvbGV0OiAxNTYzMTA4NiwKICAgIHdoZWF0OiAxNjExMzMzMSwKICAgIHdoaXRlOiAxNjc3NzIxNSwKICAgIHdoaXRlc21va2U6IDE2MTE5Mjg1LAogICAgeWVsbG93OiAxNjc3Njk2MCwKICAgIHllbGxvd2dyZWVuOiAxMDE0NTA3NAogIH0pOwogIGQzX3JnYl9uYW1lcy5mb3JFYWNoKGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgIGQzX3JnYl9uYW1lcy5zZXQoa2V5LCBkM19yZ2JOdW1iZXIodmFsdWUpKTsKICB9KTsKICBmdW5jdGlvbiBkM19mdW5jdG9yKHYpIHsKICAgIHJldHVybiB0eXBlb2YgdiA9PT0gImZ1bmN0aW9uIiA/IHYgOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHY7CiAgICB9OwogIH0KICBkMy5mdW5jdG9yID0gZDNfZnVuY3RvcjsKICBmdW5jdGlvbiBkM19pZGVudGl0eShkKSB7CiAgICByZXR1cm4gZDsKICB9CiAgZDMueGhyID0gZDNfeGhyVHlwZShkM19pZGVudGl0eSk7CiAgZnVuY3Rpb24gZDNfeGhyVHlwZShyZXNwb25zZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKHVybCwgbWltZVR5cGUsIGNhbGxiYWNrKSB7CiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyICYmIHR5cGVvZiBtaW1lVHlwZSA9PT0gImZ1bmN0aW9uIikgY2FsbGJhY2sgPSBtaW1lVHlwZSwgCiAgICAgIG1pbWVUeXBlID0gbnVsbDsKICAgICAgcmV0dXJuIGQzX3hocih1cmwsIG1pbWVUeXBlLCByZXNwb25zZSwgY2FsbGJhY2spOwogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfeGhyKHVybCwgbWltZVR5cGUsIHJlc3BvbnNlLCBjYWxsYmFjaykgewogICAgdmFyIHhociA9IHt9LCBkaXNwYXRjaCA9IGQzLmRpc3BhdGNoKCJiZWZvcmVzZW5kIiwgInByb2dyZXNzIiwgImxvYWQiLCAiZXJyb3IiKSwgaGVhZGVycyA9IHt9LCByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCksIHJlc3BvbnNlVHlwZSA9IG51bGw7CiAgICBpZiAoZDNfd2luZG93LlhEb21haW5SZXF1ZXN0ICYmICEoIndpdGhDcmVkZW50aWFscyIgaW4gcmVxdWVzdCkgJiYgL14oaHR0cChzKT86KT9cL1wvLy50ZXN0KHVybCkpIHJlcXVlc3QgPSBuZXcgWERvbWFpblJlcXVlc3QoKTsKICAgICJvbmxvYWQiIGluIHJlcXVlc3QgPyByZXF1ZXN0Lm9ubG9hZCA9IHJlcXVlc3Qub25lcnJvciA9IHJlc3BvbmQgOiByZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkgewogICAgICByZXF1ZXN0LnJlYWR5U3RhdGUgPiAzICYmIHJlc3BvbmQoKTsKICAgIH07CiAgICBmdW5jdGlvbiByZXNwb25kKCkgewogICAgICB2YXIgc3RhdHVzID0gcmVxdWVzdC5zdGF0dXMsIHJlc3VsdDsKICAgICAgaWYgKCFzdGF0dXMgJiYgZDNfeGhySGFzUmVzcG9uc2UocmVxdWVzdCkgfHwgc3RhdHVzID49IDIwMCAmJiBzdGF0dXMgPCAzMDAgfHwgc3RhdHVzID09PSAzMDQpIHsKICAgICAgICB0cnkgewogICAgICAgICAgcmVzdWx0ID0gcmVzcG9uc2UuY2FsbCh4aHIsIHJlcXVlc3QpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGRpc3BhdGNoLmVycm9yLmNhbGwoeGhyLCBlKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgZGlzcGF0Y2gubG9hZC5jYWxsKHhociwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkaXNwYXRjaC5lcnJvci5jYWxsKHhociwgcmVxdWVzdCk7CiAgICAgIH0KICAgIH0KICAgIHJlcXVlc3Qub25wcm9ncmVzcyA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIHZhciBvID0gZDMuZXZlbnQ7CiAgICAgIGQzLmV2ZW50ID0gZXZlbnQ7CiAgICAgIHRyeSB7CiAgICAgICAgZGlzcGF0Y2gucHJvZ3Jlc3MuY2FsbCh4aHIsIHJlcXVlc3QpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIGQzLmV2ZW50ID0gbzsKICAgICAgfQogICAgfTsKICAgIHhoci5oZWFkZXIgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAgICBuYW1lID0gKG5hbWUgKyAiIikudG9Mb3dlckNhc2UoKTsKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSByZXR1cm4gaGVhZGVyc1tuYW1lXTsKICAgICAgaWYgKHZhbHVlID09IG51bGwpIGRlbGV0ZSBoZWFkZXJzW25hbWVdOyBlbHNlIGhlYWRlcnNbbmFtZV0gPSB2YWx1ZSArICIiOwogICAgICByZXR1cm4geGhyOwogICAgfTsKICAgIHhoci5taW1lVHlwZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIG1pbWVUeXBlOwogICAgICBtaW1lVHlwZSA9IHZhbHVlID09IG51bGwgPyBudWxsIDogdmFsdWUgKyAiIjsKICAgICAgcmV0dXJuIHhocjsKICAgIH07CiAgICB4aHIucmVzcG9uc2VUeXBlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gcmVzcG9uc2VUeXBlOwogICAgICByZXNwb25zZVR5cGUgPSB2YWx1ZTsKICAgICAgcmV0dXJuIHhocjsKICAgIH07CiAgICB4aHIucmVzcG9uc2UgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXNwb25zZSA9IHZhbHVlOwogICAgICByZXR1cm4geGhyOwogICAgfTsKICAgIFsgImdldCIsICJwb3N0IiBdLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7CiAgICAgIHhoclttZXRob2RdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHhoci5zZW5kLmFwcGx5KHhociwgWyBtZXRob2QgXS5jb25jYXQoZDNfYXJyYXkoYXJndW1lbnRzKSkpOwogICAgICB9OwogICAgfSk7CiAgICB4aHIuc2VuZCA9IGZ1bmN0aW9uKG1ldGhvZCwgZGF0YSwgY2FsbGJhY2spIHsKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIgJiYgdHlwZW9mIGRhdGEgPT09ICJmdW5jdGlvbiIpIGNhbGxiYWNrID0gZGF0YSwgZGF0YSA9IG51bGw7CiAgICAgIHJlcXVlc3Qub3BlbihtZXRob2QsIHVybCwgdHJ1ZSk7CiAgICAgIGlmIChtaW1lVHlwZSAhPSBudWxsICYmICEoImFjY2VwdCIgaW4gaGVhZGVycykpIGhlYWRlcnNbImFjY2VwdCJdID0gbWltZVR5cGUgKyAiLCovKiI7CiAgICAgIGlmIChyZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIpIGZvciAodmFyIG5hbWUgaW4gaGVhZGVycykgcmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKG5hbWUsIGhlYWRlcnNbbmFtZV0pOwogICAgICBpZiAobWltZVR5cGUgIT0gbnVsbCAmJiByZXF1ZXN0Lm92ZXJyaWRlTWltZVR5cGUpIHJlcXVlc3Qub3ZlcnJpZGVNaW1lVHlwZShtaW1lVHlwZSk7CiAgICAgIGlmIChyZXNwb25zZVR5cGUgIT0gbnVsbCkgcmVxdWVzdC5yZXNwb25zZVR5cGUgPSByZXNwb25zZVR5cGU7CiAgICAgIGlmIChjYWxsYmFjayAhPSBudWxsKSB4aHIub24oImVycm9yIiwgY2FsbGJhY2spLm9uKCJsb2FkIiwgZnVuY3Rpb24ocmVxdWVzdCkgewogICAgICAgIGNhbGxiYWNrKG51bGwsIHJlcXVlc3QpOwogICAgICB9KTsKICAgICAgZGlzcGF0Y2guYmVmb3Jlc2VuZC5jYWxsKHhociwgcmVxdWVzdCk7CiAgICAgIHJlcXVlc3Quc2VuZChkYXRhID09IG51bGwgPyBudWxsIDogZGF0YSk7CiAgICAgIHJldHVybiB4aHI7CiAgICB9OwogICAgeGhyLmFib3J0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHJlcXVlc3QuYWJvcnQoKTsKICAgICAgcmV0dXJuIHhocjsKICAgIH07CiAgICBkMy5yZWJpbmQoeGhyLCBkaXNwYXRjaCwgIm9uIik7CiAgICByZXR1cm4gY2FsbGJhY2sgPT0gbnVsbCA/IHhociA6IHhoci5nZXQoZDNfeGhyX2ZpeENhbGxiYWNrKGNhbGxiYWNrKSk7CiAgfQogIGZ1bmN0aW9uIGQzX3hocl9maXhDYWxsYmFjayhjYWxsYmFjaykgewogICAgcmV0dXJuIGNhbGxiYWNrLmxlbmd0aCA9PT0gMSA/IGZ1bmN0aW9uKGVycm9yLCByZXF1ZXN0KSB7CiAgICAgIGNhbGxiYWNrKGVycm9yID09IG51bGwgPyByZXF1ZXN0IDogbnVsbCk7CiAgICB9IDogY2FsbGJhY2s7CiAgfQogIGZ1bmN0aW9uIGQzX3hockhhc1Jlc3BvbnNlKHJlcXVlc3QpIHsKICAgIHZhciB0eXBlID0gcmVxdWVzdC5yZXNwb25zZVR5cGU7CiAgICByZXR1cm4gdHlwZSAmJiB0eXBlICE9PSAidGV4dCIgPyByZXF1ZXN0LnJlc3BvbnNlIDogcmVxdWVzdC5yZXNwb25zZVRleHQ7CiAgfQogIGQzLmRzdiA9IGZ1bmN0aW9uKGRlbGltaXRlciwgbWltZVR5cGUpIHsKICAgIHZhciByZUZvcm1hdCA9IG5ldyBSZWdFeHAoJ1siJyArIGRlbGltaXRlciArICJcbl0iKSwgZGVsaW1pdGVyQ29kZSA9IGRlbGltaXRlci5jaGFyQ29kZUF0KDApOwogICAgZnVuY3Rpb24gZHN2KHVybCwgcm93LCBjYWxsYmFjaykgewogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDMpIGNhbGxiYWNrID0gcm93LCByb3cgPSBudWxsOwogICAgICB2YXIgeGhyID0gZDNfeGhyKHVybCwgbWltZVR5cGUsIHJvdyA9PSBudWxsID8gcmVzcG9uc2UgOiB0eXBlZFJlc3BvbnNlKHJvdyksIGNhbGxiYWNrKTsKICAgICAgeGhyLnJvdyA9IGZ1bmN0aW9uKF8pIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IHhoci5yZXNwb25zZSgocm93ID0gXykgPT0gbnVsbCA/IHJlc3BvbnNlIDogdHlwZWRSZXNwb25zZShfKSkgOiByb3c7CiAgICAgIH07CiAgICAgIHJldHVybiB4aHI7CiAgICB9CiAgICBmdW5jdGlvbiByZXNwb25zZShyZXF1ZXN0KSB7CiAgICAgIHJldHVybiBkc3YucGFyc2UocmVxdWVzdC5yZXNwb25zZVRleHQpOwogICAgfQogICAgZnVuY3Rpb24gdHlwZWRSZXNwb25zZShmKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbihyZXF1ZXN0KSB7CiAgICAgICAgcmV0dXJuIGRzdi5wYXJzZShyZXF1ZXN0LnJlc3BvbnNlVGV4dCwgZik7CiAgICAgIH07CiAgICB9CiAgICBkc3YucGFyc2UgPSBmdW5jdGlvbih0ZXh0LCBmKSB7CiAgICAgIHZhciBvOwogICAgICByZXR1cm4gZHN2LnBhcnNlUm93cyh0ZXh0LCBmdW5jdGlvbihyb3csIGkpIHsKICAgICAgICBpZiAobykgcmV0dXJuIG8ocm93LCBpIC0gMSk7CiAgICAgICAgdmFyIGEgPSBuZXcgRnVuY3Rpb24oImQiLCAicmV0dXJuIHsiICsgcm93Lm1hcChmdW5jdGlvbihuYW1lLCBpKSB7CiAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobmFtZSkgKyAiOiBkWyIgKyBpICsgIl0iOwogICAgICAgIH0pLmpvaW4oIiwiKSArICJ9Iik7CiAgICAgICAgbyA9IGYgPyBmdW5jdGlvbihyb3csIGkpIHsKICAgICAgICAgIHJldHVybiBmKGEocm93KSwgaSk7CiAgICAgICAgfSA6IGE7CiAgICAgIH0pOwogICAgfTsKICAgIGRzdi5wYXJzZVJvd3MgPSBmdW5jdGlvbih0ZXh0LCBmKSB7CiAgICAgIHZhciBFT0wgPSB7fSwgRU9GID0ge30sIHJvd3MgPSBbXSwgTiA9IHRleHQubGVuZ3RoLCBJID0gMCwgbiA9IDAsIHQsIGVvbDsKICAgICAgZnVuY3Rpb24gdG9rZW4oKSB7CiAgICAgICAgaWYgKEkgPj0gTikgcmV0dXJuIEVPRjsKICAgICAgICBpZiAoZW9sKSByZXR1cm4gZW9sID0gZmFsc2UsIEVPTDsKICAgICAgICB2YXIgaiA9IEk7CiAgICAgICAgaWYgKHRleHQuY2hhckNvZGVBdChqKSA9PT0gMzQpIHsKICAgICAgICAgIHZhciBpID0gajsKICAgICAgICAgIHdoaWxlIChpKysgPCBOKSB7CiAgICAgICAgICAgIGlmICh0ZXh0LmNoYXJDb2RlQXQoaSkgPT09IDM0KSB7CiAgICAgICAgICAgICAgaWYgKHRleHQuY2hhckNvZGVBdChpICsgMSkgIT09IDM0KSBicmVhazsKICAgICAgICAgICAgICArK2k7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIEkgPSBpICsgMjsKICAgICAgICAgIHZhciBjID0gdGV4dC5jaGFyQ29kZUF0KGkgKyAxKTsKICAgICAgICAgIGlmIChjID09PSAxMykgewogICAgICAgICAgICBlb2wgPSB0cnVlOwogICAgICAgICAgICBpZiAodGV4dC5jaGFyQ29kZUF0KGkgKyAyKSA9PT0gMTApICsrSTsKICAgICAgICAgIH0gZWxzZSBpZiAoYyA9PT0gMTApIHsKICAgICAgICAgICAgZW9sID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0ZXh0LnNsaWNlKGogKyAxLCBpKS5yZXBsYWNlKC8iIi9nLCAnIicpOwogICAgICAgIH0KICAgICAgICB3aGlsZSAoSSA8IE4pIHsKICAgICAgICAgIHZhciBjID0gdGV4dC5jaGFyQ29kZUF0KEkrKyksIGsgPSAxOwogICAgICAgICAgaWYgKGMgPT09IDEwKSBlb2wgPSB0cnVlOyBlbHNlIGlmIChjID09PSAxMykgewogICAgICAgICAgICBlb2wgPSB0cnVlOwogICAgICAgICAgICBpZiAodGV4dC5jaGFyQ29kZUF0KEkpID09PSAxMCkgKytJLCArK2s7CiAgICAgICAgICB9IGVsc2UgaWYgKGMgIT09IGRlbGltaXRlckNvZGUpIGNvbnRpbnVlOwogICAgICAgICAgcmV0dXJuIHRleHQuc2xpY2UoaiwgSSAtIGspOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGV4dC5zbGljZShqKTsKICAgICAgfQogICAgICB3aGlsZSAoKHQgPSB0b2tlbigpKSAhPT0gRU9GKSB7CiAgICAgICAgdmFyIGEgPSBbXTsKICAgICAgICB3aGlsZSAodCAhPT0gRU9MICYmIHQgIT09IEVPRikgewogICAgICAgICAgYS5wdXNoKHQpOwogICAgICAgICAgdCA9IHRva2VuKCk7CiAgICAgICAgfQogICAgICAgIGlmIChmICYmIChhID0gZihhLCBuKyspKSA9PSBudWxsKSBjb250aW51ZTsKICAgICAgICByb3dzLnB1c2goYSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJvd3M7CiAgICB9OwogICAgZHN2LmZvcm1hdCA9IGZ1bmN0aW9uKHJvd3MpIHsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkocm93c1swXSkpIHJldHVybiBkc3YuZm9ybWF0Um93cyhyb3dzKTsKICAgICAgdmFyIGZpZWxkU2V0ID0gbmV3IGQzX1NldCgpLCBmaWVsZHMgPSBbXTsKICAgICAgcm93cy5mb3JFYWNoKGZ1bmN0aW9uKHJvdykgewogICAgICAgIGZvciAodmFyIGZpZWxkIGluIHJvdykgewogICAgICAgICAgaWYgKCFmaWVsZFNldC5oYXMoZmllbGQpKSB7CiAgICAgICAgICAgIGZpZWxkcy5wdXNoKGZpZWxkU2V0LmFkZChmaWVsZCkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBbIGZpZWxkcy5tYXAoZm9ybWF0VmFsdWUpLmpvaW4oZGVsaW1pdGVyKSBdLmNvbmNhdChyb3dzLm1hcChmdW5jdGlvbihyb3cpIHsKICAgICAgICByZXR1cm4gZmllbGRzLm1hcChmdW5jdGlvbihmaWVsZCkgewogICAgICAgICAgcmV0dXJuIGZvcm1hdFZhbHVlKHJvd1tmaWVsZF0pOwogICAgICAgIH0pLmpvaW4oZGVsaW1pdGVyKTsKICAgICAgfSkpLmpvaW4oIlxuIik7CiAgICB9OwogICAgZHN2LmZvcm1hdFJvd3MgPSBmdW5jdGlvbihyb3dzKSB7CiAgICAgIHJldHVybiByb3dzLm1hcChmb3JtYXRSb3cpLmpvaW4oIlxuIik7CiAgICB9OwogICAgZnVuY3Rpb24gZm9ybWF0Um93KHJvdykgewogICAgICByZXR1cm4gcm93Lm1hcChmb3JtYXRWYWx1ZSkuam9pbihkZWxpbWl0ZXIpOwogICAgfQogICAgZnVuY3Rpb24gZm9ybWF0VmFsdWUodGV4dCkgewogICAgICByZXR1cm4gcmVGb3JtYXQudGVzdCh0ZXh0KSA/ICciJyArIHRleHQucmVwbGFjZSgvXCIvZywgJyIiJykgKyAnIicgOiB0ZXh0OwogICAgfQogICAgcmV0dXJuIGRzdjsKICB9OwogIGQzLmNzdiA9IGQzLmRzdigiLCIsICJ0ZXh0L2NzdiIpOwogIGQzLnRzdiA9IGQzLmRzdigiCSIsICJ0ZXh0L3RhYi1zZXBhcmF0ZWQtdmFsdWVzIik7CiAgdmFyIGQzX3RpbWVyX3F1ZXVlSGVhZCwgZDNfdGltZXJfcXVldWVUYWlsLCBkM190aW1lcl9pbnRlcnZhbCwgZDNfdGltZXJfdGltZW91dCwgZDNfdGltZXJfYWN0aXZlLCBkM190aW1lcl9mcmFtZSA9IGQzX3dpbmRvd1tkM192ZW5kb3JTeW1ib2woZDNfd2luZG93LCAicmVxdWVzdEFuaW1hdGlvbkZyYW1lIildIHx8IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICBzZXRUaW1lb3V0KGNhbGxiYWNrLCAxNyk7CiAgfTsKICBkMy50aW1lciA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBkZWxheSwgdGhlbikgewogICAgdmFyIG4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgaWYgKG4gPCAyKSBkZWxheSA9IDA7CiAgICBpZiAobiA8IDMpIHRoZW4gPSBEYXRlLm5vdygpOwogICAgdmFyIHRpbWUgPSB0aGVuICsgZGVsYXksIHRpbWVyID0gewogICAgICBjOiBjYWxsYmFjaywKICAgICAgdDogdGltZSwKICAgICAgZjogZmFsc2UsCiAgICAgIG46IG51bGwKICAgIH07CiAgICBpZiAoZDNfdGltZXJfcXVldWVUYWlsKSBkM190aW1lcl9xdWV1ZVRhaWwubiA9IHRpbWVyOyBlbHNlIGQzX3RpbWVyX3F1ZXVlSGVhZCA9IHRpbWVyOwogICAgZDNfdGltZXJfcXVldWVUYWlsID0gdGltZXI7CiAgICBpZiAoIWQzX3RpbWVyX2ludGVydmFsKSB7CiAgICAgIGQzX3RpbWVyX3RpbWVvdXQgPSBjbGVhclRpbWVvdXQoZDNfdGltZXJfdGltZW91dCk7CiAgICAgIGQzX3RpbWVyX2ludGVydmFsID0gMTsKICAgICAgZDNfdGltZXJfZnJhbWUoZDNfdGltZXJfc3RlcCk7CiAgICB9CiAgfTsKICBmdW5jdGlvbiBkM190aW1lcl9zdGVwKCkgewogICAgdmFyIG5vdyA9IGQzX3RpbWVyX21hcmsoKSwgZGVsYXkgPSBkM190aW1lcl9zd2VlcCgpIC0gbm93OwogICAgaWYgKGRlbGF5ID4gMjQpIHsKICAgICAgaWYgKGlzRmluaXRlKGRlbGF5KSkgewogICAgICAgIGNsZWFyVGltZW91dChkM190aW1lcl90aW1lb3V0KTsKICAgICAgICBkM190aW1lcl90aW1lb3V0ID0gc2V0VGltZW91dChkM190aW1lcl9zdGVwLCBkZWxheSk7CiAgICAgIH0KICAgICAgZDNfdGltZXJfaW50ZXJ2YWwgPSAwOwogICAgfSBlbHNlIHsKICAgICAgZDNfdGltZXJfaW50ZXJ2YWwgPSAxOwogICAgICBkM190aW1lcl9mcmFtZShkM190aW1lcl9zdGVwKTsKICAgIH0KICB9CiAgZDMudGltZXIuZmx1c2ggPSBmdW5jdGlvbigpIHsKICAgIGQzX3RpbWVyX21hcmsoKTsKICAgIGQzX3RpbWVyX3N3ZWVwKCk7CiAgfTsKICBmdW5jdGlvbiBkM190aW1lcl9tYXJrKCkgewogICAgdmFyIG5vdyA9IERhdGUubm93KCk7CiAgICBkM190aW1lcl9hY3RpdmUgPSBkM190aW1lcl9xdWV1ZUhlYWQ7CiAgICB3aGlsZSAoZDNfdGltZXJfYWN0aXZlKSB7CiAgICAgIGlmIChub3cgPj0gZDNfdGltZXJfYWN0aXZlLnQpIGQzX3RpbWVyX2FjdGl2ZS5mID0gZDNfdGltZXJfYWN0aXZlLmMobm93IC0gZDNfdGltZXJfYWN0aXZlLnQpOwogICAgICBkM190aW1lcl9hY3RpdmUgPSBkM190aW1lcl9hY3RpdmUubjsKICAgIH0KICAgIHJldHVybiBub3c7CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVyX3N3ZWVwKCkgewogICAgdmFyIHQwLCB0MSA9IGQzX3RpbWVyX3F1ZXVlSGVhZCwgdGltZSA9IEluZmluaXR5OwogICAgd2hpbGUgKHQxKSB7CiAgICAgIGlmICh0MS5mKSB7CiAgICAgICAgdDEgPSB0MCA/IHQwLm4gPSB0MS5uIDogZDNfdGltZXJfcXVldWVIZWFkID0gdDEubjsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodDEudCA8IHRpbWUpIHRpbWUgPSB0MS50OwogICAgICAgIHQxID0gKHQwID0gdDEpLm47CiAgICAgIH0KICAgIH0KICAgIGQzX3RpbWVyX3F1ZXVlVGFpbCA9IHQwOwogICAgcmV0dXJuIHRpbWU7CiAgfQogIGZ1bmN0aW9uIGQzX2Zvcm1hdF9wcmVjaXNpb24oeCwgcCkgewogICAgcmV0dXJuIHAgLSAoeCA/IE1hdGguY2VpbChNYXRoLmxvZyh4KSAvIE1hdGguTE4xMCkgOiAxKTsKICB9CiAgZDMucm91bmQgPSBmdW5jdGlvbih4LCBuKSB7CiAgICByZXR1cm4gbiA/IE1hdGgucm91bmQoeCAqIChuID0gTWF0aC5wb3coMTAsIG4pKSkgLyBuIDogTWF0aC5yb3VuZCh4KTsKICB9OwogIHZhciBkM19mb3JtYXRQcmVmaXhlcyA9IFsgInkiLCAieiIsICJhIiwgImYiLCAicCIsICJuIiwgIsK1IiwgIm0iLCAiIiwgImsiLCAiTSIsICJHIiwgIlQiLCAiUCIsICJFIiwgIloiLCAiWSIgXS5tYXAoZDNfZm9ybWF0UHJlZml4KTsKICBkMy5mb3JtYXRQcmVmaXggPSBmdW5jdGlvbih2YWx1ZSwgcHJlY2lzaW9uKSB7CiAgICB2YXIgaSA9IDA7CiAgICBpZiAodmFsdWUpIHsKICAgICAgaWYgKHZhbHVlIDwgMCkgdmFsdWUgKj0gLTE7CiAgICAgIGlmIChwcmVjaXNpb24pIHZhbHVlID0gZDMucm91bmQodmFsdWUsIGQzX2Zvcm1hdF9wcmVjaXNpb24odmFsdWUsIHByZWNpc2lvbikpOwogICAgICBpID0gMSArIE1hdGguZmxvb3IoMWUtMTIgKyBNYXRoLmxvZyh2YWx1ZSkgLyBNYXRoLkxOMTApOwogICAgICBpID0gTWF0aC5tYXgoLTI0LCBNYXRoLm1pbigyNCwgTWF0aC5mbG9vcigoaSAtIDEpIC8gMykgKiAzKSk7CiAgICB9CiAgICByZXR1cm4gZDNfZm9ybWF0UHJlZml4ZXNbOCArIGkgLyAzXTsKICB9OwogIGZ1bmN0aW9uIGQzX2Zvcm1hdFByZWZpeChkLCBpKSB7CiAgICB2YXIgayA9IE1hdGgucG93KDEwLCBhYnMoOCAtIGkpICogMyk7CiAgICByZXR1cm4gewogICAgICBzY2FsZTogaSA+IDggPyBmdW5jdGlvbihkKSB7CiAgICAgICAgcmV0dXJuIGQgLyBrOwogICAgICB9IDogZnVuY3Rpb24oZCkgewogICAgICAgIHJldHVybiBkICogazsKICAgICAgfSwKICAgICAgc3ltYm9sOiBkCiAgICB9OwogIH0KICBmdW5jdGlvbiBkM19sb2NhbGVfbnVtYmVyRm9ybWF0KGxvY2FsZSkgewogICAgdmFyIGxvY2FsZV9kZWNpbWFsID0gbG9jYWxlLmRlY2ltYWwsIGxvY2FsZV90aG91c2FuZHMgPSBsb2NhbGUudGhvdXNhbmRzLCBsb2NhbGVfZ3JvdXBpbmcgPSBsb2NhbGUuZ3JvdXBpbmcsIGxvY2FsZV9jdXJyZW5jeSA9IGxvY2FsZS5jdXJyZW5jeSwgZm9ybWF0R3JvdXAgPSBsb2NhbGVfZ3JvdXBpbmcgJiYgbG9jYWxlX3Rob3VzYW5kcyA/IGZ1bmN0aW9uKHZhbHVlLCB3aWR0aCkgewogICAgICB2YXIgaSA9IHZhbHVlLmxlbmd0aCwgdCA9IFtdLCBqID0gMCwgZyA9IGxvY2FsZV9ncm91cGluZ1swXSwgbGVuZ3RoID0gMDsKICAgICAgd2hpbGUgKGkgPiAwICYmIGcgPiAwKSB7CiAgICAgICAgaWYgKGxlbmd0aCArIGcgKyAxID4gd2lkdGgpIGcgPSBNYXRoLm1heCgxLCB3aWR0aCAtIGxlbmd0aCk7CiAgICAgICAgdC5wdXNoKHZhbHVlLnN1YnN0cmluZyhpIC09IGcsIGkgKyBnKSk7CiAgICAgICAgaWYgKChsZW5ndGggKz0gZyArIDEpID4gd2lkdGgpIGJyZWFrOwogICAgICAgIGcgPSBsb2NhbGVfZ3JvdXBpbmdbaiA9IChqICsgMSkgJSBsb2NhbGVfZ3JvdXBpbmcubGVuZ3RoXTsKICAgICAgfQogICAgICByZXR1cm4gdC5yZXZlcnNlKCkuam9pbihsb2NhbGVfdGhvdXNhbmRzKTsKICAgIH0gOiBkM19pZGVudGl0eTsKICAgIHJldHVybiBmdW5jdGlvbihzcGVjaWZpZXIpIHsKICAgICAgdmFyIG1hdGNoID0gZDNfZm9ybWF0X3JlLmV4ZWMoc3BlY2lmaWVyKSwgZmlsbCA9IG1hdGNoWzFdIHx8ICIgIiwgYWxpZ24gPSBtYXRjaFsyXSB8fCAiPiIsIHNpZ24gPSBtYXRjaFszXSB8fCAiLSIsIHN5bWJvbCA9IG1hdGNoWzRdIHx8ICIiLCB6ZmlsbCA9IG1hdGNoWzVdLCB3aWR0aCA9ICttYXRjaFs2XSwgY29tbWEgPSBtYXRjaFs3XSwgcHJlY2lzaW9uID0gbWF0Y2hbOF0sIHR5cGUgPSBtYXRjaFs5XSwgc2NhbGUgPSAxLCBwcmVmaXggPSAiIiwgc3VmZml4ID0gIiIsIGludGVnZXIgPSBmYWxzZSwgZXhwb25lbnQgPSB0cnVlOwogICAgICBpZiAocHJlY2lzaW9uKSBwcmVjaXNpb24gPSArcHJlY2lzaW9uLnN1YnN0cmluZygxKTsKICAgICAgaWYgKHpmaWxsIHx8IGZpbGwgPT09ICIwIiAmJiBhbGlnbiA9PT0gIj0iKSB7CiAgICAgICAgemZpbGwgPSBmaWxsID0gIjAiOwogICAgICAgIGFsaWduID0gIj0iOwogICAgICB9CiAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgY2FzZSAibiI6CiAgICAgICAgY29tbWEgPSB0cnVlOwogICAgICAgIHR5cGUgPSAiZyI7CiAgICAgICAgYnJlYWs7CgogICAgICAgY2FzZSAiJSI6CiAgICAgICAgc2NhbGUgPSAxMDA7CiAgICAgICAgc3VmZml4ID0gIiUiOwogICAgICAgIHR5cGUgPSAiZiI7CiAgICAgICAgYnJlYWs7CgogICAgICAgY2FzZSAicCI6CiAgICAgICAgc2NhbGUgPSAxMDA7CiAgICAgICAgc3VmZml4ID0gIiUiOwogICAgICAgIHR5cGUgPSAiciI7CiAgICAgICAgYnJlYWs7CgogICAgICAgY2FzZSAiYiI6CiAgICAgICBjYXNlICJvIjoKICAgICAgIGNhc2UgIngiOgogICAgICAgY2FzZSAiWCI6CiAgICAgICAgaWYgKHN5bWJvbCA9PT0gIiMiKSBwcmVmaXggPSAiMCIgKyB0eXBlLnRvTG93ZXJDYXNlKCk7CgogICAgICAgY2FzZSAiYyI6CiAgICAgICAgZXhwb25lbnQgPSBmYWxzZTsKCiAgICAgICBjYXNlICJkIjoKICAgICAgICBpbnRlZ2VyID0gdHJ1ZTsKICAgICAgICBwcmVjaXNpb24gPSAwOwogICAgICAgIGJyZWFrOwoKICAgICAgIGNhc2UgInMiOgogICAgICAgIHNjYWxlID0gLTE7CiAgICAgICAgdHlwZSA9ICJyIjsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAoc3ltYm9sID09PSAiJCIpIHByZWZpeCA9IGxvY2FsZV9jdXJyZW5jeVswXSwgc3VmZml4ID0gbG9jYWxlX2N1cnJlbmN5WzFdOwogICAgICBpZiAodHlwZSA9PSAiciIgJiYgIXByZWNpc2lvbikgdHlwZSA9ICJnIjsKICAgICAgaWYgKHByZWNpc2lvbiAhPSBudWxsKSB7CiAgICAgICAgaWYgKHR5cGUgPT0gImciKSBwcmVjaXNpb24gPSBNYXRoLm1heCgxLCBNYXRoLm1pbigyMSwgcHJlY2lzaW9uKSk7IGVsc2UgaWYgKHR5cGUgPT0gImUiIHx8IHR5cGUgPT0gImYiKSBwcmVjaXNpb24gPSBNYXRoLm1heCgwLCBNYXRoLm1pbigyMCwgcHJlY2lzaW9uKSk7CiAgICAgIH0KICAgICAgdHlwZSA9IGQzX2Zvcm1hdF90eXBlcy5nZXQodHlwZSkgfHwgZDNfZm9ybWF0X3R5cGVEZWZhdWx0OwogICAgICB2YXIgemNvbW1hID0gemZpbGwgJiYgY29tbWE7CiAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHZhciBmdWxsU3VmZml4ID0gc3VmZml4OwogICAgICAgIGlmIChpbnRlZ2VyICYmIHZhbHVlICUgMSkgcmV0dXJuICIiOwogICAgICAgIHZhciBuZWdhdGl2ZSA9IHZhbHVlIDwgMCB8fCB2YWx1ZSA9PT0gMCAmJiAxIC8gdmFsdWUgPCAwID8gKHZhbHVlID0gLXZhbHVlLCAiLSIpIDogc2lnbiA9PT0gIi0iID8gIiIgOiBzaWduOwogICAgICAgIGlmIChzY2FsZSA8IDApIHsKICAgICAgICAgIHZhciB1bml0ID0gZDMuZm9ybWF0UHJlZml4KHZhbHVlLCBwcmVjaXNpb24pOwogICAgICAgICAgdmFsdWUgPSB1bml0LnNjYWxlKHZhbHVlKTsKICAgICAgICAgIGZ1bGxTdWZmaXggPSB1bml0LnN5bWJvbCArIHN1ZmZpeDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFsdWUgKj0gc2NhbGU7CiAgICAgICAgfQogICAgICAgIHZhbHVlID0gdHlwZSh2YWx1ZSwgcHJlY2lzaW9uKTsKICAgICAgICB2YXIgaSA9IHZhbHVlLmxhc3RJbmRleE9mKCIuIiksIGJlZm9yZSwgYWZ0ZXI7CiAgICAgICAgaWYgKGkgPCAwKSB7CiAgICAgICAgICB2YXIgaiA9IGV4cG9uZW50ID8gdmFsdWUubGFzdEluZGV4T2YoImUiKSA6IC0xOwogICAgICAgICAgaWYgKGogPCAwKSBiZWZvcmUgPSB2YWx1ZSwgYWZ0ZXIgPSAiIjsgZWxzZSBiZWZvcmUgPSB2YWx1ZS5zdWJzdHJpbmcoMCwgaiksIGFmdGVyID0gdmFsdWUuc3Vic3RyaW5nKGopOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBiZWZvcmUgPSB2YWx1ZS5zdWJzdHJpbmcoMCwgaSk7CiAgICAgICAgICBhZnRlciA9IGxvY2FsZV9kZWNpbWFsICsgdmFsdWUuc3Vic3RyaW5nKGkgKyAxKTsKICAgICAgICB9CiAgICAgICAgaWYgKCF6ZmlsbCAmJiBjb21tYSkgYmVmb3JlID0gZm9ybWF0R3JvdXAoYmVmb3JlLCBJbmZpbml0eSk7CiAgICAgICAgdmFyIGxlbmd0aCA9IHByZWZpeC5sZW5ndGggKyBiZWZvcmUubGVuZ3RoICsgYWZ0ZXIubGVuZ3RoICsgKHpjb21tYSA/IDAgOiBuZWdhdGl2ZS5sZW5ndGgpLCBwYWRkaW5nID0gbGVuZ3RoIDwgd2lkdGggPyBuZXcgQXJyYXkobGVuZ3RoID0gd2lkdGggLSBsZW5ndGggKyAxKS5qb2luKGZpbGwpIDogIiI7CiAgICAgICAgaWYgKHpjb21tYSkgYmVmb3JlID0gZm9ybWF0R3JvdXAocGFkZGluZyArIGJlZm9yZSwgcGFkZGluZy5sZW5ndGggPyB3aWR0aCAtIGFmdGVyLmxlbmd0aCA6IEluZmluaXR5KTsKICAgICAgICBuZWdhdGl2ZSArPSBwcmVmaXg7CiAgICAgICAgdmFsdWUgPSBiZWZvcmUgKyBhZnRlcjsKICAgICAgICByZXR1cm4gKGFsaWduID09PSAiPCIgPyBuZWdhdGl2ZSArIHZhbHVlICsgcGFkZGluZyA6IGFsaWduID09PSAiPiIgPyBwYWRkaW5nICsgbmVnYXRpdmUgKyB2YWx1ZSA6IGFsaWduID09PSAiXiIgPyBwYWRkaW5nLnN1YnN0cmluZygwLCBsZW5ndGggPj49IDEpICsgbmVnYXRpdmUgKyB2YWx1ZSArIHBhZGRpbmcuc3Vic3RyaW5nKGxlbmd0aCkgOiBuZWdhdGl2ZSArICh6Y29tbWEgPyB2YWx1ZSA6IHBhZGRpbmcgKyB2YWx1ZSkpICsgZnVsbFN1ZmZpeDsKICAgICAgfTsKICAgIH07CiAgfQogIHZhciBkM19mb3JtYXRfcmUgPSAvKD86KFtee10pPyhbPD49Xl0pKT8oWytcLSBdKT8oWyQjXSk/KDApPyhcZCspPygsKT8oXC4tP1xkKyk/KFthLXolXSk/L2k7CiAgdmFyIGQzX2Zvcm1hdF90eXBlcyA9IGQzLm1hcCh7CiAgICBiOiBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiB4LnRvU3RyaW5nKDIpOwogICAgfSwKICAgIGM6IGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoeCk7CiAgICB9LAogICAgbzogZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4geC50b1N0cmluZyg4KTsKICAgIH0sCiAgICB4OiBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiB4LnRvU3RyaW5nKDE2KTsKICAgIH0sCiAgICBYOiBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiB4LnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpOwogICAgfSwKICAgIGc6IGZ1bmN0aW9uKHgsIHApIHsKICAgICAgcmV0dXJuIHgudG9QcmVjaXNpb24ocCk7CiAgICB9LAogICAgZTogZnVuY3Rpb24oeCwgcCkgewogICAgICByZXR1cm4geC50b0V4cG9uZW50aWFsKHApOwogICAgfSwKICAgIGY6IGZ1bmN0aW9uKHgsIHApIHsKICAgICAgcmV0dXJuIHgudG9GaXhlZChwKTsKICAgIH0sCiAgICByOiBmdW5jdGlvbih4LCBwKSB7CiAgICAgIHJldHVybiAoeCA9IGQzLnJvdW5kKHgsIGQzX2Zvcm1hdF9wcmVjaXNpb24oeCwgcCkpKS50b0ZpeGVkKE1hdGgubWF4KDAsIE1hdGgubWluKDIwLCBkM19mb3JtYXRfcHJlY2lzaW9uKHggKiAoMSArIDFlLTE1KSwgcCkpKSk7CiAgICB9CiAgfSk7CiAgZnVuY3Rpb24gZDNfZm9ybWF0X3R5cGVEZWZhdWx0KHgpIHsKICAgIHJldHVybiB4ICsgIiI7CiAgfQogIHZhciBkM190aW1lID0gZDMudGltZSA9IHt9LCBkM19kYXRlID0gRGF0ZTsKICBmdW5jdGlvbiBkM19kYXRlX3V0YygpIHsKICAgIHRoaXMuXyA9IG5ldyBEYXRlKGFyZ3VtZW50cy5sZW5ndGggPiAxID8gRGF0ZS5VVEMuYXBwbHkodGhpcywgYXJndW1lbnRzKSA6IGFyZ3VtZW50c1swXSk7CiAgfQogIGQzX2RhdGVfdXRjLnByb3RvdHlwZSA9IHsKICAgIGdldERhdGU6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fLmdldFVUQ0RhdGUoKTsKICAgIH0sCiAgICBnZXREYXk6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fLmdldFVUQ0RheSgpOwogICAgfSwKICAgIGdldEZ1bGxZZWFyOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuXy5nZXRVVENGdWxsWWVhcigpOwogICAgfSwKICAgIGdldEhvdXJzOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuXy5nZXRVVENIb3VycygpOwogICAgfSwKICAgIGdldE1pbGxpc2Vjb25kczogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLl8uZ2V0VVRDTWlsbGlzZWNvbmRzKCk7CiAgICB9LAogICAgZ2V0TWludXRlczogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLl8uZ2V0VVRDTWludXRlcygpOwogICAgfSwKICAgIGdldE1vbnRoOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuXy5nZXRVVENNb250aCgpOwogICAgfSwKICAgIGdldFNlY29uZHM6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fLmdldFVUQ1NlY29uZHMoKTsKICAgIH0sCiAgICBnZXRUaW1lOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuXy5nZXRUaW1lKCk7CiAgICB9LAogICAgZ2V0VGltZXpvbmVPZmZzZXQ6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gMDsKICAgIH0sCiAgICB2YWx1ZU9mOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuXy52YWx1ZU9mKCk7CiAgICB9LAogICAgc2V0RGF0ZTogZnVuY3Rpb24oKSB7CiAgICAgIGQzX3RpbWVfcHJvdG90eXBlLnNldFVUQ0RhdGUuYXBwbHkodGhpcy5fLCBhcmd1bWVudHMpOwogICAgfSwKICAgIHNldERheTogZnVuY3Rpb24oKSB7CiAgICAgIGQzX3RpbWVfcHJvdG90eXBlLnNldFVUQ0RheS5hcHBseSh0aGlzLl8sIGFyZ3VtZW50cyk7CiAgICB9LAogICAgc2V0RnVsbFllYXI6IGZ1bmN0aW9uKCkgewogICAgICBkM190aW1lX3Byb3RvdHlwZS5zZXRVVENGdWxsWWVhci5hcHBseSh0aGlzLl8sIGFyZ3VtZW50cyk7CiAgICB9LAogICAgc2V0SG91cnM6IGZ1bmN0aW9uKCkgewogICAgICBkM190aW1lX3Byb3RvdHlwZS5zZXRVVENIb3Vycy5hcHBseSh0aGlzLl8sIGFyZ3VtZW50cyk7CiAgICB9LAogICAgc2V0TWlsbGlzZWNvbmRzOiBmdW5jdGlvbigpIHsKICAgICAgZDNfdGltZV9wcm90b3R5cGUuc2V0VVRDTWlsbGlzZWNvbmRzLmFwcGx5KHRoaXMuXywgYXJndW1lbnRzKTsKICAgIH0sCiAgICBzZXRNaW51dGVzOiBmdW5jdGlvbigpIHsKICAgICAgZDNfdGltZV9wcm90b3R5cGUuc2V0VVRDTWludXRlcy5hcHBseSh0aGlzLl8sIGFyZ3VtZW50cyk7CiAgICB9LAogICAgc2V0TW9udGg6IGZ1bmN0aW9uKCkgewogICAgICBkM190aW1lX3Byb3RvdHlwZS5zZXRVVENNb250aC5hcHBseSh0aGlzLl8sIGFyZ3VtZW50cyk7CiAgICB9LAogICAgc2V0U2Vjb25kczogZnVuY3Rpb24oKSB7CiAgICAgIGQzX3RpbWVfcHJvdG90eXBlLnNldFVUQ1NlY29uZHMuYXBwbHkodGhpcy5fLCBhcmd1bWVudHMpOwogICAgfSwKICAgIHNldFRpbWU6IGZ1bmN0aW9uKCkgewogICAgICBkM190aW1lX3Byb3RvdHlwZS5zZXRUaW1lLmFwcGx5KHRoaXMuXywgYXJndW1lbnRzKTsKICAgIH0KICB9OwogIHZhciBkM190aW1lX3Byb3RvdHlwZSA9IERhdGUucHJvdG90eXBlOwogIGZ1bmN0aW9uIGQzX3RpbWVfaW50ZXJ2YWwobG9jYWwsIHN0ZXAsIG51bWJlcikgewogICAgZnVuY3Rpb24gcm91bmQoZGF0ZSkgewogICAgICB2YXIgZDAgPSBsb2NhbChkYXRlKSwgZDEgPSBvZmZzZXQoZDAsIDEpOwogICAgICByZXR1cm4gZGF0ZSAtIGQwIDwgZDEgLSBkYXRlID8gZDAgOiBkMTsKICAgIH0KICAgIGZ1bmN0aW9uIGNlaWwoZGF0ZSkgewogICAgICBzdGVwKGRhdGUgPSBsb2NhbChuZXcgZDNfZGF0ZShkYXRlIC0gMSkpLCAxKTsKICAgICAgcmV0dXJuIGRhdGU7CiAgICB9CiAgICBmdW5jdGlvbiBvZmZzZXQoZGF0ZSwgaykgewogICAgICBzdGVwKGRhdGUgPSBuZXcgZDNfZGF0ZSgrZGF0ZSksIGspOwogICAgICByZXR1cm4gZGF0ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHJhbmdlKHQwLCB0MSwgZHQpIHsKICAgICAgdmFyIHRpbWUgPSBjZWlsKHQwKSwgdGltZXMgPSBbXTsKICAgICAgaWYgKGR0ID4gMSkgewogICAgICAgIHdoaWxlICh0aW1lIDwgdDEpIHsKICAgICAgICAgIGlmICghKG51bWJlcih0aW1lKSAlIGR0KSkgdGltZXMucHVzaChuZXcgRGF0ZSgrdGltZSkpOwogICAgICAgICAgc3RlcCh0aW1lLCAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2hpbGUgKHRpbWUgPCB0MSkgdGltZXMucHVzaChuZXcgRGF0ZSgrdGltZSkpLCBzdGVwKHRpbWUsIDEpOwogICAgICB9CiAgICAgIHJldHVybiB0aW1lczsKICAgIH0KICAgIGZ1bmN0aW9uIHJhbmdlX3V0Yyh0MCwgdDEsIGR0KSB7CiAgICAgIHRyeSB7CiAgICAgICAgZDNfZGF0ZSA9IGQzX2RhdGVfdXRjOwogICAgICAgIHZhciB1dGMgPSBuZXcgZDNfZGF0ZV91dGMoKTsKICAgICAgICB1dGMuXyA9IHQwOwogICAgICAgIHJldHVybiByYW5nZSh1dGMsIHQxLCBkdCk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgZDNfZGF0ZSA9IERhdGU7CiAgICAgIH0KICAgIH0KICAgIGxvY2FsLmZsb29yID0gbG9jYWw7CiAgICBsb2NhbC5yb3VuZCA9IHJvdW5kOwogICAgbG9jYWwuY2VpbCA9IGNlaWw7CiAgICBsb2NhbC5vZmZzZXQgPSBvZmZzZXQ7CiAgICBsb2NhbC5yYW5nZSA9IHJhbmdlOwogICAgdmFyIHV0YyA9IGxvY2FsLnV0YyA9IGQzX3RpbWVfaW50ZXJ2YWxfdXRjKGxvY2FsKTsKICAgIHV0Yy5mbG9vciA9IHV0YzsKICAgIHV0Yy5yb3VuZCA9IGQzX3RpbWVfaW50ZXJ2YWxfdXRjKHJvdW5kKTsKICAgIHV0Yy5jZWlsID0gZDNfdGltZV9pbnRlcnZhbF91dGMoY2VpbCk7CiAgICB1dGMub2Zmc2V0ID0gZDNfdGltZV9pbnRlcnZhbF91dGMob2Zmc2V0KTsKICAgIHV0Yy5yYW5nZSA9IHJhbmdlX3V0YzsKICAgIHJldHVybiBsb2NhbDsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9pbnRlcnZhbF91dGMobWV0aG9kKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oZGF0ZSwgaykgewogICAgICB0cnkgewogICAgICAgIGQzX2RhdGUgPSBkM19kYXRlX3V0YzsKICAgICAgICB2YXIgdXRjID0gbmV3IGQzX2RhdGVfdXRjKCk7CiAgICAgICAgdXRjLl8gPSBkYXRlOwogICAgICAgIHJldHVybiBtZXRob2QodXRjLCBrKS5fOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIGQzX2RhdGUgPSBEYXRlOwogICAgICB9CiAgICB9OwogIH0KICBkM190aW1lLnllYXIgPSBkM190aW1lX2ludGVydmFsKGZ1bmN0aW9uKGRhdGUpIHsKICAgIGRhdGUgPSBkM190aW1lLmRheShkYXRlKTsKICAgIGRhdGUuc2V0TW9udGgoMCwgMSk7CiAgICByZXR1cm4gZGF0ZTsKICB9LCBmdW5jdGlvbihkYXRlLCBvZmZzZXQpIHsKICAgIGRhdGUuc2V0RnVsbFllYXIoZGF0ZS5nZXRGdWxsWWVhcigpICsgb2Zmc2V0KTsKICB9LCBmdW5jdGlvbihkYXRlKSB7CiAgICByZXR1cm4gZGF0ZS5nZXRGdWxsWWVhcigpOwogIH0pOwogIGQzX3RpbWUueWVhcnMgPSBkM190aW1lLnllYXIucmFuZ2U7CiAgZDNfdGltZS55ZWFycy51dGMgPSBkM190aW1lLnllYXIudXRjLnJhbmdlOwogIGQzX3RpbWUuZGF5ID0gZDNfdGltZV9pbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgICB2YXIgZGF5ID0gbmV3IGQzX2RhdGUoMmUzLCAwKTsKICAgIGRheS5zZXRGdWxsWWVhcihkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSwgZGF0ZS5nZXREYXRlKCkpOwogICAgcmV0dXJuIGRheTsKICB9LCBmdW5jdGlvbihkYXRlLCBvZmZzZXQpIHsKICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIG9mZnNldCk7CiAgfSwgZnVuY3Rpb24oZGF0ZSkgewogICAgcmV0dXJuIGRhdGUuZ2V0RGF0ZSgpIC0gMTsKICB9KTsKICBkM190aW1lLmRheXMgPSBkM190aW1lLmRheS5yYW5nZTsKICBkM190aW1lLmRheXMudXRjID0gZDNfdGltZS5kYXkudXRjLnJhbmdlOwogIGQzX3RpbWUuZGF5T2ZZZWFyID0gZnVuY3Rpb24oZGF0ZSkgewogICAgdmFyIHllYXIgPSBkM190aW1lLnllYXIoZGF0ZSk7CiAgICByZXR1cm4gTWF0aC5mbG9vcigoZGF0ZSAtIHllYXIgLSAoZGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpIC0geWVhci5nZXRUaW1lem9uZU9mZnNldCgpKSAqIDZlNCkgLyA4NjRlNSk7CiAgfTsKICBbICJzdW5kYXkiLCAibW9uZGF5IiwgInR1ZXNkYXkiLCAid2VkbmVzZGF5IiwgInRodXJzZGF5IiwgImZyaWRheSIsICJzYXR1cmRheSIgXS5mb3JFYWNoKGZ1bmN0aW9uKGRheSwgaSkgewogICAgaSA9IDcgLSBpOwogICAgdmFyIGludGVydmFsID0gZDNfdGltZVtkYXldID0gZDNfdGltZV9pbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgICAgIChkYXRlID0gZDNfdGltZS5kYXkoZGF0ZSkpLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgLSAoZGF0ZS5nZXREYXkoKSArIGkpICUgNyk7CiAgICAgIHJldHVybiBkYXRlOwogICAgfSwgZnVuY3Rpb24oZGF0ZSwgb2Zmc2V0KSB7CiAgICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIE1hdGguZmxvb3Iob2Zmc2V0KSAqIDcpOwogICAgfSwgZnVuY3Rpb24oZGF0ZSkgewogICAgICB2YXIgZGF5ID0gZDNfdGltZS55ZWFyKGRhdGUpLmdldERheSgpOwogICAgICByZXR1cm4gTWF0aC5mbG9vcigoZDNfdGltZS5kYXlPZlllYXIoZGF0ZSkgKyAoZGF5ICsgaSkgJSA3KSAvIDcpIC0gKGRheSAhPT0gaSk7CiAgICB9KTsKICAgIGQzX3RpbWVbZGF5ICsgInMiXSA9IGludGVydmFsLnJhbmdlOwogICAgZDNfdGltZVtkYXkgKyAicyJdLnV0YyA9IGludGVydmFsLnV0Yy5yYW5nZTsKICAgIGQzX3RpbWVbZGF5ICsgIk9mWWVhciJdID0gZnVuY3Rpb24oZGF0ZSkgewogICAgICB2YXIgZGF5ID0gZDNfdGltZS55ZWFyKGRhdGUpLmdldERheSgpOwogICAgICByZXR1cm4gTWF0aC5mbG9vcigoZDNfdGltZS5kYXlPZlllYXIoZGF0ZSkgKyAoZGF5ICsgaSkgJSA3KSAvIDcpOwogICAgfTsKICB9KTsKICBkM190aW1lLndlZWsgPSBkM190aW1lLnN1bmRheTsKICBkM190aW1lLndlZWtzID0gZDNfdGltZS5zdW5kYXkucmFuZ2U7CiAgZDNfdGltZS53ZWVrcy51dGMgPSBkM190aW1lLnN1bmRheS51dGMucmFuZ2U7CiAgZDNfdGltZS53ZWVrT2ZZZWFyID0gZDNfdGltZS5zdW5kYXlPZlllYXI7CiAgZnVuY3Rpb24gZDNfbG9jYWxlX3RpbWVGb3JtYXQobG9jYWxlKSB7CiAgICB2YXIgbG9jYWxlX2RhdGVUaW1lID0gbG9jYWxlLmRhdGVUaW1lLCBsb2NhbGVfZGF0ZSA9IGxvY2FsZS5kYXRlLCBsb2NhbGVfdGltZSA9IGxvY2FsZS50aW1lLCBsb2NhbGVfcGVyaW9kcyA9IGxvY2FsZS5wZXJpb2RzLCBsb2NhbGVfZGF5cyA9IGxvY2FsZS5kYXlzLCBsb2NhbGVfc2hvcnREYXlzID0gbG9jYWxlLnNob3J0RGF5cywgbG9jYWxlX21vbnRocyA9IGxvY2FsZS5tb250aHMsIGxvY2FsZV9zaG9ydE1vbnRocyA9IGxvY2FsZS5zaG9ydE1vbnRoczsKICAgIGZ1bmN0aW9uIGQzX3RpbWVfZm9ybWF0KHRlbXBsYXRlKSB7CiAgICAgIHZhciBuID0gdGVtcGxhdGUubGVuZ3RoOwogICAgICBmdW5jdGlvbiBmb3JtYXQoZGF0ZSkgewogICAgICAgIHZhciBzdHJpbmcgPSBbXSwgaSA9IC0xLCBqID0gMCwgYywgcCwgZjsKICAgICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgICAgaWYgKHRlbXBsYXRlLmNoYXJDb2RlQXQoaSkgPT09IDM3KSB7CiAgICAgICAgICAgIHN0cmluZy5wdXNoKHRlbXBsYXRlLnNsaWNlKGosIGkpKTsKICAgICAgICAgICAgaWYgKChwID0gZDNfdGltZV9mb3JtYXRQYWRzW2MgPSB0ZW1wbGF0ZS5jaGFyQXQoKytpKV0pICE9IG51bGwpIGMgPSB0ZW1wbGF0ZS5jaGFyQXQoKytpKTsKICAgICAgICAgICAgaWYgKGYgPSBkM190aW1lX2Zvcm1hdHNbY10pIGMgPSBmKGRhdGUsIHAgPT0gbnVsbCA/IGMgPT09ICJlIiA/ICIgIiA6ICIwIiA6IHApOwogICAgICAgICAgICBzdHJpbmcucHVzaChjKTsKICAgICAgICAgICAgaiA9IGkgKyAxOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzdHJpbmcucHVzaCh0ZW1wbGF0ZS5zbGljZShqLCBpKSk7CiAgICAgICAgcmV0dXJuIHN0cmluZy5qb2luKCIiKTsKICAgICAgfQogICAgICBmb3JtYXQucGFyc2UgPSBmdW5jdGlvbihzdHJpbmcpIHsKICAgICAgICB2YXIgZCA9IHsKICAgICAgICAgIHk6IDE5MDAsCiAgICAgICAgICBtOiAwLAogICAgICAgICAgZDogMSwKICAgICAgICAgIEg6IDAsCiAgICAgICAgICBNOiAwLAogICAgICAgICAgUzogMCwKICAgICAgICAgIEw6IDAsCiAgICAgICAgICBaOiBudWxsCiAgICAgICAgfSwgaSA9IGQzX3RpbWVfcGFyc2UoZCwgdGVtcGxhdGUsIHN0cmluZywgMCk7CiAgICAgICAgaWYgKGkgIT0gc3RyaW5nLmxlbmd0aCkgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKCJwIiBpbiBkKSBkLkggPSBkLkggJSAxMiArIGQucCAqIDEyOwogICAgICAgIHZhciBsb2NhbFogPSBkLlogIT0gbnVsbCAmJiBkM19kYXRlICE9PSBkM19kYXRlX3V0YywgZGF0ZSA9IG5ldyAobG9jYWxaID8gZDNfZGF0ZV91dGMgOiBkM19kYXRlKSgpOwogICAgICAgIGlmICgiaiIgaW4gZCkgZGF0ZS5zZXRGdWxsWWVhcihkLnksIDAsIGQuaik7IGVsc2UgaWYgKCJ3IiBpbiBkICYmICgiVyIgaW4gZCB8fCAiVSIgaW4gZCkpIHsKICAgICAgICAgIGRhdGUuc2V0RnVsbFllYXIoZC55LCAwLCAxKTsKICAgICAgICAgIGRhdGUuc2V0RnVsbFllYXIoZC55LCAwLCAiVyIgaW4gZCA/IChkLncgKyA2KSAlIDcgKyBkLlcgKiA3IC0gKGRhdGUuZ2V0RGF5KCkgKyA1KSAlIDcgOiBkLncgKyBkLlUgKiA3IC0gKGRhdGUuZ2V0RGF5KCkgKyA2KSAlIDcpOwogICAgICAgIH0gZWxzZSBkYXRlLnNldEZ1bGxZZWFyKGQueSwgZC5tLCBkLmQpOwogICAgICAgIGRhdGUuc2V0SG91cnMoZC5IICsgKGQuWiAvIDEwMCB8IDApLCBkLk0gKyBkLlogJSAxMDAsIGQuUywgZC5MKTsKICAgICAgICByZXR1cm4gbG9jYWxaID8gZGF0ZS5fIDogZGF0ZTsKICAgICAgfTsKICAgICAgZm9ybWF0LnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRlbXBsYXRlOwogICAgICB9OwogICAgICByZXR1cm4gZm9ybWF0OwogICAgfQogICAgZnVuY3Rpb24gZDNfdGltZV9wYXJzZShkYXRlLCB0ZW1wbGF0ZSwgc3RyaW5nLCBqKSB7CiAgICAgIHZhciBjLCBwLCB0LCBpID0gMCwgbiA9IHRlbXBsYXRlLmxlbmd0aCwgbSA9IHN0cmluZy5sZW5ndGg7CiAgICAgIHdoaWxlIChpIDwgbikgewogICAgICAgIGlmIChqID49IG0pIHJldHVybiAtMTsKICAgICAgICBjID0gdGVtcGxhdGUuY2hhckNvZGVBdChpKyspOwogICAgICAgIGlmIChjID09PSAzNykgewogICAgICAgICAgdCA9IHRlbXBsYXRlLmNoYXJBdChpKyspOwogICAgICAgICAgcCA9IGQzX3RpbWVfcGFyc2Vyc1t0IGluIGQzX3RpbWVfZm9ybWF0UGFkcyA/IHRlbXBsYXRlLmNoYXJBdChpKyspIDogdF07CiAgICAgICAgICBpZiAoIXAgfHwgKGogPSBwKGRhdGUsIHN0cmluZywgaikpIDwgMCkgcmV0dXJuIC0xOwogICAgICAgIH0gZWxzZSBpZiAoYyAhPSBzdHJpbmcuY2hhckNvZGVBdChqKyspKSB7CiAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBqOwogICAgfQogICAgZDNfdGltZV9mb3JtYXQudXRjID0gZnVuY3Rpb24odGVtcGxhdGUpIHsKICAgICAgdmFyIGxvY2FsID0gZDNfdGltZV9mb3JtYXQodGVtcGxhdGUpOwogICAgICBmdW5jdGlvbiBmb3JtYXQoZGF0ZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBkM19kYXRlID0gZDNfZGF0ZV91dGM7CiAgICAgICAgICB2YXIgdXRjID0gbmV3IGQzX2RhdGUoKTsKICAgICAgICAgIHV0Yy5fID0gZGF0ZTsKICAgICAgICAgIHJldHVybiBsb2NhbCh1dGMpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBkM19kYXRlID0gRGF0ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZm9ybWF0LnBhcnNlID0gZnVuY3Rpb24oc3RyaW5nKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGQzX2RhdGUgPSBkM19kYXRlX3V0YzsKICAgICAgICAgIHZhciBkYXRlID0gbG9jYWwucGFyc2Uoc3RyaW5nKTsKICAgICAgICAgIHJldHVybiBkYXRlICYmIGRhdGUuXzsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgZDNfZGF0ZSA9IERhdGU7CiAgICAgICAgfQogICAgICB9OwogICAgICBmb3JtYXQudG9TdHJpbmcgPSBsb2NhbC50b1N0cmluZzsKICAgICAgcmV0dXJuIGZvcm1hdDsKICAgIH07CiAgICBkM190aW1lX2Zvcm1hdC5tdWx0aSA9IGQzX3RpbWVfZm9ybWF0LnV0Yy5tdWx0aSA9IGQzX3RpbWVfZm9ybWF0TXVsdGk7CiAgICB2YXIgZDNfdGltZV9wZXJpb2RMb29rdXAgPSBkMy5tYXAoKSwgZDNfdGltZV9kYXlSZSA9IGQzX3RpbWVfZm9ybWF0UmUobG9jYWxlX2RheXMpLCBkM190aW1lX2RheUxvb2t1cCA9IGQzX3RpbWVfZm9ybWF0TG9va3VwKGxvY2FsZV9kYXlzKSwgZDNfdGltZV9kYXlBYmJyZXZSZSA9IGQzX3RpbWVfZm9ybWF0UmUobG9jYWxlX3Nob3J0RGF5cyksIGQzX3RpbWVfZGF5QWJicmV2TG9va3VwID0gZDNfdGltZV9mb3JtYXRMb29rdXAobG9jYWxlX3Nob3J0RGF5cyksIGQzX3RpbWVfbW9udGhSZSA9IGQzX3RpbWVfZm9ybWF0UmUobG9jYWxlX21vbnRocyksIGQzX3RpbWVfbW9udGhMb29rdXAgPSBkM190aW1lX2Zvcm1hdExvb2t1cChsb2NhbGVfbW9udGhzKSwgZDNfdGltZV9tb250aEFiYnJldlJlID0gZDNfdGltZV9mb3JtYXRSZShsb2NhbGVfc2hvcnRNb250aHMpLCBkM190aW1lX21vbnRoQWJicmV2TG9va3VwID0gZDNfdGltZV9mb3JtYXRMb29rdXAobG9jYWxlX3Nob3J0TW9udGhzKTsKICAgIGxvY2FsZV9wZXJpb2RzLmZvckVhY2goZnVuY3Rpb24ocCwgaSkgewogICAgICBkM190aW1lX3BlcmlvZExvb2t1cC5zZXQocC50b0xvd2VyQ2FzZSgpLCBpKTsKICAgIH0pOwogICAgdmFyIGQzX3RpbWVfZm9ybWF0cyA9IHsKICAgICAgYTogZnVuY3Rpb24oZCkgewogICAgICAgIHJldHVybiBsb2NhbGVfc2hvcnREYXlzW2QuZ2V0RGF5KCldOwogICAgICB9LAogICAgICBBOiBmdW5jdGlvbihkKSB7CiAgICAgICAgcmV0dXJuIGxvY2FsZV9kYXlzW2QuZ2V0RGF5KCldOwogICAgICB9LAogICAgICBiOiBmdW5jdGlvbihkKSB7CiAgICAgICAgcmV0dXJuIGxvY2FsZV9zaG9ydE1vbnRoc1tkLmdldE1vbnRoKCldOwogICAgICB9LAogICAgICBCOiBmdW5jdGlvbihkKSB7CiAgICAgICAgcmV0dXJuIGxvY2FsZV9tb250aHNbZC5nZXRNb250aCgpXTsKICAgICAgfSwKICAgICAgYzogZDNfdGltZV9mb3JtYXQobG9jYWxlX2RhdGVUaW1lKSwKICAgICAgZDogZnVuY3Rpb24oZCwgcCkgewogICAgICAgIHJldHVybiBkM190aW1lX2Zvcm1hdFBhZChkLmdldERhdGUoKSwgcCwgMik7CiAgICAgIH0sCiAgICAgIGU6IGZ1bmN0aW9uKGQsIHApIHsKICAgICAgICByZXR1cm4gZDNfdGltZV9mb3JtYXRQYWQoZC5nZXREYXRlKCksIHAsIDIpOwogICAgICB9LAogICAgICBIOiBmdW5jdGlvbihkLCBwKSB7CiAgICAgICAgcmV0dXJuIGQzX3RpbWVfZm9ybWF0UGFkKGQuZ2V0SG91cnMoKSwgcCwgMik7CiAgICAgIH0sCiAgICAgIEk6IGZ1bmN0aW9uKGQsIHApIHsKICAgICAgICByZXR1cm4gZDNfdGltZV9mb3JtYXRQYWQoZC5nZXRIb3VycygpICUgMTIgfHwgMTIsIHAsIDIpOwogICAgICB9LAogICAgICBqOiBmdW5jdGlvbihkLCBwKSB7CiAgICAgICAgcmV0dXJuIGQzX3RpbWVfZm9ybWF0UGFkKDEgKyBkM190aW1lLmRheU9mWWVhcihkKSwgcCwgMyk7CiAgICAgIH0sCiAgICAgIEw6IGZ1bmN0aW9uKGQsIHApIHsKICAgICAgICByZXR1cm4gZDNfdGltZV9mb3JtYXRQYWQoZC5nZXRNaWxsaXNlY29uZHMoKSwgcCwgMyk7CiAgICAgIH0sCiAgICAgIG06IGZ1bmN0aW9uKGQsIHApIHsKICAgICAgICByZXR1cm4gZDNfdGltZV9mb3JtYXRQYWQoZC5nZXRNb250aCgpICsgMSwgcCwgMik7CiAgICAgIH0sCiAgICAgIE06IGZ1bmN0aW9uKGQsIHApIHsKICAgICAgICByZXR1cm4gZDNfdGltZV9mb3JtYXRQYWQoZC5nZXRNaW51dGVzKCksIHAsIDIpOwogICAgICB9LAogICAgICBwOiBmdW5jdGlvbihkKSB7CiAgICAgICAgcmV0dXJuIGxvY2FsZV9wZXJpb2RzWysoZC5nZXRIb3VycygpID49IDEyKV07CiAgICAgIH0sCiAgICAgIFM6IGZ1bmN0aW9uKGQsIHApIHsKICAgICAgICByZXR1cm4gZDNfdGltZV9mb3JtYXRQYWQoZC5nZXRTZWNvbmRzKCksIHAsIDIpOwogICAgICB9LAogICAgICBVOiBmdW5jdGlvbihkLCBwKSB7CiAgICAgICAgcmV0dXJuIGQzX3RpbWVfZm9ybWF0UGFkKGQzX3RpbWUuc3VuZGF5T2ZZZWFyKGQpLCBwLCAyKTsKICAgICAgfSwKICAgICAgdzogZnVuY3Rpb24oZCkgewogICAgICAgIHJldHVybiBkLmdldERheSgpOwogICAgICB9LAogICAgICBXOiBmdW5jdGlvbihkLCBwKSB7CiAgICAgICAgcmV0dXJuIGQzX3RpbWVfZm9ybWF0UGFkKGQzX3RpbWUubW9uZGF5T2ZZZWFyKGQpLCBwLCAyKTsKICAgICAgfSwKICAgICAgeDogZDNfdGltZV9mb3JtYXQobG9jYWxlX2RhdGUpLAogICAgICBYOiBkM190aW1lX2Zvcm1hdChsb2NhbGVfdGltZSksCiAgICAgIHk6IGZ1bmN0aW9uKGQsIHApIHsKICAgICAgICByZXR1cm4gZDNfdGltZV9mb3JtYXRQYWQoZC5nZXRGdWxsWWVhcigpICUgMTAwLCBwLCAyKTsKICAgICAgfSwKICAgICAgWTogZnVuY3Rpb24oZCwgcCkgewogICAgICAgIHJldHVybiBkM190aW1lX2Zvcm1hdFBhZChkLmdldEZ1bGxZZWFyKCkgJSAxZTQsIHAsIDQpOwogICAgICB9LAogICAgICBaOiBkM190aW1lX3pvbmUsCiAgICAgICIlIjogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuICIlIjsKICAgICAgfQogICAgfTsKICAgIHZhciBkM190aW1lX3BhcnNlcnMgPSB7CiAgICAgIGE6IGQzX3RpbWVfcGFyc2VXZWVrZGF5QWJicmV2LAogICAgICBBOiBkM190aW1lX3BhcnNlV2Vla2RheSwKICAgICAgYjogZDNfdGltZV9wYXJzZU1vbnRoQWJicmV2LAogICAgICBCOiBkM190aW1lX3BhcnNlTW9udGgsCiAgICAgIGM6IGQzX3RpbWVfcGFyc2VMb2NhbGVGdWxsLAogICAgICBkOiBkM190aW1lX3BhcnNlRGF5LAogICAgICBlOiBkM190aW1lX3BhcnNlRGF5LAogICAgICBIOiBkM190aW1lX3BhcnNlSG91cjI0LAogICAgICBJOiBkM190aW1lX3BhcnNlSG91cjI0LAogICAgICBqOiBkM190aW1lX3BhcnNlRGF5T2ZZZWFyLAogICAgICBMOiBkM190aW1lX3BhcnNlTWlsbGlzZWNvbmRzLAogICAgICBtOiBkM190aW1lX3BhcnNlTW9udGhOdW1iZXIsCiAgICAgIE06IGQzX3RpbWVfcGFyc2VNaW51dGVzLAogICAgICBwOiBkM190aW1lX3BhcnNlQW1QbSwKICAgICAgUzogZDNfdGltZV9wYXJzZVNlY29uZHMsCiAgICAgIFU6IGQzX3RpbWVfcGFyc2VXZWVrTnVtYmVyU3VuZGF5LAogICAgICB3OiBkM190aW1lX3BhcnNlV2Vla2RheU51bWJlciwKICAgICAgVzogZDNfdGltZV9wYXJzZVdlZWtOdW1iZXJNb25kYXksCiAgICAgIHg6IGQzX3RpbWVfcGFyc2VMb2NhbGVEYXRlLAogICAgICBYOiBkM190aW1lX3BhcnNlTG9jYWxlVGltZSwKICAgICAgeTogZDNfdGltZV9wYXJzZVllYXIsCiAgICAgIFk6IGQzX3RpbWVfcGFyc2VGdWxsWWVhciwKICAgICAgWjogZDNfdGltZV9wYXJzZVpvbmUsCiAgICAgICIlIjogZDNfdGltZV9wYXJzZUxpdGVyYWxQZXJjZW50CiAgICB9OwogICAgZnVuY3Rpb24gZDNfdGltZV9wYXJzZVdlZWtkYXlBYmJyZXYoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICAgIGQzX3RpbWVfZGF5QWJicmV2UmUubGFzdEluZGV4ID0gMDsKICAgICAgdmFyIG4gPSBkM190aW1lX2RheUFiYnJldlJlLmV4ZWMoc3RyaW5nLnNsaWNlKGkpKTsKICAgICAgcmV0dXJuIG4gPyAoZGF0ZS53ID0gZDNfdGltZV9kYXlBYmJyZXZMb29rdXAuZ2V0KG5bMF0udG9Mb3dlckNhc2UoKSksIGkgKyBuWzBdLmxlbmd0aCkgOiAtMTsKICAgIH0KICAgIGZ1bmN0aW9uIGQzX3RpbWVfcGFyc2VXZWVrZGF5KGRhdGUsIHN0cmluZywgaSkgewogICAgICBkM190aW1lX2RheVJlLmxhc3RJbmRleCA9IDA7CiAgICAgIHZhciBuID0gZDNfdGltZV9kYXlSZS5leGVjKHN0cmluZy5zbGljZShpKSk7CiAgICAgIHJldHVybiBuID8gKGRhdGUudyA9IGQzX3RpbWVfZGF5TG9va3VwLmdldChuWzBdLnRvTG93ZXJDYXNlKCkpLCBpICsgblswXS5sZW5ndGgpIDogLTE7CiAgICB9CiAgICBmdW5jdGlvbiBkM190aW1lX3BhcnNlTW9udGhBYmJyZXYoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICAgIGQzX3RpbWVfbW9udGhBYmJyZXZSZS5sYXN0SW5kZXggPSAwOwogICAgICB2YXIgbiA9IGQzX3RpbWVfbW9udGhBYmJyZXZSZS5leGVjKHN0cmluZy5zbGljZShpKSk7CiAgICAgIHJldHVybiBuID8gKGRhdGUubSA9IGQzX3RpbWVfbW9udGhBYmJyZXZMb29rdXAuZ2V0KG5bMF0udG9Mb3dlckNhc2UoKSksIGkgKyBuWzBdLmxlbmd0aCkgOiAtMTsKICAgIH0KICAgIGZ1bmN0aW9uIGQzX3RpbWVfcGFyc2VNb250aChkYXRlLCBzdHJpbmcsIGkpIHsKICAgICAgZDNfdGltZV9tb250aFJlLmxhc3RJbmRleCA9IDA7CiAgICAgIHZhciBuID0gZDNfdGltZV9tb250aFJlLmV4ZWMoc3RyaW5nLnNsaWNlKGkpKTsKICAgICAgcmV0dXJuIG4gPyAoZGF0ZS5tID0gZDNfdGltZV9tb250aExvb2t1cC5nZXQoblswXS50b0xvd2VyQ2FzZSgpKSwgaSArIG5bMF0ubGVuZ3RoKSA6IC0xOwogICAgfQogICAgZnVuY3Rpb24gZDNfdGltZV9wYXJzZUxvY2FsZUZ1bGwoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICAgIHJldHVybiBkM190aW1lX3BhcnNlKGRhdGUsIGQzX3RpbWVfZm9ybWF0cy5jLnRvU3RyaW5nKCksIHN0cmluZywgaSk7CiAgICB9CiAgICBmdW5jdGlvbiBkM190aW1lX3BhcnNlTG9jYWxlRGF0ZShkYXRlLCBzdHJpbmcsIGkpIHsKICAgICAgcmV0dXJuIGQzX3RpbWVfcGFyc2UoZGF0ZSwgZDNfdGltZV9mb3JtYXRzLngudG9TdHJpbmcoKSwgc3RyaW5nLCBpKTsKICAgIH0KICAgIGZ1bmN0aW9uIGQzX3RpbWVfcGFyc2VMb2NhbGVUaW1lKGRhdGUsIHN0cmluZywgaSkgewogICAgICByZXR1cm4gZDNfdGltZV9wYXJzZShkYXRlLCBkM190aW1lX2Zvcm1hdHMuWC50b1N0cmluZygpLCBzdHJpbmcsIGkpOwogICAgfQogICAgZnVuY3Rpb24gZDNfdGltZV9wYXJzZUFtUG0oZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICAgIHZhciBuID0gZDNfdGltZV9wZXJpb2RMb29rdXAuZ2V0KHN0cmluZy5zbGljZShpLCBpICs9IDIpLnRvTG93ZXJDYXNlKCkpOwogICAgICByZXR1cm4gbiA9PSBudWxsID8gLTEgOiAoZGF0ZS5wID0gbiwgaSk7CiAgICB9CiAgICByZXR1cm4gZDNfdGltZV9mb3JtYXQ7CiAgfQogIHZhciBkM190aW1lX2Zvcm1hdFBhZHMgPSB7CiAgICAiLSI6ICIiLAogICAgXzogIiAiLAogICAgIjAiOiAiMCIKICB9LCBkM190aW1lX251bWJlclJlID0gL15ccypcZCsvLCBkM190aW1lX3BlcmNlbnRSZSA9IC9eJS87CiAgZnVuY3Rpb24gZDNfdGltZV9mb3JtYXRQYWQodmFsdWUsIGZpbGwsIHdpZHRoKSB7CiAgICB2YXIgc2lnbiA9IHZhbHVlIDwgMCA/ICItIiA6ICIiLCBzdHJpbmcgPSAoc2lnbiA/IC12YWx1ZSA6IHZhbHVlKSArICIiLCBsZW5ndGggPSBzdHJpbmcubGVuZ3RoOwogICAgcmV0dXJuIHNpZ24gKyAobGVuZ3RoIDwgd2lkdGggPyBuZXcgQXJyYXkod2lkdGggLSBsZW5ndGggKyAxKS5qb2luKGZpbGwpICsgc3RyaW5nIDogc3RyaW5nKTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9mb3JtYXRSZShuYW1lcykgewogICAgcmV0dXJuIG5ldyBSZWdFeHAoIl4oPzoiICsgbmFtZXMubWFwKGQzLnJlcXVvdGUpLmpvaW4oInwiKSArICIpIiwgImkiKTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9mb3JtYXRMb29rdXAobmFtZXMpIHsKICAgIHZhciBtYXAgPSBuZXcgZDNfTWFwKCksIGkgPSAtMSwgbiA9IG5hbWVzLmxlbmd0aDsKICAgIHdoaWxlICgrK2kgPCBuKSBtYXAuc2V0KG5hbWVzW2ldLnRvTG93ZXJDYXNlKCksIGkpOwogICAgcmV0dXJuIG1hcDsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9wYXJzZVdlZWtkYXlOdW1iZXIoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICBkM190aW1lX251bWJlclJlLmxhc3RJbmRleCA9IDA7CiAgICB2YXIgbiA9IGQzX3RpbWVfbnVtYmVyUmUuZXhlYyhzdHJpbmcuc2xpY2UoaSwgaSArIDEpKTsKICAgIHJldHVybiBuID8gKGRhdGUudyA9ICtuWzBdLCBpICsgblswXS5sZW5ndGgpIDogLTE7CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVfcGFyc2VXZWVrTnVtYmVyU3VuZGF5KGRhdGUsIHN0cmluZywgaSkgewogICAgZDNfdGltZV9udW1iZXJSZS5sYXN0SW5kZXggPSAwOwogICAgdmFyIG4gPSBkM190aW1lX251bWJlclJlLmV4ZWMoc3RyaW5nLnNsaWNlKGkpKTsKICAgIHJldHVybiBuID8gKGRhdGUuVSA9ICtuWzBdLCBpICsgblswXS5sZW5ndGgpIDogLTE7CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVfcGFyc2VXZWVrTnVtYmVyTW9uZGF5KGRhdGUsIHN0cmluZywgaSkgewogICAgZDNfdGltZV9udW1iZXJSZS5sYXN0SW5kZXggPSAwOwogICAgdmFyIG4gPSBkM190aW1lX251bWJlclJlLmV4ZWMoc3RyaW5nLnNsaWNlKGkpKTsKICAgIHJldHVybiBuID8gKGRhdGUuVyA9ICtuWzBdLCBpICsgblswXS5sZW5ndGgpIDogLTE7CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVfcGFyc2VGdWxsWWVhcihkYXRlLCBzdHJpbmcsIGkpIHsKICAgIGQzX3RpbWVfbnVtYmVyUmUubGFzdEluZGV4ID0gMDsKICAgIHZhciBuID0gZDNfdGltZV9udW1iZXJSZS5leGVjKHN0cmluZy5zbGljZShpLCBpICsgNCkpOwogICAgcmV0dXJuIG4gPyAoZGF0ZS55ID0gK25bMF0sIGkgKyBuWzBdLmxlbmd0aCkgOiAtMTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9wYXJzZVllYXIoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICBkM190aW1lX251bWJlclJlLmxhc3RJbmRleCA9IDA7CiAgICB2YXIgbiA9IGQzX3RpbWVfbnVtYmVyUmUuZXhlYyhzdHJpbmcuc2xpY2UoaSwgaSArIDIpKTsKICAgIHJldHVybiBuID8gKGRhdGUueSA9IGQzX3RpbWVfZXhwYW5kWWVhcigrblswXSksIGkgKyBuWzBdLmxlbmd0aCkgOiAtMTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9wYXJzZVpvbmUoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICByZXR1cm4gL15bKy1dXGR7NH0kLy50ZXN0KHN0cmluZyA9IHN0cmluZy5zbGljZShpLCBpICsgNSkpID8gKGRhdGUuWiA9IC1zdHJpbmcsIAogICAgaSArIDUpIDogLTE7CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVfZXhwYW5kWWVhcihkKSB7CiAgICByZXR1cm4gZCArIChkID4gNjggPyAxOTAwIDogMmUzKTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9wYXJzZU1vbnRoTnVtYmVyKGRhdGUsIHN0cmluZywgaSkgewogICAgZDNfdGltZV9udW1iZXJSZS5sYXN0SW5kZXggPSAwOwogICAgdmFyIG4gPSBkM190aW1lX251bWJlclJlLmV4ZWMoc3RyaW5nLnNsaWNlKGksIGkgKyAyKSk7CiAgICByZXR1cm4gbiA/IChkYXRlLm0gPSBuWzBdIC0gMSwgaSArIG5bMF0ubGVuZ3RoKSA6IC0xOwogIH0KICBmdW5jdGlvbiBkM190aW1lX3BhcnNlRGF5KGRhdGUsIHN0cmluZywgaSkgewogICAgZDNfdGltZV9udW1iZXJSZS5sYXN0SW5kZXggPSAwOwogICAgdmFyIG4gPSBkM190aW1lX251bWJlclJlLmV4ZWMoc3RyaW5nLnNsaWNlKGksIGkgKyAyKSk7CiAgICByZXR1cm4gbiA/IChkYXRlLmQgPSArblswXSwgaSArIG5bMF0ubGVuZ3RoKSA6IC0xOwogIH0KICBmdW5jdGlvbiBkM190aW1lX3BhcnNlRGF5T2ZZZWFyKGRhdGUsIHN0cmluZywgaSkgewogICAgZDNfdGltZV9udW1iZXJSZS5sYXN0SW5kZXggPSAwOwogICAgdmFyIG4gPSBkM190aW1lX251bWJlclJlLmV4ZWMoc3RyaW5nLnNsaWNlKGksIGkgKyAzKSk7CiAgICByZXR1cm4gbiA/IChkYXRlLmogPSArblswXSwgaSArIG5bMF0ubGVuZ3RoKSA6IC0xOwogIH0KICBmdW5jdGlvbiBkM190aW1lX3BhcnNlSG91cjI0KGRhdGUsIHN0cmluZywgaSkgewogICAgZDNfdGltZV9udW1iZXJSZS5sYXN0SW5kZXggPSAwOwogICAgdmFyIG4gPSBkM190aW1lX251bWJlclJlLmV4ZWMoc3RyaW5nLnNsaWNlKGksIGkgKyAyKSk7CiAgICByZXR1cm4gbiA/IChkYXRlLkggPSArblswXSwgaSArIG5bMF0ubGVuZ3RoKSA6IC0xOwogIH0KICBmdW5jdGlvbiBkM190aW1lX3BhcnNlTWludXRlcyhkYXRlLCBzdHJpbmcsIGkpIHsKICAgIGQzX3RpbWVfbnVtYmVyUmUubGFzdEluZGV4ID0gMDsKICAgIHZhciBuID0gZDNfdGltZV9udW1iZXJSZS5leGVjKHN0cmluZy5zbGljZShpLCBpICsgMikpOwogICAgcmV0dXJuIG4gPyAoZGF0ZS5NID0gK25bMF0sIGkgKyBuWzBdLmxlbmd0aCkgOiAtMTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9wYXJzZVNlY29uZHMoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICBkM190aW1lX251bWJlclJlLmxhc3RJbmRleCA9IDA7CiAgICB2YXIgbiA9IGQzX3RpbWVfbnVtYmVyUmUuZXhlYyhzdHJpbmcuc2xpY2UoaSwgaSArIDIpKTsKICAgIHJldHVybiBuID8gKGRhdGUuUyA9ICtuWzBdLCBpICsgblswXS5sZW5ndGgpIDogLTE7CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVfcGFyc2VNaWxsaXNlY29uZHMoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICBkM190aW1lX251bWJlclJlLmxhc3RJbmRleCA9IDA7CiAgICB2YXIgbiA9IGQzX3RpbWVfbnVtYmVyUmUuZXhlYyhzdHJpbmcuc2xpY2UoaSwgaSArIDMpKTsKICAgIHJldHVybiBuID8gKGRhdGUuTCA9ICtuWzBdLCBpICsgblswXS5sZW5ndGgpIDogLTE7CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVfem9uZShkKSB7CiAgICB2YXIgeiA9IGQuZ2V0VGltZXpvbmVPZmZzZXQoKSwgenMgPSB6ID4gMCA/ICItIiA6ICIrIiwgemggPSBhYnMoeikgLyA2MCB8IDAsIHptID0gYWJzKHopICUgNjA7CiAgICByZXR1cm4genMgKyBkM190aW1lX2Zvcm1hdFBhZCh6aCwgIjAiLCAyKSArIGQzX3RpbWVfZm9ybWF0UGFkKHptLCAiMCIsIDIpOwogIH0KICBmdW5jdGlvbiBkM190aW1lX3BhcnNlTGl0ZXJhbFBlcmNlbnQoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICBkM190aW1lX3BlcmNlbnRSZS5sYXN0SW5kZXggPSAwOwogICAgdmFyIG4gPSBkM190aW1lX3BlcmNlbnRSZS5leGVjKHN0cmluZy5zbGljZShpLCBpICsgMSkpOwogICAgcmV0dXJuIG4gPyBpICsgblswXS5sZW5ndGggOiAtMTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9mb3JtYXRNdWx0aShmb3JtYXRzKSB7CiAgICB2YXIgbiA9IGZvcm1hdHMubGVuZ3RoLCBpID0gLTE7CiAgICB3aGlsZSAoKytpIDwgbikgZm9ybWF0c1tpXVswXSA9IHRoaXMoZm9ybWF0c1tpXVswXSk7CiAgICByZXR1cm4gZnVuY3Rpb24oZGF0ZSkgewogICAgICB2YXIgaSA9IDAsIGYgPSBmb3JtYXRzW2ldOwogICAgICB3aGlsZSAoIWZbMV0oZGF0ZSkpIGYgPSBmb3JtYXRzWysraV07CiAgICAgIHJldHVybiBmWzBdKGRhdGUpOwogICAgfTsKICB9CiAgZDMubG9jYWxlID0gZnVuY3Rpb24obG9jYWxlKSB7CiAgICByZXR1cm4gewogICAgICBudW1iZXJGb3JtYXQ6IGQzX2xvY2FsZV9udW1iZXJGb3JtYXQobG9jYWxlKSwKICAgICAgdGltZUZvcm1hdDogZDNfbG9jYWxlX3RpbWVGb3JtYXQobG9jYWxlKQogICAgfTsKICB9OwogIHZhciBkM19sb2NhbGVfZW5VUyA9IGQzLmxvY2FsZSh7CiAgICBkZWNpbWFsOiAiLiIsCiAgICB0aG91c2FuZHM6ICIsIiwKICAgIGdyb3VwaW5nOiBbIDMgXSwKICAgIGN1cnJlbmN5OiBbICIkIiwgIiIgXSwKICAgIGRhdGVUaW1lOiAiJWEgJWIgJWUgJVggJVkiLAogICAgZGF0ZTogIiVtLyVkLyVZIiwKICAgIHRpbWU6ICIlSDolTTolUyIsCiAgICBwZXJpb2RzOiBbICJBTSIsICJQTSIgXSwKICAgIGRheXM6IFsgIlN1bmRheSIsICJNb25kYXkiLCAiVHVlc2RheSIsICJXZWRuZXNkYXkiLCAiVGh1cnNkYXkiLCAiRnJpZGF5IiwgIlNhdHVyZGF5IiBdLAogICAgc2hvcnREYXlzOiBbICJTdW4iLCAiTW9uIiwgIlR1ZSIsICJXZWQiLCAiVGh1IiwgIkZyaSIsICJTYXQiIF0sCiAgICBtb250aHM6IFsgIkphbnVhcnkiLCAiRmVicnVhcnkiLCAiTWFyY2giLCAiQXByaWwiLCAiTWF5IiwgIkp1bmUiLCAiSnVseSIsICJBdWd1c3QiLCAiU2VwdGVtYmVyIiwgIk9jdG9iZXIiLCAiTm92ZW1iZXIiLCAiRGVjZW1iZXIiIF0sCiAgICBzaG9ydE1vbnRoczogWyAiSmFuIiwgIkZlYiIsICJNYXIiLCAiQXByIiwgIk1heSIsICJKdW4iLCAiSnVsIiwgIkF1ZyIsICJTZXAiLCAiT2N0IiwgIk5vdiIsICJEZWMiIF0KICB9KTsKICBkMy5mb3JtYXQgPSBkM19sb2NhbGVfZW5VUy5udW1iZXJGb3JtYXQ7CiAgZDMuZ2VvID0ge307CiAgZnVuY3Rpb24gZDNfYWRkZXIoKSB7fQogIGQzX2FkZGVyLnByb3RvdHlwZSA9IHsKICAgIHM6IDAsCiAgICB0OiAwLAogICAgYWRkOiBmdW5jdGlvbih5KSB7CiAgICAgIGQzX2FkZGVyU3VtKHksIHRoaXMudCwgZDNfYWRkZXJUZW1wKTsKICAgICAgZDNfYWRkZXJTdW0oZDNfYWRkZXJUZW1wLnMsIHRoaXMucywgdGhpcyk7CiAgICAgIGlmICh0aGlzLnMpIHRoaXMudCArPSBkM19hZGRlclRlbXAudDsgZWxzZSB0aGlzLnMgPSBkM19hZGRlclRlbXAudDsKICAgIH0sCiAgICByZXNldDogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMucyA9IHRoaXMudCA9IDA7CiAgICB9LAogICAgdmFsdWVPZjogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnM7CiAgICB9CiAgfTsKICB2YXIgZDNfYWRkZXJUZW1wID0gbmV3IGQzX2FkZGVyKCk7CiAgZnVuY3Rpb24gZDNfYWRkZXJTdW0oYSwgYiwgbykgewogICAgdmFyIHggPSBvLnMgPSBhICsgYiwgYnYgPSB4IC0gYSwgYXYgPSB4IC0gYnY7CiAgICBvLnQgPSBhIC0gYXYgKyAoYiAtIGJ2KTsKICB9CiAgZDMuZ2VvLnN0cmVhbSA9IGZ1bmN0aW9uKG9iamVjdCwgbGlzdGVuZXIpIHsKICAgIGlmIChvYmplY3QgJiYgZDNfZ2VvX3N0cmVhbU9iamVjdFR5cGUuaGFzT3duUHJvcGVydHkob2JqZWN0LnR5cGUpKSB7CiAgICAgIGQzX2dlb19zdHJlYW1PYmplY3RUeXBlW29iamVjdC50eXBlXShvYmplY3QsIGxpc3RlbmVyKTsKICAgIH0gZWxzZSB7CiAgICAgIGQzX2dlb19zdHJlYW1HZW9tZXRyeShvYmplY3QsIGxpc3RlbmVyKTsKICAgIH0KICB9OwogIGZ1bmN0aW9uIGQzX2dlb19zdHJlYW1HZW9tZXRyeShnZW9tZXRyeSwgbGlzdGVuZXIpIHsKICAgIGlmIChnZW9tZXRyeSAmJiBkM19nZW9fc3RyZWFtR2VvbWV0cnlUeXBlLmhhc093blByb3BlcnR5KGdlb21ldHJ5LnR5cGUpKSB7CiAgICAgIGQzX2dlb19zdHJlYW1HZW9tZXRyeVR5cGVbZ2VvbWV0cnkudHlwZV0oZ2VvbWV0cnksIGxpc3RlbmVyKTsKICAgIH0KICB9CiAgdmFyIGQzX2dlb19zdHJlYW1PYmplY3RUeXBlID0gewogICAgRmVhdHVyZTogZnVuY3Rpb24oZmVhdHVyZSwgbGlzdGVuZXIpIHsKICAgICAgZDNfZ2VvX3N0cmVhbUdlb21ldHJ5KGZlYXR1cmUuZ2VvbWV0cnksIGxpc3RlbmVyKTsKICAgIH0sCiAgICBGZWF0dXJlQ29sbGVjdGlvbjogZnVuY3Rpb24ob2JqZWN0LCBsaXN0ZW5lcikgewogICAgICB2YXIgZmVhdHVyZXMgPSBvYmplY3QuZmVhdHVyZXMsIGkgPSAtMSwgbiA9IGZlYXR1cmVzLmxlbmd0aDsKICAgICAgd2hpbGUgKCsraSA8IG4pIGQzX2dlb19zdHJlYW1HZW9tZXRyeShmZWF0dXJlc1tpXS5nZW9tZXRyeSwgbGlzdGVuZXIpOwogICAgfQogIH07CiAgdmFyIGQzX2dlb19zdHJlYW1HZW9tZXRyeVR5cGUgPSB7CiAgICBTcGhlcmU6IGZ1bmN0aW9uKG9iamVjdCwgbGlzdGVuZXIpIHsKICAgICAgbGlzdGVuZXIuc3BoZXJlKCk7CiAgICB9LAogICAgUG9pbnQ6IGZ1bmN0aW9uKG9iamVjdCwgbGlzdGVuZXIpIHsKICAgICAgb2JqZWN0ID0gb2JqZWN0LmNvb3JkaW5hdGVzOwogICAgICBsaXN0ZW5lci5wb2ludChvYmplY3RbMF0sIG9iamVjdFsxXSwgb2JqZWN0WzJdKTsKICAgIH0sCiAgICBNdWx0aVBvaW50OiBmdW5jdGlvbihvYmplY3QsIGxpc3RlbmVyKSB7CiAgICAgIHZhciBjb29yZGluYXRlcyA9IG9iamVjdC5jb29yZGluYXRlcywgaSA9IC0xLCBuID0gY29vcmRpbmF0ZXMubGVuZ3RoOwogICAgICB3aGlsZSAoKytpIDwgbikgb2JqZWN0ID0gY29vcmRpbmF0ZXNbaV0sIGxpc3RlbmVyLnBvaW50KG9iamVjdFswXSwgb2JqZWN0WzFdLCBvYmplY3RbMl0pOwogICAgfSwKICAgIExpbmVTdHJpbmc6IGZ1bmN0aW9uKG9iamVjdCwgbGlzdGVuZXIpIHsKICAgICAgZDNfZ2VvX3N0cmVhbUxpbmUob2JqZWN0LmNvb3JkaW5hdGVzLCBsaXN0ZW5lciwgMCk7CiAgICB9LAogICAgTXVsdGlMaW5lU3RyaW5nOiBmdW5jdGlvbihvYmplY3QsIGxpc3RlbmVyKSB7CiAgICAgIHZhciBjb29yZGluYXRlcyA9IG9iamVjdC5jb29yZGluYXRlcywgaSA9IC0xLCBuID0gY29vcmRpbmF0ZXMubGVuZ3RoOwogICAgICB3aGlsZSAoKytpIDwgbikgZDNfZ2VvX3N0cmVhbUxpbmUoY29vcmRpbmF0ZXNbaV0sIGxpc3RlbmVyLCAwKTsKICAgIH0sCiAgICBQb2x5Z29uOiBmdW5jdGlvbihvYmplY3QsIGxpc3RlbmVyKSB7CiAgICAgIGQzX2dlb19zdHJlYW1Qb2x5Z29uKG9iamVjdC5jb29yZGluYXRlcywgbGlzdGVuZXIpOwogICAgfSwKICAgIE11bHRpUG9seWdvbjogZnVuY3Rpb24ob2JqZWN0LCBsaXN0ZW5lcikgewogICAgICB2YXIgY29vcmRpbmF0ZXMgPSBvYmplY3QuY29vcmRpbmF0ZXMsIGkgPSAtMSwgbiA9IGNvb3JkaW5hdGVzLmxlbmd0aDsKICAgICAgd2hpbGUgKCsraSA8IG4pIGQzX2dlb19zdHJlYW1Qb2x5Z29uKGNvb3JkaW5hdGVzW2ldLCBsaXN0ZW5lcik7CiAgICB9LAogICAgR2VvbWV0cnlDb2xsZWN0aW9uOiBmdW5jdGlvbihvYmplY3QsIGxpc3RlbmVyKSB7CiAgICAgIHZhciBnZW9tZXRyaWVzID0gb2JqZWN0Lmdlb21ldHJpZXMsIGkgPSAtMSwgbiA9IGdlb21ldHJpZXMubGVuZ3RoOwogICAgICB3aGlsZSAoKytpIDwgbikgZDNfZ2VvX3N0cmVhbUdlb21ldHJ5KGdlb21ldHJpZXNbaV0sIGxpc3RlbmVyKTsKICAgIH0KICB9OwogIGZ1bmN0aW9uIGQzX2dlb19zdHJlYW1MaW5lKGNvb3JkaW5hdGVzLCBsaXN0ZW5lciwgY2xvc2VkKSB7CiAgICB2YXIgaSA9IC0xLCBuID0gY29vcmRpbmF0ZXMubGVuZ3RoIC0gY2xvc2VkLCBjb29yZGluYXRlOwogICAgbGlzdGVuZXIubGluZVN0YXJ0KCk7CiAgICB3aGlsZSAoKytpIDwgbikgY29vcmRpbmF0ZSA9IGNvb3JkaW5hdGVzW2ldLCBsaXN0ZW5lci5wb2ludChjb29yZGluYXRlWzBdLCBjb29yZGluYXRlWzFdLCBjb29yZGluYXRlWzJdKTsKICAgIGxpc3RlbmVyLmxpbmVFbmQoKTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX3N0cmVhbVBvbHlnb24oY29vcmRpbmF0ZXMsIGxpc3RlbmVyKSB7CiAgICB2YXIgaSA9IC0xLCBuID0gY29vcmRpbmF0ZXMubGVuZ3RoOwogICAgbGlzdGVuZXIucG9seWdvblN0YXJ0KCk7CiAgICB3aGlsZSAoKytpIDwgbikgZDNfZ2VvX3N0cmVhbUxpbmUoY29vcmRpbmF0ZXNbaV0sIGxpc3RlbmVyLCAxKTsKICAgIGxpc3RlbmVyLnBvbHlnb25FbmQoKTsKICB9CiAgZDMuZ2VvLmFyZWEgPSBmdW5jdGlvbihvYmplY3QpIHsKICAgIGQzX2dlb19hcmVhU3VtID0gMDsKICAgIGQzLmdlby5zdHJlYW0ob2JqZWN0LCBkM19nZW9fYXJlYSk7CiAgICByZXR1cm4gZDNfZ2VvX2FyZWFTdW07CiAgfTsKICB2YXIgZDNfZ2VvX2FyZWFTdW0sIGQzX2dlb19hcmVhUmluZ1N1bSA9IG5ldyBkM19hZGRlcigpOwogIHZhciBkM19nZW9fYXJlYSA9IHsKICAgIHNwaGVyZTogZnVuY3Rpb24oKSB7CiAgICAgIGQzX2dlb19hcmVhU3VtICs9IDQgKiDPgDsKICAgIH0sCiAgICBwb2ludDogZDNfbm9vcCwKICAgIGxpbmVTdGFydDogZDNfbm9vcCwKICAgIGxpbmVFbmQ6IGQzX25vb3AsCiAgICBwb2x5Z29uU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICBkM19nZW9fYXJlYVJpbmdTdW0ucmVzZXQoKTsKICAgICAgZDNfZ2VvX2FyZWEubGluZVN0YXJ0ID0gZDNfZ2VvX2FyZWFSaW5nU3RhcnQ7CiAgICB9LAogICAgcG9seWdvbkVuZDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhcmVhID0gMiAqIGQzX2dlb19hcmVhUmluZ1N1bTsKICAgICAgZDNfZ2VvX2FyZWFTdW0gKz0gYXJlYSA8IDAgPyA0ICogz4AgKyBhcmVhIDogYXJlYTsKICAgICAgZDNfZ2VvX2FyZWEubGluZVN0YXJ0ID0gZDNfZ2VvX2FyZWEubGluZUVuZCA9IGQzX2dlb19hcmVhLnBvaW50ID0gZDNfbm9vcDsKICAgIH0KICB9OwogIGZ1bmN0aW9uIGQzX2dlb19hcmVhUmluZ1N0YXJ0KCkgewogICAgdmFyIM67MDAsIM+GMDAsIM67MCwgY29zz4YwLCBzaW7PhjA7CiAgICBkM19nZW9fYXJlYS5wb2ludCA9IGZ1bmN0aW9uKM67LCDPhikgewogICAgICBkM19nZW9fYXJlYS5wb2ludCA9IG5leHRQb2ludDsKICAgICAgzrswID0gKM67MDAgPSDOuykgKiBkM19yYWRpYW5zLCBjb3PPhjAgPSBNYXRoLmNvcyjPhiA9ICjPhjAwID0gz4YpICogZDNfcmFkaWFucyAvIDIgKyDPgCAvIDQpLCAKICAgICAgc2luz4YwID0gTWF0aC5zaW4oz4YpOwogICAgfTsKICAgIGZ1bmN0aW9uIG5leHRQb2ludCjOuywgz4YpIHsKICAgICAgzrsgKj0gZDNfcmFkaWFuczsKICAgICAgz4YgPSDPhiAqIGQzX3JhZGlhbnMgLyAyICsgz4AgLyA0OwogICAgICB2YXIgZM67ID0gzrsgLSDOuzAsIHNkzrsgPSBkzrsgPj0gMCA/IDEgOiAtMSwgYWTOuyA9IHNkzrsgKiBkzrssIGNvc8+GID0gTWF0aC5jb3Moz4YpLCBzaW7PhiA9IE1hdGguc2luKM+GKSwgayA9IHNpbs+GMCAqIHNpbs+GLCB1ID0gY29zz4YwICogY29zz4YgKyBrICogTWF0aC5jb3MoYWTOuyksIHYgPSBrICogc2TOuyAqIE1hdGguc2luKGFkzrspOwogICAgICBkM19nZW9fYXJlYVJpbmdTdW0uYWRkKE1hdGguYXRhbjIodiwgdSkpOwogICAgICDOuzAgPSDOuywgY29zz4YwID0gY29zz4YsIHNpbs+GMCA9IHNpbs+GOwogICAgfQogICAgZDNfZ2VvX2FyZWEubGluZUVuZCA9IGZ1bmN0aW9uKCkgewogICAgICBuZXh0UG9pbnQozrswMCwgz4YwMCk7CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM19nZW9fY2FydGVzaWFuKHNwaGVyaWNhbCkgewogICAgdmFyIM67ID0gc3BoZXJpY2FsWzBdLCDPhiA9IHNwaGVyaWNhbFsxXSwgY29zz4YgPSBNYXRoLmNvcyjPhik7CiAgICByZXR1cm4gWyBjb3PPhiAqIE1hdGguY29zKM67KSwgY29zz4YgKiBNYXRoLnNpbijOuyksIE1hdGguc2luKM+GKSBdOwogIH0KICBmdW5jdGlvbiBkM19nZW9fY2FydGVzaWFuRG90KGEsIGIpIHsKICAgIHJldHVybiBhWzBdICogYlswXSArIGFbMV0gKiBiWzFdICsgYVsyXSAqIGJbMl07CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19jYXJ0ZXNpYW5Dcm9zcyhhLCBiKSB7CiAgICByZXR1cm4gWyBhWzFdICogYlsyXSAtIGFbMl0gKiBiWzFdLCBhWzJdICogYlswXSAtIGFbMF0gKiBiWzJdLCBhWzBdICogYlsxXSAtIGFbMV0gKiBiWzBdIF07CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19jYXJ0ZXNpYW5BZGQoYSwgYikgewogICAgYVswXSArPSBiWzBdOwogICAgYVsxXSArPSBiWzFdOwogICAgYVsyXSArPSBiWzJdOwogIH0KICBmdW5jdGlvbiBkM19nZW9fY2FydGVzaWFuU2NhbGUodmVjdG9yLCBrKSB7CiAgICByZXR1cm4gWyB2ZWN0b3JbMF0gKiBrLCB2ZWN0b3JbMV0gKiBrLCB2ZWN0b3JbMl0gKiBrIF07CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19jYXJ0ZXNpYW5Ob3JtYWxpemUoZCkgewogICAgdmFyIGwgPSBNYXRoLnNxcnQoZFswXSAqIGRbMF0gKyBkWzFdICogZFsxXSArIGRbMl0gKiBkWzJdKTsKICAgIGRbMF0gLz0gbDsKICAgIGRbMV0gLz0gbDsKICAgIGRbMl0gLz0gbDsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX3NwaGVyaWNhbChjYXJ0ZXNpYW4pIHsKICAgIHJldHVybiBbIE1hdGguYXRhbjIoY2FydGVzaWFuWzFdLCBjYXJ0ZXNpYW5bMF0pLCBkM19hc2luKGNhcnRlc2lhblsyXSkgXTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX3NwaGVyaWNhbEVxdWFsKGEsIGIpIHsKICAgIHJldHVybiBhYnMoYVswXSAtIGJbMF0pIDwgzrUgJiYgYWJzKGFbMV0gLSBiWzFdKSA8IM61OwogIH0KICBkMy5nZW8uYm91bmRzID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgzrswLCDPhjAsIM67MSwgz4YxLCDOu18sIM67X18sIM+GX18sIHAwLCBkzrtTdW0sIHJhbmdlcywgcmFuZ2U7CiAgICB2YXIgYm91bmQgPSB7CiAgICAgIHBvaW50OiBwb2ludCwKICAgICAgbGluZVN0YXJ0OiBsaW5lU3RhcnQsCiAgICAgIGxpbmVFbmQ6IGxpbmVFbmQsCiAgICAgIHBvbHlnb25TdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgYm91bmQucG9pbnQgPSByaW5nUG9pbnQ7CiAgICAgICAgYm91bmQubGluZVN0YXJ0ID0gcmluZ1N0YXJ0OwogICAgICAgIGJvdW5kLmxpbmVFbmQgPSByaW5nRW5kOwogICAgICAgIGTOu1N1bSA9IDA7CiAgICAgICAgZDNfZ2VvX2FyZWEucG9seWdvblN0YXJ0KCk7CiAgICAgIH0sCiAgICAgIHBvbHlnb25FbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGQzX2dlb19hcmVhLnBvbHlnb25FbmQoKTsKICAgICAgICBib3VuZC5wb2ludCA9IHBvaW50OwogICAgICAgIGJvdW5kLmxpbmVTdGFydCA9IGxpbmVTdGFydDsKICAgICAgICBib3VuZC5saW5lRW5kID0gbGluZUVuZDsKICAgICAgICBpZiAoZDNfZ2VvX2FyZWFSaW5nU3VtIDwgMCkgzrswID0gLSjOuzEgPSAxODApLCDPhjAgPSAtKM+GMSA9IDkwKTsgZWxzZSBpZiAoZM67U3VtID4gzrUpIM+GMSA9IDkwOyBlbHNlIGlmIChkzrtTdW0gPCAtzrUpIM+GMCA9IC05MDsKICAgICAgICByYW5nZVswXSA9IM67MCwgcmFuZ2VbMV0gPSDOuzE7CiAgICAgIH0KICAgIH07CiAgICBmdW5jdGlvbiBwb2ludCjOuywgz4YpIHsKICAgICAgcmFuZ2VzLnB1c2gocmFuZ2UgPSBbIM67MCA9IM67LCDOuzEgPSDOuyBdKTsKICAgICAgaWYgKM+GIDwgz4YwKSDPhjAgPSDPhjsKICAgICAgaWYgKM+GID4gz4YxKSDPhjEgPSDPhjsKICAgIH0KICAgIGZ1bmN0aW9uIGxpbmVQb2ludCjOuywgz4YpIHsKICAgICAgdmFyIHAgPSBkM19nZW9fY2FydGVzaWFuKFsgzrsgKiBkM19yYWRpYW5zLCDPhiAqIGQzX3JhZGlhbnMgXSk7CiAgICAgIGlmIChwMCkgewogICAgICAgIHZhciBub3JtYWwgPSBkM19nZW9fY2FydGVzaWFuQ3Jvc3MocDAsIHApLCBlcXVhdG9yaWFsID0gWyBub3JtYWxbMV0sIC1ub3JtYWxbMF0sIDAgXSwgaW5mbGVjdGlvbiA9IGQzX2dlb19jYXJ0ZXNpYW5Dcm9zcyhlcXVhdG9yaWFsLCBub3JtYWwpOwogICAgICAgIGQzX2dlb19jYXJ0ZXNpYW5Ob3JtYWxpemUoaW5mbGVjdGlvbik7CiAgICAgICAgaW5mbGVjdGlvbiA9IGQzX2dlb19zcGhlcmljYWwoaW5mbGVjdGlvbik7CiAgICAgICAgdmFyIGTOuyA9IM67IC0gzrtfLCBzID0gZM67ID4gMCA/IDEgOiAtMSwgzrtpID0gaW5mbGVjdGlvblswXSAqIGQzX2RlZ3JlZXMgKiBzLCBhbnRpbWVyaWRpYW4gPSBhYnMoZM67KSA+IDE4MDsKICAgICAgICBpZiAoYW50aW1lcmlkaWFuIF4gKHMgKiDOu18gPCDOu2kgJiYgzrtpIDwgcyAqIM67KSkgewogICAgICAgICAgdmFyIM+GaSA9IGluZmxlY3Rpb25bMV0gKiBkM19kZWdyZWVzOwogICAgICAgICAgaWYgKM+GaSA+IM+GMSkgz4YxID0gz4ZpOwogICAgICAgIH0gZWxzZSBpZiAozrtpID0gKM67aSArIDM2MCkgJSAzNjAgLSAxODAsIGFudGltZXJpZGlhbiBeIChzICogzrtfIDwgzrtpICYmIM67aSA8IHMgKiDOuykpIHsKICAgICAgICAgIHZhciDPhmkgPSAtaW5mbGVjdGlvblsxXSAqIGQzX2RlZ3JlZXM7CiAgICAgICAgICBpZiAoz4ZpIDwgz4YwKSDPhjAgPSDPhmk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICjPhiA8IM+GMCkgz4YwID0gz4Y7CiAgICAgICAgICBpZiAoz4YgPiDPhjEpIM+GMSA9IM+GOwogICAgICAgIH0KICAgICAgICBpZiAoYW50aW1lcmlkaWFuKSB7CiAgICAgICAgICBpZiAozrsgPCDOu18pIHsKICAgICAgICAgICAgaWYgKGFuZ2xlKM67MCwgzrspID4gYW5nbGUozrswLCDOuzEpKSDOuzEgPSDOuzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChhbmdsZSjOuywgzrsxKSA+IGFuZ2xlKM67MCwgzrsxKSkgzrswID0gzrs7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICjOuzEgPj0gzrswKSB7CiAgICAgICAgICAgIGlmICjOuyA8IM67MCkgzrswID0gzrs7CiAgICAgICAgICAgIGlmICjOuyA+IM67MSkgzrsxID0gzrs7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAozrsgPiDOu18pIHsKICAgICAgICAgICAgICBpZiAoYW5nbGUozrswLCDOuykgPiBhbmdsZSjOuzAsIM67MSkpIM67MSA9IM67OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmIChhbmdsZSjOuywgzrsxKSA+IGFuZ2xlKM67MCwgzrsxKSkgzrswID0gzrs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcG9pbnQozrssIM+GKTsKICAgICAgfQogICAgICBwMCA9IHAsIM67XyA9IM67OwogICAgfQogICAgZnVuY3Rpb24gbGluZVN0YXJ0KCkgewogICAgICBib3VuZC5wb2ludCA9IGxpbmVQb2ludDsKICAgIH0KICAgIGZ1bmN0aW9uIGxpbmVFbmQoKSB7CiAgICAgIHJhbmdlWzBdID0gzrswLCByYW5nZVsxXSA9IM67MTsKICAgICAgYm91bmQucG9pbnQgPSBwb2ludDsKICAgICAgcDAgPSBudWxsOwogICAgfQogICAgZnVuY3Rpb24gcmluZ1BvaW50KM67LCDPhikgewogICAgICBpZiAocDApIHsKICAgICAgICB2YXIgZM67ID0gzrsgLSDOu187CiAgICAgICAgZM67U3VtICs9IGFicyhkzrspID4gMTgwID8gZM67ICsgKGTOuyA+IDAgPyAzNjAgOiAtMzYwKSA6IGTOuzsKICAgICAgfSBlbHNlIM67X18gPSDOuywgz4ZfXyA9IM+GOwogICAgICBkM19nZW9fYXJlYS5wb2ludCjOuywgz4YpOwogICAgICBsaW5lUG9pbnQozrssIM+GKTsKICAgIH0KICAgIGZ1bmN0aW9uIHJpbmdTdGFydCgpIHsKICAgICAgZDNfZ2VvX2FyZWEubGluZVN0YXJ0KCk7CiAgICB9CiAgICBmdW5jdGlvbiByaW5nRW5kKCkgewogICAgICByaW5nUG9pbnQozrtfXywgz4ZfXyk7CiAgICAgIGQzX2dlb19hcmVhLmxpbmVFbmQoKTsKICAgICAgaWYgKGFicyhkzrtTdW0pID4gzrUpIM67MCA9IC0ozrsxID0gMTgwKTsKICAgICAgcmFuZ2VbMF0gPSDOuzAsIHJhbmdlWzFdID0gzrsxOwogICAgICBwMCA9IG51bGw7CiAgICB9CiAgICBmdW5jdGlvbiBhbmdsZSjOuzAsIM67MSkgewogICAgICByZXR1cm4gKM67MSAtPSDOuzApIDwgMCA/IM67MSArIDM2MCA6IM67MTsKICAgIH0KICAgIGZ1bmN0aW9uIGNvbXBhcmVSYW5nZXMoYSwgYikgewogICAgICByZXR1cm4gYVswXSAtIGJbMF07CiAgICB9CiAgICBmdW5jdGlvbiB3aXRoaW5SYW5nZSh4LCByYW5nZSkgewogICAgICByZXR1cm4gcmFuZ2VbMF0gPD0gcmFuZ2VbMV0gPyByYW5nZVswXSA8PSB4ICYmIHggPD0gcmFuZ2VbMV0gOiB4IDwgcmFuZ2VbMF0gfHwgcmFuZ2VbMV0gPCB4OwogICAgfQogICAgcmV0dXJuIGZ1bmN0aW9uKGZlYXR1cmUpIHsKICAgICAgz4YxID0gzrsxID0gLSjOuzAgPSDPhjAgPSBJbmZpbml0eSk7CiAgICAgIHJhbmdlcyA9IFtdOwogICAgICBkMy5nZW8uc3RyZWFtKGZlYXR1cmUsIGJvdW5kKTsKICAgICAgdmFyIG4gPSByYW5nZXMubGVuZ3RoOwogICAgICBpZiAobikgewogICAgICAgIHJhbmdlcy5zb3J0KGNvbXBhcmVSYW5nZXMpOwogICAgICAgIGZvciAodmFyIGkgPSAxLCBhID0gcmFuZ2VzWzBdLCBiLCBtZXJnZWQgPSBbIGEgXTsgaSA8IG47ICsraSkgewogICAgICAgICAgYiA9IHJhbmdlc1tpXTsKICAgICAgICAgIGlmICh3aXRoaW5SYW5nZShiWzBdLCBhKSB8fCB3aXRoaW5SYW5nZShiWzFdLCBhKSkgewogICAgICAgICAgICBpZiAoYW5nbGUoYVswXSwgYlsxXSkgPiBhbmdsZShhWzBdLCBhWzFdKSkgYVsxXSA9IGJbMV07CiAgICAgICAgICAgIGlmIChhbmdsZShiWzBdLCBhWzFdKSA+IGFuZ2xlKGFbMF0sIGFbMV0pKSBhWzBdID0gYlswXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1lcmdlZC5wdXNoKGEgPSBiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIGJlc3QgPSAtSW5maW5pdHksIGTOuzsKICAgICAgICBmb3IgKHZhciBuID0gbWVyZ2VkLmxlbmd0aCAtIDEsIGkgPSAwLCBhID0gbWVyZ2VkW25dLCBiOyBpIDw9IG47IGEgPSBiLCArK2kpIHsKICAgICAgICAgIGIgPSBtZXJnZWRbaV07CiAgICAgICAgICBpZiAoKGTOuyA9IGFuZ2xlKGFbMV0sIGJbMF0pKSA+IGJlc3QpIGJlc3QgPSBkzrssIM67MCA9IGJbMF0sIM67MSA9IGFbMV07CiAgICAgICAgfQogICAgICB9CiAgICAgIHJhbmdlcyA9IHJhbmdlID0gbnVsbDsKICAgICAgcmV0dXJuIM67MCA9PT0gSW5maW5pdHkgfHwgz4YwID09PSBJbmZpbml0eSA/IFsgWyBOYU4sIE5hTiBdLCBbIE5hTiwgTmFOIF0gXSA6IFsgWyDOuzAsIM+GMCBdLCBbIM67MSwgz4YxIF0gXTsKICAgIH07CiAgfSgpOwogIGQzLmdlby5jZW50cm9pZCA9IGZ1bmN0aW9uKG9iamVjdCkgewogICAgZDNfZ2VvX2NlbnRyb2lkVzAgPSBkM19nZW9fY2VudHJvaWRXMSA9IGQzX2dlb19jZW50cm9pZFgwID0gZDNfZ2VvX2NlbnRyb2lkWTAgPSBkM19nZW9fY2VudHJvaWRaMCA9IGQzX2dlb19jZW50cm9pZFgxID0gZDNfZ2VvX2NlbnRyb2lkWTEgPSBkM19nZW9fY2VudHJvaWRaMSA9IGQzX2dlb19jZW50cm9pZFgyID0gZDNfZ2VvX2NlbnRyb2lkWTIgPSBkM19nZW9fY2VudHJvaWRaMiA9IDA7CiAgICBkMy5nZW8uc3RyZWFtKG9iamVjdCwgZDNfZ2VvX2NlbnRyb2lkKTsKICAgIHZhciB4ID0gZDNfZ2VvX2NlbnRyb2lkWDIsIHkgPSBkM19nZW9fY2VudHJvaWRZMiwgeiA9IGQzX2dlb19jZW50cm9pZFoyLCBtID0geCAqIHggKyB5ICogeSArIHogKiB6OwogICAgaWYgKG0gPCDOtTIpIHsKICAgICAgeCA9IGQzX2dlb19jZW50cm9pZFgxLCB5ID0gZDNfZ2VvX2NlbnRyb2lkWTEsIHogPSBkM19nZW9fY2VudHJvaWRaMTsKICAgICAgaWYgKGQzX2dlb19jZW50cm9pZFcxIDwgzrUpIHggPSBkM19nZW9fY2VudHJvaWRYMCwgeSA9IGQzX2dlb19jZW50cm9pZFkwLCB6ID0gZDNfZ2VvX2NlbnRyb2lkWjA7CiAgICAgIG0gPSB4ICogeCArIHkgKiB5ICsgeiAqIHo7CiAgICAgIGlmIChtIDwgzrUyKSByZXR1cm4gWyBOYU4sIE5hTiBdOwogICAgfQogICAgcmV0dXJuIFsgTWF0aC5hdGFuMih5LCB4KSAqIGQzX2RlZ3JlZXMsIGQzX2FzaW4oeiAvIE1hdGguc3FydChtKSkgKiBkM19kZWdyZWVzIF07CiAgfTsKICB2YXIgZDNfZ2VvX2NlbnRyb2lkVzAsIGQzX2dlb19jZW50cm9pZFcxLCBkM19nZW9fY2VudHJvaWRYMCwgZDNfZ2VvX2NlbnRyb2lkWTAsIGQzX2dlb19jZW50cm9pZFowLCBkM19nZW9fY2VudHJvaWRYMSwgZDNfZ2VvX2NlbnRyb2lkWTEsIGQzX2dlb19jZW50cm9pZFoxLCBkM19nZW9fY2VudHJvaWRYMiwgZDNfZ2VvX2NlbnRyb2lkWTIsIGQzX2dlb19jZW50cm9pZFoyOwogIHZhciBkM19nZW9fY2VudHJvaWQgPSB7CiAgICBzcGhlcmU6IGQzX25vb3AsCiAgICBwb2ludDogZDNfZ2VvX2NlbnRyb2lkUG9pbnQsCiAgICBsaW5lU3RhcnQ6IGQzX2dlb19jZW50cm9pZExpbmVTdGFydCwKICAgIGxpbmVFbmQ6IGQzX2dlb19jZW50cm9pZExpbmVFbmQsCiAgICBwb2x5Z29uU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICBkM19nZW9fY2VudHJvaWQubGluZVN0YXJ0ID0gZDNfZ2VvX2NlbnRyb2lkUmluZ1N0YXJ0OwogICAgfSwKICAgIHBvbHlnb25FbmQ6IGZ1bmN0aW9uKCkgewogICAgICBkM19nZW9fY2VudHJvaWQubGluZVN0YXJ0ID0gZDNfZ2VvX2NlbnRyb2lkTGluZVN0YXJ0OwogICAgfQogIH07CiAgZnVuY3Rpb24gZDNfZ2VvX2NlbnRyb2lkUG9pbnQozrssIM+GKSB7CiAgICDOuyAqPSBkM19yYWRpYW5zOwogICAgdmFyIGNvc8+GID0gTWF0aC5jb3Moz4YgKj0gZDNfcmFkaWFucyk7CiAgICBkM19nZW9fY2VudHJvaWRQb2ludFhZWihjb3PPhiAqIE1hdGguY29zKM67KSwgY29zz4YgKiBNYXRoLnNpbijOuyksIE1hdGguc2luKM+GKSk7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19jZW50cm9pZFBvaW50WFlaKHgsIHksIHopIHsKICAgICsrZDNfZ2VvX2NlbnRyb2lkVzA7CiAgICBkM19nZW9fY2VudHJvaWRYMCArPSAoeCAtIGQzX2dlb19jZW50cm9pZFgwKSAvIGQzX2dlb19jZW50cm9pZFcwOwogICAgZDNfZ2VvX2NlbnRyb2lkWTAgKz0gKHkgLSBkM19nZW9fY2VudHJvaWRZMCkgLyBkM19nZW9fY2VudHJvaWRXMDsKICAgIGQzX2dlb19jZW50cm9pZFowICs9ICh6IC0gZDNfZ2VvX2NlbnRyb2lkWjApIC8gZDNfZ2VvX2NlbnRyb2lkVzA7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19jZW50cm9pZExpbmVTdGFydCgpIHsKICAgIHZhciB4MCwgeTAsIHowOwogICAgZDNfZ2VvX2NlbnRyb2lkLnBvaW50ID0gZnVuY3Rpb24ozrssIM+GKSB7CiAgICAgIM67ICo9IGQzX3JhZGlhbnM7CiAgICAgIHZhciBjb3PPhiA9IE1hdGguY29zKM+GICo9IGQzX3JhZGlhbnMpOwogICAgICB4MCA9IGNvc8+GICogTWF0aC5jb3MozrspOwogICAgICB5MCA9IGNvc8+GICogTWF0aC5zaW4ozrspOwogICAgICB6MCA9IE1hdGguc2luKM+GKTsKICAgICAgZDNfZ2VvX2NlbnRyb2lkLnBvaW50ID0gbmV4dFBvaW50OwogICAgICBkM19nZW9fY2VudHJvaWRQb2ludFhZWih4MCwgeTAsIHowKTsKICAgIH07CiAgICBmdW5jdGlvbiBuZXh0UG9pbnQozrssIM+GKSB7CiAgICAgIM67ICo9IGQzX3JhZGlhbnM7CiAgICAgIHZhciBjb3PPhiA9IE1hdGguY29zKM+GICo9IGQzX3JhZGlhbnMpLCB4ID0gY29zz4YgKiBNYXRoLmNvcyjOuyksIHkgPSBjb3PPhiAqIE1hdGguc2luKM67KSwgeiA9IE1hdGguc2luKM+GKSwgdyA9IE1hdGguYXRhbjIoTWF0aC5zcXJ0KCh3ID0geTAgKiB6IC0gejAgKiB5KSAqIHcgKyAodyA9IHowICogeCAtIHgwICogeikgKiB3ICsgKHcgPSB4MCAqIHkgLSB5MCAqIHgpICogdyksIHgwICogeCArIHkwICogeSArIHowICogeik7CiAgICAgIGQzX2dlb19jZW50cm9pZFcxICs9IHc7CiAgICAgIGQzX2dlb19jZW50cm9pZFgxICs9IHcgKiAoeDAgKyAoeDAgPSB4KSk7CiAgICAgIGQzX2dlb19jZW50cm9pZFkxICs9IHcgKiAoeTAgKyAoeTAgPSB5KSk7CiAgICAgIGQzX2dlb19jZW50cm9pZFoxICs9IHcgKiAoejAgKyAoejAgPSB6KSk7CiAgICAgIGQzX2dlb19jZW50cm9pZFBvaW50WFlaKHgwLCB5MCwgejApOwogICAgfQogIH0KICBmdW5jdGlvbiBkM19nZW9fY2VudHJvaWRMaW5lRW5kKCkgewogICAgZDNfZ2VvX2NlbnRyb2lkLnBvaW50ID0gZDNfZ2VvX2NlbnRyb2lkUG9pbnQ7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19jZW50cm9pZFJpbmdTdGFydCgpIHsKICAgIHZhciDOuzAwLCDPhjAwLCB4MCwgeTAsIHowOwogICAgZDNfZ2VvX2NlbnRyb2lkLnBvaW50ID0gZnVuY3Rpb24ozrssIM+GKSB7CiAgICAgIM67MDAgPSDOuywgz4YwMCA9IM+GOwogICAgICBkM19nZW9fY2VudHJvaWQucG9pbnQgPSBuZXh0UG9pbnQ7CiAgICAgIM67ICo9IGQzX3JhZGlhbnM7CiAgICAgIHZhciBjb3PPhiA9IE1hdGguY29zKM+GICo9IGQzX3JhZGlhbnMpOwogICAgICB4MCA9IGNvc8+GICogTWF0aC5jb3MozrspOwogICAgICB5MCA9IGNvc8+GICogTWF0aC5zaW4ozrspOwogICAgICB6MCA9IE1hdGguc2luKM+GKTsKICAgICAgZDNfZ2VvX2NlbnRyb2lkUG9pbnRYWVooeDAsIHkwLCB6MCk7CiAgICB9OwogICAgZDNfZ2VvX2NlbnRyb2lkLmxpbmVFbmQgPSBmdW5jdGlvbigpIHsKICAgICAgbmV4dFBvaW50KM67MDAsIM+GMDApOwogICAgICBkM19nZW9fY2VudHJvaWQubGluZUVuZCA9IGQzX2dlb19jZW50cm9pZExpbmVFbmQ7CiAgICAgIGQzX2dlb19jZW50cm9pZC5wb2ludCA9IGQzX2dlb19jZW50cm9pZFBvaW50OwogICAgfTsKICAgIGZ1bmN0aW9uIG5leHRQb2ludCjOuywgz4YpIHsKICAgICAgzrsgKj0gZDNfcmFkaWFuczsKICAgICAgdmFyIGNvc8+GID0gTWF0aC5jb3Moz4YgKj0gZDNfcmFkaWFucyksIHggPSBjb3PPhiAqIE1hdGguY29zKM67KSwgeSA9IGNvc8+GICogTWF0aC5zaW4ozrspLCB6ID0gTWF0aC5zaW4oz4YpLCBjeCA9IHkwICogeiAtIHowICogeSwgY3kgPSB6MCAqIHggLSB4MCAqIHosIGN6ID0geDAgKiB5IC0geTAgKiB4LCBtID0gTWF0aC5zcXJ0KGN4ICogY3ggKyBjeSAqIGN5ICsgY3ogKiBjeiksIHUgPSB4MCAqIHggKyB5MCAqIHkgKyB6MCAqIHosIHYgPSBtICYmIC1kM19hY29zKHUpIC8gbSwgdyA9IE1hdGguYXRhbjIobSwgdSk7CiAgICAgIGQzX2dlb19jZW50cm9pZFgyICs9IHYgKiBjeDsKICAgICAgZDNfZ2VvX2NlbnRyb2lkWTIgKz0gdiAqIGN5OwogICAgICBkM19nZW9fY2VudHJvaWRaMiArPSB2ICogY3o7CiAgICAgIGQzX2dlb19jZW50cm9pZFcxICs9IHc7CiAgICAgIGQzX2dlb19jZW50cm9pZFgxICs9IHcgKiAoeDAgKyAoeDAgPSB4KSk7CiAgICAgIGQzX2dlb19jZW50cm9pZFkxICs9IHcgKiAoeTAgKyAoeTAgPSB5KSk7CiAgICAgIGQzX2dlb19jZW50cm9pZFoxICs9IHcgKiAoejAgKyAoejAgPSB6KSk7CiAgICAgIGQzX2dlb19jZW50cm9pZFBvaW50WFlaKHgwLCB5MCwgejApOwogICAgfQogIH0KICBmdW5jdGlvbiBkM19nZW9fY29tcG9zZShhLCBiKSB7CiAgICBmdW5jdGlvbiBjb21wb3NlKHgsIHkpIHsKICAgICAgcmV0dXJuIHggPSBhKHgsIHkpLCBiKHhbMF0sIHhbMV0pOwogICAgfQogICAgaWYgKGEuaW52ZXJ0ICYmIGIuaW52ZXJ0KSBjb21wb3NlLmludmVydCA9IGZ1bmN0aW9uKHgsIHkpIHsKICAgICAgcmV0dXJuIHggPSBiLmludmVydCh4LCB5KSwgeCAmJiBhLmludmVydCh4WzBdLCB4WzFdKTsKICAgIH07CiAgICByZXR1cm4gY29tcG9zZTsKICB9CiAgZnVuY3Rpb24gZDNfdHJ1ZSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBmdW5jdGlvbiBkM19nZW9fY2xpcFBvbHlnb24oc2VnbWVudHMsIGNvbXBhcmUsIGNsaXBTdGFydEluc2lkZSwgaW50ZXJwb2xhdGUsIGxpc3RlbmVyKSB7CiAgICB2YXIgc3ViamVjdCA9IFtdLCBjbGlwID0gW107CiAgICBzZWdtZW50cy5mb3JFYWNoKGZ1bmN0aW9uKHNlZ21lbnQpIHsKICAgICAgaWYgKChuID0gc2VnbWVudC5sZW5ndGggLSAxKSA8PSAwKSByZXR1cm47CiAgICAgIHZhciBuLCBwMCA9IHNlZ21lbnRbMF0sIHAxID0gc2VnbWVudFtuXTsKICAgICAgaWYgKGQzX2dlb19zcGhlcmljYWxFcXVhbChwMCwgcDEpKSB7CiAgICAgICAgbGlzdGVuZXIubGluZVN0YXJ0KCk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyArK2kpIGxpc3RlbmVyLnBvaW50KChwMCA9IHNlZ21lbnRbaV0pWzBdLCBwMFsxXSk7CiAgICAgICAgbGlzdGVuZXIubGluZUVuZCgpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YXIgYSA9IG5ldyBkM19nZW9fY2xpcFBvbHlnb25JbnRlcnNlY3Rpb24ocDAsIHNlZ21lbnQsIG51bGwsIHRydWUpLCBiID0gbmV3IGQzX2dlb19jbGlwUG9seWdvbkludGVyc2VjdGlvbihwMCwgbnVsbCwgYSwgZmFsc2UpOwogICAgICBhLm8gPSBiOwogICAgICBzdWJqZWN0LnB1c2goYSk7CiAgICAgIGNsaXAucHVzaChiKTsKICAgICAgYSA9IG5ldyBkM19nZW9fY2xpcFBvbHlnb25JbnRlcnNlY3Rpb24ocDEsIHNlZ21lbnQsIG51bGwsIGZhbHNlKTsKICAgICAgYiA9IG5ldyBkM19nZW9fY2xpcFBvbHlnb25JbnRlcnNlY3Rpb24ocDEsIG51bGwsIGEsIHRydWUpOwogICAgICBhLm8gPSBiOwogICAgICBzdWJqZWN0LnB1c2goYSk7CiAgICAgIGNsaXAucHVzaChiKTsKICAgIH0pOwogICAgY2xpcC5zb3J0KGNvbXBhcmUpOwogICAgZDNfZ2VvX2NsaXBQb2x5Z29uTGlua0NpcmN1bGFyKHN1YmplY3QpOwogICAgZDNfZ2VvX2NsaXBQb2x5Z29uTGlua0NpcmN1bGFyKGNsaXApOwogICAgaWYgKCFzdWJqZWN0Lmxlbmd0aCkgcmV0dXJuOwogICAgZm9yICh2YXIgaSA9IDAsIGVudHJ5ID0gY2xpcFN0YXJ0SW5zaWRlLCBuID0gY2xpcC5sZW5ndGg7IGkgPCBuOyArK2kpIHsKICAgICAgY2xpcFtpXS5lID0gZW50cnkgPSAhZW50cnk7CiAgICB9CiAgICB2YXIgc3RhcnQgPSBzdWJqZWN0WzBdLCBwb2ludHMsIHBvaW50OwogICAgd2hpbGUgKDEpIHsKICAgICAgdmFyIGN1cnJlbnQgPSBzdGFydCwgaXNTdWJqZWN0ID0gdHJ1ZTsKICAgICAgd2hpbGUgKGN1cnJlbnQudikgaWYgKChjdXJyZW50ID0gY3VycmVudC5uKSA9PT0gc3RhcnQpIHJldHVybjsKICAgICAgcG9pbnRzID0gY3VycmVudC56OwogICAgICBsaXN0ZW5lci5saW5lU3RhcnQoKTsKICAgICAgZG8gewogICAgICAgIGN1cnJlbnQudiA9IGN1cnJlbnQuby52ID0gdHJ1ZTsKICAgICAgICBpZiAoY3VycmVudC5lKSB7CiAgICAgICAgICBpZiAoaXNTdWJqZWN0KSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gcG9pbnRzLmxlbmd0aDsgaSA8IG47ICsraSkgbGlzdGVuZXIucG9pbnQoKHBvaW50ID0gcG9pbnRzW2ldKVswXSwgcG9pbnRbMV0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaW50ZXJwb2xhdGUoY3VycmVudC54LCBjdXJyZW50Lm4ueCwgMSwgbGlzdGVuZXIpOwogICAgICAgICAgfQogICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQubjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGlzU3ViamVjdCkgewogICAgICAgICAgICBwb2ludHMgPSBjdXJyZW50LnAuejsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IHBvaW50cy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgbGlzdGVuZXIucG9pbnQoKHBvaW50ID0gcG9pbnRzW2ldKVswXSwgcG9pbnRbMV0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaW50ZXJwb2xhdGUoY3VycmVudC54LCBjdXJyZW50LnAueCwgLTEsIGxpc3RlbmVyKTsKICAgICAgICAgIH0KICAgICAgICAgIGN1cnJlbnQgPSBjdXJyZW50LnA7CiAgICAgICAgfQogICAgICAgIGN1cnJlbnQgPSBjdXJyZW50Lm87CiAgICAgICAgcG9pbnRzID0gY3VycmVudC56OwogICAgICAgIGlzU3ViamVjdCA9ICFpc1N1YmplY3Q7CiAgICAgIH0gd2hpbGUgKCFjdXJyZW50LnYpOwogICAgICBsaXN0ZW5lci5saW5lRW5kKCk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19jbGlwUG9seWdvbkxpbmtDaXJjdWxhcihhcnJheSkgewogICAgaWYgKCEobiA9IGFycmF5Lmxlbmd0aCkpIHJldHVybjsKICAgIHZhciBuLCBpID0gMCwgYSA9IGFycmF5WzBdLCBiOwogICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgYS5uID0gYiA9IGFycmF5W2ldOwogICAgICBiLnAgPSBhOwogICAgICBhID0gYjsKICAgIH0KICAgIGEubiA9IGIgPSBhcnJheVswXTsKICAgIGIucCA9IGE7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19jbGlwUG9seWdvbkludGVyc2VjdGlvbihwb2ludCwgcG9pbnRzLCBvdGhlciwgZW50cnkpIHsKICAgIHRoaXMueCA9IHBvaW50OwogICAgdGhpcy56ID0gcG9pbnRzOwogICAgdGhpcy5vID0gb3RoZXI7CiAgICB0aGlzLmUgPSBlbnRyeTsKICAgIHRoaXMudiA9IGZhbHNlOwogICAgdGhpcy5uID0gdGhpcy5wID0gbnVsbDsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX2NsaXAocG9pbnRWaXNpYmxlLCBjbGlwTGluZSwgaW50ZXJwb2xhdGUsIGNsaXBTdGFydCkgewogICAgcmV0dXJuIGZ1bmN0aW9uKHJvdGF0ZSwgbGlzdGVuZXIpIHsKICAgICAgdmFyIGxpbmUgPSBjbGlwTGluZShsaXN0ZW5lciksIHJvdGF0ZWRDbGlwU3RhcnQgPSByb3RhdGUuaW52ZXJ0KGNsaXBTdGFydFswXSwgY2xpcFN0YXJ0WzFdKTsKICAgICAgdmFyIGNsaXAgPSB7CiAgICAgICAgcG9pbnQ6IHBvaW50LAogICAgICAgIGxpbmVTdGFydDogbGluZVN0YXJ0LAogICAgICAgIGxpbmVFbmQ6IGxpbmVFbmQsCiAgICAgICAgcG9seWdvblN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICAgIGNsaXAucG9pbnQgPSBwb2ludFJpbmc7CiAgICAgICAgICBjbGlwLmxpbmVTdGFydCA9IHJpbmdTdGFydDsKICAgICAgICAgIGNsaXAubGluZUVuZCA9IHJpbmdFbmQ7CiAgICAgICAgICBzZWdtZW50cyA9IFtdOwogICAgICAgICAgcG9seWdvbiA9IFtdOwogICAgICAgIH0sCiAgICAgICAgcG9seWdvbkVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBjbGlwLnBvaW50ID0gcG9pbnQ7CiAgICAgICAgICBjbGlwLmxpbmVTdGFydCA9IGxpbmVTdGFydDsKICAgICAgICAgIGNsaXAubGluZUVuZCA9IGxpbmVFbmQ7CiAgICAgICAgICBzZWdtZW50cyA9IGQzLm1lcmdlKHNlZ21lbnRzKTsKICAgICAgICAgIHZhciBjbGlwU3RhcnRJbnNpZGUgPSBkM19nZW9fcG9pbnRJblBvbHlnb24ocm90YXRlZENsaXBTdGFydCwgcG9seWdvbik7CiAgICAgICAgICBpZiAoc2VnbWVudHMubGVuZ3RoKSB7CiAgICAgICAgICAgIGlmICghcG9seWdvblN0YXJ0ZWQpIGxpc3RlbmVyLnBvbHlnb25TdGFydCgpLCBwb2x5Z29uU3RhcnRlZCA9IHRydWU7CiAgICAgICAgICAgIGQzX2dlb19jbGlwUG9seWdvbihzZWdtZW50cywgZDNfZ2VvX2NsaXBTb3J0LCBjbGlwU3RhcnRJbnNpZGUsIGludGVycG9sYXRlLCBsaXN0ZW5lcik7CiAgICAgICAgICB9IGVsc2UgaWYgKGNsaXBTdGFydEluc2lkZSkgewogICAgICAgICAgICBpZiAoIXBvbHlnb25TdGFydGVkKSBsaXN0ZW5lci5wb2x5Z29uU3RhcnQoKSwgcG9seWdvblN0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgICBsaXN0ZW5lci5saW5lU3RhcnQoKTsKICAgICAgICAgICAgaW50ZXJwb2xhdGUobnVsbCwgbnVsbCwgMSwgbGlzdGVuZXIpOwogICAgICAgICAgICBsaXN0ZW5lci5saW5lRW5kKCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocG9seWdvblN0YXJ0ZWQpIGxpc3RlbmVyLnBvbHlnb25FbmQoKSwgcG9seWdvblN0YXJ0ZWQgPSBmYWxzZTsKICAgICAgICAgIHNlZ21lbnRzID0gcG9seWdvbiA9IG51bGw7CiAgICAgICAgfSwKICAgICAgICBzcGhlcmU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgbGlzdGVuZXIucG9seWdvblN0YXJ0KCk7CiAgICAgICAgICBsaXN0ZW5lci5saW5lU3RhcnQoKTsKICAgICAgICAgIGludGVycG9sYXRlKG51bGwsIG51bGwsIDEsIGxpc3RlbmVyKTsKICAgICAgICAgIGxpc3RlbmVyLmxpbmVFbmQoKTsKICAgICAgICAgIGxpc3RlbmVyLnBvbHlnb25FbmQoKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIGZ1bmN0aW9uIHBvaW50KM67LCDPhikgewogICAgICAgIHZhciBwb2ludCA9IHJvdGF0ZSjOuywgz4YpOwogICAgICAgIGlmIChwb2ludFZpc2libGUozrsgPSBwb2ludFswXSwgz4YgPSBwb2ludFsxXSkpIGxpc3RlbmVyLnBvaW50KM67LCDPhik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcG9pbnRMaW5lKM67LCDPhikgewogICAgICAgIHZhciBwb2ludCA9IHJvdGF0ZSjOuywgz4YpOwogICAgICAgIGxpbmUucG9pbnQocG9pbnRbMF0sIHBvaW50WzFdKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBsaW5lU3RhcnQoKSB7CiAgICAgICAgY2xpcC5wb2ludCA9IHBvaW50TGluZTsKICAgICAgICBsaW5lLmxpbmVTdGFydCgpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGxpbmVFbmQoKSB7CiAgICAgICAgY2xpcC5wb2ludCA9IHBvaW50OwogICAgICAgIGxpbmUubGluZUVuZCgpOwogICAgICB9CiAgICAgIHZhciBzZWdtZW50czsKICAgICAgdmFyIGJ1ZmZlciA9IGQzX2dlb19jbGlwQnVmZmVyTGlzdGVuZXIoKSwgcmluZ0xpc3RlbmVyID0gY2xpcExpbmUoYnVmZmVyKSwgcG9seWdvblN0YXJ0ZWQgPSBmYWxzZSwgcG9seWdvbiwgcmluZzsKICAgICAgZnVuY3Rpb24gcG9pbnRSaW5nKM67LCDPhikgewogICAgICAgIHJpbmcucHVzaChbIM67LCDPhiBdKTsKICAgICAgICB2YXIgcG9pbnQgPSByb3RhdGUozrssIM+GKTsKICAgICAgICByaW5nTGlzdGVuZXIucG9pbnQocG9pbnRbMF0sIHBvaW50WzFdKTsKICAgICAgfQogICAgICBmdW5jdGlvbiByaW5nU3RhcnQoKSB7CiAgICAgICAgcmluZ0xpc3RlbmVyLmxpbmVTdGFydCgpOwogICAgICAgIHJpbmcgPSBbXTsKICAgICAgfQogICAgICBmdW5jdGlvbiByaW5nRW5kKCkgewogICAgICAgIHBvaW50UmluZyhyaW5nWzBdWzBdLCByaW5nWzBdWzFdKTsKICAgICAgICByaW5nTGlzdGVuZXIubGluZUVuZCgpOwogICAgICAgIHZhciBjbGVhbiA9IHJpbmdMaXN0ZW5lci5jbGVhbigpLCByaW5nU2VnbWVudHMgPSBidWZmZXIuYnVmZmVyKCksIHNlZ21lbnQsIG4gPSByaW5nU2VnbWVudHMubGVuZ3RoOwogICAgICAgIHJpbmcucG9wKCk7CiAgICAgICAgcG9seWdvbi5wdXNoKHJpbmcpOwogICAgICAgIHJpbmcgPSBudWxsOwogICAgICAgIGlmICghbikgcmV0dXJuOwogICAgICAgIGlmIChjbGVhbiAmIDEpIHsKICAgICAgICAgIHNlZ21lbnQgPSByaW5nU2VnbWVudHNbMF07CiAgICAgICAgICB2YXIgbiA9IHNlZ21lbnQubGVuZ3RoIC0gMSwgaSA9IC0xLCBwb2ludDsKICAgICAgICAgIGlmIChuID4gMCkgewogICAgICAgICAgICBpZiAoIXBvbHlnb25TdGFydGVkKSBsaXN0ZW5lci5wb2x5Z29uU3RhcnQoKSwgcG9seWdvblN0YXJ0ZWQgPSB0cnVlOwogICAgICAgICAgICBsaXN0ZW5lci5saW5lU3RhcnQoKTsKICAgICAgICAgICAgd2hpbGUgKCsraSA8IG4pIGxpc3RlbmVyLnBvaW50KChwb2ludCA9IHNlZ21lbnRbaV0pWzBdLCBwb2ludFsxXSk7CiAgICAgICAgICAgIGxpc3RlbmVyLmxpbmVFbmQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKG4gPiAxICYmIGNsZWFuICYgMikgcmluZ1NlZ21lbnRzLnB1c2gocmluZ1NlZ21lbnRzLnBvcCgpLmNvbmNhdChyaW5nU2VnbWVudHMuc2hpZnQoKSkpOwogICAgICAgIHNlZ21lbnRzLnB1c2gocmluZ1NlZ21lbnRzLmZpbHRlcihkM19nZW9fY2xpcFNlZ21lbnRMZW5ndGgxKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNsaXA7CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM19nZW9fY2xpcFNlZ21lbnRMZW5ndGgxKHNlZ21lbnQpIHsKICAgIHJldHVybiBzZWdtZW50Lmxlbmd0aCA+IDE7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19jbGlwQnVmZmVyTGlzdGVuZXIoKSB7CiAgICB2YXIgbGluZXMgPSBbXSwgbGluZTsKICAgIHJldHVybiB7CiAgICAgIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgbGluZXMucHVzaChsaW5lID0gW10pOwogICAgICB9LAogICAgICBwb2ludDogZnVuY3Rpb24ozrssIM+GKSB7CiAgICAgICAgbGluZS5wdXNoKFsgzrssIM+GIF0pOwogICAgICB9LAogICAgICBsaW5lRW5kOiBkM19ub29wLAogICAgICBidWZmZXI6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBidWZmZXIgPSBsaW5lczsKICAgICAgICBsaW5lcyA9IFtdOwogICAgICAgIGxpbmUgPSBudWxsOwogICAgICAgIHJldHVybiBidWZmZXI7CiAgICAgIH0sCiAgICAgIHJlam9pbjogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKGxpbmVzLmxlbmd0aCA+IDEpIGxpbmVzLnB1c2gobGluZXMucG9wKCkuY29uY2F0KGxpbmVzLnNoaWZ0KCkpKTsKICAgICAgfQogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX2NsaXBTb3J0KGEsIGIpIHsKICAgIHJldHVybiAoKGEgPSBhLngpWzBdIDwgMCA/IGFbMV0gLSBoYWxmz4AgLSDOtSA6IGhhbGbPgCAtIGFbMV0pIC0gKChiID0gYi54KVswXSA8IDAgPyBiWzFdIC0gaGFsZs+AIC0gzrUgOiBoYWxmz4AgLSBiWzFdKTsKICB9CiAgdmFyIGQzX2dlb19jbGlwQW50aW1lcmlkaWFuID0gZDNfZ2VvX2NsaXAoZDNfdHJ1ZSwgZDNfZ2VvX2NsaXBBbnRpbWVyaWRpYW5MaW5lLCBkM19nZW9fY2xpcEFudGltZXJpZGlhbkludGVycG9sYXRlLCBbIC3PgCwgLc+AIC8gMiBdKTsKICBmdW5jdGlvbiBkM19nZW9fY2xpcEFudGltZXJpZGlhbkxpbmUobGlzdGVuZXIpIHsKICAgIHZhciDOuzAgPSBOYU4sIM+GMCA9IE5hTiwgc867MCA9IE5hTiwgY2xlYW47CiAgICByZXR1cm4gewogICAgICBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGxpc3RlbmVyLmxpbmVTdGFydCgpOwogICAgICAgIGNsZWFuID0gMTsKICAgICAgfSwKICAgICAgcG9pbnQ6IGZ1bmN0aW9uKM67MSwgz4YxKSB7CiAgICAgICAgdmFyIHPOuzEgPSDOuzEgPiAwID8gz4AgOiAtz4AsIGTOuyA9IGFicyjOuzEgLSDOuzApOwogICAgICAgIGlmIChhYnMoZM67IC0gz4ApIDwgzrUpIHsKICAgICAgICAgIGxpc3RlbmVyLnBvaW50KM67MCwgz4YwID0gKM+GMCArIM+GMSkgLyAyID4gMCA/IGhhbGbPgCA6IC1oYWxmz4ApOwogICAgICAgICAgbGlzdGVuZXIucG9pbnQoc867MCwgz4YwKTsKICAgICAgICAgIGxpc3RlbmVyLmxpbmVFbmQoKTsKICAgICAgICAgIGxpc3RlbmVyLmxpbmVTdGFydCgpOwogICAgICAgICAgbGlzdGVuZXIucG9pbnQoc867MSwgz4YwKTsKICAgICAgICAgIGxpc3RlbmVyLnBvaW50KM67MSwgz4YwKTsKICAgICAgICAgIGNsZWFuID0gMDsKICAgICAgICB9IGVsc2UgaWYgKHPOuzAgIT09IHPOuzEgJiYgZM67ID49IM+AKSB7CiAgICAgICAgICBpZiAoYWJzKM67MCAtIHPOuzApIDwgzrUpIM67MCAtPSBzzrswICogzrU7CiAgICAgICAgICBpZiAoYWJzKM67MSAtIHPOuzEpIDwgzrUpIM67MSAtPSBzzrsxICogzrU7CiAgICAgICAgICDPhjAgPSBkM19nZW9fY2xpcEFudGltZXJpZGlhbkludGVyc2VjdCjOuzAsIM+GMCwgzrsxLCDPhjEpOwogICAgICAgICAgbGlzdGVuZXIucG9pbnQoc867MCwgz4YwKTsKICAgICAgICAgIGxpc3RlbmVyLmxpbmVFbmQoKTsKICAgICAgICAgIGxpc3RlbmVyLmxpbmVTdGFydCgpOwogICAgICAgICAgbGlzdGVuZXIucG9pbnQoc867MSwgz4YwKTsKICAgICAgICAgIGNsZWFuID0gMDsKICAgICAgICB9CiAgICAgICAgbGlzdGVuZXIucG9pbnQozrswID0gzrsxLCDPhjAgPSDPhjEpOwogICAgICAgIHPOuzAgPSBzzrsxOwogICAgICB9LAogICAgICBsaW5lRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICBsaXN0ZW5lci5saW5lRW5kKCk7CiAgICAgICAgzrswID0gz4YwID0gTmFOOwogICAgICB9LAogICAgICBjbGVhbjogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIDIgLSBjbGVhbjsKICAgICAgfQogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX2NsaXBBbnRpbWVyaWRpYW5JbnRlcnNlY3QozrswLCDPhjAsIM67MSwgz4YxKSB7CiAgICB2YXIgY29zz4YwLCBjb3PPhjEsIHNpbs67MF/OuzEgPSBNYXRoLnNpbijOuzAgLSDOuzEpOwogICAgcmV0dXJuIGFicyhzaW7OuzBfzrsxKSA+IM61ID8gTWF0aC5hdGFuKChNYXRoLnNpbijPhjApICogKGNvc8+GMSA9IE1hdGguY29zKM+GMSkpICogTWF0aC5zaW4ozrsxKSAtIE1hdGguc2luKM+GMSkgKiAoY29zz4YwID0gTWF0aC5jb3Moz4YwKSkgKiBNYXRoLnNpbijOuzApKSAvIChjb3PPhjAgKiBjb3PPhjEgKiBzaW7OuzBfzrsxKSkgOiAoz4YwICsgz4YxKSAvIDI7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19jbGlwQW50aW1lcmlkaWFuSW50ZXJwb2xhdGUoZnJvbSwgdG8sIGRpcmVjdGlvbiwgbGlzdGVuZXIpIHsKICAgIHZhciDPhjsKICAgIGlmIChmcm9tID09IG51bGwpIHsKICAgICAgz4YgPSBkaXJlY3Rpb24gKiBoYWxmz4A7CiAgICAgIGxpc3RlbmVyLnBvaW50KC3PgCwgz4YpOwogICAgICBsaXN0ZW5lci5wb2ludCgwLCDPhik7CiAgICAgIGxpc3RlbmVyLnBvaW50KM+ALCDPhik7CiAgICAgIGxpc3RlbmVyLnBvaW50KM+ALCAwKTsKICAgICAgbGlzdGVuZXIucG9pbnQoz4AsIC3Phik7CiAgICAgIGxpc3RlbmVyLnBvaW50KDAsIC3Phik7CiAgICAgIGxpc3RlbmVyLnBvaW50KC3PgCwgLc+GKTsKICAgICAgbGlzdGVuZXIucG9pbnQoLc+ALCAwKTsKICAgICAgbGlzdGVuZXIucG9pbnQoLc+ALCDPhik7CiAgICB9IGVsc2UgaWYgKGFicyhmcm9tWzBdIC0gdG9bMF0pID4gzrUpIHsKICAgICAgdmFyIHMgPSBmcm9tWzBdIDwgdG9bMF0gPyDPgCA6IC3PgDsKICAgICAgz4YgPSBkaXJlY3Rpb24gKiBzIC8gMjsKICAgICAgbGlzdGVuZXIucG9pbnQoLXMsIM+GKTsKICAgICAgbGlzdGVuZXIucG9pbnQoMCwgz4YpOwogICAgICBsaXN0ZW5lci5wb2ludChzLCDPhik7CiAgICB9IGVsc2UgewogICAgICBsaXN0ZW5lci5wb2ludCh0b1swXSwgdG9bMV0pOwogICAgfQogIH0KICBmdW5jdGlvbiBkM19nZW9fcG9pbnRJblBvbHlnb24ocG9pbnQsIHBvbHlnb24pIHsKICAgIHZhciBtZXJpZGlhbiA9IHBvaW50WzBdLCBwYXJhbGxlbCA9IHBvaW50WzFdLCBtZXJpZGlhbk5vcm1hbCA9IFsgTWF0aC5zaW4obWVyaWRpYW4pLCAtTWF0aC5jb3MobWVyaWRpYW4pLCAwIF0sIHBvbGFyQW5nbGUgPSAwLCB3aW5kaW5nID0gMDsKICAgIGQzX2dlb19hcmVhUmluZ1N1bS5yZXNldCgpOwogICAgZm9yICh2YXIgaSA9IDAsIG4gPSBwb2x5Z29uLmxlbmd0aDsgaSA8IG47ICsraSkgewogICAgICB2YXIgcmluZyA9IHBvbHlnb25baV0sIG0gPSByaW5nLmxlbmd0aDsKICAgICAgaWYgKCFtKSBjb250aW51ZTsKICAgICAgdmFyIHBvaW50MCA9IHJpbmdbMF0sIM67MCA9IHBvaW50MFswXSwgz4YwID0gcG9pbnQwWzFdIC8gMiArIM+AIC8gNCwgc2luz4YwID0gTWF0aC5zaW4oz4YwKSwgY29zz4YwID0gTWF0aC5jb3Moz4YwKSwgaiA9IDE7CiAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgaWYgKGogPT09IG0pIGogPSAwOwogICAgICAgIHBvaW50ID0gcmluZ1tqXTsKICAgICAgICB2YXIgzrsgPSBwb2ludFswXSwgz4YgPSBwb2ludFsxXSAvIDIgKyDPgCAvIDQsIHNpbs+GID0gTWF0aC5zaW4oz4YpLCBjb3PPhiA9IE1hdGguY29zKM+GKSwgZM67ID0gzrsgLSDOuzAsIHNkzrsgPSBkzrsgPj0gMCA/IDEgOiAtMSwgYWTOuyA9IHNkzrsgKiBkzrssIGFudGltZXJpZGlhbiA9IGFkzrsgPiDPgCwgayA9IHNpbs+GMCAqIHNpbs+GOwogICAgICAgIGQzX2dlb19hcmVhUmluZ1N1bS5hZGQoTWF0aC5hdGFuMihrICogc2TOuyAqIE1hdGguc2luKGFkzrspLCBjb3PPhjAgKiBjb3PPhiArIGsgKiBNYXRoLmNvcyhhZM67KSkpOwogICAgICAgIHBvbGFyQW5nbGUgKz0gYW50aW1lcmlkaWFuID8gZM67ICsgc2TOuyAqIM+EIDogZM67OwogICAgICAgIGlmIChhbnRpbWVyaWRpYW4gXiDOuzAgPj0gbWVyaWRpYW4gXiDOuyA+PSBtZXJpZGlhbikgewogICAgICAgICAgdmFyIGFyYyA9IGQzX2dlb19jYXJ0ZXNpYW5Dcm9zcyhkM19nZW9fY2FydGVzaWFuKHBvaW50MCksIGQzX2dlb19jYXJ0ZXNpYW4ocG9pbnQpKTsKICAgICAgICAgIGQzX2dlb19jYXJ0ZXNpYW5Ob3JtYWxpemUoYXJjKTsKICAgICAgICAgIHZhciBpbnRlcnNlY3Rpb24gPSBkM19nZW9fY2FydGVzaWFuQ3Jvc3MobWVyaWRpYW5Ob3JtYWwsIGFyYyk7CiAgICAgICAgICBkM19nZW9fY2FydGVzaWFuTm9ybWFsaXplKGludGVyc2VjdGlvbik7CiAgICAgICAgICB2YXIgz4ZhcmMgPSAoYW50aW1lcmlkaWFuIF4gZM67ID49IDAgPyAtMSA6IDEpICogZDNfYXNpbihpbnRlcnNlY3Rpb25bMl0pOwogICAgICAgICAgaWYgKHBhcmFsbGVsID4gz4ZhcmMgfHwgcGFyYWxsZWwgPT09IM+GYXJjICYmIChhcmNbMF0gfHwgYXJjWzFdKSkgewogICAgICAgICAgICB3aW5kaW5nICs9IGFudGltZXJpZGlhbiBeIGTOuyA+PSAwID8gMSA6IC0xOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIWorKykgYnJlYWs7CiAgICAgICAgzrswID0gzrssIHNpbs+GMCA9IHNpbs+GLCBjb3PPhjAgPSBjb3PPhiwgcG9pbnQwID0gcG9pbnQ7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAocG9sYXJBbmdsZSA8IC3OtSB8fCBwb2xhckFuZ2xlIDwgzrUgJiYgZDNfZ2VvX2FyZWFSaW5nU3VtIDwgMCkgXiB3aW5kaW5nICYgMTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX2NsaXBDaXJjbGUocmFkaXVzKSB7CiAgICB2YXIgY3IgPSBNYXRoLmNvcyhyYWRpdXMpLCBzbWFsbFJhZGl1cyA9IGNyID4gMCwgbm90SGVtaXNwaGVyZSA9IGFicyhjcikgPiDOtSwgaW50ZXJwb2xhdGUgPSBkM19nZW9fY2lyY2xlSW50ZXJwb2xhdGUocmFkaXVzLCA2ICogZDNfcmFkaWFucyk7CiAgICByZXR1cm4gZDNfZ2VvX2NsaXAodmlzaWJsZSwgY2xpcExpbmUsIGludGVycG9sYXRlLCBzbWFsbFJhZGl1cyA/IFsgMCwgLXJhZGl1cyBdIDogWyAtz4AsIHJhZGl1cyAtIM+AIF0pOwogICAgZnVuY3Rpb24gdmlzaWJsZSjOuywgz4YpIHsKICAgICAgcmV0dXJuIE1hdGguY29zKM67KSAqIE1hdGguY29zKM+GKSA+IGNyOwogICAgfQogICAgZnVuY3Rpb24gY2xpcExpbmUobGlzdGVuZXIpIHsKICAgICAgdmFyIHBvaW50MCwgYzAsIHYwLCB2MDAsIGNsZWFuOwogICAgICByZXR1cm4gewogICAgICAgIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgICB2MDAgPSB2MCA9IGZhbHNlOwogICAgICAgICAgY2xlYW4gPSAxOwogICAgICAgIH0sCiAgICAgICAgcG9pbnQ6IGZ1bmN0aW9uKM67LCDPhikgewogICAgICAgICAgdmFyIHBvaW50MSA9IFsgzrssIM+GIF0sIHBvaW50MiwgdiA9IHZpc2libGUozrssIM+GKSwgYyA9IHNtYWxsUmFkaXVzID8gdiA/IDAgOiBjb2RlKM67LCDPhikgOiB2ID8gY29kZSjOuyArICjOuyA8IDAgPyDPgCA6IC3PgCksIM+GKSA6IDA7CiAgICAgICAgICBpZiAoIXBvaW50MCAmJiAodjAwID0gdjAgPSB2KSkgbGlzdGVuZXIubGluZVN0YXJ0KCk7CiAgICAgICAgICBpZiAodiAhPT0gdjApIHsKICAgICAgICAgICAgcG9pbnQyID0gaW50ZXJzZWN0KHBvaW50MCwgcG9pbnQxKTsKICAgICAgICAgICAgaWYgKGQzX2dlb19zcGhlcmljYWxFcXVhbChwb2ludDAsIHBvaW50MikgfHwgZDNfZ2VvX3NwaGVyaWNhbEVxdWFsKHBvaW50MSwgcG9pbnQyKSkgewogICAgICAgICAgICAgIHBvaW50MVswXSArPSDOtTsKICAgICAgICAgICAgICBwb2ludDFbMV0gKz0gzrU7CiAgICAgICAgICAgICAgdiA9IHZpc2libGUocG9pbnQxWzBdLCBwb2ludDFbMV0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodiAhPT0gdjApIHsKICAgICAgICAgICAgY2xlYW4gPSAwOwogICAgICAgICAgICBpZiAodikgewogICAgICAgICAgICAgIGxpc3RlbmVyLmxpbmVTdGFydCgpOwogICAgICAgICAgICAgIHBvaW50MiA9IGludGVyc2VjdChwb2ludDEsIHBvaW50MCk7CiAgICAgICAgICAgICAgbGlzdGVuZXIucG9pbnQocG9pbnQyWzBdLCBwb2ludDJbMV0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHBvaW50MiA9IGludGVyc2VjdChwb2ludDAsIHBvaW50MSk7CiAgICAgICAgICAgICAgbGlzdGVuZXIucG9pbnQocG9pbnQyWzBdLCBwb2ludDJbMV0pOwogICAgICAgICAgICAgIGxpc3RlbmVyLmxpbmVFbmQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwb2ludDAgPSBwb2ludDI7CiAgICAgICAgICB9IGVsc2UgaWYgKG5vdEhlbWlzcGhlcmUgJiYgcG9pbnQwICYmIHNtYWxsUmFkaXVzIF4gdikgewogICAgICAgICAgICB2YXIgdDsKICAgICAgICAgICAgaWYgKCEoYyAmIGMwKSAmJiAodCA9IGludGVyc2VjdChwb2ludDEsIHBvaW50MCwgdHJ1ZSkpKSB7CiAgICAgICAgICAgICAgY2xlYW4gPSAwOwogICAgICAgICAgICAgIGlmIChzbWFsbFJhZGl1cykgewogICAgICAgICAgICAgICAgbGlzdGVuZXIubGluZVN0YXJ0KCk7CiAgICAgICAgICAgICAgICBsaXN0ZW5lci5wb2ludCh0WzBdWzBdLCB0WzBdWzFdKTsKICAgICAgICAgICAgICAgIGxpc3RlbmVyLnBvaW50KHRbMV1bMF0sIHRbMV1bMV0pOwogICAgICAgICAgICAgICAgbGlzdGVuZXIubGluZUVuZCgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsaXN0ZW5lci5wb2ludCh0WzFdWzBdLCB0WzFdWzFdKTsKICAgICAgICAgICAgICAgIGxpc3RlbmVyLmxpbmVFbmQoKTsKICAgICAgICAgICAgICAgIGxpc3RlbmVyLmxpbmVTdGFydCgpOwogICAgICAgICAgICAgICAgbGlzdGVuZXIucG9pbnQodFswXVswXSwgdFswXVsxXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodiAmJiAoIXBvaW50MCB8fCAhZDNfZ2VvX3NwaGVyaWNhbEVxdWFsKHBvaW50MCwgcG9pbnQxKSkpIHsKICAgICAgICAgICAgbGlzdGVuZXIucG9pbnQocG9pbnQxWzBdLCBwb2ludDFbMV0pOwogICAgICAgICAgfQogICAgICAgICAgcG9pbnQwID0gcG9pbnQxLCB2MCA9IHYsIGMwID0gYzsKICAgICAgICB9LAogICAgICAgIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHYwKSBsaXN0ZW5lci5saW5lRW5kKCk7CiAgICAgICAgICBwb2ludDAgPSBudWxsOwogICAgICAgIH0sCiAgICAgICAgY2xlYW46IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGNsZWFuIHwgKHYwMCAmJiB2MCkgPDwgMTsKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBpbnRlcnNlY3QoYSwgYiwgdHdvKSB7CiAgICAgIHZhciBwYSA9IGQzX2dlb19jYXJ0ZXNpYW4oYSksIHBiID0gZDNfZ2VvX2NhcnRlc2lhbihiKTsKICAgICAgdmFyIG4xID0gWyAxLCAwLCAwIF0sIG4yID0gZDNfZ2VvX2NhcnRlc2lhbkNyb3NzKHBhLCBwYiksIG4ybjIgPSBkM19nZW9fY2FydGVzaWFuRG90KG4yLCBuMiksIG4xbjIgPSBuMlswXSwgZGV0ZXJtaW5hbnQgPSBuMm4yIC0gbjFuMiAqIG4xbjI7CiAgICAgIGlmICghZGV0ZXJtaW5hbnQpIHJldHVybiAhdHdvICYmIGE7CiAgICAgIHZhciBjMSA9IGNyICogbjJuMiAvIGRldGVybWluYW50LCBjMiA9IC1jciAqIG4xbjIgLyBkZXRlcm1pbmFudCwgbjF4bjIgPSBkM19nZW9fY2FydGVzaWFuQ3Jvc3MobjEsIG4yKSwgQSA9IGQzX2dlb19jYXJ0ZXNpYW5TY2FsZShuMSwgYzEpLCBCID0gZDNfZ2VvX2NhcnRlc2lhblNjYWxlKG4yLCBjMik7CiAgICAgIGQzX2dlb19jYXJ0ZXNpYW5BZGQoQSwgQik7CiAgICAgIHZhciB1ID0gbjF4bjIsIHcgPSBkM19nZW9fY2FydGVzaWFuRG90KEEsIHUpLCB1dSA9IGQzX2dlb19jYXJ0ZXNpYW5Eb3QodSwgdSksIHQyID0gdyAqIHcgLSB1dSAqIChkM19nZW9fY2FydGVzaWFuRG90KEEsIEEpIC0gMSk7CiAgICAgIGlmICh0MiA8IDApIHJldHVybjsKICAgICAgdmFyIHQgPSBNYXRoLnNxcnQodDIpLCBxID0gZDNfZ2VvX2NhcnRlc2lhblNjYWxlKHUsICgtdyAtIHQpIC8gdXUpOwogICAgICBkM19nZW9fY2FydGVzaWFuQWRkKHEsIEEpOwogICAgICBxID0gZDNfZ2VvX3NwaGVyaWNhbChxKTsKICAgICAgaWYgKCF0d28pIHJldHVybiBxOwogICAgICB2YXIgzrswID0gYVswXSwgzrsxID0gYlswXSwgz4YwID0gYVsxXSwgz4YxID0gYlsxXSwgejsKICAgICAgaWYgKM67MSA8IM67MCkgeiA9IM67MCwgzrswID0gzrsxLCDOuzEgPSB6OwogICAgICB2YXIgzrTOuyA9IM67MSAtIM67MCwgcG9sYXIgPSBhYnMozrTOuyAtIM+AKSA8IM61LCBtZXJpZGlhbiA9IHBvbGFyIHx8IM60zrsgPCDOtTsKICAgICAgaWYgKCFwb2xhciAmJiDPhjEgPCDPhjApIHogPSDPhjAsIM+GMCA9IM+GMSwgz4YxID0gejsKICAgICAgaWYgKG1lcmlkaWFuID8gcG9sYXIgPyDPhjAgKyDPhjEgPiAwIF4gcVsxXSA8IChhYnMocVswXSAtIM67MCkgPCDOtSA/IM+GMCA6IM+GMSkgOiDPhjAgPD0gcVsxXSAmJiBxWzFdIDw9IM+GMSA6IM60zrsgPiDPgCBeICjOuzAgPD0gcVswXSAmJiBxWzBdIDw9IM67MSkpIHsKICAgICAgICB2YXIgcTEgPSBkM19nZW9fY2FydGVzaWFuU2NhbGUodSwgKC13ICsgdCkgLyB1dSk7CiAgICAgICAgZDNfZ2VvX2NhcnRlc2lhbkFkZChxMSwgQSk7CiAgICAgICAgcmV0dXJuIFsgcSwgZDNfZ2VvX3NwaGVyaWNhbChxMSkgXTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gY29kZSjOuywgz4YpIHsKICAgICAgdmFyIHIgPSBzbWFsbFJhZGl1cyA/IHJhZGl1cyA6IM+AIC0gcmFkaXVzLCBjb2RlID0gMDsKICAgICAgaWYgKM67IDwgLXIpIGNvZGUgfD0gMTsgZWxzZSBpZiAozrsgPiByKSBjb2RlIHw9IDI7CiAgICAgIGlmICjPhiA8IC1yKSBjb2RlIHw9IDQ7IGVsc2UgaWYgKM+GID4gcikgY29kZSB8PSA4OwogICAgICByZXR1cm4gY29kZTsKICAgIH0KICB9CiAgZnVuY3Rpb24gZDNfZ2VvbV9jbGlwTGluZSh4MCwgeTAsIHgxLCB5MSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKGxpbmUpIHsKICAgICAgdmFyIGEgPSBsaW5lLmEsIGIgPSBsaW5lLmIsIGF4ID0gYS54LCBheSA9IGEueSwgYnggPSBiLngsIGJ5ID0gYi55LCB0MCA9IDAsIHQxID0gMSwgZHggPSBieCAtIGF4LCBkeSA9IGJ5IC0gYXksIHI7CiAgICAgIHIgPSB4MCAtIGF4OwogICAgICBpZiAoIWR4ICYmIHIgPiAwKSByZXR1cm47CiAgICAgIHIgLz0gZHg7CiAgICAgIGlmIChkeCA8IDApIHsKICAgICAgICBpZiAociA8IHQwKSByZXR1cm47CiAgICAgICAgaWYgKHIgPCB0MSkgdDEgPSByOwogICAgICB9IGVsc2UgaWYgKGR4ID4gMCkgewogICAgICAgIGlmIChyID4gdDEpIHJldHVybjsKICAgICAgICBpZiAociA+IHQwKSB0MCA9IHI7CiAgICAgIH0KICAgICAgciA9IHgxIC0gYXg7CiAgICAgIGlmICghZHggJiYgciA8IDApIHJldHVybjsKICAgICAgciAvPSBkeDsKICAgICAgaWYgKGR4IDwgMCkgewogICAgICAgIGlmIChyID4gdDEpIHJldHVybjsKICAgICAgICBpZiAociA+IHQwKSB0MCA9IHI7CiAgICAgIH0gZWxzZSBpZiAoZHggPiAwKSB7CiAgICAgICAgaWYgKHIgPCB0MCkgcmV0dXJuOwogICAgICAgIGlmIChyIDwgdDEpIHQxID0gcjsKICAgICAgfQogICAgICByID0geTAgLSBheTsKICAgICAgaWYgKCFkeSAmJiByID4gMCkgcmV0dXJuOwogICAgICByIC89IGR5OwogICAgICBpZiAoZHkgPCAwKSB7CiAgICAgICAgaWYgKHIgPCB0MCkgcmV0dXJuOwogICAgICAgIGlmIChyIDwgdDEpIHQxID0gcjsKICAgICAgfSBlbHNlIGlmIChkeSA+IDApIHsKICAgICAgICBpZiAociA+IHQxKSByZXR1cm47CiAgICAgICAgaWYgKHIgPiB0MCkgdDAgPSByOwogICAgICB9CiAgICAgIHIgPSB5MSAtIGF5OwogICAgICBpZiAoIWR5ICYmIHIgPCAwKSByZXR1cm47CiAgICAgIHIgLz0gZHk7CiAgICAgIGlmIChkeSA8IDApIHsKICAgICAgICBpZiAociA+IHQxKSByZXR1cm47CiAgICAgICAgaWYgKHIgPiB0MCkgdDAgPSByOwogICAgICB9IGVsc2UgaWYgKGR5ID4gMCkgewogICAgICAgIGlmIChyIDwgdDApIHJldHVybjsKICAgICAgICBpZiAociA8IHQxKSB0MSA9IHI7CiAgICAgIH0KICAgICAgaWYgKHQwID4gMCkgbGluZS5hID0gewogICAgICAgIHg6IGF4ICsgdDAgKiBkeCwKICAgICAgICB5OiBheSArIHQwICogZHkKICAgICAgfTsKICAgICAgaWYgKHQxIDwgMSkgbGluZS5iID0gewogICAgICAgIHg6IGF4ICsgdDEgKiBkeCwKICAgICAgICB5OiBheSArIHQxICogZHkKICAgICAgfTsKICAgICAgcmV0dXJuIGxpbmU7CiAgICB9OwogIH0KICB2YXIgZDNfZ2VvX2NsaXBFeHRlbnRNQVggPSAxZTk7CiAgZDMuZ2VvLmNsaXBFeHRlbnQgPSBmdW5jdGlvbigpIHsKICAgIHZhciB4MCwgeTAsIHgxLCB5MSwgc3RyZWFtLCBjbGlwLCBjbGlwRXh0ZW50ID0gewogICAgICBzdHJlYW06IGZ1bmN0aW9uKG91dHB1dCkgewogICAgICAgIGlmIChzdHJlYW0pIHN0cmVhbS52YWxpZCA9IGZhbHNlOwogICAgICAgIHN0cmVhbSA9IGNsaXAob3V0cHV0KTsKICAgICAgICBzdHJlYW0udmFsaWQgPSB0cnVlOwogICAgICAgIHJldHVybiBzdHJlYW07CiAgICAgIH0sCiAgICAgIGV4dGVudDogZnVuY3Rpb24oXykgewogICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIFsgWyB4MCwgeTAgXSwgWyB4MSwgeTEgXSBdOwogICAgICAgIGNsaXAgPSBkM19nZW9fY2xpcEV4dGVudCh4MCA9ICtfWzBdWzBdLCB5MCA9ICtfWzBdWzFdLCB4MSA9ICtfWzFdWzBdLCB5MSA9ICtfWzFdWzFdKTsKICAgICAgICBpZiAoc3RyZWFtKSBzdHJlYW0udmFsaWQgPSBmYWxzZSwgc3RyZWFtID0gbnVsbDsKICAgICAgICByZXR1cm4gY2xpcEV4dGVudDsKICAgICAgfQogICAgfTsKICAgIHJldHVybiBjbGlwRXh0ZW50LmV4dGVudChbIFsgMCwgMCBdLCBbIDk2MCwgNTAwIF0gXSk7CiAgfTsKICBmdW5jdGlvbiBkM19nZW9fY2xpcEV4dGVudCh4MCwgeTAsIHgxLCB5MSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKGxpc3RlbmVyKSB7CiAgICAgIHZhciBsaXN0ZW5lcl8gPSBsaXN0ZW5lciwgYnVmZmVyTGlzdGVuZXIgPSBkM19nZW9fY2xpcEJ1ZmZlckxpc3RlbmVyKCksIGNsaXBMaW5lID0gZDNfZ2VvbV9jbGlwTGluZSh4MCwgeTAsIHgxLCB5MSksIHNlZ21lbnRzLCBwb2x5Z29uLCByaW5nOwogICAgICB2YXIgY2xpcCA9IHsKICAgICAgICBwb2ludDogcG9pbnQsCiAgICAgICAgbGluZVN0YXJ0OiBsaW5lU3RhcnQsCiAgICAgICAgbGluZUVuZDogbGluZUVuZCwKICAgICAgICBwb2x5Z29uU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgbGlzdGVuZXIgPSBidWZmZXJMaXN0ZW5lcjsKICAgICAgICAgIHNlZ21lbnRzID0gW107CiAgICAgICAgICBwb2x5Z29uID0gW107CiAgICAgICAgICBjbGVhbiA9IHRydWU7CiAgICAgICAgfSwKICAgICAgICBwb2x5Z29uRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGxpc3RlbmVyID0gbGlzdGVuZXJfOwogICAgICAgICAgc2VnbWVudHMgPSBkMy5tZXJnZShzZWdtZW50cyk7CiAgICAgICAgICB2YXIgY2xpcFN0YXJ0SW5zaWRlID0gaW5zaWRlUG9seWdvbihbIHgwLCB5MSBdKSwgaW5zaWRlID0gY2xlYW4gJiYgY2xpcFN0YXJ0SW5zaWRlLCB2aXNpYmxlID0gc2VnbWVudHMubGVuZ3RoOwogICAgICAgICAgaWYgKGluc2lkZSB8fCB2aXNpYmxlKSB7CiAgICAgICAgICAgIGxpc3RlbmVyLnBvbHlnb25TdGFydCgpOwogICAgICAgICAgICBpZiAoaW5zaWRlKSB7CiAgICAgICAgICAgICAgbGlzdGVuZXIubGluZVN0YXJ0KCk7CiAgICAgICAgICAgICAgaW50ZXJwb2xhdGUobnVsbCwgbnVsbCwgMSwgbGlzdGVuZXIpOwogICAgICAgICAgICAgIGxpc3RlbmVyLmxpbmVFbmQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodmlzaWJsZSkgewogICAgICAgICAgICAgIGQzX2dlb19jbGlwUG9seWdvbihzZWdtZW50cywgY29tcGFyZSwgY2xpcFN0YXJ0SW5zaWRlLCBpbnRlcnBvbGF0ZSwgbGlzdGVuZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxpc3RlbmVyLnBvbHlnb25FbmQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHNlZ21lbnRzID0gcG9seWdvbiA9IHJpbmcgPSBudWxsOwogICAgICAgIH0KICAgICAgfTsKICAgICAgZnVuY3Rpb24gaW5zaWRlUG9seWdvbihwKSB7CiAgICAgICAgdmFyIHduID0gMCwgbiA9IHBvbHlnb24ubGVuZ3RoLCB5ID0gcFsxXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG47ICsraSkgewogICAgICAgICAgZm9yICh2YXIgaiA9IDEsIHYgPSBwb2x5Z29uW2ldLCBtID0gdi5sZW5ndGgsIGEgPSB2WzBdLCBiOyBqIDwgbTsgKytqKSB7CiAgICAgICAgICAgIGIgPSB2W2pdOwogICAgICAgICAgICBpZiAoYVsxXSA8PSB5KSB7CiAgICAgICAgICAgICAgaWYgKGJbMV0gPiB5ICYmIGQzX2Nyb3NzMmQoYSwgYiwgcCkgPiAwKSArK3duOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmIChiWzFdIDw9IHkgJiYgZDNfY3Jvc3MyZChhLCBiLCBwKSA8IDApIC0td247CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYSA9IGI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB3biAhPT0gMDsKICAgICAgfQogICAgICBmdW5jdGlvbiBpbnRlcnBvbGF0ZShmcm9tLCB0bywgZGlyZWN0aW9uLCBsaXN0ZW5lcikgewogICAgICAgIHZhciBhID0gMCwgYTEgPSAwOwogICAgICAgIGlmIChmcm9tID09IG51bGwgfHwgKGEgPSBjb3JuZXIoZnJvbSwgZGlyZWN0aW9uKSkgIT09IChhMSA9IGNvcm5lcih0bywgZGlyZWN0aW9uKSkgfHwgY29tcGFyZVBvaW50cyhmcm9tLCB0bykgPCAwIF4gZGlyZWN0aW9uID4gMCkgewogICAgICAgICAgZG8gewogICAgICAgICAgICBsaXN0ZW5lci5wb2ludChhID09PSAwIHx8IGEgPT09IDMgPyB4MCA6IHgxLCBhID4gMSA/IHkxIDogeTApOwogICAgICAgICAgfSB3aGlsZSAoKGEgPSAoYSArIGRpcmVjdGlvbiArIDQpICUgNCkgIT09IGExKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGlzdGVuZXIucG9pbnQodG9bMF0sIHRvWzFdKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcG9pbnRWaXNpYmxlKHgsIHkpIHsKICAgICAgICByZXR1cm4geDAgPD0geCAmJiB4IDw9IHgxICYmIHkwIDw9IHkgJiYgeSA8PSB5MTsKICAgICAgfQogICAgICBmdW5jdGlvbiBwb2ludCh4LCB5KSB7CiAgICAgICAgaWYgKHBvaW50VmlzaWJsZSh4LCB5KSkgbGlzdGVuZXIucG9pbnQoeCwgeSk7CiAgICAgIH0KICAgICAgdmFyIHhfXywgeV9fLCB2X18sIHhfLCB5Xywgdl8sIGZpcnN0LCBjbGVhbjsKICAgICAgZnVuY3Rpb24gbGluZVN0YXJ0KCkgewogICAgICAgIGNsaXAucG9pbnQgPSBsaW5lUG9pbnQ7CiAgICAgICAgaWYgKHBvbHlnb24pIHBvbHlnb24ucHVzaChyaW5nID0gW10pOwogICAgICAgIGZpcnN0ID0gdHJ1ZTsKICAgICAgICB2XyA9IGZhbHNlOwogICAgICAgIHhfID0geV8gPSBOYU47CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbGluZUVuZCgpIHsKICAgICAgICBpZiAoc2VnbWVudHMpIHsKICAgICAgICAgIGxpbmVQb2ludCh4X18sIHlfXyk7CiAgICAgICAgICBpZiAodl9fICYmIHZfKSBidWZmZXJMaXN0ZW5lci5yZWpvaW4oKTsKICAgICAgICAgIHNlZ21lbnRzLnB1c2goYnVmZmVyTGlzdGVuZXIuYnVmZmVyKCkpOwogICAgICAgIH0KICAgICAgICBjbGlwLnBvaW50ID0gcG9pbnQ7CiAgICAgICAgaWYgKHZfKSBsaXN0ZW5lci5saW5lRW5kKCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbGluZVBvaW50KHgsIHkpIHsKICAgICAgICB4ID0gTWF0aC5tYXgoLWQzX2dlb19jbGlwRXh0ZW50TUFYLCBNYXRoLm1pbihkM19nZW9fY2xpcEV4dGVudE1BWCwgeCkpOwogICAgICAgIHkgPSBNYXRoLm1heCgtZDNfZ2VvX2NsaXBFeHRlbnRNQVgsIE1hdGgubWluKGQzX2dlb19jbGlwRXh0ZW50TUFYLCB5KSk7CiAgICAgICAgdmFyIHYgPSBwb2ludFZpc2libGUoeCwgeSk7CiAgICAgICAgaWYgKHBvbHlnb24pIHJpbmcucHVzaChbIHgsIHkgXSk7CiAgICAgICAgaWYgKGZpcnN0KSB7CiAgICAgICAgICB4X18gPSB4LCB5X18gPSB5LCB2X18gPSB2OwogICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgICAgICAgIGlmICh2KSB7CiAgICAgICAgICAgIGxpc3RlbmVyLmxpbmVTdGFydCgpOwogICAgICAgICAgICBsaXN0ZW5lci5wb2ludCh4LCB5KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHYgJiYgdl8pIGxpc3RlbmVyLnBvaW50KHgsIHkpOyBlbHNlIHsKICAgICAgICAgICAgdmFyIGwgPSB7CiAgICAgICAgICAgICAgYTogewogICAgICAgICAgICAgICAgeDogeF8sCiAgICAgICAgICAgICAgICB5OiB5XwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgYjogewogICAgICAgICAgICAgICAgeDogeCwKICAgICAgICAgICAgICAgIHk6IHkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChjbGlwTGluZShsKSkgewogICAgICAgICAgICAgIGlmICghdl8pIHsKICAgICAgICAgICAgICAgIGxpc3RlbmVyLmxpbmVTdGFydCgpOwogICAgICAgICAgICAgICAgbGlzdGVuZXIucG9pbnQobC5hLngsIGwuYS55KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbGlzdGVuZXIucG9pbnQobC5iLngsIGwuYi55KTsKICAgICAgICAgICAgICBpZiAoIXYpIGxpc3RlbmVyLmxpbmVFbmQoKTsKICAgICAgICAgICAgICBjbGVhbiA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgaWYgKHYpIHsKICAgICAgICAgICAgICBsaXN0ZW5lci5saW5lU3RhcnQoKTsKICAgICAgICAgICAgICBsaXN0ZW5lci5wb2ludCh4LCB5KTsKICAgICAgICAgICAgICBjbGVhbiA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHhfID0geCwgeV8gPSB5LCB2XyA9IHY7CiAgICAgIH0KICAgICAgcmV0dXJuIGNsaXA7CiAgICB9OwogICAgZnVuY3Rpb24gY29ybmVyKHAsIGRpcmVjdGlvbikgewogICAgICByZXR1cm4gYWJzKHBbMF0gLSB4MCkgPCDOtSA/IGRpcmVjdGlvbiA+IDAgPyAwIDogMyA6IGFicyhwWzBdIC0geDEpIDwgzrUgPyBkaXJlY3Rpb24gPiAwID8gMiA6IDEgOiBhYnMocFsxXSAtIHkwKSA8IM61ID8gZGlyZWN0aW9uID4gMCA/IDEgOiAwIDogZGlyZWN0aW9uID4gMCA/IDMgOiAyOwogICAgfQogICAgZnVuY3Rpb24gY29tcGFyZShhLCBiKSB7CiAgICAgIHJldHVybiBjb21wYXJlUG9pbnRzKGEueCwgYi54KTsKICAgIH0KICAgIGZ1bmN0aW9uIGNvbXBhcmVQb2ludHMoYSwgYikgewogICAgICB2YXIgY2EgPSBjb3JuZXIoYSwgMSksIGNiID0gY29ybmVyKGIsIDEpOwogICAgICByZXR1cm4gY2EgIT09IGNiID8gY2EgLSBjYiA6IGNhID09PSAwID8gYlsxXSAtIGFbMV0gOiBjYSA9PT0gMSA/IGFbMF0gLSBiWzBdIDogY2EgPT09IDIgPyBhWzFdIC0gYlsxXSA6IGJbMF0gLSBhWzBdOwogICAgfQogIH0KICBmdW5jdGlvbiBkM19nZW9fY29uaWMocHJvamVjdEF0KSB7CiAgICB2YXIgz4YwID0gMCwgz4YxID0gz4AgLyAzLCBtID0gZDNfZ2VvX3Byb2plY3Rpb25NdXRhdG9yKHByb2plY3RBdCksIHAgPSBtKM+GMCwgz4YxKTsKICAgIHAucGFyYWxsZWxzID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBbIM+GMCAvIM+AICogMTgwLCDPhjEgLyDPgCAqIDE4MCBdOwogICAgICByZXR1cm4gbSjPhjAgPSBfWzBdICogz4AgLyAxODAsIM+GMSA9IF9bMV0gKiDPgCAvIDE4MCk7CiAgICB9OwogICAgcmV0dXJuIHA7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19jb25pY0VxdWFsQXJlYSjPhjAsIM+GMSkgewogICAgdmFyIHNpbs+GMCA9IE1hdGguc2luKM+GMCksIG4gPSAoc2luz4YwICsgTWF0aC5zaW4oz4YxKSkgLyAyLCBDID0gMSArIHNpbs+GMCAqICgyICogbiAtIHNpbs+GMCksIM+BMCA9IE1hdGguc3FydChDKSAvIG47CiAgICBmdW5jdGlvbiBmb3J3YXJkKM67LCDPhikgewogICAgICB2YXIgz4EgPSBNYXRoLnNxcnQoQyAtIDIgKiBuICogTWF0aC5zaW4oz4YpKSAvIG47CiAgICAgIHJldHVybiBbIM+BICogTWF0aC5zaW4ozrsgKj0gbiksIM+BMCAtIM+BICogTWF0aC5jb3MozrspIF07CiAgICB9CiAgICBmb3J3YXJkLmludmVydCA9IGZ1bmN0aW9uKHgsIHkpIHsKICAgICAgdmFyIM+BMF95ID0gz4EwIC0geTsKICAgICAgcmV0dXJuIFsgTWF0aC5hdGFuMih4LCDPgTBfeSkgLyBuLCBkM19hc2luKChDIC0gKHggKiB4ICsgz4EwX3kgKiDPgTBfeSkgKiBuICogbikgLyAoMiAqIG4pKSBdOwogICAgfTsKICAgIHJldHVybiBmb3J3YXJkOwogIH0KICAoZDMuZ2VvLmNvbmljRXF1YWxBcmVhID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZDNfZ2VvX2NvbmljKGQzX2dlb19jb25pY0VxdWFsQXJlYSk7CiAgfSkucmF3ID0gZDNfZ2VvX2NvbmljRXF1YWxBcmVhOwogIGQzLmdlby5hbGJlcnMgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkMy5nZW8uY29uaWNFcXVhbEFyZWEoKS5yb3RhdGUoWyA5NiwgMCBdKS5jZW50ZXIoWyAtLjYsIDM4LjcgXSkucGFyYWxsZWxzKFsgMjkuNSwgNDUuNSBdKS5zY2FsZSgxMDcwKTsKICB9OwogIGQzLmdlby5hbGJlcnNVc2EgPSBmdW5jdGlvbigpIHsKICAgIHZhciBsb3dlcjQ4ID0gZDMuZ2VvLmFsYmVycygpOwogICAgdmFyIGFsYXNrYSA9IGQzLmdlby5jb25pY0VxdWFsQXJlYSgpLnJvdGF0ZShbIDE1NCwgMCBdKS5jZW50ZXIoWyAtMiwgNTguNSBdKS5wYXJhbGxlbHMoWyA1NSwgNjUgXSk7CiAgICB2YXIgaGF3YWlpID0gZDMuZ2VvLmNvbmljRXF1YWxBcmVhKCkucm90YXRlKFsgMTU3LCAwIF0pLmNlbnRlcihbIC0zLCAxOS45IF0pLnBhcmFsbGVscyhbIDgsIDE4IF0pOwogICAgdmFyIHBvaW50LCBwb2ludFN0cmVhbSA9IHsKICAgICAgcG9pbnQ6IGZ1bmN0aW9uKHgsIHkpIHsKICAgICAgICBwb2ludCA9IFsgeCwgeSBdOwogICAgICB9CiAgICB9LCBsb3dlcjQ4UG9pbnQsIGFsYXNrYVBvaW50LCBoYXdhaWlQb2ludDsKICAgIGZ1bmN0aW9uIGFsYmVyc1VzYShjb29yZGluYXRlcykgewogICAgICB2YXIgeCA9IGNvb3JkaW5hdGVzWzBdLCB5ID0gY29vcmRpbmF0ZXNbMV07CiAgICAgIHBvaW50ID0gbnVsbDsKICAgICAgKGxvd2VyNDhQb2ludCh4LCB5KSwgcG9pbnQpIHx8IChhbGFza2FQb2ludCh4LCB5KSwgcG9pbnQpIHx8IGhhd2FpaVBvaW50KHgsIHkpOwogICAgICByZXR1cm4gcG9pbnQ7CiAgICB9CiAgICBhbGJlcnNVc2EuaW52ZXJ0ID0gZnVuY3Rpb24oY29vcmRpbmF0ZXMpIHsKICAgICAgdmFyIGsgPSBsb3dlcjQ4LnNjYWxlKCksIHQgPSBsb3dlcjQ4LnRyYW5zbGF0ZSgpLCB4ID0gKGNvb3JkaW5hdGVzWzBdIC0gdFswXSkgLyBrLCB5ID0gKGNvb3JkaW5hdGVzWzFdIC0gdFsxXSkgLyBrOwogICAgICByZXR1cm4gKHkgPj0gLjEyICYmIHkgPCAuMjM0ICYmIHggPj0gLS40MjUgJiYgeCA8IC0uMjE0ID8gYWxhc2thIDogeSA+PSAuMTY2ICYmIHkgPCAuMjM0ICYmIHggPj0gLS4yMTQgJiYgeCA8IC0uMTE1ID8gaGF3YWlpIDogbG93ZXI0OCkuaW52ZXJ0KGNvb3JkaW5hdGVzKTsKICAgIH07CiAgICBhbGJlcnNVc2Euc3RyZWFtID0gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAgIHZhciBsb3dlcjQ4U3RyZWFtID0gbG93ZXI0OC5zdHJlYW0oc3RyZWFtKSwgYWxhc2thU3RyZWFtID0gYWxhc2thLnN0cmVhbShzdHJlYW0pLCBoYXdhaWlTdHJlYW0gPSBoYXdhaWkuc3RyZWFtKHN0cmVhbSk7CiAgICAgIHJldHVybiB7CiAgICAgICAgcG9pbnQ6IGZ1bmN0aW9uKHgsIHkpIHsKICAgICAgICAgIGxvd2VyNDhTdHJlYW0ucG9pbnQoeCwgeSk7CiAgICAgICAgICBhbGFza2FTdHJlYW0ucG9pbnQoeCwgeSk7CiAgICAgICAgICBoYXdhaWlTdHJlYW0ucG9pbnQoeCwgeSk7CiAgICAgICAgfSwKICAgICAgICBzcGhlcmU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgbG93ZXI0OFN0cmVhbS5zcGhlcmUoKTsKICAgICAgICAgIGFsYXNrYVN0cmVhbS5zcGhlcmUoKTsKICAgICAgICAgIGhhd2FpaVN0cmVhbS5zcGhlcmUoKTsKICAgICAgICB9LAogICAgICAgIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBsb3dlcjQ4U3RyZWFtLmxpbmVTdGFydCgpOwogICAgICAgICAgYWxhc2thU3RyZWFtLmxpbmVTdGFydCgpOwogICAgICAgICAgaGF3YWlpU3RyZWFtLmxpbmVTdGFydCgpOwogICAgICAgIH0sCiAgICAgICAgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBsb3dlcjQ4U3RyZWFtLmxpbmVFbmQoKTsKICAgICAgICAgIGFsYXNrYVN0cmVhbS5saW5lRW5kKCk7CiAgICAgICAgICBoYXdhaWlTdHJlYW0ubGluZUVuZCgpOwogICAgICAgIH0sCiAgICAgICAgcG9seWdvblN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICAgIGxvd2VyNDhTdHJlYW0ucG9seWdvblN0YXJ0KCk7CiAgICAgICAgICBhbGFza2FTdHJlYW0ucG9seWdvblN0YXJ0KCk7CiAgICAgICAgICBoYXdhaWlTdHJlYW0ucG9seWdvblN0YXJ0KCk7CiAgICAgICAgfSwKICAgICAgICBwb2x5Z29uRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGxvd2VyNDhTdHJlYW0ucG9seWdvbkVuZCgpOwogICAgICAgICAgYWxhc2thU3RyZWFtLnBvbHlnb25FbmQoKTsKICAgICAgICAgIGhhd2FpaVN0cmVhbS5wb2x5Z29uRW5kKCk7CiAgICAgICAgfQogICAgICB9OwogICAgfTsKICAgIGFsYmVyc1VzYS5wcmVjaXNpb24gPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGxvd2VyNDgucHJlY2lzaW9uKCk7CiAgICAgIGxvd2VyNDgucHJlY2lzaW9uKF8pOwogICAgICBhbGFza2EucHJlY2lzaW9uKF8pOwogICAgICBoYXdhaWkucHJlY2lzaW9uKF8pOwogICAgICByZXR1cm4gYWxiZXJzVXNhOwogICAgfTsKICAgIGFsYmVyc1VzYS5zY2FsZSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gbG93ZXI0OC5zY2FsZSgpOwogICAgICBsb3dlcjQ4LnNjYWxlKF8pOwogICAgICBhbGFza2Euc2NhbGUoXyAqIC4zNSk7CiAgICAgIGhhd2FpaS5zY2FsZShfKTsKICAgICAgcmV0dXJuIGFsYmVyc1VzYS50cmFuc2xhdGUobG93ZXI0OC50cmFuc2xhdGUoKSk7CiAgICB9OwogICAgYWxiZXJzVXNhLnRyYW5zbGF0ZSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gbG93ZXI0OC50cmFuc2xhdGUoKTsKICAgICAgdmFyIGsgPSBsb3dlcjQ4LnNjYWxlKCksIHggPSArX1swXSwgeSA9ICtfWzFdOwogICAgICBsb3dlcjQ4UG9pbnQgPSBsb3dlcjQ4LnRyYW5zbGF0ZShfKS5jbGlwRXh0ZW50KFsgWyB4IC0gLjQ1NSAqIGssIHkgLSAuMjM4ICogayBdLCBbIHggKyAuNDU1ICogaywgeSArIC4yMzggKiBrIF0gXSkuc3RyZWFtKHBvaW50U3RyZWFtKS5wb2ludDsKICAgICAgYWxhc2thUG9pbnQgPSBhbGFza2EudHJhbnNsYXRlKFsgeCAtIC4zMDcgKiBrLCB5ICsgLjIwMSAqIGsgXSkuY2xpcEV4dGVudChbIFsgeCAtIC40MjUgKiBrICsgzrUsIHkgKyAuMTIgKiBrICsgzrUgXSwgWyB4IC0gLjIxNCAqIGsgLSDOtSwgeSArIC4yMzQgKiBrIC0gzrUgXSBdKS5zdHJlYW0ocG9pbnRTdHJlYW0pLnBvaW50OwogICAgICBoYXdhaWlQb2ludCA9IGhhd2FpaS50cmFuc2xhdGUoWyB4IC0gLjIwNSAqIGssIHkgKyAuMjEyICogayBdKS5jbGlwRXh0ZW50KFsgWyB4IC0gLjIxNCAqIGsgKyDOtSwgeSArIC4xNjYgKiBrICsgzrUgXSwgWyB4IC0gLjExNSAqIGsgLSDOtSwgeSArIC4yMzQgKiBrIC0gzrUgXSBdKS5zdHJlYW0ocG9pbnRTdHJlYW0pLnBvaW50OwogICAgICByZXR1cm4gYWxiZXJzVXNhOwogICAgfTsKICAgIHJldHVybiBhbGJlcnNVc2Euc2NhbGUoMTA3MCk7CiAgfTsKICB2YXIgZDNfZ2VvX3BhdGhBcmVhU3VtLCBkM19nZW9fcGF0aEFyZWFQb2x5Z29uLCBkM19nZW9fcGF0aEFyZWEgPSB7CiAgICBwb2ludDogZDNfbm9vcCwKICAgIGxpbmVTdGFydDogZDNfbm9vcCwKICAgIGxpbmVFbmQ6IGQzX25vb3AsCiAgICBwb2x5Z29uU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICBkM19nZW9fcGF0aEFyZWFQb2x5Z29uID0gMDsKICAgICAgZDNfZ2VvX3BhdGhBcmVhLmxpbmVTdGFydCA9IGQzX2dlb19wYXRoQXJlYVJpbmdTdGFydDsKICAgIH0sCiAgICBwb2x5Z29uRW5kOiBmdW5jdGlvbigpIHsKICAgICAgZDNfZ2VvX3BhdGhBcmVhLmxpbmVTdGFydCA9IGQzX2dlb19wYXRoQXJlYS5saW5lRW5kID0gZDNfZ2VvX3BhdGhBcmVhLnBvaW50ID0gZDNfbm9vcDsKICAgICAgZDNfZ2VvX3BhdGhBcmVhU3VtICs9IGFicyhkM19nZW9fcGF0aEFyZWFQb2x5Z29uIC8gMik7CiAgICB9CiAgfTsKICBmdW5jdGlvbiBkM19nZW9fcGF0aEFyZWFSaW5nU3RhcnQoKSB7CiAgICB2YXIgeDAwLCB5MDAsIHgwLCB5MDsKICAgIGQzX2dlb19wYXRoQXJlYS5wb2ludCA9IGZ1bmN0aW9uKHgsIHkpIHsKICAgICAgZDNfZ2VvX3BhdGhBcmVhLnBvaW50ID0gbmV4dFBvaW50OwogICAgICB4MDAgPSB4MCA9IHgsIHkwMCA9IHkwID0geTsKICAgIH07CiAgICBmdW5jdGlvbiBuZXh0UG9pbnQoeCwgeSkgewogICAgICBkM19nZW9fcGF0aEFyZWFQb2x5Z29uICs9IHkwICogeCAtIHgwICogeTsKICAgICAgeDAgPSB4LCB5MCA9IHk7CiAgICB9CiAgICBkM19nZW9fcGF0aEFyZWEubGluZUVuZCA9IGZ1bmN0aW9uKCkgewogICAgICBuZXh0UG9pbnQoeDAwLCB5MDApOwogICAgfTsKICB9CiAgdmFyIGQzX2dlb19wYXRoQm91bmRzWDAsIGQzX2dlb19wYXRoQm91bmRzWTAsIGQzX2dlb19wYXRoQm91bmRzWDEsIGQzX2dlb19wYXRoQm91bmRzWTE7CiAgdmFyIGQzX2dlb19wYXRoQm91bmRzID0gewogICAgcG9pbnQ6IGQzX2dlb19wYXRoQm91bmRzUG9pbnQsCiAgICBsaW5lU3RhcnQ6IGQzX25vb3AsCiAgICBsaW5lRW5kOiBkM19ub29wLAogICAgcG9seWdvblN0YXJ0OiBkM19ub29wLAogICAgcG9seWdvbkVuZDogZDNfbm9vcAogIH07CiAgZnVuY3Rpb24gZDNfZ2VvX3BhdGhCb3VuZHNQb2ludCh4LCB5KSB7CiAgICBpZiAoeCA8IGQzX2dlb19wYXRoQm91bmRzWDApIGQzX2dlb19wYXRoQm91bmRzWDAgPSB4OwogICAgaWYgKHggPiBkM19nZW9fcGF0aEJvdW5kc1gxKSBkM19nZW9fcGF0aEJvdW5kc1gxID0geDsKICAgIGlmICh5IDwgZDNfZ2VvX3BhdGhCb3VuZHNZMCkgZDNfZ2VvX3BhdGhCb3VuZHNZMCA9IHk7CiAgICBpZiAoeSA+IGQzX2dlb19wYXRoQm91bmRzWTEpIGQzX2dlb19wYXRoQm91bmRzWTEgPSB5OwogIH0KICBmdW5jdGlvbiBkM19nZW9fcGF0aEJ1ZmZlcigpIHsKICAgIHZhciBwb2ludENpcmNsZSA9IGQzX2dlb19wYXRoQnVmZmVyQ2lyY2xlKDQuNSksIGJ1ZmZlciA9IFtdOwogICAgdmFyIHN0cmVhbSA9IHsKICAgICAgcG9pbnQ6IHBvaW50LAogICAgICBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHN0cmVhbS5wb2ludCA9IHBvaW50TGluZVN0YXJ0OwogICAgICB9LAogICAgICBsaW5lRW5kOiBsaW5lRW5kLAogICAgICBwb2x5Z29uU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHN0cmVhbS5saW5lRW5kID0gbGluZUVuZFBvbHlnb247CiAgICAgIH0sCiAgICAgIHBvbHlnb25FbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHN0cmVhbS5saW5lRW5kID0gbGluZUVuZDsKICAgICAgICBzdHJlYW0ucG9pbnQgPSBwb2ludDsKICAgICAgfSwKICAgICAgcG9pbnRSYWRpdXM6IGZ1bmN0aW9uKF8pIHsKICAgICAgICBwb2ludENpcmNsZSA9IGQzX2dlb19wYXRoQnVmZmVyQ2lyY2xlKF8pOwogICAgICAgIHJldHVybiBzdHJlYW07CiAgICAgIH0sCiAgICAgIHJlc3VsdDogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKGJ1ZmZlci5sZW5ndGgpIHsKICAgICAgICAgIHZhciByZXN1bHQgPSBidWZmZXIuam9pbigiIik7CiAgICAgICAgICBidWZmZXIgPSBbXTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgZnVuY3Rpb24gcG9pbnQoeCwgeSkgewogICAgICBidWZmZXIucHVzaCgiTSIsIHgsICIsIiwgeSwgcG9pbnRDaXJjbGUpOwogICAgfQogICAgZnVuY3Rpb24gcG9pbnRMaW5lU3RhcnQoeCwgeSkgewogICAgICBidWZmZXIucHVzaCgiTSIsIHgsICIsIiwgeSk7CiAgICAgIHN0cmVhbS5wb2ludCA9IHBvaW50TGluZTsKICAgIH0KICAgIGZ1bmN0aW9uIHBvaW50TGluZSh4LCB5KSB7CiAgICAgIGJ1ZmZlci5wdXNoKCJMIiwgeCwgIiwiLCB5KTsKICAgIH0KICAgIGZ1bmN0aW9uIGxpbmVFbmQoKSB7CiAgICAgIHN0cmVhbS5wb2ludCA9IHBvaW50OwogICAgfQogICAgZnVuY3Rpb24gbGluZUVuZFBvbHlnb24oKSB7CiAgICAgIGJ1ZmZlci5wdXNoKCJaIik7CiAgICB9CiAgICByZXR1cm4gc3RyZWFtOwogIH0KICBmdW5jdGlvbiBkM19nZW9fcGF0aEJ1ZmZlckNpcmNsZShyYWRpdXMpIHsKICAgIHJldHVybiAibTAsIiArIHJhZGl1cyArICJhIiArIHJhZGl1cyArICIsIiArIHJhZGl1cyArICIgMCAxLDEgMCwiICsgLTIgKiByYWRpdXMgKyAiYSIgKyByYWRpdXMgKyAiLCIgKyByYWRpdXMgKyAiIDAgMSwxIDAsIiArIDIgKiByYWRpdXMgKyAieiI7CiAgfQogIHZhciBkM19nZW9fcGF0aENlbnRyb2lkID0gewogICAgcG9pbnQ6IGQzX2dlb19wYXRoQ2VudHJvaWRQb2ludCwKICAgIGxpbmVTdGFydDogZDNfZ2VvX3BhdGhDZW50cm9pZExpbmVTdGFydCwKICAgIGxpbmVFbmQ6IGQzX2dlb19wYXRoQ2VudHJvaWRMaW5lRW5kLAogICAgcG9seWdvblN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgZDNfZ2VvX3BhdGhDZW50cm9pZC5saW5lU3RhcnQgPSBkM19nZW9fcGF0aENlbnRyb2lkUmluZ1N0YXJ0OwogICAgfSwKICAgIHBvbHlnb25FbmQ6IGZ1bmN0aW9uKCkgewogICAgICBkM19nZW9fcGF0aENlbnRyb2lkLnBvaW50ID0gZDNfZ2VvX3BhdGhDZW50cm9pZFBvaW50OwogICAgICBkM19nZW9fcGF0aENlbnRyb2lkLmxpbmVTdGFydCA9IGQzX2dlb19wYXRoQ2VudHJvaWRMaW5lU3RhcnQ7CiAgICAgIGQzX2dlb19wYXRoQ2VudHJvaWQubGluZUVuZCA9IGQzX2dlb19wYXRoQ2VudHJvaWRMaW5lRW5kOwogICAgfQogIH07CiAgZnVuY3Rpb24gZDNfZ2VvX3BhdGhDZW50cm9pZFBvaW50KHgsIHkpIHsKICAgIGQzX2dlb19jZW50cm9pZFgwICs9IHg7CiAgICBkM19nZW9fY2VudHJvaWRZMCArPSB5OwogICAgKytkM19nZW9fY2VudHJvaWRaMDsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX3BhdGhDZW50cm9pZExpbmVTdGFydCgpIHsKICAgIHZhciB4MCwgeTA7CiAgICBkM19nZW9fcGF0aENlbnRyb2lkLnBvaW50ID0gZnVuY3Rpb24oeCwgeSkgewogICAgICBkM19nZW9fcGF0aENlbnRyb2lkLnBvaW50ID0gbmV4dFBvaW50OwogICAgICBkM19nZW9fcGF0aENlbnRyb2lkUG9pbnQoeDAgPSB4LCB5MCA9IHkpOwogICAgfTsKICAgIGZ1bmN0aW9uIG5leHRQb2ludCh4LCB5KSB7CiAgICAgIHZhciBkeCA9IHggLSB4MCwgZHkgPSB5IC0geTAsIHogPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpOwogICAgICBkM19nZW9fY2VudHJvaWRYMSArPSB6ICogKHgwICsgeCkgLyAyOwogICAgICBkM19nZW9fY2VudHJvaWRZMSArPSB6ICogKHkwICsgeSkgLyAyOwogICAgICBkM19nZW9fY2VudHJvaWRaMSArPSB6OwogICAgICBkM19nZW9fcGF0aENlbnRyb2lkUG9pbnQoeDAgPSB4LCB5MCA9IHkpOwogICAgfQogIH0KICBmdW5jdGlvbiBkM19nZW9fcGF0aENlbnRyb2lkTGluZUVuZCgpIHsKICAgIGQzX2dlb19wYXRoQ2VudHJvaWQucG9pbnQgPSBkM19nZW9fcGF0aENlbnRyb2lkUG9pbnQ7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19wYXRoQ2VudHJvaWRSaW5nU3RhcnQoKSB7CiAgICB2YXIgeDAwLCB5MDAsIHgwLCB5MDsKICAgIGQzX2dlb19wYXRoQ2VudHJvaWQucG9pbnQgPSBmdW5jdGlvbih4LCB5KSB7CiAgICAgIGQzX2dlb19wYXRoQ2VudHJvaWQucG9pbnQgPSBuZXh0UG9pbnQ7CiAgICAgIGQzX2dlb19wYXRoQ2VudHJvaWRQb2ludCh4MDAgPSB4MCA9IHgsIHkwMCA9IHkwID0geSk7CiAgICB9OwogICAgZnVuY3Rpb24gbmV4dFBvaW50KHgsIHkpIHsKICAgICAgdmFyIGR4ID0geCAtIHgwLCBkeSA9IHkgLSB5MCwgeiA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7CiAgICAgIGQzX2dlb19jZW50cm9pZFgxICs9IHogKiAoeDAgKyB4KSAvIDI7CiAgICAgIGQzX2dlb19jZW50cm9pZFkxICs9IHogKiAoeTAgKyB5KSAvIDI7CiAgICAgIGQzX2dlb19jZW50cm9pZFoxICs9IHo7CiAgICAgIHogPSB5MCAqIHggLSB4MCAqIHk7CiAgICAgIGQzX2dlb19jZW50cm9pZFgyICs9IHogKiAoeDAgKyB4KTsKICAgICAgZDNfZ2VvX2NlbnRyb2lkWTIgKz0geiAqICh5MCArIHkpOwogICAgICBkM19nZW9fY2VudHJvaWRaMiArPSB6ICogMzsKICAgICAgZDNfZ2VvX3BhdGhDZW50cm9pZFBvaW50KHgwID0geCwgeTAgPSB5KTsKICAgIH0KICAgIGQzX2dlb19wYXRoQ2VudHJvaWQubGluZUVuZCA9IGZ1bmN0aW9uKCkgewogICAgICBuZXh0UG9pbnQoeDAwLCB5MDApOwogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX3BhdGhDb250ZXh0KGNvbnRleHQpIHsKICAgIHZhciBwb2ludFJhZGl1cyA9IDQuNTsKICAgIHZhciBzdHJlYW0gPSB7CiAgICAgIHBvaW50OiBwb2ludCwKICAgICAgbGluZVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICBzdHJlYW0ucG9pbnQgPSBwb2ludExpbmVTdGFydDsKICAgICAgfSwKICAgICAgbGluZUVuZDogbGluZUVuZCwKICAgICAgcG9seWdvblN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICBzdHJlYW0ubGluZUVuZCA9IGxpbmVFbmRQb2x5Z29uOwogICAgICB9LAogICAgICBwb2x5Z29uRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICBzdHJlYW0ubGluZUVuZCA9IGxpbmVFbmQ7CiAgICAgICAgc3RyZWFtLnBvaW50ID0gcG9pbnQ7CiAgICAgIH0sCiAgICAgIHBvaW50UmFkaXVzOiBmdW5jdGlvbihfKSB7CiAgICAgICAgcG9pbnRSYWRpdXMgPSBfOwogICAgICAgIHJldHVybiBzdHJlYW07CiAgICAgIH0sCiAgICAgIHJlc3VsdDogZDNfbm9vcAogICAgfTsKICAgIGZ1bmN0aW9uIHBvaW50KHgsIHkpIHsKICAgICAgY29udGV4dC5tb3ZlVG8oeCArIHBvaW50UmFkaXVzLCB5KTsKICAgICAgY29udGV4dC5hcmMoeCwgeSwgcG9pbnRSYWRpdXMsIDAsIM+EKTsKICAgIH0KICAgIGZ1bmN0aW9uIHBvaW50TGluZVN0YXJ0KHgsIHkpIHsKICAgICAgY29udGV4dC5tb3ZlVG8oeCwgeSk7CiAgICAgIHN0cmVhbS5wb2ludCA9IHBvaW50TGluZTsKICAgIH0KICAgIGZ1bmN0aW9uIHBvaW50TGluZSh4LCB5KSB7CiAgICAgIGNvbnRleHQubGluZVRvKHgsIHkpOwogICAgfQogICAgZnVuY3Rpb24gbGluZUVuZCgpIHsKICAgICAgc3RyZWFtLnBvaW50ID0gcG9pbnQ7CiAgICB9CiAgICBmdW5jdGlvbiBsaW5lRW5kUG9seWdvbigpIHsKICAgICAgY29udGV4dC5jbG9zZVBhdGgoKTsKICAgIH0KICAgIHJldHVybiBzdHJlYW07CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19yZXNhbXBsZShwcm9qZWN0KSB7CiAgICB2YXIgzrQyID0gLjUsIGNvc01pbkRpc3RhbmNlID0gTWF0aC5jb3MoMzAgKiBkM19yYWRpYW5zKSwgbWF4RGVwdGggPSAxNjsKICAgIGZ1bmN0aW9uIHJlc2FtcGxlKHN0cmVhbSkgewogICAgICByZXR1cm4gKG1heERlcHRoID8gcmVzYW1wbGVSZWN1cnNpdmUgOiByZXNhbXBsZU5vbmUpKHN0cmVhbSk7CiAgICB9CiAgICBmdW5jdGlvbiByZXNhbXBsZU5vbmUoc3RyZWFtKSB7CiAgICAgIHJldHVybiBkM19nZW9fdHJhbnNmb3JtUG9pbnQoc3RyZWFtLCBmdW5jdGlvbih4LCB5KSB7CiAgICAgICAgeCA9IHByb2plY3QoeCwgeSk7CiAgICAgICAgc3RyZWFtLnBvaW50KHhbMF0sIHhbMV0pOwogICAgICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlc2FtcGxlUmVjdXJzaXZlKHN0cmVhbSkgewogICAgICB2YXIgzrswMCwgz4YwMCwgeDAwLCB5MDAsIGEwMCwgYjAwLCBjMDAsIM67MCwgeDAsIHkwLCBhMCwgYjAsIGMwOwogICAgICB2YXIgcmVzYW1wbGUgPSB7CiAgICAgICAgcG9pbnQ6IHBvaW50LAogICAgICAgIGxpbmVTdGFydDogbGluZVN0YXJ0LAogICAgICAgIGxpbmVFbmQ6IGxpbmVFbmQsCiAgICAgICAgcG9seWdvblN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICAgIHN0cmVhbS5wb2x5Z29uU3RhcnQoKTsKICAgICAgICAgIHJlc2FtcGxlLmxpbmVTdGFydCA9IHJpbmdTdGFydDsKICAgICAgICB9LAogICAgICAgIHBvbHlnb25FbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgc3RyZWFtLnBvbHlnb25FbmQoKTsKICAgICAgICAgIHJlc2FtcGxlLmxpbmVTdGFydCA9IGxpbmVTdGFydDsKICAgICAgICB9CiAgICAgIH07CiAgICAgIGZ1bmN0aW9uIHBvaW50KHgsIHkpIHsKICAgICAgICB4ID0gcHJvamVjdCh4LCB5KTsKICAgICAgICBzdHJlYW0ucG9pbnQoeFswXSwgeFsxXSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbGluZVN0YXJ0KCkgewogICAgICAgIHgwID0gTmFOOwogICAgICAgIHJlc2FtcGxlLnBvaW50ID0gbGluZVBvaW50OwogICAgICAgIHN0cmVhbS5saW5lU3RhcnQoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBsaW5lUG9pbnQozrssIM+GKSB7CiAgICAgICAgdmFyIGMgPSBkM19nZW9fY2FydGVzaWFuKFsgzrssIM+GIF0pLCBwID0gcHJvamVjdCjOuywgz4YpOwogICAgICAgIHJlc2FtcGxlTGluZVRvKHgwLCB5MCwgzrswLCBhMCwgYjAsIGMwLCB4MCA9IHBbMF0sIHkwID0gcFsxXSwgzrswID0gzrssIGEwID0gY1swXSwgYjAgPSBjWzFdLCBjMCA9IGNbMl0sIG1heERlcHRoLCBzdHJlYW0pOwogICAgICAgIHN0cmVhbS5wb2ludCh4MCwgeTApOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGxpbmVFbmQoKSB7CiAgICAgICAgcmVzYW1wbGUucG9pbnQgPSBwb2ludDsKICAgICAgICBzdHJlYW0ubGluZUVuZCgpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHJpbmdTdGFydCgpIHsKICAgICAgICBsaW5lU3RhcnQoKTsKICAgICAgICByZXNhbXBsZS5wb2ludCA9IHJpbmdQb2ludDsKICAgICAgICByZXNhbXBsZS5saW5lRW5kID0gcmluZ0VuZDsKICAgICAgfQogICAgICBmdW5jdGlvbiByaW5nUG9pbnQozrssIM+GKSB7CiAgICAgICAgbGluZVBvaW50KM67MDAgPSDOuywgz4YwMCA9IM+GKSwgeDAwID0geDAsIHkwMCA9IHkwLCBhMDAgPSBhMCwgYjAwID0gYjAsIGMwMCA9IGMwOwogICAgICAgIHJlc2FtcGxlLnBvaW50ID0gbGluZVBvaW50OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHJpbmdFbmQoKSB7CiAgICAgICAgcmVzYW1wbGVMaW5lVG8oeDAsIHkwLCDOuzAsIGEwLCBiMCwgYzAsIHgwMCwgeTAwLCDOuzAwLCBhMDAsIGIwMCwgYzAwLCBtYXhEZXB0aCwgc3RyZWFtKTsKICAgICAgICByZXNhbXBsZS5saW5lRW5kID0gbGluZUVuZDsKICAgICAgICBsaW5lRW5kKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc2FtcGxlOwogICAgfQogICAgZnVuY3Rpb24gcmVzYW1wbGVMaW5lVG8oeDAsIHkwLCDOuzAsIGEwLCBiMCwgYzAsIHgxLCB5MSwgzrsxLCBhMSwgYjEsIGMxLCBkZXB0aCwgc3RyZWFtKSB7CiAgICAgIHZhciBkeCA9IHgxIC0geDAsIGR5ID0geTEgLSB5MCwgZDIgPSBkeCAqIGR4ICsgZHkgKiBkeTsKICAgICAgaWYgKGQyID4gNCAqIM60MiAmJiBkZXB0aC0tKSB7CiAgICAgICAgdmFyIGEgPSBhMCArIGExLCBiID0gYjAgKyBiMSwgYyA9IGMwICsgYzEsIG0gPSBNYXRoLnNxcnQoYSAqIGEgKyBiICogYiArIGMgKiBjKSwgz4YyID0gTWF0aC5hc2luKGMgLz0gbSksIM67MiA9IGFicyhhYnMoYykgLSAxKSA8IM61IHx8IGFicyjOuzAgLSDOuzEpIDwgzrUgPyAozrswICsgzrsxKSAvIDIgOiBNYXRoLmF0YW4yKGIsIGEpLCBwID0gcHJvamVjdCjOuzIsIM+GMiksIHgyID0gcFswXSwgeTIgPSBwWzFdLCBkeDIgPSB4MiAtIHgwLCBkeTIgPSB5MiAtIHkwLCBkeiA9IGR5ICogZHgyIC0gZHggKiBkeTI7CiAgICAgICAgaWYgKGR6ICogZHogLyBkMiA+IM60MiB8fCBhYnMoKGR4ICogZHgyICsgZHkgKiBkeTIpIC8gZDIgLSAuNSkgPiAuMyB8fCBhMCAqIGExICsgYjAgKiBiMSArIGMwICogYzEgPCBjb3NNaW5EaXN0YW5jZSkgewogICAgICAgICAgcmVzYW1wbGVMaW5lVG8oeDAsIHkwLCDOuzAsIGEwLCBiMCwgYzAsIHgyLCB5MiwgzrsyLCBhIC89IG0sIGIgLz0gbSwgYywgZGVwdGgsIHN0cmVhbSk7CiAgICAgICAgICBzdHJlYW0ucG9pbnQoeDIsIHkyKTsKICAgICAgICAgIHJlc2FtcGxlTGluZVRvKHgyLCB5MiwgzrsyLCBhLCBiLCBjLCB4MSwgeTEsIM67MSwgYTEsIGIxLCBjMSwgZGVwdGgsIHN0cmVhbSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXNhbXBsZS5wcmVjaXNpb24gPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIE1hdGguc3FydCjOtDIpOwogICAgICBtYXhEZXB0aCA9ICjOtDIgPSBfICogXykgPiAwICYmIDE2OwogICAgICByZXR1cm4gcmVzYW1wbGU7CiAgICB9OwogICAgcmV0dXJuIHJlc2FtcGxlOwogIH0KICBkMy5nZW8ucGF0aCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHBvaW50UmFkaXVzID0gNC41LCBwcm9qZWN0aW9uLCBjb250ZXh0LCBwcm9qZWN0U3RyZWFtLCBjb250ZXh0U3RyZWFtLCBjYWNoZVN0cmVhbTsKICAgIGZ1bmN0aW9uIHBhdGgob2JqZWN0KSB7CiAgICAgIGlmIChvYmplY3QpIHsKICAgICAgICBpZiAodHlwZW9mIHBvaW50UmFkaXVzID09PSAiZnVuY3Rpb24iKSBjb250ZXh0U3RyZWFtLnBvaW50UmFkaXVzKCtwb2ludFJhZGl1cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsKICAgICAgICBpZiAoIWNhY2hlU3RyZWFtIHx8ICFjYWNoZVN0cmVhbS52YWxpZCkgY2FjaGVTdHJlYW0gPSBwcm9qZWN0U3RyZWFtKGNvbnRleHRTdHJlYW0pOwogICAgICAgIGQzLmdlby5zdHJlYW0ob2JqZWN0LCBjYWNoZVN0cmVhbSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNvbnRleHRTdHJlYW0ucmVzdWx0KCk7CiAgICB9CiAgICBwYXRoLmFyZWEgPSBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgZDNfZ2VvX3BhdGhBcmVhU3VtID0gMDsKICAgICAgZDMuZ2VvLnN0cmVhbShvYmplY3QsIHByb2plY3RTdHJlYW0oZDNfZ2VvX3BhdGhBcmVhKSk7CiAgICAgIHJldHVybiBkM19nZW9fcGF0aEFyZWFTdW07CiAgICB9OwogICAgcGF0aC5jZW50cm9pZCA9IGZ1bmN0aW9uKG9iamVjdCkgewogICAgICBkM19nZW9fY2VudHJvaWRYMCA9IGQzX2dlb19jZW50cm9pZFkwID0gZDNfZ2VvX2NlbnRyb2lkWjAgPSBkM19nZW9fY2VudHJvaWRYMSA9IGQzX2dlb19jZW50cm9pZFkxID0gZDNfZ2VvX2NlbnRyb2lkWjEgPSBkM19nZW9fY2VudHJvaWRYMiA9IGQzX2dlb19jZW50cm9pZFkyID0gZDNfZ2VvX2NlbnRyb2lkWjIgPSAwOwogICAgICBkMy5nZW8uc3RyZWFtKG9iamVjdCwgcHJvamVjdFN0cmVhbShkM19nZW9fcGF0aENlbnRyb2lkKSk7CiAgICAgIHJldHVybiBkM19nZW9fY2VudHJvaWRaMiA/IFsgZDNfZ2VvX2NlbnRyb2lkWDIgLyBkM19nZW9fY2VudHJvaWRaMiwgZDNfZ2VvX2NlbnRyb2lkWTIgLyBkM19nZW9fY2VudHJvaWRaMiBdIDogZDNfZ2VvX2NlbnRyb2lkWjEgPyBbIGQzX2dlb19jZW50cm9pZFgxIC8gZDNfZ2VvX2NlbnRyb2lkWjEsIGQzX2dlb19jZW50cm9pZFkxIC8gZDNfZ2VvX2NlbnRyb2lkWjEgXSA6IGQzX2dlb19jZW50cm9pZFowID8gWyBkM19nZW9fY2VudHJvaWRYMCAvIGQzX2dlb19jZW50cm9pZFowLCBkM19nZW9fY2VudHJvaWRZMCAvIGQzX2dlb19jZW50cm9pZFowIF0gOiBbIE5hTiwgTmFOIF07CiAgICB9OwogICAgcGF0aC5ib3VuZHMgPSBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgZDNfZ2VvX3BhdGhCb3VuZHNYMSA9IGQzX2dlb19wYXRoQm91bmRzWTEgPSAtKGQzX2dlb19wYXRoQm91bmRzWDAgPSBkM19nZW9fcGF0aEJvdW5kc1kwID0gSW5maW5pdHkpOwogICAgICBkMy5nZW8uc3RyZWFtKG9iamVjdCwgcHJvamVjdFN0cmVhbShkM19nZW9fcGF0aEJvdW5kcykpOwogICAgICByZXR1cm4gWyBbIGQzX2dlb19wYXRoQm91bmRzWDAsIGQzX2dlb19wYXRoQm91bmRzWTAgXSwgWyBkM19nZW9fcGF0aEJvdW5kc1gxLCBkM19nZW9fcGF0aEJvdW5kc1kxIF0gXTsKICAgIH07CiAgICBwYXRoLnByb2plY3Rpb24gPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHByb2plY3Rpb247CiAgICAgIHByb2plY3RTdHJlYW0gPSAocHJvamVjdGlvbiA9IF8pID8gXy5zdHJlYW0gfHwgZDNfZ2VvX3BhdGhQcm9qZWN0U3RyZWFtKF8pIDogZDNfaWRlbnRpdHk7CiAgICAgIHJldHVybiByZXNldCgpOwogICAgfTsKICAgIHBhdGguY29udGV4dCA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gY29udGV4dDsKICAgICAgY29udGV4dFN0cmVhbSA9IChjb250ZXh0ID0gXykgPT0gbnVsbCA/IG5ldyBkM19nZW9fcGF0aEJ1ZmZlcigpIDogbmV3IGQzX2dlb19wYXRoQ29udGV4dChfKTsKICAgICAgaWYgKHR5cGVvZiBwb2ludFJhZGl1cyAhPT0gImZ1bmN0aW9uIikgY29udGV4dFN0cmVhbS5wb2ludFJhZGl1cyhwb2ludFJhZGl1cyk7CiAgICAgIHJldHVybiByZXNldCgpOwogICAgfTsKICAgIHBhdGgucG9pbnRSYWRpdXMgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHBvaW50UmFkaXVzOwogICAgICBwb2ludFJhZGl1cyA9IHR5cGVvZiBfID09PSAiZnVuY3Rpb24iID8gXyA6IChjb250ZXh0U3RyZWFtLnBvaW50UmFkaXVzKCtfKSwgK18pOwogICAgICByZXR1cm4gcGF0aDsKICAgIH07CiAgICBmdW5jdGlvbiByZXNldCgpIHsKICAgICAgY2FjaGVTdHJlYW0gPSBudWxsOwogICAgICByZXR1cm4gcGF0aDsKICAgIH0KICAgIHJldHVybiBwYXRoLnByb2plY3Rpb24oZDMuZ2VvLmFsYmVyc1VzYSgpKS5jb250ZXh0KG51bGwpOwogIH07CiAgZnVuY3Rpb24gZDNfZ2VvX3BhdGhQcm9qZWN0U3RyZWFtKHByb2plY3QpIHsKICAgIHZhciByZXNhbXBsZSA9IGQzX2dlb19yZXNhbXBsZShmdW5jdGlvbih4LCB5KSB7CiAgICAgIHJldHVybiBwcm9qZWN0KFsgeCAqIGQzX2RlZ3JlZXMsIHkgKiBkM19kZWdyZWVzIF0pOwogICAgfSk7CiAgICByZXR1cm4gZnVuY3Rpb24oc3RyZWFtKSB7CiAgICAgIHJldHVybiBkM19nZW9fcHJvamVjdGlvblJhZGlhbnMocmVzYW1wbGUoc3RyZWFtKSk7CiAgICB9OwogIH0KICBkMy5nZW8udHJhbnNmb3JtID0gZnVuY3Rpb24obWV0aG9kcykgewogICAgcmV0dXJuIHsKICAgICAgc3RyZWFtOiBmdW5jdGlvbihzdHJlYW0pIHsKICAgICAgICB2YXIgdHJhbnNmb3JtID0gbmV3IGQzX2dlb190cmFuc2Zvcm0oc3RyZWFtKTsKICAgICAgICBmb3IgKHZhciBrIGluIG1ldGhvZHMpIHRyYW5zZm9ybVtrXSA9IG1ldGhvZHNba107CiAgICAgICAgcmV0dXJuIHRyYW5zZm9ybTsKICAgICAgfQogICAgfTsKICB9OwogIGZ1bmN0aW9uIGQzX2dlb190cmFuc2Zvcm0oc3RyZWFtKSB7CiAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICB9CiAgZDNfZ2VvX3RyYW5zZm9ybS5wcm90b3R5cGUgPSB7CiAgICBwb2ludDogZnVuY3Rpb24oeCwgeSkgewogICAgICB0aGlzLnN0cmVhbS5wb2ludCh4LCB5KTsKICAgIH0sCiAgICBzcGhlcmU6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnN0cmVhbS5zcGhlcmUoKTsKICAgIH0sCiAgICBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnN0cmVhbS5saW5lU3RhcnQoKTsKICAgIH0sCiAgICBsaW5lRW5kOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5zdHJlYW0ubGluZUVuZCgpOwogICAgfSwKICAgIHBvbHlnb25TdGFydDogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuc3RyZWFtLnBvbHlnb25TdGFydCgpOwogICAgfSwKICAgIHBvbHlnb25FbmQ6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnN0cmVhbS5wb2x5Z29uRW5kKCk7CiAgICB9CiAgfTsKICBmdW5jdGlvbiBkM19nZW9fdHJhbnNmb3JtUG9pbnQoc3RyZWFtLCBwb2ludCkgewogICAgcmV0dXJuIHsKICAgICAgcG9pbnQ6IHBvaW50LAogICAgICBzcGhlcmU6IGZ1bmN0aW9uKCkgewogICAgICAgIHN0cmVhbS5zcGhlcmUoKTsKICAgICAgfSwKICAgICAgbGluZVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICBzdHJlYW0ubGluZVN0YXJ0KCk7CiAgICAgIH0sCiAgICAgIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHN0cmVhbS5saW5lRW5kKCk7CiAgICAgIH0sCiAgICAgIHBvbHlnb25TdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgc3RyZWFtLnBvbHlnb25TdGFydCgpOwogICAgICB9LAogICAgICBwb2x5Z29uRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICBzdHJlYW0ucG9seWdvbkVuZCgpOwogICAgICB9CiAgICB9OwogIH0KICBkMy5nZW8ucHJvamVjdGlvbiA9IGQzX2dlb19wcm9qZWN0aW9uOwogIGQzLmdlby5wcm9qZWN0aW9uTXV0YXRvciA9IGQzX2dlb19wcm9qZWN0aW9uTXV0YXRvcjsKICBmdW5jdGlvbiBkM19nZW9fcHJvamVjdGlvbihwcm9qZWN0KSB7CiAgICByZXR1cm4gZDNfZ2VvX3Byb2plY3Rpb25NdXRhdG9yKGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gcHJvamVjdDsKICAgIH0pKCk7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19wcm9qZWN0aW9uTXV0YXRvcihwcm9qZWN0QXQpIHsKICAgIHZhciBwcm9qZWN0LCByb3RhdGUsIHByb2plY3RSb3RhdGUsIHByb2plY3RSZXNhbXBsZSA9IGQzX2dlb19yZXNhbXBsZShmdW5jdGlvbih4LCB5KSB7CiAgICAgIHggPSBwcm9qZWN0KHgsIHkpOwogICAgICByZXR1cm4gWyB4WzBdICogayArIM60eCwgzrR5IC0geFsxXSAqIGsgXTsKICAgIH0pLCBrID0gMTUwLCB4ID0gNDgwLCB5ID0gMjUwLCDOuyA9IDAsIM+GID0gMCwgzrTOuyA9IDAsIM60z4YgPSAwLCDOtM6zID0gMCwgzrR4LCDOtHksIHByZWNsaXAgPSBkM19nZW9fY2xpcEFudGltZXJpZGlhbiwgcG9zdGNsaXAgPSBkM19pZGVudGl0eSwgY2xpcEFuZ2xlID0gbnVsbCwgY2xpcEV4dGVudCA9IG51bGwsIHN0cmVhbTsKICAgIGZ1bmN0aW9uIHByb2plY3Rpb24ocG9pbnQpIHsKICAgICAgcG9pbnQgPSBwcm9qZWN0Um90YXRlKHBvaW50WzBdICogZDNfcmFkaWFucywgcG9pbnRbMV0gKiBkM19yYWRpYW5zKTsKICAgICAgcmV0dXJuIFsgcG9pbnRbMF0gKiBrICsgzrR4LCDOtHkgLSBwb2ludFsxXSAqIGsgXTsKICAgIH0KICAgIGZ1bmN0aW9uIGludmVydChwb2ludCkgewogICAgICBwb2ludCA9IHByb2plY3RSb3RhdGUuaW52ZXJ0KChwb2ludFswXSAtIM60eCkgLyBrLCAozrR5IC0gcG9pbnRbMV0pIC8gayk7CiAgICAgIHJldHVybiBwb2ludCAmJiBbIHBvaW50WzBdICogZDNfZGVncmVlcywgcG9pbnRbMV0gKiBkM19kZWdyZWVzIF07CiAgICB9CiAgICBwcm9qZWN0aW9uLnN0cmVhbSA9IGZ1bmN0aW9uKG91dHB1dCkgewogICAgICBpZiAoc3RyZWFtKSBzdHJlYW0udmFsaWQgPSBmYWxzZTsKICAgICAgc3RyZWFtID0gZDNfZ2VvX3Byb2plY3Rpb25SYWRpYW5zKHByZWNsaXAocm90YXRlLCBwcm9qZWN0UmVzYW1wbGUocG9zdGNsaXAob3V0cHV0KSkpKTsKICAgICAgc3RyZWFtLnZhbGlkID0gdHJ1ZTsKICAgICAgcmV0dXJuIHN0cmVhbTsKICAgIH07CiAgICBwcm9qZWN0aW9uLmNsaXBBbmdsZSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gY2xpcEFuZ2xlOwogICAgICBwcmVjbGlwID0gXyA9PSBudWxsID8gKGNsaXBBbmdsZSA9IF8sIGQzX2dlb19jbGlwQW50aW1lcmlkaWFuKSA6IGQzX2dlb19jbGlwQ2lyY2xlKChjbGlwQW5nbGUgPSArXykgKiBkM19yYWRpYW5zKTsKICAgICAgcmV0dXJuIGludmFsaWRhdGUoKTsKICAgIH07CiAgICBwcm9qZWN0aW9uLmNsaXBFeHRlbnQgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGNsaXBFeHRlbnQ7CiAgICAgIGNsaXBFeHRlbnQgPSBfOwogICAgICBwb3N0Y2xpcCA9IF8gPyBkM19nZW9fY2xpcEV4dGVudChfWzBdWzBdLCBfWzBdWzFdLCBfWzFdWzBdLCBfWzFdWzFdKSA6IGQzX2lkZW50aXR5OwogICAgICByZXR1cm4gaW52YWxpZGF0ZSgpOwogICAgfTsKICAgIHByb2plY3Rpb24uc2NhbGUgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGs7CiAgICAgIGsgPSArXzsKICAgICAgcmV0dXJuIHJlc2V0KCk7CiAgICB9OwogICAgcHJvamVjdGlvbi50cmFuc2xhdGUgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIFsgeCwgeSBdOwogICAgICB4ID0gK19bMF07CiAgICAgIHkgPSArX1sxXTsKICAgICAgcmV0dXJuIHJlc2V0KCk7CiAgICB9OwogICAgcHJvamVjdGlvbi5jZW50ZXIgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIFsgzrsgKiBkM19kZWdyZWVzLCDPhiAqIGQzX2RlZ3JlZXMgXTsKICAgICAgzrsgPSBfWzBdICUgMzYwICogZDNfcmFkaWFuczsKICAgICAgz4YgPSBfWzFdICUgMzYwICogZDNfcmFkaWFuczsKICAgICAgcmV0dXJuIHJlc2V0KCk7CiAgICB9OwogICAgcHJvamVjdGlvbi5yb3RhdGUgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIFsgzrTOuyAqIGQzX2RlZ3JlZXMsIM60z4YgKiBkM19kZWdyZWVzLCDOtM6zICogZDNfZGVncmVlcyBdOwogICAgICDOtM67ID0gX1swXSAlIDM2MCAqIGQzX3JhZGlhbnM7CiAgICAgIM60z4YgPSBfWzFdICUgMzYwICogZDNfcmFkaWFuczsKICAgICAgzrTOsyA9IF8ubGVuZ3RoID4gMiA/IF9bMl0gJSAzNjAgKiBkM19yYWRpYW5zIDogMDsKICAgICAgcmV0dXJuIHJlc2V0KCk7CiAgICB9OwogICAgZDMucmViaW5kKHByb2plY3Rpb24sIHByb2plY3RSZXNhbXBsZSwgInByZWNpc2lvbiIpOwogICAgZnVuY3Rpb24gcmVzZXQoKSB7CiAgICAgIHByb2plY3RSb3RhdGUgPSBkM19nZW9fY29tcG9zZShyb3RhdGUgPSBkM19nZW9fcm90YXRpb24ozrTOuywgzrTPhiwgzrTOsyksIHByb2plY3QpOwogICAgICB2YXIgY2VudGVyID0gcHJvamVjdCjOuywgz4YpOwogICAgICDOtHggPSB4IC0gY2VudGVyWzBdICogazsKICAgICAgzrR5ID0geSArIGNlbnRlclsxXSAqIGs7CiAgICAgIHJldHVybiBpbnZhbGlkYXRlKCk7CiAgICB9CiAgICBmdW5jdGlvbiBpbnZhbGlkYXRlKCkgewogICAgICBpZiAoc3RyZWFtKSBzdHJlYW0udmFsaWQgPSBmYWxzZSwgc3RyZWFtID0gbnVsbDsKICAgICAgcmV0dXJuIHByb2plY3Rpb247CiAgICB9CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHByb2plY3QgPSBwcm9qZWN0QXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgcHJvamVjdGlvbi5pbnZlcnQgPSBwcm9qZWN0LmludmVydCAmJiBpbnZlcnQ7CiAgICAgIHJldHVybiByZXNldCgpOwogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX3Byb2plY3Rpb25SYWRpYW5zKHN0cmVhbSkgewogICAgcmV0dXJuIGQzX2dlb190cmFuc2Zvcm1Qb2ludChzdHJlYW0sIGZ1bmN0aW9uKHgsIHkpIHsKICAgICAgc3RyZWFtLnBvaW50KHggKiBkM19yYWRpYW5zLCB5ICogZDNfcmFkaWFucyk7CiAgICB9KTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX2VxdWlyZWN0YW5ndWxhcijOuywgz4YpIHsKICAgIHJldHVybiBbIM67LCDPhiBdOwogIH0KICAoZDMuZ2VvLmVxdWlyZWN0YW5ndWxhciA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX2dlb19wcm9qZWN0aW9uKGQzX2dlb19lcXVpcmVjdGFuZ3VsYXIpOwogIH0pLnJhdyA9IGQzX2dlb19lcXVpcmVjdGFuZ3VsYXIuaW52ZXJ0ID0gZDNfZ2VvX2VxdWlyZWN0YW5ndWxhcjsKICBkMy5nZW8ucm90YXRpb24gPSBmdW5jdGlvbihyb3RhdGUpIHsKICAgIHJvdGF0ZSA9IGQzX2dlb19yb3RhdGlvbihyb3RhdGVbMF0gJSAzNjAgKiBkM19yYWRpYW5zLCByb3RhdGVbMV0gKiBkM19yYWRpYW5zLCByb3RhdGUubGVuZ3RoID4gMiA/IHJvdGF0ZVsyXSAqIGQzX3JhZGlhbnMgOiAwKTsKICAgIGZ1bmN0aW9uIGZvcndhcmQoY29vcmRpbmF0ZXMpIHsKICAgICAgY29vcmRpbmF0ZXMgPSByb3RhdGUoY29vcmRpbmF0ZXNbMF0gKiBkM19yYWRpYW5zLCBjb29yZGluYXRlc1sxXSAqIGQzX3JhZGlhbnMpOwogICAgICByZXR1cm4gY29vcmRpbmF0ZXNbMF0gKj0gZDNfZGVncmVlcywgY29vcmRpbmF0ZXNbMV0gKj0gZDNfZGVncmVlcywgY29vcmRpbmF0ZXM7CiAgICB9CiAgICBmb3J3YXJkLmludmVydCA9IGZ1bmN0aW9uKGNvb3JkaW5hdGVzKSB7CiAgICAgIGNvb3JkaW5hdGVzID0gcm90YXRlLmludmVydChjb29yZGluYXRlc1swXSAqIGQzX3JhZGlhbnMsIGNvb3JkaW5hdGVzWzFdICogZDNfcmFkaWFucyk7CiAgICAgIHJldHVybiBjb29yZGluYXRlc1swXSAqPSBkM19kZWdyZWVzLCBjb29yZGluYXRlc1sxXSAqPSBkM19kZWdyZWVzLCBjb29yZGluYXRlczsKICAgIH07CiAgICByZXR1cm4gZm9yd2FyZDsKICB9OwogIGZ1bmN0aW9uIGQzX2dlb19pZGVudGl0eVJvdGF0aW9uKM67LCDPhikgewogICAgcmV0dXJuIFsgzrsgPiDPgCA/IM67IC0gz4QgOiDOuyA8IC3PgCA/IM67ICsgz4QgOiDOuywgz4YgXTsKICB9CiAgZDNfZ2VvX2lkZW50aXR5Um90YXRpb24uaW52ZXJ0ID0gZDNfZ2VvX2VxdWlyZWN0YW5ndWxhcjsKICBmdW5jdGlvbiBkM19nZW9fcm90YXRpb24ozrTOuywgzrTPhiwgzrTOsykgewogICAgcmV0dXJuIM60zrsgPyDOtM+GIHx8IM60zrMgPyBkM19nZW9fY29tcG9zZShkM19nZW9fcm90YXRpb27OuyjOtM67KSwgZDNfZ2VvX3JvdGF0aW9uz4bOsyjOtM+GLCDOtM6zKSkgOiBkM19nZW9fcm90YXRpb27OuyjOtM67KSA6IM60z4YgfHwgzrTOsyA/IGQzX2dlb19yb3RhdGlvbs+GzrMozrTPhiwgzrTOsykgOiBkM19nZW9faWRlbnRpdHlSb3RhdGlvbjsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX2ZvcndhcmRSb3RhdGlvbs67KM60zrspIHsKICAgIHJldHVybiBmdW5jdGlvbijOuywgz4YpIHsKICAgICAgcmV0dXJuIM67ICs9IM60zrssIFsgzrsgPiDPgCA/IM67IC0gz4QgOiDOuyA8IC3PgCA/IM67ICsgz4QgOiDOuywgz4YgXTsKICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19yb3RhdGlvbs67KM60zrspIHsKICAgIHZhciByb3RhdGlvbiA9IGQzX2dlb19mb3J3YXJkUm90YXRpb27OuyjOtM67KTsKICAgIHJvdGF0aW9uLmludmVydCA9IGQzX2dlb19mb3J3YXJkUm90YXRpb27OuygtzrTOuyk7CiAgICByZXR1cm4gcm90YXRpb247CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19yb3RhdGlvbs+GzrMozrTPhiwgzrTOsykgewogICAgdmFyIGNvc860z4YgPSBNYXRoLmNvcyjOtM+GKSwgc2luzrTPhiA9IE1hdGguc2luKM60z4YpLCBjb3POtM6zID0gTWF0aC5jb3MozrTOsyksIHNpbs60zrMgPSBNYXRoLnNpbijOtM6zKTsKICAgIGZ1bmN0aW9uIHJvdGF0aW9uKM67LCDPhikgewogICAgICB2YXIgY29zz4YgPSBNYXRoLmNvcyjPhiksIHggPSBNYXRoLmNvcyjOuykgKiBjb3PPhiwgeSA9IE1hdGguc2luKM67KSAqIGNvc8+GLCB6ID0gTWF0aC5zaW4oz4YpLCBrID0geiAqIGNvc860z4YgKyB4ICogc2luzrTPhjsKICAgICAgcmV0dXJuIFsgTWF0aC5hdGFuMih5ICogY29zzrTOsyAtIGsgKiBzaW7OtM6zLCB4ICogY29zzrTPhiAtIHogKiBzaW7OtM+GKSwgZDNfYXNpbihrICogY29zzrTOsyArIHkgKiBzaW7OtM6zKSBdOwogICAgfQogICAgcm90YXRpb24uaW52ZXJ0ID0gZnVuY3Rpb24ozrssIM+GKSB7CiAgICAgIHZhciBjb3PPhiA9IE1hdGguY29zKM+GKSwgeCA9IE1hdGguY29zKM67KSAqIGNvc8+GLCB5ID0gTWF0aC5zaW4ozrspICogY29zz4YsIHogPSBNYXRoLnNpbijPhiksIGsgPSB6ICogY29zzrTOsyAtIHkgKiBzaW7OtM6zOwogICAgICByZXR1cm4gWyBNYXRoLmF0YW4yKHkgKiBjb3POtM6zICsgeiAqIHNpbs60zrMsIHggKiBjb3POtM+GICsgayAqIHNpbs60z4YpLCBkM19hc2luKGsgKiBjb3POtM+GIC0geCAqIHNpbs60z4YpIF07CiAgICB9OwogICAgcmV0dXJuIHJvdGF0aW9uOwogIH0KICBkMy5nZW8uY2lyY2xlID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgb3JpZ2luID0gWyAwLCAwIF0sIGFuZ2xlLCBwcmVjaXNpb24gPSA2LCBpbnRlcnBvbGF0ZTsKICAgIGZ1bmN0aW9uIGNpcmNsZSgpIHsKICAgICAgdmFyIGNlbnRlciA9IHR5cGVvZiBvcmlnaW4gPT09ICJmdW5jdGlvbiIgPyBvcmlnaW4uYXBwbHkodGhpcywgYXJndW1lbnRzKSA6IG9yaWdpbiwgcm90YXRlID0gZDNfZ2VvX3JvdGF0aW9uKC1jZW50ZXJbMF0gKiBkM19yYWRpYW5zLCAtY2VudGVyWzFdICogZDNfcmFkaWFucywgMCkuaW52ZXJ0LCByaW5nID0gW107CiAgICAgIGludGVycG9sYXRlKG51bGwsIG51bGwsIDEsIHsKICAgICAgICBwb2ludDogZnVuY3Rpb24oeCwgeSkgewogICAgICAgICAgcmluZy5wdXNoKHggPSByb3RhdGUoeCwgeSkpOwogICAgICAgICAgeFswXSAqPSBkM19kZWdyZWVzLCB4WzFdICo9IGQzX2RlZ3JlZXM7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAiUG9seWdvbiIsCiAgICAgICAgY29vcmRpbmF0ZXM6IFsgcmluZyBdCiAgICAgIH07CiAgICB9CiAgICBjaXJjbGUub3JpZ2luID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBvcmlnaW47CiAgICAgIG9yaWdpbiA9IHg7CiAgICAgIHJldHVybiBjaXJjbGU7CiAgICB9OwogICAgY2lyY2xlLmFuZ2xlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBhbmdsZTsKICAgICAgaW50ZXJwb2xhdGUgPSBkM19nZW9fY2lyY2xlSW50ZXJwb2xhdGUoKGFuZ2xlID0gK3gpICogZDNfcmFkaWFucywgcHJlY2lzaW9uICogZDNfcmFkaWFucyk7CiAgICAgIHJldHVybiBjaXJjbGU7CiAgICB9OwogICAgY2lyY2xlLnByZWNpc2lvbiA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gcHJlY2lzaW9uOwogICAgICBpbnRlcnBvbGF0ZSA9IGQzX2dlb19jaXJjbGVJbnRlcnBvbGF0ZShhbmdsZSAqIGQzX3JhZGlhbnMsIChwcmVjaXNpb24gPSArXykgKiBkM19yYWRpYW5zKTsKICAgICAgcmV0dXJuIGNpcmNsZTsKICAgIH07CiAgICByZXR1cm4gY2lyY2xlLmFuZ2xlKDkwKTsKICB9OwogIGZ1bmN0aW9uIGQzX2dlb19jaXJjbGVJbnRlcnBvbGF0ZShyYWRpdXMsIHByZWNpc2lvbikgewogICAgdmFyIGNyID0gTWF0aC5jb3MocmFkaXVzKSwgc3IgPSBNYXRoLnNpbihyYWRpdXMpOwogICAgcmV0dXJuIGZ1bmN0aW9uKGZyb20sIHRvLCBkaXJlY3Rpb24sIGxpc3RlbmVyKSB7CiAgICAgIHZhciBzdGVwID0gZGlyZWN0aW9uICogcHJlY2lzaW9uOwogICAgICBpZiAoZnJvbSAhPSBudWxsKSB7CiAgICAgICAgZnJvbSA9IGQzX2dlb19jaXJjbGVBbmdsZShjciwgZnJvbSk7CiAgICAgICAgdG8gPSBkM19nZW9fY2lyY2xlQW5nbGUoY3IsIHRvKTsKICAgICAgICBpZiAoZGlyZWN0aW9uID4gMCA/IGZyb20gPCB0byA6IGZyb20gPiB0bykgZnJvbSArPSBkaXJlY3Rpb24gKiDPhDsKICAgICAgfSBlbHNlIHsKICAgICAgICBmcm9tID0gcmFkaXVzICsgZGlyZWN0aW9uICogz4Q7CiAgICAgICAgdG8gPSByYWRpdXMgLSAuNSAqIHN0ZXA7CiAgICAgIH0KICAgICAgZm9yICh2YXIgcG9pbnQsIHQgPSBmcm9tOyBkaXJlY3Rpb24gPiAwID8gdCA+IHRvIDogdCA8IHRvOyB0IC09IHN0ZXApIHsKICAgICAgICBsaXN0ZW5lci5wb2ludCgocG9pbnQgPSBkM19nZW9fc3BoZXJpY2FsKFsgY3IsIC1zciAqIE1hdGguY29zKHQpLCAtc3IgKiBNYXRoLnNpbih0KSBdKSlbMF0sIHBvaW50WzFdKTsKICAgICAgfQogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX2NpcmNsZUFuZ2xlKGNyLCBwb2ludCkgewogICAgdmFyIGEgPSBkM19nZW9fY2FydGVzaWFuKHBvaW50KTsKICAgIGFbMF0gLT0gY3I7CiAgICBkM19nZW9fY2FydGVzaWFuTm9ybWFsaXplKGEpOwogICAgdmFyIGFuZ2xlID0gZDNfYWNvcygtYVsxXSk7CiAgICByZXR1cm4gKCgtYVsyXSA8IDAgPyAtYW5nbGUgOiBhbmdsZSkgKyAyICogTWF0aC5QSSAtIM61KSAlICgyICogTWF0aC5QSSk7CiAgfQogIGQzLmdlby5kaXN0YW5jZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHZhciDOlM67ID0gKGJbMF0gLSBhWzBdKSAqIGQzX3JhZGlhbnMsIM+GMCA9IGFbMV0gKiBkM19yYWRpYW5zLCDPhjEgPSBiWzFdICogZDNfcmFkaWFucywgc2luzpTOuyA9IE1hdGguc2luKM6UzrspLCBjb3POlM67ID0gTWF0aC5jb3MozpTOuyksIHNpbs+GMCA9IE1hdGguc2luKM+GMCksIGNvc8+GMCA9IE1hdGguY29zKM+GMCksIHNpbs+GMSA9IE1hdGguc2luKM+GMSksIGNvc8+GMSA9IE1hdGguY29zKM+GMSksIHQ7CiAgICByZXR1cm4gTWF0aC5hdGFuMihNYXRoLnNxcnQoKHQgPSBjb3PPhjEgKiBzaW7OlM67KSAqIHQgKyAodCA9IGNvc8+GMCAqIHNpbs+GMSAtIHNpbs+GMCAqIGNvc8+GMSAqIGNvc86UzrspICogdCksIHNpbs+GMCAqIHNpbs+GMSArIGNvc8+GMCAqIGNvc8+GMSAqIGNvc86UzrspOwogIH07CiAgZDMuZ2VvLmdyYXRpY3VsZSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHgxLCB4MCwgWDEsIFgwLCB5MSwgeTAsIFkxLCBZMCwgZHggPSAxMCwgZHkgPSBkeCwgRFggPSA5MCwgRFkgPSAzNjAsIHgsIHksIFgsIFksIHByZWNpc2lvbiA9IDIuNTsKICAgIGZ1bmN0aW9uIGdyYXRpY3VsZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAiTXVsdGlMaW5lU3RyaW5nIiwKICAgICAgICBjb29yZGluYXRlczogbGluZXMoKQogICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gbGluZXMoKSB7CiAgICAgIHJldHVybiBkMy5yYW5nZShNYXRoLmNlaWwoWDAgLyBEWCkgKiBEWCwgWDEsIERYKS5tYXAoWCkuY29uY2F0KGQzLnJhbmdlKE1hdGguY2VpbChZMCAvIERZKSAqIERZLCBZMSwgRFkpLm1hcChZKSkuY29uY2F0KGQzLnJhbmdlKE1hdGguY2VpbCh4MCAvIGR4KSAqIGR4LCB4MSwgZHgpLmZpbHRlcihmdW5jdGlvbih4KSB7CiAgICAgICAgcmV0dXJuIGFicyh4ICUgRFgpID4gzrU7CiAgICAgIH0pLm1hcCh4KSkuY29uY2F0KGQzLnJhbmdlKE1hdGguY2VpbCh5MCAvIGR5KSAqIGR5LCB5MSwgZHkpLmZpbHRlcihmdW5jdGlvbih5KSB7CiAgICAgICAgcmV0dXJuIGFicyh5ICUgRFkpID4gzrU7CiAgICAgIH0pLm1hcCh5KSk7CiAgICB9CiAgICBncmF0aWN1bGUubGluZXMgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGxpbmVzKCkubWFwKGZ1bmN0aW9uKGNvb3JkaW5hdGVzKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6ICJMaW5lU3RyaW5nIiwKICAgICAgICAgIGNvb3JkaW5hdGVzOiBjb29yZGluYXRlcwogICAgICAgIH07CiAgICAgIH0pOwogICAgfTsKICAgIGdyYXRpY3VsZS5vdXRsaW5lID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogIlBvbHlnb24iLAogICAgICAgIGNvb3JkaW5hdGVzOiBbIFgoWDApLmNvbmNhdChZKFkxKS5zbGljZSgxKSwgWChYMSkucmV2ZXJzZSgpLnNsaWNlKDEpLCBZKFkwKS5yZXZlcnNlKCkuc2xpY2UoMSkpIF0KICAgICAgfTsKICAgIH07CiAgICBncmF0aWN1bGUuZXh0ZW50ID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBncmF0aWN1bGUubWlub3JFeHRlbnQoKTsKICAgICAgcmV0dXJuIGdyYXRpY3VsZS5tYWpvckV4dGVudChfKS5taW5vckV4dGVudChfKTsKICAgIH07CiAgICBncmF0aWN1bGUubWFqb3JFeHRlbnQgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIFsgWyBYMCwgWTAgXSwgWyBYMSwgWTEgXSBdOwogICAgICBYMCA9ICtfWzBdWzBdLCBYMSA9ICtfWzFdWzBdOwogICAgICBZMCA9ICtfWzBdWzFdLCBZMSA9ICtfWzFdWzFdOwogICAgICBpZiAoWDAgPiBYMSkgXyA9IFgwLCBYMCA9IFgxLCBYMSA9IF87CiAgICAgIGlmIChZMCA+IFkxKSBfID0gWTAsIFkwID0gWTEsIFkxID0gXzsKICAgICAgcmV0dXJuIGdyYXRpY3VsZS5wcmVjaXNpb24ocHJlY2lzaW9uKTsKICAgIH07CiAgICBncmF0aWN1bGUubWlub3JFeHRlbnQgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIFsgWyB4MCwgeTAgXSwgWyB4MSwgeTEgXSBdOwogICAgICB4MCA9ICtfWzBdWzBdLCB4MSA9ICtfWzFdWzBdOwogICAgICB5MCA9ICtfWzBdWzFdLCB5MSA9ICtfWzFdWzFdOwogICAgICBpZiAoeDAgPiB4MSkgXyA9IHgwLCB4MCA9IHgxLCB4MSA9IF87CiAgICAgIGlmICh5MCA+IHkxKSBfID0geTAsIHkwID0geTEsIHkxID0gXzsKICAgICAgcmV0dXJuIGdyYXRpY3VsZS5wcmVjaXNpb24ocHJlY2lzaW9uKTsKICAgIH07CiAgICBncmF0aWN1bGUuc3RlcCA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gZ3JhdGljdWxlLm1pbm9yU3RlcCgpOwogICAgICByZXR1cm4gZ3JhdGljdWxlLm1ham9yU3RlcChfKS5taW5vclN0ZXAoXyk7CiAgICB9OwogICAgZ3JhdGljdWxlLm1ham9yU3RlcCA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gWyBEWCwgRFkgXTsKICAgICAgRFggPSArX1swXSwgRFkgPSArX1sxXTsKICAgICAgcmV0dXJuIGdyYXRpY3VsZTsKICAgIH07CiAgICBncmF0aWN1bGUubWlub3JTdGVwID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBbIGR4LCBkeSBdOwogICAgICBkeCA9ICtfWzBdLCBkeSA9ICtfWzFdOwogICAgICByZXR1cm4gZ3JhdGljdWxlOwogICAgfTsKICAgIGdyYXRpY3VsZS5wcmVjaXNpb24gPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHByZWNpc2lvbjsKICAgICAgcHJlY2lzaW9uID0gK187CiAgICAgIHggPSBkM19nZW9fZ3JhdGljdWxlWCh5MCwgeTEsIDkwKTsKICAgICAgeSA9IGQzX2dlb19ncmF0aWN1bGVZKHgwLCB4MSwgcHJlY2lzaW9uKTsKICAgICAgWCA9IGQzX2dlb19ncmF0aWN1bGVYKFkwLCBZMSwgOTApOwogICAgICBZID0gZDNfZ2VvX2dyYXRpY3VsZVkoWDAsIFgxLCBwcmVjaXNpb24pOwogICAgICByZXR1cm4gZ3JhdGljdWxlOwogICAgfTsKICAgIHJldHVybiBncmF0aWN1bGUubWFqb3JFeHRlbnQoWyBbIC0xODAsIC05MCArIM61IF0sIFsgMTgwLCA5MCAtIM61IF0gXSkubWlub3JFeHRlbnQoWyBbIC0xODAsIC04MCAtIM61IF0sIFsgMTgwLCA4MCArIM61IF0gXSk7CiAgfTsKICBmdW5jdGlvbiBkM19nZW9fZ3JhdGljdWxlWCh5MCwgeTEsIGR5KSB7CiAgICB2YXIgeSA9IGQzLnJhbmdlKHkwLCB5MSAtIM61LCBkeSkuY29uY2F0KHkxKTsKICAgIHJldHVybiBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiB5Lm1hcChmdW5jdGlvbih5KSB7CiAgICAgICAgcmV0dXJuIFsgeCwgeSBdOwogICAgICB9KTsKICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19ncmF0aWN1bGVZKHgwLCB4MSwgZHgpIHsKICAgIHZhciB4ID0gZDMucmFuZ2UoeDAsIHgxIC0gzrUsIGR4KS5jb25jYXQoeDEpOwogICAgcmV0dXJuIGZ1bmN0aW9uKHkpIHsKICAgICAgcmV0dXJuIHgubWFwKGZ1bmN0aW9uKHgpIHsKICAgICAgICByZXR1cm4gWyB4LCB5IF07CiAgICAgIH0pOwogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfc291cmNlKGQpIHsKICAgIHJldHVybiBkLnNvdXJjZTsKICB9CiAgZnVuY3Rpb24gZDNfdGFyZ2V0KGQpIHsKICAgIHJldHVybiBkLnRhcmdldDsKICB9CiAgZDMuZ2VvLmdyZWF0QXJjID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgc291cmNlID0gZDNfc291cmNlLCBzb3VyY2VfLCB0YXJnZXQgPSBkM190YXJnZXQsIHRhcmdldF87CiAgICBmdW5jdGlvbiBncmVhdEFyYygpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAiTGluZVN0cmluZyIsCiAgICAgICAgY29vcmRpbmF0ZXM6IFsgc291cmNlXyB8fCBzb3VyY2UuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgdGFyZ2V0XyB8fCB0YXJnZXQuYXBwbHkodGhpcywgYXJndW1lbnRzKSBdCiAgICAgIH07CiAgICB9CiAgICBncmVhdEFyYy5kaXN0YW5jZSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZDMuZ2VvLmRpc3RhbmNlKHNvdXJjZV8gfHwgc291cmNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRhcmdldF8gfHwgdGFyZ2V0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgfTsKICAgIGdyZWF0QXJjLnNvdXJjZSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc291cmNlOwogICAgICBzb3VyY2UgPSBfLCBzb3VyY2VfID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBudWxsIDogXzsKICAgICAgcmV0dXJuIGdyZWF0QXJjOwogICAgfTsKICAgIGdyZWF0QXJjLnRhcmdldCA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdGFyZ2V0OwogICAgICB0YXJnZXQgPSBfLCB0YXJnZXRfID0gdHlwZW9mIF8gPT09ICJmdW5jdGlvbiIgPyBudWxsIDogXzsKICAgICAgcmV0dXJuIGdyZWF0QXJjOwogICAgfTsKICAgIGdyZWF0QXJjLnByZWNpc2lvbiA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IGdyZWF0QXJjIDogMDsKICAgIH07CiAgICByZXR1cm4gZ3JlYXRBcmM7CiAgfTsKICBkMy5nZW8uaW50ZXJwb2xhdGUgPSBmdW5jdGlvbihzb3VyY2UsIHRhcmdldCkgewogICAgcmV0dXJuIGQzX2dlb19pbnRlcnBvbGF0ZShzb3VyY2VbMF0gKiBkM19yYWRpYW5zLCBzb3VyY2VbMV0gKiBkM19yYWRpYW5zLCB0YXJnZXRbMF0gKiBkM19yYWRpYW5zLCB0YXJnZXRbMV0gKiBkM19yYWRpYW5zKTsKICB9OwogIGZ1bmN0aW9uIGQzX2dlb19pbnRlcnBvbGF0ZSh4MCwgeTAsIHgxLCB5MSkgewogICAgdmFyIGN5MCA9IE1hdGguY29zKHkwKSwgc3kwID0gTWF0aC5zaW4oeTApLCBjeTEgPSBNYXRoLmNvcyh5MSksIHN5MSA9IE1hdGguc2luKHkxKSwga3gwID0gY3kwICogTWF0aC5jb3MoeDApLCBreTAgPSBjeTAgKiBNYXRoLnNpbih4MCksIGt4MSA9IGN5MSAqIE1hdGguY29zKHgxKSwga3kxID0gY3kxICogTWF0aC5zaW4oeDEpLCBkID0gMiAqIE1hdGguYXNpbihNYXRoLnNxcnQoZDNfaGF2ZXJzaW4oeTEgLSB5MCkgKyBjeTAgKiBjeTEgKiBkM19oYXZlcnNpbih4MSAtIHgwKSkpLCBrID0gMSAvIE1hdGguc2luKGQpOwogICAgdmFyIGludGVycG9sYXRlID0gZCA/IGZ1bmN0aW9uKHQpIHsKICAgICAgdmFyIEIgPSBNYXRoLnNpbih0ICo9IGQpICogaywgQSA9IE1hdGguc2luKGQgLSB0KSAqIGssIHggPSBBICoga3gwICsgQiAqIGt4MSwgeSA9IEEgKiBreTAgKyBCICoga3kxLCB6ID0gQSAqIHN5MCArIEIgKiBzeTE7CiAgICAgIHJldHVybiBbIE1hdGguYXRhbjIoeSwgeCkgKiBkM19kZWdyZWVzLCBNYXRoLmF0YW4yKHosIE1hdGguc3FydCh4ICogeCArIHkgKiB5KSkgKiBkM19kZWdyZWVzIF07CiAgICB9IDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBbIHgwICogZDNfZGVncmVlcywgeTAgKiBkM19kZWdyZWVzIF07CiAgICB9OwogICAgaW50ZXJwb2xhdGUuZGlzdGFuY2UgPSBkOwogICAgcmV0dXJuIGludGVycG9sYXRlOwogIH0KICBkMy5nZW8ubGVuZ3RoID0gZnVuY3Rpb24ob2JqZWN0KSB7CiAgICBkM19nZW9fbGVuZ3RoU3VtID0gMDsKICAgIGQzLmdlby5zdHJlYW0ob2JqZWN0LCBkM19nZW9fbGVuZ3RoKTsKICAgIHJldHVybiBkM19nZW9fbGVuZ3RoU3VtOwogIH07CiAgdmFyIGQzX2dlb19sZW5ndGhTdW07CiAgdmFyIGQzX2dlb19sZW5ndGggPSB7CiAgICBzcGhlcmU6IGQzX25vb3AsCiAgICBwb2ludDogZDNfbm9vcCwKICAgIGxpbmVTdGFydDogZDNfZ2VvX2xlbmd0aExpbmVTdGFydCwKICAgIGxpbmVFbmQ6IGQzX25vb3AsCiAgICBwb2x5Z29uU3RhcnQ6IGQzX25vb3AsCiAgICBwb2x5Z29uRW5kOiBkM19ub29wCiAgfTsKICBmdW5jdGlvbiBkM19nZW9fbGVuZ3RoTGluZVN0YXJ0KCkgewogICAgdmFyIM67MCwgc2luz4YwLCBjb3PPhjA7CiAgICBkM19nZW9fbGVuZ3RoLnBvaW50ID0gZnVuY3Rpb24ozrssIM+GKSB7CiAgICAgIM67MCA9IM67ICogZDNfcmFkaWFucywgc2luz4YwID0gTWF0aC5zaW4oz4YgKj0gZDNfcmFkaWFucyksIGNvc8+GMCA9IE1hdGguY29zKM+GKTsKICAgICAgZDNfZ2VvX2xlbmd0aC5wb2ludCA9IG5leHRQb2ludDsKICAgIH07CiAgICBkM19nZW9fbGVuZ3RoLmxpbmVFbmQgPSBmdW5jdGlvbigpIHsKICAgICAgZDNfZ2VvX2xlbmd0aC5wb2ludCA9IGQzX2dlb19sZW5ndGgubGluZUVuZCA9IGQzX25vb3A7CiAgICB9OwogICAgZnVuY3Rpb24gbmV4dFBvaW50KM67LCDPhikgewogICAgICB2YXIgc2luz4YgPSBNYXRoLnNpbijPhiAqPSBkM19yYWRpYW5zKSwgY29zz4YgPSBNYXRoLmNvcyjPhiksIHQgPSBhYnMoKM67ICo9IGQzX3JhZGlhbnMpIC0gzrswKSwgY29zzpTOuyA9IE1hdGguY29zKHQpOwogICAgICBkM19nZW9fbGVuZ3RoU3VtICs9IE1hdGguYXRhbjIoTWF0aC5zcXJ0KCh0ID0gY29zz4YgKiBNYXRoLnNpbih0KSkgKiB0ICsgKHQgPSBjb3PPhjAgKiBzaW7PhiAtIHNpbs+GMCAqIGNvc8+GICogY29zzpTOuykgKiB0KSwgc2luz4YwICogc2luz4YgKyBjb3PPhjAgKiBjb3PPhiAqIGNvc86UzrspOwogICAgICDOuzAgPSDOuywgc2luz4YwID0gc2luz4YsIGNvc8+GMCA9IGNvc8+GOwogICAgfQogIH0KICBmdW5jdGlvbiBkM19nZW9fYXppbXV0aGFsKHNjYWxlLCBhbmdsZSkgewogICAgZnVuY3Rpb24gYXppbXV0aGFsKM67LCDPhikgewogICAgICB2YXIgY29zzrsgPSBNYXRoLmNvcyjOuyksIGNvc8+GID0gTWF0aC5jb3Moz4YpLCBrID0gc2NhbGUoY29zzrsgKiBjb3PPhik7CiAgICAgIHJldHVybiBbIGsgKiBjb3PPhiAqIE1hdGguc2luKM67KSwgayAqIE1hdGguc2luKM+GKSBdOwogICAgfQogICAgYXppbXV0aGFsLmludmVydCA9IGZ1bmN0aW9uKHgsIHkpIHsKICAgICAgdmFyIM+BID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkpLCBjID0gYW5nbGUoz4EpLCBzaW5jID0gTWF0aC5zaW4oYyksIGNvc2MgPSBNYXRoLmNvcyhjKTsKICAgICAgcmV0dXJuIFsgTWF0aC5hdGFuMih4ICogc2luYywgz4EgKiBjb3NjKSwgTWF0aC5hc2luKM+BICYmIHkgKiBzaW5jIC8gz4EpIF07CiAgICB9OwogICAgcmV0dXJuIGF6aW11dGhhbDsKICB9CiAgdmFyIGQzX2dlb19hemltdXRoYWxFcXVhbEFyZWEgPSBkM19nZW9fYXppbXV0aGFsKGZ1bmN0aW9uKGNvc867Y29zz4YpIHsKICAgIHJldHVybiBNYXRoLnNxcnQoMiAvICgxICsgY29zzrtjb3PPhikpOwogIH0sIGZ1bmN0aW9uKM+BKSB7CiAgICByZXR1cm4gMiAqIE1hdGguYXNpbijPgSAvIDIpOwogIH0pOwogIChkMy5nZW8uYXppbXV0aGFsRXF1YWxBcmVhID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZDNfZ2VvX3Byb2plY3Rpb24oZDNfZ2VvX2F6aW11dGhhbEVxdWFsQXJlYSk7CiAgfSkucmF3ID0gZDNfZ2VvX2F6aW11dGhhbEVxdWFsQXJlYTsKICB2YXIgZDNfZ2VvX2F6aW11dGhhbEVxdWlkaXN0YW50ID0gZDNfZ2VvX2F6aW11dGhhbChmdW5jdGlvbihjb3POu2Nvc8+GKSB7CiAgICB2YXIgYyA9IE1hdGguYWNvcyhjb3POu2Nvc8+GKTsKICAgIHJldHVybiBjICYmIGMgLyBNYXRoLnNpbihjKTsKICB9LCBkM19pZGVudGl0eSk7CiAgKGQzLmdlby5hemltdXRoYWxFcXVpZGlzdGFudCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX2dlb19wcm9qZWN0aW9uKGQzX2dlb19hemltdXRoYWxFcXVpZGlzdGFudCk7CiAgfSkucmF3ID0gZDNfZ2VvX2F6aW11dGhhbEVxdWlkaXN0YW50OwogIGZ1bmN0aW9uIGQzX2dlb19jb25pY0NvbmZvcm1hbCjPhjAsIM+GMSkgewogICAgdmFyIGNvc8+GMCA9IE1hdGguY29zKM+GMCksIHQgPSBmdW5jdGlvbijPhikgewogICAgICByZXR1cm4gTWF0aC50YW4oz4AgLyA0ICsgz4YgLyAyKTsKICAgIH0sIG4gPSDPhjAgPT09IM+GMSA/IE1hdGguc2luKM+GMCkgOiBNYXRoLmxvZyhjb3PPhjAgLyBNYXRoLmNvcyjPhjEpKSAvIE1hdGgubG9nKHQoz4YxKSAvIHQoz4YwKSksIEYgPSBjb3PPhjAgKiBNYXRoLnBvdyh0KM+GMCksIG4pIC8gbjsKICAgIGlmICghbikgcmV0dXJuIGQzX2dlb19tZXJjYXRvcjsKICAgIGZ1bmN0aW9uIGZvcndhcmQozrssIM+GKSB7CiAgICAgIGlmIChGID4gMCkgewogICAgICAgIGlmICjPhiA8IC1oYWxmz4AgKyDOtSkgz4YgPSAtaGFsZs+AICsgzrU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKM+GID4gaGFsZs+AIC0gzrUpIM+GID0gaGFsZs+AIC0gzrU7CiAgICAgIH0KICAgICAgdmFyIM+BID0gRiAvIE1hdGgucG93KHQoz4YpLCBuKTsKICAgICAgcmV0dXJuIFsgz4EgKiBNYXRoLnNpbihuICogzrspLCBGIC0gz4EgKiBNYXRoLmNvcyhuICogzrspIF07CiAgICB9CiAgICBmb3J3YXJkLmludmVydCA9IGZ1bmN0aW9uKHgsIHkpIHsKICAgICAgdmFyIM+BMF95ID0gRiAtIHksIM+BID0gZDNfc2duKG4pICogTWF0aC5zcXJ0KHggKiB4ICsgz4EwX3kgKiDPgTBfeSk7CiAgICAgIHJldHVybiBbIE1hdGguYXRhbjIoeCwgz4EwX3kpIC8gbiwgMiAqIE1hdGguYXRhbihNYXRoLnBvdyhGIC8gz4EsIDEgLyBuKSkgLSBoYWxmz4AgXTsKICAgIH07CiAgICByZXR1cm4gZm9yd2FyZDsKICB9CiAgKGQzLmdlby5jb25pY0NvbmZvcm1hbCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX2dlb19jb25pYyhkM19nZW9fY29uaWNDb25mb3JtYWwpOwogIH0pLnJhdyA9IGQzX2dlb19jb25pY0NvbmZvcm1hbDsKICBmdW5jdGlvbiBkM19nZW9fY29uaWNFcXVpZGlzdGFudCjPhjAsIM+GMSkgewogICAgdmFyIGNvc8+GMCA9IE1hdGguY29zKM+GMCksIG4gPSDPhjAgPT09IM+GMSA/IE1hdGguc2luKM+GMCkgOiAoY29zz4YwIC0gTWF0aC5jb3Moz4YxKSkgLyAoz4YxIC0gz4YwKSwgRyA9IGNvc8+GMCAvIG4gKyDPhjA7CiAgICBpZiAoYWJzKG4pIDwgzrUpIHJldHVybiBkM19nZW9fZXF1aXJlY3Rhbmd1bGFyOwogICAgZnVuY3Rpb24gZm9yd2FyZCjOuywgz4YpIHsKICAgICAgdmFyIM+BID0gRyAtIM+GOwogICAgICByZXR1cm4gWyDPgSAqIE1hdGguc2luKG4gKiDOuyksIEcgLSDPgSAqIE1hdGguY29zKG4gKiDOuykgXTsKICAgIH0KICAgIGZvcndhcmQuaW52ZXJ0ID0gZnVuY3Rpb24oeCwgeSkgewogICAgICB2YXIgz4EwX3kgPSBHIC0geTsKICAgICAgcmV0dXJuIFsgTWF0aC5hdGFuMih4LCDPgTBfeSkgLyBuLCBHIC0gZDNfc2duKG4pICogTWF0aC5zcXJ0KHggKiB4ICsgz4EwX3kgKiDPgTBfeSkgXTsKICAgIH07CiAgICByZXR1cm4gZm9yd2FyZDsKICB9CiAgKGQzLmdlby5jb25pY0VxdWlkaXN0YW50ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZDNfZ2VvX2NvbmljKGQzX2dlb19jb25pY0VxdWlkaXN0YW50KTsKICB9KS5yYXcgPSBkM19nZW9fY29uaWNFcXVpZGlzdGFudDsKICB2YXIgZDNfZ2VvX2dub21vbmljID0gZDNfZ2VvX2F6aW11dGhhbChmdW5jdGlvbihjb3POu2Nvc8+GKSB7CiAgICByZXR1cm4gMSAvIGNvc867Y29zz4Y7CiAgfSwgTWF0aC5hdGFuKTsKICAoZDMuZ2VvLmdub21vbmljID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZDNfZ2VvX3Byb2plY3Rpb24oZDNfZ2VvX2dub21vbmljKTsKICB9KS5yYXcgPSBkM19nZW9fZ25vbW9uaWM7CiAgZnVuY3Rpb24gZDNfZ2VvX21lcmNhdG9yKM67LCDPhikgewogICAgcmV0dXJuIFsgzrssIE1hdGgubG9nKE1hdGgudGFuKM+AIC8gNCArIM+GIC8gMikpIF07CiAgfQogIGQzX2dlb19tZXJjYXRvci5pbnZlcnQgPSBmdW5jdGlvbih4LCB5KSB7CiAgICByZXR1cm4gWyB4LCAyICogTWF0aC5hdGFuKE1hdGguZXhwKHkpKSAtIGhhbGbPgCBdOwogIH07CiAgZnVuY3Rpb24gZDNfZ2VvX21lcmNhdG9yUHJvamVjdGlvbihwcm9qZWN0KSB7CiAgICB2YXIgbSA9IGQzX2dlb19wcm9qZWN0aW9uKHByb2plY3QpLCBzY2FsZSA9IG0uc2NhbGUsIHRyYW5zbGF0ZSA9IG0udHJhbnNsYXRlLCBjbGlwRXh0ZW50ID0gbS5jbGlwRXh0ZW50LCBjbGlwQXV0bzsKICAgIG0uc2NhbGUgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHYgPSBzY2FsZS5hcHBseShtLCBhcmd1bWVudHMpOwogICAgICByZXR1cm4gdiA9PT0gbSA/IGNsaXBBdXRvID8gbS5jbGlwRXh0ZW50KG51bGwpIDogbSA6IHY7CiAgICB9OwogICAgbS50cmFuc2xhdGUgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHYgPSB0cmFuc2xhdGUuYXBwbHkobSwgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIHYgPT09IG0gPyBjbGlwQXV0byA/IG0uY2xpcEV4dGVudChudWxsKSA6IG0gOiB2OwogICAgfTsKICAgIG0uY2xpcEV4dGVudCA9IGZ1bmN0aW9uKF8pIHsKICAgICAgdmFyIHYgPSBjbGlwRXh0ZW50LmFwcGx5KG0sIGFyZ3VtZW50cyk7CiAgICAgIGlmICh2ID09PSBtKSB7CiAgICAgICAgaWYgKGNsaXBBdXRvID0gXyA9PSBudWxsKSB7CiAgICAgICAgICB2YXIgayA9IM+AICogc2NhbGUoKSwgdCA9IHRyYW5zbGF0ZSgpOwogICAgICAgICAgY2xpcEV4dGVudChbIFsgdFswXSAtIGssIHRbMV0gLSBrIF0sIFsgdFswXSArIGssIHRbMV0gKyBrIF0gXSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGNsaXBBdXRvKSB7CiAgICAgICAgdiA9IG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIHY7CiAgICB9OwogICAgcmV0dXJuIG0uY2xpcEV4dGVudChudWxsKTsKICB9CiAgKGQzLmdlby5tZXJjYXRvciA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX2dlb19tZXJjYXRvclByb2plY3Rpb24oZDNfZ2VvX21lcmNhdG9yKTsKICB9KS5yYXcgPSBkM19nZW9fbWVyY2F0b3I7CiAgdmFyIGQzX2dlb19vcnRob2dyYXBoaWMgPSBkM19nZW9fYXppbXV0aGFsKGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIDE7CiAgfSwgTWF0aC5hc2luKTsKICAoZDMuZ2VvLm9ydGhvZ3JhcGhpYyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX2dlb19wcm9qZWN0aW9uKGQzX2dlb19vcnRob2dyYXBoaWMpOwogIH0pLnJhdyA9IGQzX2dlb19vcnRob2dyYXBoaWM7CiAgdmFyIGQzX2dlb19zdGVyZW9ncmFwaGljID0gZDNfZ2VvX2F6aW11dGhhbChmdW5jdGlvbihjb3POu2Nvc8+GKSB7CiAgICByZXR1cm4gMSAvICgxICsgY29zzrtjb3PPhik7CiAgfSwgZnVuY3Rpb24oz4EpIHsKICAgIHJldHVybiAyICogTWF0aC5hdGFuKM+BKTsKICB9KTsKICAoZDMuZ2VvLnN0ZXJlb2dyYXBoaWMgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM19nZW9fcHJvamVjdGlvbihkM19nZW9fc3RlcmVvZ3JhcGhpYyk7CiAgfSkucmF3ID0gZDNfZ2VvX3N0ZXJlb2dyYXBoaWM7CiAgZnVuY3Rpb24gZDNfZ2VvX3RyYW5zdmVyc2VNZXJjYXRvcijOuywgz4YpIHsKICAgIHJldHVybiBbIE1hdGgubG9nKE1hdGgudGFuKM+AIC8gNCArIM+GIC8gMikpLCAtzrsgXTsKICB9CiAgZDNfZ2VvX3RyYW5zdmVyc2VNZXJjYXRvci5pbnZlcnQgPSBmdW5jdGlvbih4LCB5KSB7CiAgICByZXR1cm4gWyAteSwgMiAqIE1hdGguYXRhbihNYXRoLmV4cCh4KSkgLSBoYWxmz4AgXTsKICB9OwogIChkMy5nZW8udHJhbnN2ZXJzZU1lcmNhdG9yID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgcHJvamVjdGlvbiA9IGQzX2dlb19tZXJjYXRvclByb2plY3Rpb24oZDNfZ2VvX3RyYW5zdmVyc2VNZXJjYXRvciksIGNlbnRlciA9IHByb2plY3Rpb24uY2VudGVyLCByb3RhdGUgPSBwcm9qZWN0aW9uLnJvdGF0ZTsKICAgIHByb2plY3Rpb24uY2VudGVyID0gZnVuY3Rpb24oXykgewogICAgICByZXR1cm4gXyA/IGNlbnRlcihbIC1fWzFdLCBfWzBdIF0pIDogKF8gPSBjZW50ZXIoKSwgWyBfWzFdLCAtX1swXSBdKTsKICAgIH07CiAgICBwcm9qZWN0aW9uLnJvdGF0ZSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgcmV0dXJuIF8gPyByb3RhdGUoWyBfWzBdLCBfWzFdLCBfLmxlbmd0aCA+IDIgPyBfWzJdICsgOTAgOiA5MCBdKSA6IChfID0gcm90YXRlKCksIAogICAgICBbIF9bMF0sIF9bMV0sIF9bMl0gLSA5MCBdKTsKICAgIH07CiAgICByZXR1cm4gcm90YXRlKFsgMCwgMCwgOTAgXSk7CiAgfSkucmF3ID0gZDNfZ2VvX3RyYW5zdmVyc2VNZXJjYXRvcjsKICBkMy5nZW9tID0ge307CiAgZnVuY3Rpb24gZDNfZ2VvbV9wb2ludFgoZCkgewogICAgcmV0dXJuIGRbMF07CiAgfQogIGZ1bmN0aW9uIGQzX2dlb21fcG9pbnRZKGQpIHsKICAgIHJldHVybiBkWzFdOwogIH0KICBkMy5nZW9tLmh1bGwgPSBmdW5jdGlvbih2ZXJ0aWNlcykgewogICAgdmFyIHggPSBkM19nZW9tX3BvaW50WCwgeSA9IGQzX2dlb21fcG9pbnRZOwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBodWxsKHZlcnRpY2VzKTsKICAgIGZ1bmN0aW9uIGh1bGwoZGF0YSkgewogICAgICBpZiAoZGF0YS5sZW5ndGggPCAzKSByZXR1cm4gW107CiAgICAgIHZhciBmeCA9IGQzX2Z1bmN0b3IoeCksIGZ5ID0gZDNfZnVuY3Rvcih5KSwgaSwgbiA9IGRhdGEubGVuZ3RoLCBwb2ludHMgPSBbXSwgZmxpcHBlZFBvaW50cyA9IFtdOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgcG9pbnRzLnB1c2goWyArZnguY2FsbCh0aGlzLCBkYXRhW2ldLCBpKSwgK2Z5LmNhbGwodGhpcywgZGF0YVtpXSwgaSksIGkgXSk7CiAgICAgIH0KICAgICAgcG9pbnRzLnNvcnQoZDNfZ2VvbV9odWxsT3JkZXIpOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSBmbGlwcGVkUG9pbnRzLnB1c2goWyBwb2ludHNbaV1bMF0sIC1wb2ludHNbaV1bMV0gXSk7CiAgICAgIHZhciB1cHBlciA9IGQzX2dlb21faHVsbFVwcGVyKHBvaW50cyksIGxvd2VyID0gZDNfZ2VvbV9odWxsVXBwZXIoZmxpcHBlZFBvaW50cyk7CiAgICAgIHZhciBza2lwTGVmdCA9IGxvd2VyWzBdID09PSB1cHBlclswXSwgc2tpcFJpZ2h0ID0gbG93ZXJbbG93ZXIubGVuZ3RoIC0gMV0gPT09IHVwcGVyW3VwcGVyLmxlbmd0aCAtIDFdLCBwb2x5Z29uID0gW107CiAgICAgIGZvciAoaSA9IHVwcGVyLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSBwb2x5Z29uLnB1c2goZGF0YVtwb2ludHNbdXBwZXJbaV1dWzJdXSk7CiAgICAgIGZvciAoaSA9ICtza2lwTGVmdDsgaSA8IGxvd2VyLmxlbmd0aCAtIHNraXBSaWdodDsgKytpKSBwb2x5Z29uLnB1c2goZGF0YVtwb2ludHNbbG93ZXJbaV1dWzJdXSk7CiAgICAgIHJldHVybiBwb2x5Z29uOwogICAgfQogICAgaHVsbC54ID0gZnVuY3Rpb24oXykgewogICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh4ID0gXywgaHVsbCkgOiB4OwogICAgfTsKICAgIGh1bGwueSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoeSA9IF8sIGh1bGwpIDogeTsKICAgIH07CiAgICByZXR1cm4gaHVsbDsKICB9OwogIGZ1bmN0aW9uIGQzX2dlb21faHVsbFVwcGVyKHBvaW50cykgewogICAgdmFyIG4gPSBwb2ludHMubGVuZ3RoLCBodWxsID0gWyAwLCAxIF0sIGhzID0gMjsKICAgIGZvciAodmFyIGkgPSAyOyBpIDwgbjsgaSsrKSB7CiAgICAgIHdoaWxlIChocyA+IDEgJiYgZDNfY3Jvc3MyZChwb2ludHNbaHVsbFtocyAtIDJdXSwgcG9pbnRzW2h1bGxbaHMgLSAxXV0sIHBvaW50c1tpXSkgPD0gMCkgLS1oczsKICAgICAgaHVsbFtocysrXSA9IGk7CiAgICB9CiAgICByZXR1cm4gaHVsbC5zbGljZSgwLCBocyk7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb21faHVsbE9yZGVyKGEsIGIpIHsKICAgIHJldHVybiBhWzBdIC0gYlswXSB8fCBhWzFdIC0gYlsxXTsKICB9CiAgZDMuZ2VvbS5wb2x5Z29uID0gZnVuY3Rpb24oY29vcmRpbmF0ZXMpIHsKICAgIGQzX3N1YmNsYXNzKGNvb3JkaW5hdGVzLCBkM19nZW9tX3BvbHlnb25Qcm90b3R5cGUpOwogICAgcmV0dXJuIGNvb3JkaW5hdGVzOwogIH07CiAgdmFyIGQzX2dlb21fcG9seWdvblByb3RvdHlwZSA9IGQzLmdlb20ucG9seWdvbi5wcm90b3R5cGUgPSBbXTsKICBkM19nZW9tX3BvbHlnb25Qcm90b3R5cGUuYXJlYSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGkgPSAtMSwgbiA9IHRoaXMubGVuZ3RoLCBhLCBiID0gdGhpc1tuIC0gMV0sIGFyZWEgPSAwOwogICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgYSA9IGI7CiAgICAgIGIgPSB0aGlzW2ldOwogICAgICBhcmVhICs9IGFbMV0gKiBiWzBdIC0gYVswXSAqIGJbMV07CiAgICB9CiAgICByZXR1cm4gYXJlYSAqIC41OwogIH07CiAgZDNfZ2VvbV9wb2x5Z29uUHJvdG90eXBlLmNlbnRyb2lkID0gZnVuY3Rpb24oaykgewogICAgdmFyIGkgPSAtMSwgbiA9IHRoaXMubGVuZ3RoLCB4ID0gMCwgeSA9IDAsIGEsIGIgPSB0aGlzW24gLSAxXSwgYzsKICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgayA9IC0xIC8gKDYgKiB0aGlzLmFyZWEoKSk7CiAgICB3aGlsZSAoKytpIDwgbikgewogICAgICBhID0gYjsKICAgICAgYiA9IHRoaXNbaV07CiAgICAgIGMgPSBhWzBdICogYlsxXSAtIGJbMF0gKiBhWzFdOwogICAgICB4ICs9IChhWzBdICsgYlswXSkgKiBjOwogICAgICB5ICs9IChhWzFdICsgYlsxXSkgKiBjOwogICAgfQogICAgcmV0dXJuIFsgeCAqIGssIHkgKiBrIF07CiAgfTsKICBkM19nZW9tX3BvbHlnb25Qcm90b3R5cGUuY2xpcCA9IGZ1bmN0aW9uKHN1YmplY3QpIHsKICAgIHZhciBpbnB1dCwgY2xvc2VkID0gZDNfZ2VvbV9wb2x5Z29uQ2xvc2VkKHN1YmplY3QpLCBpID0gLTEsIG4gPSB0aGlzLmxlbmd0aCAtIGQzX2dlb21fcG9seWdvbkNsb3NlZCh0aGlzKSwgaiwgbSwgYSA9IHRoaXNbbiAtIDFdLCBiLCBjLCBkOwogICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgaW5wdXQgPSBzdWJqZWN0LnNsaWNlKCk7CiAgICAgIHN1YmplY3QubGVuZ3RoID0gMDsKICAgICAgYiA9IHRoaXNbaV07CiAgICAgIGMgPSBpbnB1dFsobSA9IGlucHV0Lmxlbmd0aCAtIGNsb3NlZCkgLSAxXTsKICAgICAgaiA9IC0xOwogICAgICB3aGlsZSAoKytqIDwgbSkgewogICAgICAgIGQgPSBpbnB1dFtqXTsKICAgICAgICBpZiAoZDNfZ2VvbV9wb2x5Z29uSW5zaWRlKGQsIGEsIGIpKSB7CiAgICAgICAgICBpZiAoIWQzX2dlb21fcG9seWdvbkluc2lkZShjLCBhLCBiKSkgewogICAgICAgICAgICBzdWJqZWN0LnB1c2goZDNfZ2VvbV9wb2x5Z29uSW50ZXJzZWN0KGMsIGQsIGEsIGIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHN1YmplY3QucHVzaChkKTsKICAgICAgICB9IGVsc2UgaWYgKGQzX2dlb21fcG9seWdvbkluc2lkZShjLCBhLCBiKSkgewogICAgICAgICAgc3ViamVjdC5wdXNoKGQzX2dlb21fcG9seWdvbkludGVyc2VjdChjLCBkLCBhLCBiKSk7CiAgICAgICAgfQogICAgICAgIGMgPSBkOwogICAgICB9CiAgICAgIGlmIChjbG9zZWQpIHN1YmplY3QucHVzaChzdWJqZWN0WzBdKTsKICAgICAgYSA9IGI7CiAgICB9CiAgICByZXR1cm4gc3ViamVjdDsKICB9OwogIGZ1bmN0aW9uIGQzX2dlb21fcG9seWdvbkluc2lkZShwLCBhLCBiKSB7CiAgICByZXR1cm4gKGJbMF0gLSBhWzBdKSAqIChwWzFdIC0gYVsxXSkgPCAoYlsxXSAtIGFbMV0pICogKHBbMF0gLSBhWzBdKTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvbV9wb2x5Z29uSW50ZXJzZWN0KGMsIGQsIGEsIGIpIHsKICAgIHZhciB4MSA9IGNbMF0sIHgzID0gYVswXSwgeDIxID0gZFswXSAtIHgxLCB4NDMgPSBiWzBdIC0geDMsIHkxID0gY1sxXSwgeTMgPSBhWzFdLCB5MjEgPSBkWzFdIC0geTEsIHk0MyA9IGJbMV0gLSB5MywgdWEgPSAoeDQzICogKHkxIC0geTMpIC0geTQzICogKHgxIC0geDMpKSAvICh5NDMgKiB4MjEgLSB4NDMgKiB5MjEpOwogICAgcmV0dXJuIFsgeDEgKyB1YSAqIHgyMSwgeTEgKyB1YSAqIHkyMSBdOwogIH0KICBmdW5jdGlvbiBkM19nZW9tX3BvbHlnb25DbG9zZWQoY29vcmRpbmF0ZXMpIHsKICAgIHZhciBhID0gY29vcmRpbmF0ZXNbMF0sIGIgPSBjb29yZGluYXRlc1tjb29yZGluYXRlcy5sZW5ndGggLSAxXTsKICAgIHJldHVybiAhKGFbMF0gLSBiWzBdIHx8IGFbMV0gLSBiWzFdKTsKICB9CiAgdmFyIGQzX2dlb21fdm9yb25vaUVkZ2VzLCBkM19nZW9tX3Zvcm9ub2lDZWxscywgZDNfZ2VvbV92b3Jvbm9pQmVhY2hlcywgZDNfZ2VvbV92b3Jvbm9pQmVhY2hQb29sID0gW10sIGQzX2dlb21fdm9yb25vaUZpcnN0Q2lyY2xlLCBkM19nZW9tX3Zvcm9ub2lDaXJjbGVzLCBkM19nZW9tX3Zvcm9ub2lDaXJjbGVQb29sID0gW107CiAgZnVuY3Rpb24gZDNfZ2VvbV92b3Jvbm9pQmVhY2goKSB7CiAgICBkM19nZW9tX3Zvcm9ub2lSZWRCbGFja05vZGUodGhpcyk7CiAgICB0aGlzLmVkZ2UgPSB0aGlzLnNpdGUgPSB0aGlzLmNpcmNsZSA9IG51bGw7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb21fdm9yb25vaUNyZWF0ZUJlYWNoKHNpdGUpIHsKICAgIHZhciBiZWFjaCA9IGQzX2dlb21fdm9yb25vaUJlYWNoUG9vbC5wb3AoKSB8fCBuZXcgZDNfZ2VvbV92b3Jvbm9pQmVhY2goKTsKICAgIGJlYWNoLnNpdGUgPSBzaXRlOwogICAgcmV0dXJuIGJlYWNoOwogIH0KICBmdW5jdGlvbiBkM19nZW9tX3Zvcm9ub2lEZXRhY2hCZWFjaChiZWFjaCkgewogICAgZDNfZ2VvbV92b3Jvbm9pRGV0YWNoQ2lyY2xlKGJlYWNoKTsKICAgIGQzX2dlb21fdm9yb25vaUJlYWNoZXMucmVtb3ZlKGJlYWNoKTsKICAgIGQzX2dlb21fdm9yb25vaUJlYWNoUG9vbC5wdXNoKGJlYWNoKTsKICAgIGQzX2dlb21fdm9yb25vaVJlZEJsYWNrTm9kZShiZWFjaCk7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb21fdm9yb25vaVJlbW92ZUJlYWNoKGJlYWNoKSB7CiAgICB2YXIgY2lyY2xlID0gYmVhY2guY2lyY2xlLCB4ID0gY2lyY2xlLngsIHkgPSBjaXJjbGUuY3ksIHZlcnRleCA9IHsKICAgICAgeDogeCwKICAgICAgeTogeQogICAgfSwgcHJldmlvdXMgPSBiZWFjaC5QLCBuZXh0ID0gYmVhY2guTiwgZGlzYXBwZWFyaW5nID0gWyBiZWFjaCBdOwogICAgZDNfZ2VvbV92b3Jvbm9pRGV0YWNoQmVhY2goYmVhY2gpOwogICAgdmFyIGxBcmMgPSBwcmV2aW91czsKICAgIHdoaWxlIChsQXJjLmNpcmNsZSAmJiBhYnMoeCAtIGxBcmMuY2lyY2xlLngpIDwgzrUgJiYgYWJzKHkgLSBsQXJjLmNpcmNsZS5jeSkgPCDOtSkgewogICAgICBwcmV2aW91cyA9IGxBcmMuUDsKICAgICAgZGlzYXBwZWFyaW5nLnVuc2hpZnQobEFyYyk7CiAgICAgIGQzX2dlb21fdm9yb25vaURldGFjaEJlYWNoKGxBcmMpOwogICAgICBsQXJjID0gcHJldmlvdXM7CiAgICB9CiAgICBkaXNhcHBlYXJpbmcudW5zaGlmdChsQXJjKTsKICAgIGQzX2dlb21fdm9yb25vaURldGFjaENpcmNsZShsQXJjKTsKICAgIHZhciByQXJjID0gbmV4dDsKICAgIHdoaWxlIChyQXJjLmNpcmNsZSAmJiBhYnMoeCAtIHJBcmMuY2lyY2xlLngpIDwgzrUgJiYgYWJzKHkgLSByQXJjLmNpcmNsZS5jeSkgPCDOtSkgewogICAgICBuZXh0ID0gckFyYy5OOwogICAgICBkaXNhcHBlYXJpbmcucHVzaChyQXJjKTsKICAgICAgZDNfZ2VvbV92b3Jvbm9pRGV0YWNoQmVhY2gockFyYyk7CiAgICAgIHJBcmMgPSBuZXh0OwogICAgfQogICAgZGlzYXBwZWFyaW5nLnB1c2gockFyYyk7CiAgICBkM19nZW9tX3Zvcm9ub2lEZXRhY2hDaXJjbGUockFyYyk7CiAgICB2YXIgbkFyY3MgPSBkaXNhcHBlYXJpbmcubGVuZ3RoLCBpQXJjOwogICAgZm9yIChpQXJjID0gMTsgaUFyYyA8IG5BcmNzOyArK2lBcmMpIHsKICAgICAgckFyYyA9IGRpc2FwcGVhcmluZ1tpQXJjXTsKICAgICAgbEFyYyA9IGRpc2FwcGVhcmluZ1tpQXJjIC0gMV07CiAgICAgIGQzX2dlb21fdm9yb25vaVNldEVkZ2VFbmQockFyYy5lZGdlLCBsQXJjLnNpdGUsIHJBcmMuc2l0ZSwgdmVydGV4KTsKICAgIH0KICAgIGxBcmMgPSBkaXNhcHBlYXJpbmdbMF07CiAgICByQXJjID0gZGlzYXBwZWFyaW5nW25BcmNzIC0gMV07CiAgICByQXJjLmVkZ2UgPSBkM19nZW9tX3Zvcm9ub2lDcmVhdGVFZGdlKGxBcmMuc2l0ZSwgckFyYy5zaXRlLCBudWxsLCB2ZXJ0ZXgpOwogICAgZDNfZ2VvbV92b3Jvbm9pQXR0YWNoQ2lyY2xlKGxBcmMpOwogICAgZDNfZ2VvbV92b3Jvbm9pQXR0YWNoQ2lyY2xlKHJBcmMpOwogIH0KICBmdW5jdGlvbiBkM19nZW9tX3Zvcm9ub2lBZGRCZWFjaChzaXRlKSB7CiAgICB2YXIgeCA9IHNpdGUueCwgZGlyZWN0cml4ID0gc2l0ZS55LCBsQXJjLCByQXJjLCBkeGwsIGR4ciwgbm9kZSA9IGQzX2dlb21fdm9yb25vaUJlYWNoZXMuXzsKICAgIHdoaWxlIChub2RlKSB7CiAgICAgIGR4bCA9IGQzX2dlb21fdm9yb25vaUxlZnRCcmVha1BvaW50KG5vZGUsIGRpcmVjdHJpeCkgLSB4OwogICAgICBpZiAoZHhsID4gzrUpIG5vZGUgPSBub2RlLkw7IGVsc2UgewogICAgICAgIGR4ciA9IHggLSBkM19nZW9tX3Zvcm9ub2lSaWdodEJyZWFrUG9pbnQobm9kZSwgZGlyZWN0cml4KTsKICAgICAgICBpZiAoZHhyID4gzrUpIHsKICAgICAgICAgIGlmICghbm9kZS5SKSB7CiAgICAgICAgICAgIGxBcmMgPSBub2RlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIG5vZGUgPSBub2RlLlI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChkeGwgPiAtzrUpIHsKICAgICAgICAgICAgbEFyYyA9IG5vZGUuUDsKICAgICAgICAgICAgckFyYyA9IG5vZGU7CiAgICAgICAgICB9IGVsc2UgaWYgKGR4ciA+IC3OtSkgewogICAgICAgICAgICBsQXJjID0gbm9kZTsKICAgICAgICAgICAgckFyYyA9IG5vZGUuTjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxBcmMgPSByQXJjID0gbm9kZTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdmFyIG5ld0FyYyA9IGQzX2dlb21fdm9yb25vaUNyZWF0ZUJlYWNoKHNpdGUpOwogICAgZDNfZ2VvbV92b3Jvbm9pQmVhY2hlcy5pbnNlcnQobEFyYywgbmV3QXJjKTsKICAgIGlmICghbEFyYyAmJiAhckFyYykgcmV0dXJuOwogICAgaWYgKGxBcmMgPT09IHJBcmMpIHsKICAgICAgZDNfZ2VvbV92b3Jvbm9pRGV0YWNoQ2lyY2xlKGxBcmMpOwogICAgICByQXJjID0gZDNfZ2VvbV92b3Jvbm9pQ3JlYXRlQmVhY2gobEFyYy5zaXRlKTsKICAgICAgZDNfZ2VvbV92b3Jvbm9pQmVhY2hlcy5pbnNlcnQobmV3QXJjLCByQXJjKTsKICAgICAgbmV3QXJjLmVkZ2UgPSByQXJjLmVkZ2UgPSBkM19nZW9tX3Zvcm9ub2lDcmVhdGVFZGdlKGxBcmMuc2l0ZSwgbmV3QXJjLnNpdGUpOwogICAgICBkM19nZW9tX3Zvcm9ub2lBdHRhY2hDaXJjbGUobEFyYyk7CiAgICAgIGQzX2dlb21fdm9yb25vaUF0dGFjaENpcmNsZShyQXJjKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCFyQXJjKSB7CiAgICAgIG5ld0FyYy5lZGdlID0gZDNfZ2VvbV92b3Jvbm9pQ3JlYXRlRWRnZShsQXJjLnNpdGUsIG5ld0FyYy5zaXRlKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgZDNfZ2VvbV92b3Jvbm9pRGV0YWNoQ2lyY2xlKGxBcmMpOwogICAgZDNfZ2VvbV92b3Jvbm9pRGV0YWNoQ2lyY2xlKHJBcmMpOwogICAgdmFyIGxTaXRlID0gbEFyYy5zaXRlLCBheCA9IGxTaXRlLngsIGF5ID0gbFNpdGUueSwgYnggPSBzaXRlLnggLSBheCwgYnkgPSBzaXRlLnkgLSBheSwgclNpdGUgPSByQXJjLnNpdGUsIGN4ID0gclNpdGUueCAtIGF4LCBjeSA9IHJTaXRlLnkgLSBheSwgZCA9IDIgKiAoYnggKiBjeSAtIGJ5ICogY3gpLCBoYiA9IGJ4ICogYnggKyBieSAqIGJ5LCBoYyA9IGN4ICogY3ggKyBjeSAqIGN5LCB2ZXJ0ZXggPSB7CiAgICAgIHg6IChjeSAqIGhiIC0gYnkgKiBoYykgLyBkICsgYXgsCiAgICAgIHk6IChieCAqIGhjIC0gY3ggKiBoYikgLyBkICsgYXkKICAgIH07CiAgICBkM19nZW9tX3Zvcm9ub2lTZXRFZGdlRW5kKHJBcmMuZWRnZSwgbFNpdGUsIHJTaXRlLCB2ZXJ0ZXgpOwogICAgbmV3QXJjLmVkZ2UgPSBkM19nZW9tX3Zvcm9ub2lDcmVhdGVFZGdlKGxTaXRlLCBzaXRlLCBudWxsLCB2ZXJ0ZXgpOwogICAgckFyYy5lZGdlID0gZDNfZ2VvbV92b3Jvbm9pQ3JlYXRlRWRnZShzaXRlLCByU2l0ZSwgbnVsbCwgdmVydGV4KTsKICAgIGQzX2dlb21fdm9yb25vaUF0dGFjaENpcmNsZShsQXJjKTsKICAgIGQzX2dlb21fdm9yb25vaUF0dGFjaENpcmNsZShyQXJjKTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvbV92b3Jvbm9pTGVmdEJyZWFrUG9pbnQoYXJjLCBkaXJlY3RyaXgpIHsKICAgIHZhciBzaXRlID0gYXJjLnNpdGUsIHJmb2N4ID0gc2l0ZS54LCByZm9jeSA9IHNpdGUueSwgcGJ5MiA9IHJmb2N5IC0gZGlyZWN0cml4OwogICAgaWYgKCFwYnkyKSByZXR1cm4gcmZvY3g7CiAgICB2YXIgbEFyYyA9IGFyYy5QOwogICAgaWYgKCFsQXJjKSByZXR1cm4gLUluZmluaXR5OwogICAgc2l0ZSA9IGxBcmMuc2l0ZTsKICAgIHZhciBsZm9jeCA9IHNpdGUueCwgbGZvY3kgPSBzaXRlLnksIHBsYnkyID0gbGZvY3kgLSBkaXJlY3RyaXg7CiAgICBpZiAoIXBsYnkyKSByZXR1cm4gbGZvY3g7CiAgICB2YXIgaGwgPSBsZm9jeCAtIHJmb2N4LCBhYnkyID0gMSAvIHBieTIgLSAxIC8gcGxieTIsIGIgPSBobCAvIHBsYnkyOwogICAgaWYgKGFieTIpIHJldHVybiAoLWIgKyBNYXRoLnNxcnQoYiAqIGIgLSAyICogYWJ5MiAqIChobCAqIGhsIC8gKC0yICogcGxieTIpIC0gbGZvY3kgKyBwbGJ5MiAvIDIgKyByZm9jeSAtIHBieTIgLyAyKSkpIC8gYWJ5MiArIHJmb2N4OwogICAgcmV0dXJuIChyZm9jeCArIGxmb2N4KSAvIDI7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb21fdm9yb25vaVJpZ2h0QnJlYWtQb2ludChhcmMsIGRpcmVjdHJpeCkgewogICAgdmFyIHJBcmMgPSBhcmMuTjsKICAgIGlmIChyQXJjKSByZXR1cm4gZDNfZ2VvbV92b3Jvbm9pTGVmdEJyZWFrUG9pbnQockFyYywgZGlyZWN0cml4KTsKICAgIHZhciBzaXRlID0gYXJjLnNpdGU7CiAgICByZXR1cm4gc2l0ZS55ID09PSBkaXJlY3RyaXggPyBzaXRlLnggOiBJbmZpbml0eTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvbV92b3Jvbm9pQ2VsbChzaXRlKSB7CiAgICB0aGlzLnNpdGUgPSBzaXRlOwogICAgdGhpcy5lZGdlcyA9IFtdOwogIH0KICBkM19nZW9tX3Zvcm9ub2lDZWxsLnByb3RvdHlwZS5wcmVwYXJlID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgaGFsZkVkZ2VzID0gdGhpcy5lZGdlcywgaUhhbGZFZGdlID0gaGFsZkVkZ2VzLmxlbmd0aCwgZWRnZTsKICAgIHdoaWxlIChpSGFsZkVkZ2UtLSkgewogICAgICBlZGdlID0gaGFsZkVkZ2VzW2lIYWxmRWRnZV0uZWRnZTsKICAgICAgaWYgKCFlZGdlLmIgfHwgIWVkZ2UuYSkgaGFsZkVkZ2VzLnNwbGljZShpSGFsZkVkZ2UsIDEpOwogICAgfQogICAgaGFsZkVkZ2VzLnNvcnQoZDNfZ2VvbV92b3Jvbm9pSGFsZkVkZ2VPcmRlcik7CiAgICByZXR1cm4gaGFsZkVkZ2VzLmxlbmd0aDsKICB9OwogIGZ1bmN0aW9uIGQzX2dlb21fdm9yb25vaUNsb3NlQ2VsbHMoZXh0ZW50KSB7CiAgICB2YXIgeDAgPSBleHRlbnRbMF1bMF0sIHgxID0gZXh0ZW50WzFdWzBdLCB5MCA9IGV4dGVudFswXVsxXSwgeTEgPSBleHRlbnRbMV1bMV0sIHgyLCB5MiwgeDMsIHkzLCBjZWxscyA9IGQzX2dlb21fdm9yb25vaUNlbGxzLCBpQ2VsbCA9IGNlbGxzLmxlbmd0aCwgY2VsbCwgaUhhbGZFZGdlLCBoYWxmRWRnZXMsIG5IYWxmRWRnZXMsIHN0YXJ0LCBlbmQ7CiAgICB3aGlsZSAoaUNlbGwtLSkgewogICAgICBjZWxsID0gY2VsbHNbaUNlbGxdOwogICAgICBpZiAoIWNlbGwgfHwgIWNlbGwucHJlcGFyZSgpKSBjb250aW51ZTsKICAgICAgaGFsZkVkZ2VzID0gY2VsbC5lZGdlczsKICAgICAgbkhhbGZFZGdlcyA9IGhhbGZFZGdlcy5sZW5ndGg7CiAgICAgIGlIYWxmRWRnZSA9IDA7CiAgICAgIHdoaWxlIChpSGFsZkVkZ2UgPCBuSGFsZkVkZ2VzKSB7CiAgICAgICAgZW5kID0gaGFsZkVkZ2VzW2lIYWxmRWRnZV0uZW5kKCksIHgzID0gZW5kLngsIHkzID0gZW5kLnk7CiAgICAgICAgc3RhcnQgPSBoYWxmRWRnZXNbKytpSGFsZkVkZ2UgJSBuSGFsZkVkZ2VzXS5zdGFydCgpLCB4MiA9IHN0YXJ0LngsIHkyID0gc3RhcnQueTsKICAgICAgICBpZiAoYWJzKHgzIC0geDIpID4gzrUgfHwgYWJzKHkzIC0geTIpID4gzrUpIHsKICAgICAgICAgIGhhbGZFZGdlcy5zcGxpY2UoaUhhbGZFZGdlLCAwLCBuZXcgZDNfZ2VvbV92b3Jvbm9pSGFsZkVkZ2UoZDNfZ2VvbV92b3Jvbm9pQ3JlYXRlQm9yZGVyRWRnZShjZWxsLnNpdGUsIGVuZCwgYWJzKHgzIC0geDApIDwgzrUgJiYgeTEgLSB5MyA+IM61ID8gewogICAgICAgICAgICB4OiB4MCwKICAgICAgICAgICAgeTogYWJzKHgyIC0geDApIDwgzrUgPyB5MiA6IHkxCiAgICAgICAgICB9IDogYWJzKHkzIC0geTEpIDwgzrUgJiYgeDEgLSB4MyA+IM61ID8gewogICAgICAgICAgICB4OiBhYnMoeTIgLSB5MSkgPCDOtSA/IHgyIDogeDEsCiAgICAgICAgICAgIHk6IHkxCiAgICAgICAgICB9IDogYWJzKHgzIC0geDEpIDwgzrUgJiYgeTMgLSB5MCA+IM61ID8gewogICAgICAgICAgICB4OiB4MSwKICAgICAgICAgICAgeTogYWJzKHgyIC0geDEpIDwgzrUgPyB5MiA6IHkwCiAgICAgICAgICB9IDogYWJzKHkzIC0geTApIDwgzrUgJiYgeDMgLSB4MCA+IM61ID8gewogICAgICAgICAgICB4OiBhYnMoeTIgLSB5MCkgPCDOtSA/IHgyIDogeDAsCiAgICAgICAgICAgIHk6IHkwCiAgICAgICAgICB9IDogbnVsbCksIGNlbGwuc2l0ZSwgbnVsbCkpOwogICAgICAgICAgKytuSGFsZkVkZ2VzOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICBmdW5jdGlvbiBkM19nZW9tX3Zvcm9ub2lIYWxmRWRnZU9yZGVyKGEsIGIpIHsKICAgIHJldHVybiBiLmFuZ2xlIC0gYS5hbmdsZTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvbV92b3Jvbm9pQ2lyY2xlKCkgewogICAgZDNfZ2VvbV92b3Jvbm9pUmVkQmxhY2tOb2RlKHRoaXMpOwogICAgdGhpcy54ID0gdGhpcy55ID0gdGhpcy5hcmMgPSB0aGlzLnNpdGUgPSB0aGlzLmN5ID0gbnVsbDsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvbV92b3Jvbm9pQXR0YWNoQ2lyY2xlKGFyYykgewogICAgdmFyIGxBcmMgPSBhcmMuUCwgckFyYyA9IGFyYy5OOwogICAgaWYgKCFsQXJjIHx8ICFyQXJjKSByZXR1cm47CiAgICB2YXIgbFNpdGUgPSBsQXJjLnNpdGUsIGNTaXRlID0gYXJjLnNpdGUsIHJTaXRlID0gckFyYy5zaXRlOwogICAgaWYgKGxTaXRlID09PSByU2l0ZSkgcmV0dXJuOwogICAgdmFyIGJ4ID0gY1NpdGUueCwgYnkgPSBjU2l0ZS55LCBheCA9IGxTaXRlLnggLSBieCwgYXkgPSBsU2l0ZS55IC0gYnksIGN4ID0gclNpdGUueCAtIGJ4LCBjeSA9IHJTaXRlLnkgLSBieTsKICAgIHZhciBkID0gMiAqIChheCAqIGN5IC0gYXkgKiBjeCk7CiAgICBpZiAoZCA+PSAtzrUyKSByZXR1cm47CiAgICB2YXIgaGEgPSBheCAqIGF4ICsgYXkgKiBheSwgaGMgPSBjeCAqIGN4ICsgY3kgKiBjeSwgeCA9IChjeSAqIGhhIC0gYXkgKiBoYykgLyBkLCB5ID0gKGF4ICogaGMgLSBjeCAqIGhhKSAvIGQsIGN5ID0geSArIGJ5OwogICAgdmFyIGNpcmNsZSA9IGQzX2dlb21fdm9yb25vaUNpcmNsZVBvb2wucG9wKCkgfHwgbmV3IGQzX2dlb21fdm9yb25vaUNpcmNsZSgpOwogICAgY2lyY2xlLmFyYyA9IGFyYzsKICAgIGNpcmNsZS5zaXRlID0gY1NpdGU7CiAgICBjaXJjbGUueCA9IHggKyBieDsKICAgIGNpcmNsZS55ID0gY3kgKyBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSk7CiAgICBjaXJjbGUuY3kgPSBjeTsKICAgIGFyYy5jaXJjbGUgPSBjaXJjbGU7CiAgICB2YXIgYmVmb3JlID0gbnVsbCwgbm9kZSA9IGQzX2dlb21fdm9yb25vaUNpcmNsZXMuXzsKICAgIHdoaWxlIChub2RlKSB7CiAgICAgIGlmIChjaXJjbGUueSA8IG5vZGUueSB8fCBjaXJjbGUueSA9PT0gbm9kZS55ICYmIGNpcmNsZS54IDw9IG5vZGUueCkgewogICAgICAgIGlmIChub2RlLkwpIG5vZGUgPSBub2RlLkw7IGVsc2UgewogICAgICAgICAgYmVmb3JlID0gbm9kZS5QOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChub2RlLlIpIG5vZGUgPSBub2RlLlI7IGVsc2UgewogICAgICAgICAgYmVmb3JlID0gbm9kZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZDNfZ2VvbV92b3Jvbm9pQ2lyY2xlcy5pbnNlcnQoYmVmb3JlLCBjaXJjbGUpOwogICAgaWYgKCFiZWZvcmUpIGQzX2dlb21fdm9yb25vaUZpcnN0Q2lyY2xlID0gY2lyY2xlOwogIH0KICBmdW5jdGlvbiBkM19nZW9tX3Zvcm9ub2lEZXRhY2hDaXJjbGUoYXJjKSB7CiAgICB2YXIgY2lyY2xlID0gYXJjLmNpcmNsZTsKICAgIGlmIChjaXJjbGUpIHsKICAgICAgaWYgKCFjaXJjbGUuUCkgZDNfZ2VvbV92b3Jvbm9pRmlyc3RDaXJjbGUgPSBjaXJjbGUuTjsKICAgICAgZDNfZ2VvbV92b3Jvbm9pQ2lyY2xlcy5yZW1vdmUoY2lyY2xlKTsKICAgICAgZDNfZ2VvbV92b3Jvbm9pQ2lyY2xlUG9vbC5wdXNoKGNpcmNsZSk7CiAgICAgIGQzX2dlb21fdm9yb25vaVJlZEJsYWNrTm9kZShjaXJjbGUpOwogICAgICBhcmMuY2lyY2xlID0gbnVsbDsKICAgIH0KICB9CiAgZnVuY3Rpb24gZDNfZ2VvbV92b3Jvbm9pQ2xpcEVkZ2VzKGV4dGVudCkgewogICAgdmFyIGVkZ2VzID0gZDNfZ2VvbV92b3Jvbm9pRWRnZXMsIGNsaXAgPSBkM19nZW9tX2NsaXBMaW5lKGV4dGVudFswXVswXSwgZXh0ZW50WzBdWzFdLCBleHRlbnRbMV1bMF0sIGV4dGVudFsxXVsxXSksIGkgPSBlZGdlcy5sZW5ndGgsIGU7CiAgICB3aGlsZSAoaS0tKSB7CiAgICAgIGUgPSBlZGdlc1tpXTsKICAgICAgaWYgKCFkM19nZW9tX3Zvcm9ub2lDb25uZWN0RWRnZShlLCBleHRlbnQpIHx8ICFjbGlwKGUpIHx8IGFicyhlLmEueCAtIGUuYi54KSA8IM61ICYmIGFicyhlLmEueSAtIGUuYi55KSA8IM61KSB7CiAgICAgICAgZS5hID0gZS5iID0gbnVsbDsKICAgICAgICBlZGdlcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICB9CiAgZnVuY3Rpb24gZDNfZ2VvbV92b3Jvbm9pQ29ubmVjdEVkZ2UoZWRnZSwgZXh0ZW50KSB7CiAgICB2YXIgdmIgPSBlZGdlLmI7CiAgICBpZiAodmIpIHJldHVybiB0cnVlOwogICAgdmFyIHZhID0gZWRnZS5hLCB4MCA9IGV4dGVudFswXVswXSwgeDEgPSBleHRlbnRbMV1bMF0sIHkwID0gZXh0ZW50WzBdWzFdLCB5MSA9IGV4dGVudFsxXVsxXSwgbFNpdGUgPSBlZGdlLmwsIHJTaXRlID0gZWRnZS5yLCBseCA9IGxTaXRlLngsIGx5ID0gbFNpdGUueSwgcnggPSByU2l0ZS54LCByeSA9IHJTaXRlLnksIGZ4ID0gKGx4ICsgcngpIC8gMiwgZnkgPSAobHkgKyByeSkgLyAyLCBmbSwgZmI7CiAgICBpZiAocnkgPT09IGx5KSB7CiAgICAgIGlmIChmeCA8IHgwIHx8IGZ4ID49IHgxKSByZXR1cm47CiAgICAgIGlmIChseCA+IHJ4KSB7CiAgICAgICAgaWYgKCF2YSkgdmEgPSB7CiAgICAgICAgICB4OiBmeCwKICAgICAgICAgIHk6IHkwCiAgICAgICAgfTsgZWxzZSBpZiAodmEueSA+PSB5MSkgcmV0dXJuOwogICAgICAgIHZiID0gewogICAgICAgICAgeDogZngsCiAgICAgICAgICB5OiB5MQogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF2YSkgdmEgPSB7CiAgICAgICAgICB4OiBmeCwKICAgICAgICAgIHk6IHkxCiAgICAgICAgfTsgZWxzZSBpZiAodmEueSA8IHkwKSByZXR1cm47CiAgICAgICAgdmIgPSB7CiAgICAgICAgICB4OiBmeCwKICAgICAgICAgIHk6IHkwCiAgICAgICAgfTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZm0gPSAobHggLSByeCkgLyAocnkgLSBseSk7CiAgICAgIGZiID0gZnkgLSBmbSAqIGZ4OwogICAgICBpZiAoZm0gPCAtMSB8fCBmbSA+IDEpIHsKICAgICAgICBpZiAobHggPiByeCkgewogICAgICAgICAgaWYgKCF2YSkgdmEgPSB7CiAgICAgICAgICAgIHg6ICh5MCAtIGZiKSAvIGZtLAogICAgICAgICAgICB5OiB5MAogICAgICAgICAgfTsgZWxzZSBpZiAodmEueSA+PSB5MSkgcmV0dXJuOwogICAgICAgICAgdmIgPSB7CiAgICAgICAgICAgIHg6ICh5MSAtIGZiKSAvIGZtLAogICAgICAgICAgICB5OiB5MQogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKCF2YSkgdmEgPSB7CiAgICAgICAgICAgIHg6ICh5MSAtIGZiKSAvIGZtLAogICAgICAgICAgICB5OiB5MQogICAgICAgICAgfTsgZWxzZSBpZiAodmEueSA8IHkwKSByZXR1cm47CiAgICAgICAgICB2YiA9IHsKICAgICAgICAgICAgeDogKHkwIC0gZmIpIC8gZm0sCiAgICAgICAgICAgIHk6IHkwCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAobHkgPCByeSkgewogICAgICAgICAgaWYgKCF2YSkgdmEgPSB7CiAgICAgICAgICAgIHg6IHgwLAogICAgICAgICAgICB5OiBmbSAqIHgwICsgZmIKICAgICAgICAgIH07IGVsc2UgaWYgKHZhLnggPj0geDEpIHJldHVybjsKICAgICAgICAgIHZiID0gewogICAgICAgICAgICB4OiB4MSwKICAgICAgICAgICAgeTogZm0gKiB4MSArIGZiCiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoIXZhKSB2YSA9IHsKICAgICAgICAgICAgeDogeDEsCiAgICAgICAgICAgIHk6IGZtICogeDEgKyBmYgogICAgICAgICAgfTsgZWxzZSBpZiAodmEueCA8IHgwKSByZXR1cm47CiAgICAgICAgICB2YiA9IHsKICAgICAgICAgICAgeDogeDAsCiAgICAgICAgICAgIHk6IGZtICogeDAgKyBmYgogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGVkZ2UuYSA9IHZhOwogICAgZWRnZS5iID0gdmI7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvbV92b3Jvbm9pRWRnZShsU2l0ZSwgclNpdGUpIHsKICAgIHRoaXMubCA9IGxTaXRlOwogICAgdGhpcy5yID0gclNpdGU7CiAgICB0aGlzLmEgPSB0aGlzLmIgPSBudWxsOwogIH0KICBmdW5jdGlvbiBkM19nZW9tX3Zvcm9ub2lDcmVhdGVFZGdlKGxTaXRlLCByU2l0ZSwgdmEsIHZiKSB7CiAgICB2YXIgZWRnZSA9IG5ldyBkM19nZW9tX3Zvcm9ub2lFZGdlKGxTaXRlLCByU2l0ZSk7CiAgICBkM19nZW9tX3Zvcm9ub2lFZGdlcy5wdXNoKGVkZ2UpOwogICAgaWYgKHZhKSBkM19nZW9tX3Zvcm9ub2lTZXRFZGdlRW5kKGVkZ2UsIGxTaXRlLCByU2l0ZSwgdmEpOwogICAgaWYgKHZiKSBkM19nZW9tX3Zvcm9ub2lTZXRFZGdlRW5kKGVkZ2UsIHJTaXRlLCBsU2l0ZSwgdmIpOwogICAgZDNfZ2VvbV92b3Jvbm9pQ2VsbHNbbFNpdGUuaV0uZWRnZXMucHVzaChuZXcgZDNfZ2VvbV92b3Jvbm9pSGFsZkVkZ2UoZWRnZSwgbFNpdGUsIHJTaXRlKSk7CiAgICBkM19nZW9tX3Zvcm9ub2lDZWxsc1tyU2l0ZS5pXS5lZGdlcy5wdXNoKG5ldyBkM19nZW9tX3Zvcm9ub2lIYWxmRWRnZShlZGdlLCByU2l0ZSwgbFNpdGUpKTsKICAgIHJldHVybiBlZGdlOwogIH0KICBmdW5jdGlvbiBkM19nZW9tX3Zvcm9ub2lDcmVhdGVCb3JkZXJFZGdlKGxTaXRlLCB2YSwgdmIpIHsKICAgIHZhciBlZGdlID0gbmV3IGQzX2dlb21fdm9yb25vaUVkZ2UobFNpdGUsIG51bGwpOwogICAgZWRnZS5hID0gdmE7CiAgICBlZGdlLmIgPSB2YjsKICAgIGQzX2dlb21fdm9yb25vaUVkZ2VzLnB1c2goZWRnZSk7CiAgICByZXR1cm4gZWRnZTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvbV92b3Jvbm9pU2V0RWRnZUVuZChlZGdlLCBsU2l0ZSwgclNpdGUsIHZlcnRleCkgewogICAgaWYgKCFlZGdlLmEgJiYgIWVkZ2UuYikgewogICAgICBlZGdlLmEgPSB2ZXJ0ZXg7CiAgICAgIGVkZ2UubCA9IGxTaXRlOwogICAgICBlZGdlLnIgPSByU2l0ZTsKICAgIH0gZWxzZSBpZiAoZWRnZS5sID09PSByU2l0ZSkgewogICAgICBlZGdlLmIgPSB2ZXJ0ZXg7CiAgICB9IGVsc2UgewogICAgICBlZGdlLmEgPSB2ZXJ0ZXg7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGQzX2dlb21fdm9yb25vaUhhbGZFZGdlKGVkZ2UsIGxTaXRlLCByU2l0ZSkgewogICAgdmFyIHZhID0gZWRnZS5hLCB2YiA9IGVkZ2UuYjsKICAgIHRoaXMuZWRnZSA9IGVkZ2U7CiAgICB0aGlzLnNpdGUgPSBsU2l0ZTsKICAgIHRoaXMuYW5nbGUgPSByU2l0ZSA/IE1hdGguYXRhbjIoclNpdGUueSAtIGxTaXRlLnksIHJTaXRlLnggLSBsU2l0ZS54KSA6IGVkZ2UubCA9PT0gbFNpdGUgPyBNYXRoLmF0YW4yKHZiLnggLSB2YS54LCB2YS55IC0gdmIueSkgOiBNYXRoLmF0YW4yKHZhLnggLSB2Yi54LCB2Yi55IC0gdmEueSk7CiAgfQogIGQzX2dlb21fdm9yb25vaUhhbGZFZGdlLnByb3RvdHlwZSA9IHsKICAgIHN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuZWRnZS5sID09PSB0aGlzLnNpdGUgPyB0aGlzLmVkZ2UuYSA6IHRoaXMuZWRnZS5iOwogICAgfSwKICAgIGVuZDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLmVkZ2UubCA9PT0gdGhpcy5zaXRlID8gdGhpcy5lZGdlLmIgOiB0aGlzLmVkZ2UuYTsKICAgIH0KICB9OwogIGZ1bmN0aW9uIGQzX2dlb21fdm9yb25vaVJlZEJsYWNrVHJlZSgpIHsKICAgIHRoaXMuXyA9IG51bGw7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb21fdm9yb25vaVJlZEJsYWNrTm9kZShub2RlKSB7CiAgICBub2RlLlUgPSBub2RlLkMgPSBub2RlLkwgPSBub2RlLlIgPSBub2RlLlAgPSBub2RlLk4gPSBudWxsOwogIH0KICBkM19nZW9tX3Zvcm9ub2lSZWRCbGFja1RyZWUucHJvdG90eXBlID0gewogICAgaW5zZXJ0OiBmdW5jdGlvbihhZnRlciwgbm9kZSkgewogICAgICB2YXIgcGFyZW50LCBncmFuZHBhLCB1bmNsZTsKICAgICAgaWYgKGFmdGVyKSB7CiAgICAgICAgbm9kZS5QID0gYWZ0ZXI7CiAgICAgICAgbm9kZS5OID0gYWZ0ZXIuTjsKICAgICAgICBpZiAoYWZ0ZXIuTikgYWZ0ZXIuTi5QID0gbm9kZTsKICAgICAgICBhZnRlci5OID0gbm9kZTsKICAgICAgICBpZiAoYWZ0ZXIuUikgewogICAgICAgICAgYWZ0ZXIgPSBhZnRlci5SOwogICAgICAgICAgd2hpbGUgKGFmdGVyLkwpIGFmdGVyID0gYWZ0ZXIuTDsKICAgICAgICAgIGFmdGVyLkwgPSBub2RlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhZnRlci5SID0gbm9kZTsKICAgICAgICB9CiAgICAgICAgcGFyZW50ID0gYWZ0ZXI7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5fKSB7CiAgICAgICAgYWZ0ZXIgPSBkM19nZW9tX3Zvcm9ub2lSZWRCbGFja0ZpcnN0KHRoaXMuXyk7CiAgICAgICAgbm9kZS5QID0gbnVsbDsKICAgICAgICBub2RlLk4gPSBhZnRlcjsKICAgICAgICBhZnRlci5QID0gYWZ0ZXIuTCA9IG5vZGU7CiAgICAgICAgcGFyZW50ID0gYWZ0ZXI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbm9kZS5QID0gbm9kZS5OID0gbnVsbDsKICAgICAgICB0aGlzLl8gPSBub2RlOwogICAgICAgIHBhcmVudCA9IG51bGw7CiAgICAgIH0KICAgICAgbm9kZS5MID0gbm9kZS5SID0gbnVsbDsKICAgICAgbm9kZS5VID0gcGFyZW50OwogICAgICBub2RlLkMgPSB0cnVlOwogICAgICBhZnRlciA9IG5vZGU7CiAgICAgIHdoaWxlIChwYXJlbnQgJiYgcGFyZW50LkMpIHsKICAgICAgICBncmFuZHBhID0gcGFyZW50LlU7CiAgICAgICAgaWYgKHBhcmVudCA9PT0gZ3JhbmRwYS5MKSB7CiAgICAgICAgICB1bmNsZSA9IGdyYW5kcGEuUjsKICAgICAgICAgIGlmICh1bmNsZSAmJiB1bmNsZS5DKSB7CiAgICAgICAgICAgIHBhcmVudC5DID0gdW5jbGUuQyA9IGZhbHNlOwogICAgICAgICAgICBncmFuZHBhLkMgPSB0cnVlOwogICAgICAgICAgICBhZnRlciA9IGdyYW5kcGE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoYWZ0ZXIgPT09IHBhcmVudC5SKSB7CiAgICAgICAgICAgICAgZDNfZ2VvbV92b3Jvbm9pUmVkQmxhY2tSb3RhdGVMZWZ0KHRoaXMsIHBhcmVudCk7CiAgICAgICAgICAgICAgYWZ0ZXIgPSBwYXJlbnQ7CiAgICAgICAgICAgICAgcGFyZW50ID0gYWZ0ZXIuVTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwYXJlbnQuQyA9IGZhbHNlOwogICAgICAgICAgICBncmFuZHBhLkMgPSB0cnVlOwogICAgICAgICAgICBkM19nZW9tX3Zvcm9ub2lSZWRCbGFja1JvdGF0ZVJpZ2h0KHRoaXMsIGdyYW5kcGEpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB1bmNsZSA9IGdyYW5kcGEuTDsKICAgICAgICAgIGlmICh1bmNsZSAmJiB1bmNsZS5DKSB7CiAgICAgICAgICAgIHBhcmVudC5DID0gdW5jbGUuQyA9IGZhbHNlOwogICAgICAgICAgICBncmFuZHBhLkMgPSB0cnVlOwogICAgICAgICAgICBhZnRlciA9IGdyYW5kcGE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoYWZ0ZXIgPT09IHBhcmVudC5MKSB7CiAgICAgICAgICAgICAgZDNfZ2VvbV92b3Jvbm9pUmVkQmxhY2tSb3RhdGVSaWdodCh0aGlzLCBwYXJlbnQpOwogICAgICAgICAgICAgIGFmdGVyID0gcGFyZW50OwogICAgICAgICAgICAgIHBhcmVudCA9IGFmdGVyLlU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGFyZW50LkMgPSBmYWxzZTsKICAgICAgICAgICAgZ3JhbmRwYS5DID0gdHJ1ZTsKICAgICAgICAgICAgZDNfZ2VvbV92b3Jvbm9pUmVkQmxhY2tSb3RhdGVMZWZ0KHRoaXMsIGdyYW5kcGEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwYXJlbnQgPSBhZnRlci5VOwogICAgICB9CiAgICAgIHRoaXMuXy5DID0gZmFsc2U7CiAgICB9LAogICAgcmVtb3ZlOiBmdW5jdGlvbihub2RlKSB7CiAgICAgIGlmIChub2RlLk4pIG5vZGUuTi5QID0gbm9kZS5QOwogICAgICBpZiAobm9kZS5QKSBub2RlLlAuTiA9IG5vZGUuTjsKICAgICAgbm9kZS5OID0gbm9kZS5QID0gbnVsbDsKICAgICAgdmFyIHBhcmVudCA9IG5vZGUuVSwgc2libGluZywgbGVmdCA9IG5vZGUuTCwgcmlnaHQgPSBub2RlLlIsIG5leHQsIHJlZDsKICAgICAgaWYgKCFsZWZ0KSBuZXh0ID0gcmlnaHQ7IGVsc2UgaWYgKCFyaWdodCkgbmV4dCA9IGxlZnQ7IGVsc2UgbmV4dCA9IGQzX2dlb21fdm9yb25vaVJlZEJsYWNrRmlyc3QocmlnaHQpOwogICAgICBpZiAocGFyZW50KSB7CiAgICAgICAgaWYgKHBhcmVudC5MID09PSBub2RlKSBwYXJlbnQuTCA9IG5leHQ7IGVsc2UgcGFyZW50LlIgPSBuZXh0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuXyA9IG5leHQ7CiAgICAgIH0KICAgICAgaWYgKGxlZnQgJiYgcmlnaHQpIHsKICAgICAgICByZWQgPSBuZXh0LkM7CiAgICAgICAgbmV4dC5DID0gbm9kZS5DOwogICAgICAgIG5leHQuTCA9IGxlZnQ7CiAgICAgICAgbGVmdC5VID0gbmV4dDsKICAgICAgICBpZiAobmV4dCAhPT0gcmlnaHQpIHsKICAgICAgICAgIHBhcmVudCA9IG5leHQuVTsKICAgICAgICAgIG5leHQuVSA9IG5vZGUuVTsKICAgICAgICAgIG5vZGUgPSBuZXh0LlI7CiAgICAgICAgICBwYXJlbnQuTCA9IG5vZGU7CiAgICAgICAgICBuZXh0LlIgPSByaWdodDsKICAgICAgICAgIHJpZ2h0LlUgPSBuZXh0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBuZXh0LlUgPSBwYXJlbnQ7CiAgICAgICAgICBwYXJlbnQgPSBuZXh0OwogICAgICAgICAgbm9kZSA9IG5leHQuUjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVkID0gbm9kZS5DOwogICAgICAgIG5vZGUgPSBuZXh0OwogICAgICB9CiAgICAgIGlmIChub2RlKSBub2RlLlUgPSBwYXJlbnQ7CiAgICAgIGlmIChyZWQpIHJldHVybjsKICAgICAgaWYgKG5vZGUgJiYgbm9kZS5DKSB7CiAgICAgICAgbm9kZS5DID0gZmFsc2U7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGRvIHsKICAgICAgICBpZiAobm9kZSA9PT0gdGhpcy5fKSBicmVhazsKICAgICAgICBpZiAobm9kZSA9PT0gcGFyZW50LkwpIHsKICAgICAgICAgIHNpYmxpbmcgPSBwYXJlbnQuUjsKICAgICAgICAgIGlmIChzaWJsaW5nLkMpIHsKICAgICAgICAgICAgc2libGluZy5DID0gZmFsc2U7CiAgICAgICAgICAgIHBhcmVudC5DID0gdHJ1ZTsKICAgICAgICAgICAgZDNfZ2VvbV92b3Jvbm9pUmVkQmxhY2tSb3RhdGVMZWZ0KHRoaXMsIHBhcmVudCk7CiAgICAgICAgICAgIHNpYmxpbmcgPSBwYXJlbnQuUjsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzaWJsaW5nLkwgJiYgc2libGluZy5MLkMgfHwgc2libGluZy5SICYmIHNpYmxpbmcuUi5DKSB7CiAgICAgICAgICAgIGlmICghc2libGluZy5SIHx8ICFzaWJsaW5nLlIuQykgewogICAgICAgICAgICAgIHNpYmxpbmcuTC5DID0gZmFsc2U7CiAgICAgICAgICAgICAgc2libGluZy5DID0gdHJ1ZTsKICAgICAgICAgICAgICBkM19nZW9tX3Zvcm9ub2lSZWRCbGFja1JvdGF0ZVJpZ2h0KHRoaXMsIHNpYmxpbmcpOwogICAgICAgICAgICAgIHNpYmxpbmcgPSBwYXJlbnQuUjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzaWJsaW5nLkMgPSBwYXJlbnQuQzsKICAgICAgICAgICAgcGFyZW50LkMgPSBzaWJsaW5nLlIuQyA9IGZhbHNlOwogICAgICAgICAgICBkM19nZW9tX3Zvcm9ub2lSZWRCbGFja1JvdGF0ZUxlZnQodGhpcywgcGFyZW50KTsKICAgICAgICAgICAgbm9kZSA9IHRoaXMuXzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNpYmxpbmcgPSBwYXJlbnQuTDsKICAgICAgICAgIGlmIChzaWJsaW5nLkMpIHsKICAgICAgICAgICAgc2libGluZy5DID0gZmFsc2U7CiAgICAgICAgICAgIHBhcmVudC5DID0gdHJ1ZTsKICAgICAgICAgICAgZDNfZ2VvbV92b3Jvbm9pUmVkQmxhY2tSb3RhdGVSaWdodCh0aGlzLCBwYXJlbnQpOwogICAgICAgICAgICBzaWJsaW5nID0gcGFyZW50Lkw7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc2libGluZy5MICYmIHNpYmxpbmcuTC5DIHx8IHNpYmxpbmcuUiAmJiBzaWJsaW5nLlIuQykgewogICAgICAgICAgICBpZiAoIXNpYmxpbmcuTCB8fCAhc2libGluZy5MLkMpIHsKICAgICAgICAgICAgICBzaWJsaW5nLlIuQyA9IGZhbHNlOwogICAgICAgICAgICAgIHNpYmxpbmcuQyA9IHRydWU7CiAgICAgICAgICAgICAgZDNfZ2VvbV92b3Jvbm9pUmVkQmxhY2tSb3RhdGVMZWZ0KHRoaXMsIHNpYmxpbmcpOwogICAgICAgICAgICAgIHNpYmxpbmcgPSBwYXJlbnQuTDsKICAgICAgICAgICAgfQogICAgICAgICAgICBzaWJsaW5nLkMgPSBwYXJlbnQuQzsKICAgICAgICAgICAgcGFyZW50LkMgPSBzaWJsaW5nLkwuQyA9IGZhbHNlOwogICAgICAgICAgICBkM19nZW9tX3Zvcm9ub2lSZWRCbGFja1JvdGF0ZVJpZ2h0KHRoaXMsIHBhcmVudCk7CiAgICAgICAgICAgIG5vZGUgPSB0aGlzLl87CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzaWJsaW5nLkMgPSB0cnVlOwogICAgICAgIG5vZGUgPSBwYXJlbnQ7CiAgICAgICAgcGFyZW50ID0gcGFyZW50LlU7CiAgICAgIH0gd2hpbGUgKCFub2RlLkMpOwogICAgICBpZiAobm9kZSkgbm9kZS5DID0gZmFsc2U7CiAgICB9CiAgfTsKICBmdW5jdGlvbiBkM19nZW9tX3Zvcm9ub2lSZWRCbGFja1JvdGF0ZUxlZnQodHJlZSwgbm9kZSkgewogICAgdmFyIHAgPSBub2RlLCBxID0gbm9kZS5SLCBwYXJlbnQgPSBwLlU7CiAgICBpZiAocGFyZW50KSB7CiAgICAgIGlmIChwYXJlbnQuTCA9PT0gcCkgcGFyZW50LkwgPSBxOyBlbHNlIHBhcmVudC5SID0gcTsKICAgIH0gZWxzZSB7CiAgICAgIHRyZWUuXyA9IHE7CiAgICB9CiAgICBxLlUgPSBwYXJlbnQ7CiAgICBwLlUgPSBxOwogICAgcC5SID0gcS5MOwogICAgaWYgKHAuUikgcC5SLlUgPSBwOwogICAgcS5MID0gcDsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvbV92b3Jvbm9pUmVkQmxhY2tSb3RhdGVSaWdodCh0cmVlLCBub2RlKSB7CiAgICB2YXIgcCA9IG5vZGUsIHEgPSBub2RlLkwsIHBhcmVudCA9IHAuVTsKICAgIGlmIChwYXJlbnQpIHsKICAgICAgaWYgKHBhcmVudC5MID09PSBwKSBwYXJlbnQuTCA9IHE7IGVsc2UgcGFyZW50LlIgPSBxOwogICAgfSBlbHNlIHsKICAgICAgdHJlZS5fID0gcTsKICAgIH0KICAgIHEuVSA9IHBhcmVudDsKICAgIHAuVSA9IHE7CiAgICBwLkwgPSBxLlI7CiAgICBpZiAocC5MKSBwLkwuVSA9IHA7CiAgICBxLlIgPSBwOwogIH0KICBmdW5jdGlvbiBkM19nZW9tX3Zvcm9ub2lSZWRCbGFja0ZpcnN0KG5vZGUpIHsKICAgIHdoaWxlIChub2RlLkwpIG5vZGUgPSBub2RlLkw7CiAgICByZXR1cm4gbm9kZTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvbV92b3Jvbm9pKHNpdGVzLCBiYm94KSB7CiAgICB2YXIgc2l0ZSA9IHNpdGVzLnNvcnQoZDNfZ2VvbV92b3Jvbm9pVmVydGV4T3JkZXIpLnBvcCgpLCB4MCwgeTAsIGNpcmNsZTsKICAgIGQzX2dlb21fdm9yb25vaUVkZ2VzID0gW107CiAgICBkM19nZW9tX3Zvcm9ub2lDZWxscyA9IG5ldyBBcnJheShzaXRlcy5sZW5ndGgpOwogICAgZDNfZ2VvbV92b3Jvbm9pQmVhY2hlcyA9IG5ldyBkM19nZW9tX3Zvcm9ub2lSZWRCbGFja1RyZWUoKTsKICAgIGQzX2dlb21fdm9yb25vaUNpcmNsZXMgPSBuZXcgZDNfZ2VvbV92b3Jvbm9pUmVkQmxhY2tUcmVlKCk7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBjaXJjbGUgPSBkM19nZW9tX3Zvcm9ub2lGaXJzdENpcmNsZTsKICAgICAgaWYgKHNpdGUgJiYgKCFjaXJjbGUgfHwgc2l0ZS55IDwgY2lyY2xlLnkgfHwgc2l0ZS55ID09PSBjaXJjbGUueSAmJiBzaXRlLnggPCBjaXJjbGUueCkpIHsKICAgICAgICBpZiAoc2l0ZS54ICE9PSB4MCB8fCBzaXRlLnkgIT09IHkwKSB7CiAgICAgICAgICBkM19nZW9tX3Zvcm9ub2lDZWxsc1tzaXRlLmldID0gbmV3IGQzX2dlb21fdm9yb25vaUNlbGwoc2l0ZSk7CiAgICAgICAgICBkM19nZW9tX3Zvcm9ub2lBZGRCZWFjaChzaXRlKTsKICAgICAgICAgIHgwID0gc2l0ZS54LCB5MCA9IHNpdGUueTsKICAgICAgICB9CiAgICAgICAgc2l0ZSA9IHNpdGVzLnBvcCgpOwogICAgICB9IGVsc2UgaWYgKGNpcmNsZSkgewogICAgICAgIGQzX2dlb21fdm9yb25vaVJlbW92ZUJlYWNoKGNpcmNsZS5hcmMpOwogICAgICB9IGVsc2UgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBpZiAoYmJveCkgZDNfZ2VvbV92b3Jvbm9pQ2xpcEVkZ2VzKGJib3gpLCBkM19nZW9tX3Zvcm9ub2lDbG9zZUNlbGxzKGJib3gpOwogICAgdmFyIGRpYWdyYW0gPSB7CiAgICAgIGNlbGxzOiBkM19nZW9tX3Zvcm9ub2lDZWxscywKICAgICAgZWRnZXM6IGQzX2dlb21fdm9yb25vaUVkZ2VzCiAgICB9OwogICAgZDNfZ2VvbV92b3Jvbm9pQmVhY2hlcyA9IGQzX2dlb21fdm9yb25vaUNpcmNsZXMgPSBkM19nZW9tX3Zvcm9ub2lFZGdlcyA9IGQzX2dlb21fdm9yb25vaUNlbGxzID0gbnVsbDsKICAgIHJldHVybiBkaWFncmFtOwogIH0KICBmdW5jdGlvbiBkM19nZW9tX3Zvcm9ub2lWZXJ0ZXhPcmRlcihhLCBiKSB7CiAgICByZXR1cm4gYi55IC0gYS55IHx8IGIueCAtIGEueDsKICB9CiAgZDMuZ2VvbS52b3Jvbm9pID0gZnVuY3Rpb24ocG9pbnRzKSB7CiAgICB2YXIgeCA9IGQzX2dlb21fcG9pbnRYLCB5ID0gZDNfZ2VvbV9wb2ludFksIGZ4ID0geCwgZnkgPSB5LCBjbGlwRXh0ZW50ID0gZDNfZ2VvbV92b3Jvbm9pQ2xpcEV4dGVudDsKICAgIGlmIChwb2ludHMpIHJldHVybiB2b3Jvbm9pKHBvaW50cyk7CiAgICBmdW5jdGlvbiB2b3Jvbm9pKGRhdGEpIHsKICAgICAgdmFyIHBvbHlnb25zID0gbmV3IEFycmF5KGRhdGEubGVuZ3RoKSwgeDAgPSBjbGlwRXh0ZW50WzBdWzBdLCB5MCA9IGNsaXBFeHRlbnRbMF1bMV0sIHgxID0gY2xpcEV4dGVudFsxXVswXSwgeTEgPSBjbGlwRXh0ZW50WzFdWzFdOwogICAgICBkM19nZW9tX3Zvcm9ub2koc2l0ZXMoZGF0YSksIGNsaXBFeHRlbnQpLmNlbGxzLmZvckVhY2goZnVuY3Rpb24oY2VsbCwgaSkgewogICAgICAgIHZhciBlZGdlcyA9IGNlbGwuZWRnZXMsIHNpdGUgPSBjZWxsLnNpdGUsIHBvbHlnb24gPSBwb2x5Z29uc1tpXSA9IGVkZ2VzLmxlbmd0aCA/IGVkZ2VzLm1hcChmdW5jdGlvbihlKSB7CiAgICAgICAgICB2YXIgcyA9IGUuc3RhcnQoKTsKICAgICAgICAgIHJldHVybiBbIHMueCwgcy55IF07CiAgICAgICAgfSkgOiBzaXRlLnggPj0geDAgJiYgc2l0ZS54IDw9IHgxICYmIHNpdGUueSA+PSB5MCAmJiBzaXRlLnkgPD0geTEgPyBbIFsgeDAsIHkxIF0sIFsgeDEsIHkxIF0sIFsgeDEsIHkwIF0sIFsgeDAsIHkwIF0gXSA6IFtdOwogICAgICAgIHBvbHlnb24ucG9pbnQgPSBkYXRhW2ldOwogICAgICB9KTsKICAgICAgcmV0dXJuIHBvbHlnb25zOwogICAgfQogICAgZnVuY3Rpb24gc2l0ZXMoZGF0YSkgewogICAgICByZXR1cm4gZGF0YS5tYXAoZnVuY3Rpb24oZCwgaSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB4OiBNYXRoLnJvdW5kKGZ4KGQsIGkpIC8gzrUpICogzrUsCiAgICAgICAgICB5OiBNYXRoLnJvdW5kKGZ5KGQsIGkpIC8gzrUpICogzrUsCiAgICAgICAgICBpOiBpCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9CiAgICB2b3Jvbm9pLmxpbmtzID0gZnVuY3Rpb24oZGF0YSkgewogICAgICByZXR1cm4gZDNfZ2VvbV92b3Jvbm9pKHNpdGVzKGRhdGEpKS5lZGdlcy5maWx0ZXIoZnVuY3Rpb24oZWRnZSkgewogICAgICAgIHJldHVybiBlZGdlLmwgJiYgZWRnZS5yOwogICAgICB9KS5tYXAoZnVuY3Rpb24oZWRnZSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBzb3VyY2U6IGRhdGFbZWRnZS5sLmldLAogICAgICAgICAgdGFyZ2V0OiBkYXRhW2VkZ2Uuci5pXQogICAgICAgIH07CiAgICAgIH0pOwogICAgfTsKICAgIHZvcm9ub2kudHJpYW5nbGVzID0gZnVuY3Rpb24oZGF0YSkgewogICAgICB2YXIgdHJpYW5nbGVzID0gW107CiAgICAgIGQzX2dlb21fdm9yb25vaShzaXRlcyhkYXRhKSkuY2VsbHMuZm9yRWFjaChmdW5jdGlvbihjZWxsLCBpKSB7CiAgICAgICAgdmFyIHNpdGUgPSBjZWxsLnNpdGUsIGVkZ2VzID0gY2VsbC5lZGdlcy5zb3J0KGQzX2dlb21fdm9yb25vaUhhbGZFZGdlT3JkZXIpLCBqID0gLTEsIG0gPSBlZGdlcy5sZW5ndGgsIGUwLCBzMCwgZTEgPSBlZGdlc1ttIC0gMV0uZWRnZSwgczEgPSBlMS5sID09PSBzaXRlID8gZTEuciA6IGUxLmw7CiAgICAgICAgd2hpbGUgKCsraiA8IG0pIHsKICAgICAgICAgIGUwID0gZTE7CiAgICAgICAgICBzMCA9IHMxOwogICAgICAgICAgZTEgPSBlZGdlc1tqXS5lZGdlOwogICAgICAgICAgczEgPSBlMS5sID09PSBzaXRlID8gZTEuciA6IGUxLmw7CiAgICAgICAgICBpZiAoaSA8IHMwLmkgJiYgaSA8IHMxLmkgJiYgZDNfZ2VvbV92b3Jvbm9pVHJpYW5nbGVBcmVhKHNpdGUsIHMwLCBzMSkgPCAwKSB7CiAgICAgICAgICAgIHRyaWFuZ2xlcy5wdXNoKFsgZGF0YVtpXSwgZGF0YVtzMC5pXSwgZGF0YVtzMS5pXSBdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gdHJpYW5nbGVzOwogICAgfTsKICAgIHZvcm9ub2kueCA9IGZ1bmN0aW9uKF8pIHsKICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZnggPSBkM19mdW5jdG9yKHggPSBfKSwgdm9yb25vaSkgOiB4OwogICAgfTsKICAgIHZvcm9ub2kueSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZnkgPSBkM19mdW5jdG9yKHkgPSBfKSwgdm9yb25vaSkgOiB5OwogICAgfTsKICAgIHZvcm9ub2kuY2xpcEV4dGVudCA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gY2xpcEV4dGVudCA9PT0gZDNfZ2VvbV92b3Jvbm9pQ2xpcEV4dGVudCA/IG51bGwgOiBjbGlwRXh0ZW50OwogICAgICBjbGlwRXh0ZW50ID0gXyA9PSBudWxsID8gZDNfZ2VvbV92b3Jvbm9pQ2xpcEV4dGVudCA6IF87CiAgICAgIHJldHVybiB2b3Jvbm9pOwogICAgfTsKICAgIHZvcm9ub2kuc2l6ZSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gY2xpcEV4dGVudCA9PT0gZDNfZ2VvbV92b3Jvbm9pQ2xpcEV4dGVudCA/IG51bGwgOiBjbGlwRXh0ZW50ICYmIGNsaXBFeHRlbnRbMV07CiAgICAgIHJldHVybiB2b3Jvbm9pLmNsaXBFeHRlbnQoXyAmJiBbIFsgMCwgMCBdLCBfIF0pOwogICAgfTsKICAgIHJldHVybiB2b3Jvbm9pOwogIH07CiAgdmFyIGQzX2dlb21fdm9yb25vaUNsaXBFeHRlbnQgPSBbIFsgLTFlNiwgLTFlNiBdLCBbIDFlNiwgMWU2IF0gXTsKICBmdW5jdGlvbiBkM19nZW9tX3Zvcm9ub2lUcmlhbmdsZUFyZWEoYSwgYiwgYykgewogICAgcmV0dXJuIChhLnggLSBjLngpICogKGIueSAtIGEueSkgLSAoYS54IC0gYi54KSAqIChjLnkgLSBhLnkpOwogIH0KICBkMy5nZW9tLmRlbGF1bmF5ID0gZnVuY3Rpb24odmVydGljZXMpIHsKICAgIHJldHVybiBkMy5nZW9tLnZvcm9ub2koKS50cmlhbmdsZXModmVydGljZXMpOwogIH07CiAgZDMuZ2VvbS5xdWFkdHJlZSA9IGZ1bmN0aW9uKHBvaW50cywgeDEsIHkxLCB4MiwgeTIpIHsKICAgIHZhciB4ID0gZDNfZ2VvbV9wb2ludFgsIHkgPSBkM19nZW9tX3BvaW50WSwgY29tcGF0OwogICAgaWYgKGNvbXBhdCA9IGFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgeCA9IGQzX2dlb21fcXVhZHRyZWVDb21wYXRYOwogICAgICB5ID0gZDNfZ2VvbV9xdWFkdHJlZUNvbXBhdFk7CiAgICAgIGlmIChjb21wYXQgPT09IDMpIHsKICAgICAgICB5MiA9IHkxOwogICAgICAgIHgyID0geDE7CiAgICAgICAgeTEgPSB4MSA9IDA7CiAgICAgIH0KICAgICAgcmV0dXJuIHF1YWR0cmVlKHBvaW50cyk7CiAgICB9CiAgICBmdW5jdGlvbiBxdWFkdHJlZShkYXRhKSB7CiAgICAgIHZhciBkLCBmeCA9IGQzX2Z1bmN0b3IoeCksIGZ5ID0gZDNfZnVuY3Rvcih5KSwgeHMsIHlzLCBpLCBuLCB4MV8sIHkxXywgeDJfLCB5Ml87CiAgICAgIGlmICh4MSAhPSBudWxsKSB7CiAgICAgICAgeDFfID0geDEsIHkxXyA9IHkxLCB4Ml8gPSB4MiwgeTJfID0geTI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgeDJfID0geTJfID0gLSh4MV8gPSB5MV8gPSBJbmZpbml0eSk7CiAgICAgICAgeHMgPSBbXSwgeXMgPSBbXTsKICAgICAgICBuID0gZGF0YS5sZW5ndGg7CiAgICAgICAgaWYgKGNvbXBhdCkgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICAgICAgZCA9IGRhdGFbaV07CiAgICAgICAgICBpZiAoZC54IDwgeDFfKSB4MV8gPSBkLng7CiAgICAgICAgICBpZiAoZC55IDwgeTFfKSB5MV8gPSBkLnk7CiAgICAgICAgICBpZiAoZC54ID4geDJfKSB4Ml8gPSBkLng7CiAgICAgICAgICBpZiAoZC55ID4geTJfKSB5Ml8gPSBkLnk7CiAgICAgICAgICB4cy5wdXNoKGQueCk7CiAgICAgICAgICB5cy5wdXNoKGQueSk7CiAgICAgICAgfSBlbHNlIGZvciAoaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgICAgIHZhciB4XyA9ICtmeChkID0gZGF0YVtpXSwgaSksIHlfID0gK2Z5KGQsIGkpOwogICAgICAgICAgaWYgKHhfIDwgeDFfKSB4MV8gPSB4XzsKICAgICAgICAgIGlmICh5XyA8IHkxXykgeTFfID0geV87CiAgICAgICAgICBpZiAoeF8gPiB4Ml8pIHgyXyA9IHhfOwogICAgICAgICAgaWYgKHlfID4geTJfKSB5Ml8gPSB5XzsKICAgICAgICAgIHhzLnB1c2goeF8pOwogICAgICAgICAgeXMucHVzaCh5Xyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciBkeCA9IHgyXyAtIHgxXywgZHkgPSB5Ml8gLSB5MV87CiAgICAgIGlmIChkeCA+IGR5KSB5Ml8gPSB5MV8gKyBkeDsgZWxzZSB4Ml8gPSB4MV8gKyBkeTsKICAgICAgZnVuY3Rpb24gaW5zZXJ0KG4sIGQsIHgsIHksIHgxLCB5MSwgeDIsIHkyKSB7CiAgICAgICAgaWYgKGlzTmFOKHgpIHx8IGlzTmFOKHkpKSByZXR1cm47CiAgICAgICAgaWYgKG4ubGVhZikgewogICAgICAgICAgdmFyIG54ID0gbi54LCBueSA9IG4ueTsKICAgICAgICAgIGlmIChueCAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChhYnMobnggLSB4KSArIGFicyhueSAtIHkpIDwgLjAxKSB7CiAgICAgICAgICAgICAgaW5zZXJ0Q2hpbGQobiwgZCwgeCwgeSwgeDEsIHkxLCB4MiwgeTIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBuUG9pbnQgPSBuLnBvaW50OwogICAgICAgICAgICAgIG4ueCA9IG4ueSA9IG4ucG9pbnQgPSBudWxsOwogICAgICAgICAgICAgIGluc2VydENoaWxkKG4sIG5Qb2ludCwgbngsIG55LCB4MSwgeTEsIHgyLCB5Mik7CiAgICAgICAgICAgICAgaW5zZXJ0Q2hpbGQobiwgZCwgeCwgeSwgeDEsIHkxLCB4MiwgeTIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuLnggPSB4LCBuLnkgPSB5LCBuLnBvaW50ID0gZDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaW5zZXJ0Q2hpbGQobiwgZCwgeCwgeSwgeDEsIHkxLCB4MiwgeTIpOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBpbnNlcnRDaGlsZChuLCBkLCB4LCB5LCB4MSwgeTEsIHgyLCB5MikgewogICAgICAgIHZhciB4bSA9ICh4MSArIHgyKSAqIC41LCB5bSA9ICh5MSArIHkyKSAqIC41LCByaWdodCA9IHggPj0geG0sIGJlbG93ID0geSA+PSB5bSwgaSA9IGJlbG93IDw8IDEgfCByaWdodDsKICAgICAgICBuLmxlYWYgPSBmYWxzZTsKICAgICAgICBuID0gbi5ub2Rlc1tpXSB8fCAobi5ub2Rlc1tpXSA9IGQzX2dlb21fcXVhZHRyZWVOb2RlKCkpOwogICAgICAgIGlmIChyaWdodCkgeDEgPSB4bTsgZWxzZSB4MiA9IHhtOwogICAgICAgIGlmIChiZWxvdykgeTEgPSB5bTsgZWxzZSB5MiA9IHltOwogICAgICAgIGluc2VydChuLCBkLCB4LCB5LCB4MSwgeTEsIHgyLCB5Mik7CiAgICAgIH0KICAgICAgdmFyIHJvb3QgPSBkM19nZW9tX3F1YWR0cmVlTm9kZSgpOwogICAgICByb290LmFkZCA9IGZ1bmN0aW9uKGQpIHsKICAgICAgICBpbnNlcnQocm9vdCwgZCwgK2Z4KGQsICsraSksICtmeShkLCBpKSwgeDFfLCB5MV8sIHgyXywgeTJfKTsKICAgICAgfTsKICAgICAgcm9vdC52aXNpdCA9IGZ1bmN0aW9uKGYpIHsKICAgICAgICBkM19nZW9tX3F1YWR0cmVlVmlzaXQoZiwgcm9vdCwgeDFfLCB5MV8sIHgyXywgeTJfKTsKICAgICAgfTsKICAgICAgcm9vdC5maW5kID0gZnVuY3Rpb24ocG9pbnQpIHsKICAgICAgICByZXR1cm4gZDNfZ2VvbV9xdWFkdHJlZUZpbmQocm9vdCwgcG9pbnRbMF0sIHBvaW50WzFdLCB4MV8sIHkxXywgeDJfLCB5Ml8pOwogICAgICB9OwogICAgICBpID0gLTE7CiAgICAgIGlmICh4MSA9PSBudWxsKSB7CiAgICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICAgIGluc2VydChyb290LCBkYXRhW2ldLCB4c1tpXSwgeXNbaV0sIHgxXywgeTFfLCB4Ml8sIHkyXyk7CiAgICAgICAgfQogICAgICAgIC0taTsKICAgICAgfSBlbHNlIGRhdGEuZm9yRWFjaChyb290LmFkZCk7CiAgICAgIHhzID0geXMgPSBkYXRhID0gZCA9IG51bGw7CiAgICAgIHJldHVybiByb290OwogICAgfQogICAgcXVhZHRyZWUueCA9IGZ1bmN0aW9uKF8pIHsKICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoeCA9IF8sIHF1YWR0cmVlKSA6IHg7CiAgICB9OwogICAgcXVhZHRyZWUueSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoeSA9IF8sIHF1YWR0cmVlKSA6IHk7CiAgICB9OwogICAgcXVhZHRyZWUuZXh0ZW50ID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB4MSA9PSBudWxsID8gbnVsbCA6IFsgWyB4MSwgeTEgXSwgWyB4MiwgeTIgXSBdOwogICAgICBpZiAoXyA9PSBudWxsKSB4MSA9IHkxID0geDIgPSB5MiA9IG51bGw7IGVsc2UgeDEgPSArX1swXVswXSwgeTEgPSArX1swXVsxXSwgeDIgPSArX1sxXVswXSwgCiAgICAgIHkyID0gK19bMV1bMV07CiAgICAgIHJldHVybiBxdWFkdHJlZTsKICAgIH07CiAgICBxdWFkdHJlZS5zaXplID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB4MSA9PSBudWxsID8gbnVsbCA6IFsgeDIgLSB4MSwgeTIgLSB5MSBdOwogICAgICBpZiAoXyA9PSBudWxsKSB4MSA9IHkxID0geDIgPSB5MiA9IG51bGw7IGVsc2UgeDEgPSB5MSA9IDAsIHgyID0gK19bMF0sIHkyID0gK19bMV07CiAgICAgIHJldHVybiBxdWFkdHJlZTsKICAgIH07CiAgICByZXR1cm4gcXVhZHRyZWU7CiAgfTsKICBmdW5jdGlvbiBkM19nZW9tX3F1YWR0cmVlQ29tcGF0WChkKSB7CiAgICByZXR1cm4gZC54OwogIH0KICBmdW5jdGlvbiBkM19nZW9tX3F1YWR0cmVlQ29tcGF0WShkKSB7CiAgICByZXR1cm4gZC55OwogIH0KICBmdW5jdGlvbiBkM19nZW9tX3F1YWR0cmVlTm9kZSgpIHsKICAgIHJldHVybiB7CiAgICAgIGxlYWY6IHRydWUsCiAgICAgIG5vZGVzOiBbXSwKICAgICAgcG9pbnQ6IG51bGwsCiAgICAgIHg6IG51bGwsCiAgICAgIHk6IG51bGwKICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX2dlb21fcXVhZHRyZWVWaXNpdChmLCBub2RlLCB4MSwgeTEsIHgyLCB5MikgewogICAgaWYgKCFmKG5vZGUsIHgxLCB5MSwgeDIsIHkyKSkgewogICAgICB2YXIgc3ggPSAoeDEgKyB4MikgKiAuNSwgc3kgPSAoeTEgKyB5MikgKiAuNSwgY2hpbGRyZW4gPSBub2RlLm5vZGVzOwogICAgICBpZiAoY2hpbGRyZW5bMF0pIGQzX2dlb21fcXVhZHRyZWVWaXNpdChmLCBjaGlsZHJlblswXSwgeDEsIHkxLCBzeCwgc3kpOwogICAgICBpZiAoY2hpbGRyZW5bMV0pIGQzX2dlb21fcXVhZHRyZWVWaXNpdChmLCBjaGlsZHJlblsxXSwgc3gsIHkxLCB4Miwgc3kpOwogICAgICBpZiAoY2hpbGRyZW5bMl0pIGQzX2dlb21fcXVhZHRyZWVWaXNpdChmLCBjaGlsZHJlblsyXSwgeDEsIHN5LCBzeCwgeTIpOwogICAgICBpZiAoY2hpbGRyZW5bM10pIGQzX2dlb21fcXVhZHRyZWVWaXNpdChmLCBjaGlsZHJlblszXSwgc3gsIHN5LCB4MiwgeTIpOwogICAgfQogIH0KICBmdW5jdGlvbiBkM19nZW9tX3F1YWR0cmVlRmluZChyb290LCB4LCB5LCB4MCwgeTAsIHgzLCB5MykgewogICAgdmFyIG1pbkRpc3RhbmNlMiA9IEluZmluaXR5LCBjbG9zZXN0UG9pbnQ7CiAgICAoZnVuY3Rpb24gZmluZChub2RlLCB4MSwgeTEsIHgyLCB5MikgewogICAgICBpZiAoeDEgPiB4MyB8fCB5MSA+IHkzIHx8IHgyIDwgeDAgfHwgeTIgPCB5MCkgcmV0dXJuOwogICAgICBpZiAocG9pbnQgPSBub2RlLnBvaW50KSB7CiAgICAgICAgdmFyIHBvaW50LCBkeCA9IHggLSBwb2ludFswXSwgZHkgPSB5IC0gcG9pbnRbMV0sIGRpc3RhbmNlMiA9IGR4ICogZHggKyBkeSAqIGR5OwogICAgICAgIGlmIChkaXN0YW5jZTIgPCBtaW5EaXN0YW5jZTIpIHsKICAgICAgICAgIHZhciBkaXN0YW5jZSA9IE1hdGguc3FydChtaW5EaXN0YW5jZTIgPSBkaXN0YW5jZTIpOwogICAgICAgICAgeDAgPSB4IC0gZGlzdGFuY2UsIHkwID0geSAtIGRpc3RhbmNlOwogICAgICAgICAgeDMgPSB4ICsgZGlzdGFuY2UsIHkzID0geSArIGRpc3RhbmNlOwogICAgICAgICAgY2xvc2VzdFBvaW50ID0gcG9pbnQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciBjaGlsZHJlbiA9IG5vZGUubm9kZXMsIHhtID0gKHgxICsgeDIpICogLjUsIHltID0gKHkxICsgeTIpICogLjUsIHJpZ2h0ID0geCA+PSB4bSwgYmVsb3cgPSB5ID49IHltOwogICAgICBmb3IgKHZhciBpID0gYmVsb3cgPDwgMSB8IHJpZ2h0LCBqID0gaSArIDQ7IGkgPCBqOyArK2kpIHsKICAgICAgICBpZiAobm9kZSA9IGNoaWxkcmVuW2kgJiAzXSkgc3dpdGNoIChpICYgMykgewogICAgICAgICBjYXNlIDA6CiAgICAgICAgICBmaW5kKG5vZGUsIHgxLCB5MSwgeG0sIHltKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgY2FzZSAxOgogICAgICAgICAgZmluZChub2RlLCB4bSwgeTEsIHgyLCB5bSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgIGNhc2UgMjoKICAgICAgICAgIGZpbmQobm9kZSwgeDEsIHltLCB4bSwgeTIpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgICBjYXNlIDM6CiAgICAgICAgICBmaW5kKG5vZGUsIHhtLCB5bSwgeDIsIHkyKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSkocm9vdCwgeDAsIHkwLCB4MywgeTMpOwogICAgcmV0dXJuIGNsb3Nlc3RQb2ludDsKICB9CiAgZDMuaW50ZXJwb2xhdGVSZ2IgPSBkM19pbnRlcnBvbGF0ZVJnYjsKICBmdW5jdGlvbiBkM19pbnRlcnBvbGF0ZVJnYihhLCBiKSB7CiAgICBhID0gZDMucmdiKGEpOwogICAgYiA9IGQzLnJnYihiKTsKICAgIHZhciBhciA9IGEuciwgYWcgPSBhLmcsIGFiID0gYS5iLCBiciA9IGIuciAtIGFyLCBiZyA9IGIuZyAtIGFnLCBiYiA9IGIuYiAtIGFiOwogICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKICAgICAgcmV0dXJuICIjIiArIGQzX3JnYl9oZXgoTWF0aC5yb3VuZChhciArIGJyICogdCkpICsgZDNfcmdiX2hleChNYXRoLnJvdW5kKGFnICsgYmcgKiB0KSkgKyBkM19yZ2JfaGV4KE1hdGgucm91bmQoYWIgKyBiYiAqIHQpKTsKICAgIH07CiAgfQogIGQzLmludGVycG9sYXRlT2JqZWN0ID0gZDNfaW50ZXJwb2xhdGVPYmplY3Q7CiAgZnVuY3Rpb24gZDNfaW50ZXJwb2xhdGVPYmplY3QoYSwgYikgewogICAgdmFyIGkgPSB7fSwgYyA9IHt9LCBrOwogICAgZm9yIChrIGluIGEpIHsKICAgICAgaWYgKGsgaW4gYikgewogICAgICAgIGlba10gPSBkM19pbnRlcnBvbGF0ZShhW2tdLCBiW2tdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjW2tdID0gYVtrXTsKICAgICAgfQogICAgfQogICAgZm9yIChrIGluIGIpIHsKICAgICAgaWYgKCEoayBpbiBhKSkgewogICAgICAgIGNba10gPSBiW2tdOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgICBmb3IgKGsgaW4gaSkgY1trXSA9IGlba10odCk7CiAgICAgIHJldHVybiBjOwogICAgfTsKICB9CiAgZDMuaW50ZXJwb2xhdGVOdW1iZXIgPSBkM19pbnRlcnBvbGF0ZU51bWJlcjsKICBmdW5jdGlvbiBkM19pbnRlcnBvbGF0ZU51bWJlcihhLCBiKSB7CiAgICBhID0gK2EsIGIgPSArYjsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIHJldHVybiBhICogKDEgLSB0KSArIGIgKiB0OwogICAgfTsKICB9CiAgZDMuaW50ZXJwb2xhdGVTdHJpbmcgPSBkM19pbnRlcnBvbGF0ZVN0cmluZzsKICBmdW5jdGlvbiBkM19pbnRlcnBvbGF0ZVN0cmluZyhhLCBiKSB7CiAgICB2YXIgYmkgPSBkM19pbnRlcnBvbGF0ZV9udW1iZXJBLmxhc3RJbmRleCA9IGQzX2ludGVycG9sYXRlX251bWJlckIubGFzdEluZGV4ID0gMCwgYW0sIGJtLCBicywgaSA9IC0xLCBzID0gW10sIHEgPSBbXTsKICAgIGEgPSBhICsgIiIsIGIgPSBiICsgIiI7CiAgICB3aGlsZSAoKGFtID0gZDNfaW50ZXJwb2xhdGVfbnVtYmVyQS5leGVjKGEpKSAmJiAoYm0gPSBkM19pbnRlcnBvbGF0ZV9udW1iZXJCLmV4ZWMoYikpKSB7CiAgICAgIGlmICgoYnMgPSBibS5pbmRleCkgPiBiaSkgewogICAgICAgIGJzID0gYi5zbGljZShiaSwgYnMpOwogICAgICAgIGlmIChzW2ldKSBzW2ldICs9IGJzOyBlbHNlIHNbKytpXSA9IGJzOwogICAgICB9CiAgICAgIGlmICgoYW0gPSBhbVswXSkgPT09IChibSA9IGJtWzBdKSkgewogICAgICAgIGlmIChzW2ldKSBzW2ldICs9IGJtOyBlbHNlIHNbKytpXSA9IGJtOwogICAgICB9IGVsc2UgewogICAgICAgIHNbKytpXSA9IG51bGw7CiAgICAgICAgcS5wdXNoKHsKICAgICAgICAgIGk6IGksCiAgICAgICAgICB4OiBkM19pbnRlcnBvbGF0ZU51bWJlcihhbSwgYm0pCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgYmkgPSBkM19pbnRlcnBvbGF0ZV9udW1iZXJCLmxhc3RJbmRleDsKICAgIH0KICAgIGlmIChiaSA8IGIubGVuZ3RoKSB7CiAgICAgIGJzID0gYi5zbGljZShiaSk7CiAgICAgIGlmIChzW2ldKSBzW2ldICs9IGJzOyBlbHNlIHNbKytpXSA9IGJzOwogICAgfQogICAgcmV0dXJuIHMubGVuZ3RoIDwgMiA/IHFbMF0gPyAoYiA9IHFbMF0ueCwgZnVuY3Rpb24odCkgewogICAgICByZXR1cm4gYih0KSArICIiOwogICAgfSkgOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGI7CiAgICB9IDogKGIgPSBxLmxlbmd0aCwgZnVuY3Rpb24odCkgewogICAgICBmb3IgKHZhciBpID0gMCwgbzsgaSA8IGI7ICsraSkgc1sobyA9IHFbaV0pLmldID0gby54KHQpOwogICAgICByZXR1cm4gcy5qb2luKCIiKTsKICAgIH0pOwogIH0KICB2YXIgZDNfaW50ZXJwb2xhdGVfbnVtYmVyQSA9IC9bLStdPyg/OlxkK1wuP1xkKnxcLj9cZCspKD86W2VFXVstK10/XGQrKT8vZywgZDNfaW50ZXJwb2xhdGVfbnVtYmVyQiA9IG5ldyBSZWdFeHAoZDNfaW50ZXJwb2xhdGVfbnVtYmVyQS5zb3VyY2UsICJnIik7CiAgZDMuaW50ZXJwb2xhdGUgPSBkM19pbnRlcnBvbGF0ZTsKICBmdW5jdGlvbiBkM19pbnRlcnBvbGF0ZShhLCBiKSB7CiAgICB2YXIgaSA9IGQzLmludGVycG9sYXRvcnMubGVuZ3RoLCBmOwogICAgd2hpbGUgKC0taSA+PSAwICYmICEoZiA9IGQzLmludGVycG9sYXRvcnNbaV0oYSwgYikpKSA7CiAgICByZXR1cm4gZjsKICB9CiAgZDMuaW50ZXJwb2xhdG9ycyA9IFsgZnVuY3Rpb24oYSwgYikgewogICAgdmFyIHQgPSB0eXBlb2YgYjsKICAgIHJldHVybiAodCA9PT0gInN0cmluZyIgPyBkM19yZ2JfbmFtZXMuaGFzKGIpIHx8IC9eKCN8cmdiXCh8aHNsXCgpLy50ZXN0KGIpID8gZDNfaW50ZXJwb2xhdGVSZ2IgOiBkM19pbnRlcnBvbGF0ZVN0cmluZyA6IGIgaW5zdGFuY2VvZiBkM19jb2xvciA/IGQzX2ludGVycG9sYXRlUmdiIDogQXJyYXkuaXNBcnJheShiKSA/IGQzX2ludGVycG9sYXRlQXJyYXkgOiB0ID09PSAib2JqZWN0IiAmJiBpc05hTihiKSA/IGQzX2ludGVycG9sYXRlT2JqZWN0IDogZDNfaW50ZXJwb2xhdGVOdW1iZXIpKGEsIGIpOwogIH0gXTsKICBkMy5pbnRlcnBvbGF0ZUFycmF5ID0gZDNfaW50ZXJwb2xhdGVBcnJheTsKICBmdW5jdGlvbiBkM19pbnRlcnBvbGF0ZUFycmF5KGEsIGIpIHsKICAgIHZhciB4ID0gW10sIGMgPSBbXSwgbmEgPSBhLmxlbmd0aCwgbmIgPSBiLmxlbmd0aCwgbjAgPSBNYXRoLm1pbihhLmxlbmd0aCwgYi5sZW5ndGgpLCBpOwogICAgZm9yIChpID0gMDsgaSA8IG4wOyArK2kpIHgucHVzaChkM19pbnRlcnBvbGF0ZShhW2ldLCBiW2ldKSk7CiAgICBmb3IgKDtpIDwgbmE7ICsraSkgY1tpXSA9IGFbaV07CiAgICBmb3IgKDtpIDwgbmI7ICsraSkgY1tpXSA9IGJbaV07CiAgICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgICBmb3IgKGkgPSAwOyBpIDwgbjA7ICsraSkgY1tpXSA9IHhbaV0odCk7CiAgICAgIHJldHVybiBjOwogICAgfTsKICB9CiAgdmFyIGQzX2Vhc2VfZGVmYXVsdCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX2lkZW50aXR5OwogIH07CiAgdmFyIGQzX2Vhc2UgPSBkMy5tYXAoewogICAgbGluZWFyOiBkM19lYXNlX2RlZmF1bHQsCiAgICBwb2x5OiBkM19lYXNlX3BvbHksCiAgICBxdWFkOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX2Vhc2VfcXVhZDsKICAgIH0sCiAgICBjdWJpYzogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkM19lYXNlX2N1YmljOwogICAgfSwKICAgIHNpbjogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkM19lYXNlX3NpbjsKICAgIH0sCiAgICBleHA6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZDNfZWFzZV9leHA7CiAgICB9LAogICAgY2lyY2xlOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX2Vhc2VfY2lyY2xlOwogICAgfSwKICAgIGVsYXN0aWM6IGQzX2Vhc2VfZWxhc3RpYywKICAgIGJhY2s6IGQzX2Vhc2VfYmFjaywKICAgIGJvdW5jZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkM19lYXNlX2JvdW5jZTsKICAgIH0KICB9KTsKICB2YXIgZDNfZWFzZV9tb2RlID0gZDMubWFwKHsKICAgICJpbiI6IGQzX2lkZW50aXR5LAogICAgb3V0OiBkM19lYXNlX3JldmVyc2UsCiAgICAiaW4tb3V0IjogZDNfZWFzZV9yZWZsZWN0LAogICAgIm91dC1pbiI6IGZ1bmN0aW9uKGYpIHsKICAgICAgcmV0dXJuIGQzX2Vhc2VfcmVmbGVjdChkM19lYXNlX3JldmVyc2UoZikpOwogICAgfQogIH0pOwogIGQzLmVhc2UgPSBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgaSA9IG5hbWUuaW5kZXhPZigiLSIpLCB0ID0gaSA+PSAwID8gbmFtZS5zbGljZSgwLCBpKSA6IG5hbWUsIG0gPSBpID49IDAgPyBuYW1lLnNsaWNlKGkgKyAxKSA6ICJpbiI7CiAgICB0ID0gZDNfZWFzZS5nZXQodCkgfHwgZDNfZWFzZV9kZWZhdWx0OwogICAgbSA9IGQzX2Vhc2VfbW9kZS5nZXQobSkgfHwgZDNfaWRlbnRpdHk7CiAgICByZXR1cm4gZDNfZWFzZV9jbGFtcChtKHQuYXBwbHkobnVsbCwgZDNfYXJyYXlTbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpKSk7CiAgfTsKICBmdW5jdGlvbiBkM19lYXNlX2NsYW1wKGYpIHsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIHJldHVybiB0IDw9IDAgPyAwIDogdCA+PSAxID8gMSA6IGYodCk7CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM19lYXNlX3JldmVyc2UoZikgewogICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKICAgICAgcmV0dXJuIDEgLSBmKDEgLSB0KTsKICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX2Vhc2VfcmVmbGVjdChmKSB7CiAgICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgICByZXR1cm4gLjUgKiAodCA8IC41ID8gZigyICogdCkgOiAyIC0gZigyIC0gMiAqIHQpKTsKICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX2Vhc2VfcXVhZCh0KSB7CiAgICByZXR1cm4gdCAqIHQ7CiAgfQogIGZ1bmN0aW9uIGQzX2Vhc2VfY3ViaWModCkgewogICAgcmV0dXJuIHQgKiB0ICogdDsKICB9CiAgZnVuY3Rpb24gZDNfZWFzZV9jdWJpY0luT3V0KHQpIHsKICAgIGlmICh0IDw9IDApIHJldHVybiAwOwogICAgaWYgKHQgPj0gMSkgcmV0dXJuIDE7CiAgICB2YXIgdDIgPSB0ICogdCwgdDMgPSB0MiAqIHQ7CiAgICByZXR1cm4gNCAqICh0IDwgLjUgPyB0MyA6IDMgKiAodCAtIHQyKSArIHQzIC0gLjc1KTsKICB9CiAgZnVuY3Rpb24gZDNfZWFzZV9wb2x5KGUpIHsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIHJldHVybiBNYXRoLnBvdyh0LCBlKTsKICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX2Vhc2Vfc2luKHQpIHsKICAgIHJldHVybiAxIC0gTWF0aC5jb3ModCAqIGhhbGbPgCk7CiAgfQogIGZ1bmN0aW9uIGQzX2Vhc2VfZXhwKHQpIHsKICAgIHJldHVybiBNYXRoLnBvdygyLCAxMCAqICh0IC0gMSkpOwogIH0KICBmdW5jdGlvbiBkM19lYXNlX2NpcmNsZSh0KSB7CiAgICByZXR1cm4gMSAtIE1hdGguc3FydCgxIC0gdCAqIHQpOwogIH0KICBmdW5jdGlvbiBkM19lYXNlX2VsYXN0aWMoYSwgcCkgewogICAgdmFyIHM7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHAgPSAuNDU7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCkgcyA9IHAgLyDPhCAqIE1hdGguYXNpbigxIC8gYSk7IGVsc2UgYSA9IDEsIHMgPSBwIC8gNDsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIHJldHVybiAxICsgYSAqIE1hdGgucG93KDIsIC0xMCAqIHQpICogTWF0aC5zaW4oKHQgLSBzKSAqIM+EIC8gcCk7CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM19lYXNlX2JhY2socykgewogICAgaWYgKCFzKSBzID0gMS43MDE1ODsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIHJldHVybiB0ICogdCAqICgocyArIDEpICogdCAtIHMpOwogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfZWFzZV9ib3VuY2UodCkgewogICAgcmV0dXJuIHQgPCAxIC8gMi43NSA/IDcuNTYyNSAqIHQgKiB0IDogdCA8IDIgLyAyLjc1ID8gNy41NjI1ICogKHQgLT0gMS41IC8gMi43NSkgKiB0ICsgLjc1IDogdCA8IDIuNSAvIDIuNzUgPyA3LjU2MjUgKiAodCAtPSAyLjI1IC8gMi43NSkgKiB0ICsgLjkzNzUgOiA3LjU2MjUgKiAodCAtPSAyLjYyNSAvIDIuNzUpICogdCArIC45ODQzNzU7CiAgfQogIGQzLmludGVycG9sYXRlSGNsID0gZDNfaW50ZXJwb2xhdGVIY2w7CiAgZnVuY3Rpb24gZDNfaW50ZXJwb2xhdGVIY2woYSwgYikgewogICAgYSA9IGQzLmhjbChhKTsKICAgIGIgPSBkMy5oY2woYik7CiAgICB2YXIgYWggPSBhLmgsIGFjID0gYS5jLCBhbCA9IGEubCwgYmggPSBiLmggLSBhaCwgYmMgPSBiLmMgLSBhYywgYmwgPSBiLmwgLSBhbDsKICAgIGlmIChpc05hTihiYykpIGJjID0gMCwgYWMgPSBpc05hTihhYykgPyBiLmMgOiBhYzsKICAgIGlmIChpc05hTihiaCkpIGJoID0gMCwgYWggPSBpc05hTihhaCkgPyBiLmggOiBhaDsgZWxzZSBpZiAoYmggPiAxODApIGJoIC09IDM2MDsgZWxzZSBpZiAoYmggPCAtMTgwKSBiaCArPSAzNjA7CiAgICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgICByZXR1cm4gZDNfaGNsX2xhYihhaCArIGJoICogdCwgYWMgKyBiYyAqIHQsIGFsICsgYmwgKiB0KSArICIiOwogICAgfTsKICB9CiAgZDMuaW50ZXJwb2xhdGVIc2wgPSBkM19pbnRlcnBvbGF0ZUhzbDsKICBmdW5jdGlvbiBkM19pbnRlcnBvbGF0ZUhzbChhLCBiKSB7CiAgICBhID0gZDMuaHNsKGEpOwogICAgYiA9IGQzLmhzbChiKTsKICAgIHZhciBhaCA9IGEuaCwgYXMgPSBhLnMsIGFsID0gYS5sLCBiaCA9IGIuaCAtIGFoLCBicyA9IGIucyAtIGFzLCBibCA9IGIubCAtIGFsOwogICAgaWYgKGlzTmFOKGJzKSkgYnMgPSAwLCBhcyA9IGlzTmFOKGFzKSA/IGIucyA6IGFzOwogICAgaWYgKGlzTmFOKGJoKSkgYmggPSAwLCBhaCA9IGlzTmFOKGFoKSA/IGIuaCA6IGFoOyBlbHNlIGlmIChiaCA+IDE4MCkgYmggLT0gMzYwOyBlbHNlIGlmIChiaCA8IC0xODApIGJoICs9IDM2MDsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIHJldHVybiBkM19oc2xfcmdiKGFoICsgYmggKiB0LCBhcyArIGJzICogdCwgYWwgKyBibCAqIHQpICsgIiI7CiAgICB9OwogIH0KICBkMy5pbnRlcnBvbGF0ZUxhYiA9IGQzX2ludGVycG9sYXRlTGFiOwogIGZ1bmN0aW9uIGQzX2ludGVycG9sYXRlTGFiKGEsIGIpIHsKICAgIGEgPSBkMy5sYWIoYSk7CiAgICBiID0gZDMubGFiKGIpOwogICAgdmFyIGFsID0gYS5sLCBhYSA9IGEuYSwgYWIgPSBhLmIsIGJsID0gYi5sIC0gYWwsIGJhID0gYi5hIC0gYWEsIGJiID0gYi5iIC0gYWI7CiAgICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgICByZXR1cm4gZDNfbGFiX3JnYihhbCArIGJsICogdCwgYWEgKyBiYSAqIHQsIGFiICsgYmIgKiB0KSArICIiOwogICAgfTsKICB9CiAgZDMuaW50ZXJwb2xhdGVSb3VuZCA9IGQzX2ludGVycG9sYXRlUm91bmQ7CiAgZnVuY3Rpb24gZDNfaW50ZXJwb2xhdGVSb3VuZChhLCBiKSB7CiAgICBiIC09IGE7CiAgICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgICByZXR1cm4gTWF0aC5yb3VuZChhICsgYiAqIHQpOwogICAgfTsKICB9CiAgZDMudHJhbnNmb3JtID0gZnVuY3Rpb24oc3RyaW5nKSB7CiAgICB2YXIgZyA9IGQzX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhkMy5ucy5wcmVmaXguc3ZnLCAiZyIpOwogICAgcmV0dXJuIChkMy50cmFuc2Zvcm0gPSBmdW5jdGlvbihzdHJpbmcpIHsKICAgICAgaWYgKHN0cmluZyAhPSBudWxsKSB7CiAgICAgICAgZy5zZXRBdHRyaWJ1dGUoInRyYW5zZm9ybSIsIHN0cmluZyk7CiAgICAgICAgdmFyIHQgPSBnLnRyYW5zZm9ybS5iYXNlVmFsLmNvbnNvbGlkYXRlKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ldyBkM190cmFuc2Zvcm0odCA/IHQubWF0cml4IDogZDNfdHJhbnNmb3JtSWRlbnRpdHkpOwogICAgfSkoc3RyaW5nKTsKICB9OwogIGZ1bmN0aW9uIGQzX3RyYW5zZm9ybShtKSB7CiAgICB2YXIgcjAgPSBbIG0uYSwgbS5iIF0sIHIxID0gWyBtLmMsIG0uZCBdLCBreCA9IGQzX3RyYW5zZm9ybU5vcm1hbGl6ZShyMCksIGt6ID0gZDNfdHJhbnNmb3JtRG90KHIwLCByMSksIGt5ID0gZDNfdHJhbnNmb3JtTm9ybWFsaXplKGQzX3RyYW5zZm9ybUNvbWJpbmUocjEsIHIwLCAta3opKSB8fCAwOwogICAgaWYgKHIwWzBdICogcjFbMV0gPCByMVswXSAqIHIwWzFdKSB7CiAgICAgIHIwWzBdICo9IC0xOwogICAgICByMFsxXSAqPSAtMTsKICAgICAga3ggKj0gLTE7CiAgICAgIGt6ICo9IC0xOwogICAgfQogICAgdGhpcy5yb3RhdGUgPSAoa3ggPyBNYXRoLmF0YW4yKHIwWzFdLCByMFswXSkgOiBNYXRoLmF0YW4yKC1yMVswXSwgcjFbMV0pKSAqIGQzX2RlZ3JlZXM7CiAgICB0aGlzLnRyYW5zbGF0ZSA9IFsgbS5lLCBtLmYgXTsKICAgIHRoaXMuc2NhbGUgPSBbIGt4LCBreSBdOwogICAgdGhpcy5za2V3ID0ga3kgPyBNYXRoLmF0YW4yKGt6LCBreSkgKiBkM19kZWdyZWVzIDogMDsKICB9CiAgZDNfdHJhbnNmb3JtLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuICJ0cmFuc2xhdGUoIiArIHRoaXMudHJhbnNsYXRlICsgIilyb3RhdGUoIiArIHRoaXMucm90YXRlICsgIilza2V3WCgiICsgdGhpcy5za2V3ICsgIilzY2FsZSgiICsgdGhpcy5zY2FsZSArICIpIjsKICB9OwogIGZ1bmN0aW9uIGQzX3RyYW5zZm9ybURvdChhLCBiKSB7CiAgICByZXR1cm4gYVswXSAqIGJbMF0gKyBhWzFdICogYlsxXTsKICB9CiAgZnVuY3Rpb24gZDNfdHJhbnNmb3JtTm9ybWFsaXplKGEpIHsKICAgIHZhciBrID0gTWF0aC5zcXJ0KGQzX3RyYW5zZm9ybURvdChhLCBhKSk7CiAgICBpZiAoaykgewogICAgICBhWzBdIC89IGs7CiAgICAgIGFbMV0gLz0gazsKICAgIH0KICAgIHJldHVybiBrOwogIH0KICBmdW5jdGlvbiBkM190cmFuc2Zvcm1Db21iaW5lKGEsIGIsIGspIHsKICAgIGFbMF0gKz0gayAqIGJbMF07CiAgICBhWzFdICs9IGsgKiBiWzFdOwogICAgcmV0dXJuIGE7CiAgfQogIHZhciBkM190cmFuc2Zvcm1JZGVudGl0eSA9IHsKICAgIGE6IDEsCiAgICBiOiAwLAogICAgYzogMCwKICAgIGQ6IDEsCiAgICBlOiAwLAogICAgZjogMAogIH07CiAgZDMuaW50ZXJwb2xhdGVUcmFuc2Zvcm0gPSBkM19pbnRlcnBvbGF0ZVRyYW5zZm9ybTsKICBmdW5jdGlvbiBkM19pbnRlcnBvbGF0ZVRyYW5zZm9ybShhLCBiKSB7CiAgICB2YXIgcyA9IFtdLCBxID0gW10sIG4sIEEgPSBkMy50cmFuc2Zvcm0oYSksIEIgPSBkMy50cmFuc2Zvcm0oYiksIHRhID0gQS50cmFuc2xhdGUsIHRiID0gQi50cmFuc2xhdGUsIHJhID0gQS5yb3RhdGUsIHJiID0gQi5yb3RhdGUsIHdhID0gQS5za2V3LCB3YiA9IEIuc2tldywga2EgPSBBLnNjYWxlLCBrYiA9IEIuc2NhbGU7CiAgICBpZiAodGFbMF0gIT0gdGJbMF0gfHwgdGFbMV0gIT0gdGJbMV0pIHsKICAgICAgcy5wdXNoKCJ0cmFuc2xhdGUoIiwgbnVsbCwgIiwiLCBudWxsLCAiKSIpOwogICAgICBxLnB1c2goewogICAgICAgIGk6IDEsCiAgICAgICAgeDogZDNfaW50ZXJwb2xhdGVOdW1iZXIodGFbMF0sIHRiWzBdKQogICAgICB9LCB7CiAgICAgICAgaTogMywKICAgICAgICB4OiBkM19pbnRlcnBvbGF0ZU51bWJlcih0YVsxXSwgdGJbMV0pCiAgICAgIH0pOwogICAgfSBlbHNlIGlmICh0YlswXSB8fCB0YlsxXSkgewogICAgICBzLnB1c2goInRyYW5zbGF0ZSgiICsgdGIgKyAiKSIpOwogICAgfSBlbHNlIHsKICAgICAgcy5wdXNoKCIiKTsKICAgIH0KICAgIGlmIChyYSAhPSByYikgewogICAgICBpZiAocmEgLSByYiA+IDE4MCkgcmIgKz0gMzYwOyBlbHNlIGlmIChyYiAtIHJhID4gMTgwKSByYSArPSAzNjA7CiAgICAgIHEucHVzaCh7CiAgICAgICAgaTogcy5wdXNoKHMucG9wKCkgKyAicm90YXRlKCIsIG51bGwsICIpIikgLSAyLAogICAgICAgIHg6IGQzX2ludGVycG9sYXRlTnVtYmVyKHJhLCByYikKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKHJiKSB7CiAgICAgIHMucHVzaChzLnBvcCgpICsgInJvdGF0ZSgiICsgcmIgKyAiKSIpOwogICAgfQogICAgaWYgKHdhICE9IHdiKSB7CiAgICAgIHEucHVzaCh7CiAgICAgICAgaTogcy5wdXNoKHMucG9wKCkgKyAic2tld1goIiwgbnVsbCwgIikiKSAtIDIsCiAgICAgICAgeDogZDNfaW50ZXJwb2xhdGVOdW1iZXIod2EsIHdiKQogICAgICB9KTsKICAgIH0gZWxzZSBpZiAod2IpIHsKICAgICAgcy5wdXNoKHMucG9wKCkgKyAic2tld1goIiArIHdiICsgIikiKTsKICAgIH0KICAgIGlmIChrYVswXSAhPSBrYlswXSB8fCBrYVsxXSAhPSBrYlsxXSkgewogICAgICBuID0gcy5wdXNoKHMucG9wKCkgKyAic2NhbGUoIiwgbnVsbCwgIiwiLCBudWxsLCAiKSIpOwogICAgICBxLnB1c2goewogICAgICAgIGk6IG4gLSA0LAogICAgICAgIHg6IGQzX2ludGVycG9sYXRlTnVtYmVyKGthWzBdLCBrYlswXSkKICAgICAgfSwgewogICAgICAgIGk6IG4gLSAyLAogICAgICAgIHg6IGQzX2ludGVycG9sYXRlTnVtYmVyKGthWzFdLCBrYlsxXSkKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKGtiWzBdICE9IDEgfHwga2JbMV0gIT0gMSkgewogICAgICBzLnB1c2gocy5wb3AoKSArICJzY2FsZSgiICsga2IgKyAiKSIpOwogICAgfQogICAgbiA9IHEubGVuZ3RoOwogICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKICAgICAgdmFyIGkgPSAtMSwgbzsKICAgICAgd2hpbGUgKCsraSA8IG4pIHNbKG8gPSBxW2ldKS5pXSA9IG8ueCh0KTsKICAgICAgcmV0dXJuIHMuam9pbigiIik7CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM191bmludGVycG9sYXRlTnVtYmVyKGEsIGIpIHsKICAgIGIgPSAoYiAtPSBhID0gK2EpIHx8IDEgLyBiOwogICAgcmV0dXJuIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuICh4IC0gYSkgLyBiOwogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfdW5pbnRlcnBvbGF0ZUNsYW1wKGEsIGIpIHsKICAgIGIgPSAoYiAtPSBhID0gK2EpIHx8IDEgLyBiOwogICAgcmV0dXJuIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKDEsICh4IC0gYSkgLyBiKSk7CiAgICB9OwogIH0KICBkMy5sYXlvdXQgPSB7fTsKICBkMy5sYXlvdXQuYnVuZGxlID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZnVuY3Rpb24obGlua3MpIHsKICAgICAgdmFyIHBhdGhzID0gW10sIGkgPSAtMSwgbiA9IGxpbmtzLmxlbmd0aDsKICAgICAgd2hpbGUgKCsraSA8IG4pIHBhdGhzLnB1c2goZDNfbGF5b3V0X2J1bmRsZVBhdGgobGlua3NbaV0pKTsKICAgICAgcmV0dXJuIHBhdGhzOwogICAgfTsKICB9OwogIGZ1bmN0aW9uIGQzX2xheW91dF9idW5kbGVQYXRoKGxpbmspIHsKICAgIHZhciBzdGFydCA9IGxpbmsuc291cmNlLCBlbmQgPSBsaW5rLnRhcmdldCwgbGNhID0gZDNfbGF5b3V0X2J1bmRsZUxlYXN0Q29tbW9uQW5jZXN0b3Ioc3RhcnQsIGVuZCksIHBvaW50cyA9IFsgc3RhcnQgXTsKICAgIHdoaWxlIChzdGFydCAhPT0gbGNhKSB7CiAgICAgIHN0YXJ0ID0gc3RhcnQucGFyZW50OwogICAgICBwb2ludHMucHVzaChzdGFydCk7CiAgICB9CiAgICB2YXIgayA9IHBvaW50cy5sZW5ndGg7CiAgICB3aGlsZSAoZW5kICE9PSBsY2EpIHsKICAgICAgcG9pbnRzLnNwbGljZShrLCAwLCBlbmQpOwogICAgICBlbmQgPSBlbmQucGFyZW50OwogICAgfQogICAgcmV0dXJuIHBvaW50czsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2J1bmRsZUFuY2VzdG9ycyhub2RlKSB7CiAgICB2YXIgYW5jZXN0b3JzID0gW10sIHBhcmVudCA9IG5vZGUucGFyZW50OwogICAgd2hpbGUgKHBhcmVudCAhPSBudWxsKSB7CiAgICAgIGFuY2VzdG9ycy5wdXNoKG5vZGUpOwogICAgICBub2RlID0gcGFyZW50OwogICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50OwogICAgfQogICAgYW5jZXN0b3JzLnB1c2gobm9kZSk7CiAgICByZXR1cm4gYW5jZXN0b3JzOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfYnVuZGxlTGVhc3RDb21tb25BbmNlc3RvcihhLCBiKSB7CiAgICBpZiAoYSA9PT0gYikgcmV0dXJuIGE7CiAgICB2YXIgYU5vZGVzID0gZDNfbGF5b3V0X2J1bmRsZUFuY2VzdG9ycyhhKSwgYk5vZGVzID0gZDNfbGF5b3V0X2J1bmRsZUFuY2VzdG9ycyhiKSwgYU5vZGUgPSBhTm9kZXMucG9wKCksIGJOb2RlID0gYk5vZGVzLnBvcCgpLCBzaGFyZWROb2RlID0gbnVsbDsKICAgIHdoaWxlIChhTm9kZSA9PT0gYk5vZGUpIHsKICAgICAgc2hhcmVkTm9kZSA9IGFOb2RlOwogICAgICBhTm9kZSA9IGFOb2Rlcy5wb3AoKTsKICAgICAgYk5vZGUgPSBiTm9kZXMucG9wKCk7CiAgICB9CiAgICByZXR1cm4gc2hhcmVkTm9kZTsKICB9CiAgZDMubGF5b3V0LmNob3JkID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgY2hvcmQgPSB7fSwgY2hvcmRzLCBncm91cHMsIG1hdHJpeCwgbiwgcGFkZGluZyA9IDAsIHNvcnRHcm91cHMsIHNvcnRTdWJncm91cHMsIHNvcnRDaG9yZHM7CiAgICBmdW5jdGlvbiByZWxheW91dCgpIHsKICAgICAgdmFyIHN1Ymdyb3VwcyA9IHt9LCBncm91cFN1bXMgPSBbXSwgZ3JvdXBJbmRleCA9IGQzLnJhbmdlKG4pLCBzdWJncm91cEluZGV4ID0gW10sIGssIHgsIHgwLCBpLCBqOwogICAgICBjaG9yZHMgPSBbXTsKICAgICAgZ3JvdXBzID0gW107CiAgICAgIGsgPSAwLCBpID0gLTE7CiAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgeCA9IDAsIGogPSAtMTsKICAgICAgICB3aGlsZSAoKytqIDwgbikgewogICAgICAgICAgeCArPSBtYXRyaXhbaV1bal07CiAgICAgICAgfQogICAgICAgIGdyb3VwU3Vtcy5wdXNoKHgpOwogICAgICAgIHN1Ymdyb3VwSW5kZXgucHVzaChkMy5yYW5nZShuKSk7CiAgICAgICAgayArPSB4OwogICAgICB9CiAgICAgIGlmIChzb3J0R3JvdXBzKSB7CiAgICAgICAgZ3JvdXBJbmRleC5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBzb3J0R3JvdXBzKGdyb3VwU3Vtc1thXSwgZ3JvdXBTdW1zW2JdKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBpZiAoc29ydFN1Ymdyb3VwcykgewogICAgICAgIHN1Ymdyb3VwSW5kZXguZm9yRWFjaChmdW5jdGlvbihkLCBpKSB7CiAgICAgICAgICBkLnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICByZXR1cm4gc29ydFN1Ymdyb3VwcyhtYXRyaXhbaV1bYV0sIG1hdHJpeFtpXVtiXSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBrID0gKM+EIC0gcGFkZGluZyAqIG4pIC8gazsKICAgICAgeCA9IDAsIGkgPSAtMTsKICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICB4MCA9IHgsIGogPSAtMTsKICAgICAgICB3aGlsZSAoKytqIDwgbikgewogICAgICAgICAgdmFyIGRpID0gZ3JvdXBJbmRleFtpXSwgZGogPSBzdWJncm91cEluZGV4W2RpXVtqXSwgdiA9IG1hdHJpeFtkaV1bZGpdLCBhMCA9IHgsIGExID0geCArPSB2ICogazsKICAgICAgICAgIHN1Ymdyb3Vwc1tkaSArICItIiArIGRqXSA9IHsKICAgICAgICAgICAgaW5kZXg6IGRpLAogICAgICAgICAgICBzdWJpbmRleDogZGosCiAgICAgICAgICAgIHN0YXJ0QW5nbGU6IGEwLAogICAgICAgICAgICBlbmRBbmdsZTogYTEsCiAgICAgICAgICAgIHZhbHVlOiB2CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBncm91cHNbZGldID0gewogICAgICAgICAgaW5kZXg6IGRpLAogICAgICAgICAgc3RhcnRBbmdsZTogeDAsCiAgICAgICAgICBlbmRBbmdsZTogeCwKICAgICAgICAgIHZhbHVlOiAoeCAtIHgwKSAvIGsKICAgICAgICB9OwogICAgICAgIHggKz0gcGFkZGluZzsKICAgICAgfQogICAgICBpID0gLTE7CiAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgaiA9IGkgLSAxOwogICAgICAgIHdoaWxlICgrK2ogPCBuKSB7CiAgICAgICAgICB2YXIgc291cmNlID0gc3ViZ3JvdXBzW2kgKyAiLSIgKyBqXSwgdGFyZ2V0ID0gc3ViZ3JvdXBzW2ogKyAiLSIgKyBpXTsKICAgICAgICAgIGlmIChzb3VyY2UudmFsdWUgfHwgdGFyZ2V0LnZhbHVlKSB7CiAgICAgICAgICAgIGNob3Jkcy5wdXNoKHNvdXJjZS52YWx1ZSA8IHRhcmdldC52YWx1ZSA/IHsKICAgICAgICAgICAgICBzb3VyY2U6IHRhcmdldCwKICAgICAgICAgICAgICB0YXJnZXQ6IHNvdXJjZQogICAgICAgICAgICB9IDogewogICAgICAgICAgICAgIHNvdXJjZTogc291cmNlLAogICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc29ydENob3JkcykgcmVzb3J0KCk7CiAgICB9CiAgICBmdW5jdGlvbiByZXNvcnQoKSB7CiAgICAgIGNob3Jkcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gc29ydENob3JkcygoYS5zb3VyY2UudmFsdWUgKyBhLnRhcmdldC52YWx1ZSkgLyAyLCAoYi5zb3VyY2UudmFsdWUgKyBiLnRhcmdldC52YWx1ZSkgLyAyKTsKICAgICAgfSk7CiAgICB9CiAgICBjaG9yZC5tYXRyaXggPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIG1hdHJpeDsKICAgICAgbiA9IChtYXRyaXggPSB4KSAmJiBtYXRyaXgubGVuZ3RoOwogICAgICBjaG9yZHMgPSBncm91cHMgPSBudWxsOwogICAgICByZXR1cm4gY2hvcmQ7CiAgICB9OwogICAgY2hvcmQucGFkZGluZyA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gcGFkZGluZzsKICAgICAgcGFkZGluZyA9IHg7CiAgICAgIGNob3JkcyA9IGdyb3VwcyA9IG51bGw7CiAgICAgIHJldHVybiBjaG9yZDsKICAgIH07CiAgICBjaG9yZC5zb3J0R3JvdXBzID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzb3J0R3JvdXBzOwogICAgICBzb3J0R3JvdXBzID0geDsKICAgICAgY2hvcmRzID0gZ3JvdXBzID0gbnVsbDsKICAgICAgcmV0dXJuIGNob3JkOwogICAgfTsKICAgIGNob3JkLnNvcnRTdWJncm91cHMgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNvcnRTdWJncm91cHM7CiAgICAgIHNvcnRTdWJncm91cHMgPSB4OwogICAgICBjaG9yZHMgPSBudWxsOwogICAgICByZXR1cm4gY2hvcmQ7CiAgICB9OwogICAgY2hvcmQuc29ydENob3JkcyA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc29ydENob3JkczsKICAgICAgc29ydENob3JkcyA9IHg7CiAgICAgIGlmIChjaG9yZHMpIHJlc29ydCgpOwogICAgICByZXR1cm4gY2hvcmQ7CiAgICB9OwogICAgY2hvcmQuY2hvcmRzID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmICghY2hvcmRzKSByZWxheW91dCgpOwogICAgICByZXR1cm4gY2hvcmRzOwogICAgfTsKICAgIGNob3JkLmdyb3VwcyA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIWdyb3VwcykgcmVsYXlvdXQoKTsKICAgICAgcmV0dXJuIGdyb3VwczsKICAgIH07CiAgICByZXR1cm4gY2hvcmQ7CiAgfTsKICBkMy5sYXlvdXQuZm9yY2UgPSBmdW5jdGlvbigpIHsKICAgIHZhciBmb3JjZSA9IHt9LCBldmVudCA9IGQzLmRpc3BhdGNoKCJzdGFydCIsICJ0aWNrIiwgImVuZCIpLCBzaXplID0gWyAxLCAxIF0sIGRyYWcsIGFscGhhLCBmcmljdGlvbiA9IC45LCBsaW5rRGlzdGFuY2UgPSBkM19sYXlvdXRfZm9yY2VMaW5rRGlzdGFuY2UsIGxpbmtTdHJlbmd0aCA9IGQzX2xheW91dF9mb3JjZUxpbmtTdHJlbmd0aCwgY2hhcmdlID0gLTMwLCBjaGFyZ2VEaXN0YW5jZTIgPSBkM19sYXlvdXRfZm9yY2VDaGFyZ2VEaXN0YW5jZTIsIGdyYXZpdHkgPSAuMSwgdGhldGEyID0gLjY0LCBub2RlcyA9IFtdLCBsaW5rcyA9IFtdLCBkaXN0YW5jZXMsIHN0cmVuZ3RocywgY2hhcmdlczsKICAgIGZ1bmN0aW9uIHJlcHVsc2Uobm9kZSkgewogICAgICByZXR1cm4gZnVuY3Rpb24ocXVhZCwgeDEsIF8sIHgyKSB7CiAgICAgICAgaWYgKHF1YWQucG9pbnQgIT09IG5vZGUpIHsKICAgICAgICAgIHZhciBkeCA9IHF1YWQuY3ggLSBub2RlLngsIGR5ID0gcXVhZC5jeSAtIG5vZGUueSwgZHcgPSB4MiAtIHgxLCBkbiA9IGR4ICogZHggKyBkeSAqIGR5OwogICAgICAgICAgaWYgKGR3ICogZHcgLyB0aGV0YTIgPCBkbikgewogICAgICAgICAgICBpZiAoZG4gPCBjaGFyZ2VEaXN0YW5jZTIpIHsKICAgICAgICAgICAgICB2YXIgayA9IHF1YWQuY2hhcmdlIC8gZG47CiAgICAgICAgICAgICAgbm9kZS5weCAtPSBkeCAqIGs7CiAgICAgICAgICAgICAgbm9kZS5weSAtPSBkeSAqIGs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocXVhZC5wb2ludCAmJiBkbiAmJiBkbiA8IGNoYXJnZURpc3RhbmNlMikgewogICAgICAgICAgICB2YXIgayA9IHF1YWQucG9pbnRDaGFyZ2UgLyBkbjsKICAgICAgICAgICAgbm9kZS5weCAtPSBkeCAqIGs7CiAgICAgICAgICAgIG5vZGUucHkgLT0gZHkgKiBrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gIXF1YWQuY2hhcmdlOwogICAgICB9OwogICAgfQogICAgZm9yY2UudGljayA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAoKGFscGhhICo9IC45OSkgPCAuMDA1KSB7CiAgICAgICAgZXZlbnQuZW5kKHsKICAgICAgICAgIHR5cGU6ICJlbmQiLAogICAgICAgICAgYWxwaGE6IGFscGhhID0gMAogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHZhciBuID0gbm9kZXMubGVuZ3RoLCBtID0gbGlua3MubGVuZ3RoLCBxLCBpLCBvLCBzLCB0LCBsLCBrLCB4LCB5OwogICAgICBmb3IgKGkgPSAwOyBpIDwgbTsgKytpKSB7CiAgICAgICAgbyA9IGxpbmtzW2ldOwogICAgICAgIHMgPSBvLnNvdXJjZTsKICAgICAgICB0ID0gby50YXJnZXQ7CiAgICAgICAgeCA9IHQueCAtIHMueDsKICAgICAgICB5ID0gdC55IC0gcy55OwogICAgICAgIGlmIChsID0geCAqIHggKyB5ICogeSkgewogICAgICAgICAgbCA9IGFscGhhICogc3RyZW5ndGhzW2ldICogKChsID0gTWF0aC5zcXJ0KGwpKSAtIGRpc3RhbmNlc1tpXSkgLyBsOwogICAgICAgICAgeCAqPSBsOwogICAgICAgICAgeSAqPSBsOwogICAgICAgICAgdC54IC09IHggKiAoayA9IHMud2VpZ2h0IC8gKHQud2VpZ2h0ICsgcy53ZWlnaHQpKTsKICAgICAgICAgIHQueSAtPSB5ICogazsKICAgICAgICAgIHMueCArPSB4ICogKGsgPSAxIC0gayk7CiAgICAgICAgICBzLnkgKz0geSAqIGs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChrID0gYWxwaGEgKiBncmF2aXR5KSB7CiAgICAgICAgeCA9IHNpemVbMF0gLyAyOwogICAgICAgIHkgPSBzaXplWzFdIC8gMjsKICAgICAgICBpID0gLTE7CiAgICAgICAgaWYgKGspIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgICBvID0gbm9kZXNbaV07CiAgICAgICAgICBvLnggKz0gKHggLSBvLngpICogazsKICAgICAgICAgIG8ueSArPSAoeSAtIG8ueSkgKiBrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoY2hhcmdlKSB7CiAgICAgICAgZDNfbGF5b3V0X2ZvcmNlQWNjdW11bGF0ZShxID0gZDMuZ2VvbS5xdWFkdHJlZShub2RlcyksIGFscGhhLCBjaGFyZ2VzKTsKICAgICAgICBpID0gLTE7CiAgICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICAgIGlmICghKG8gPSBub2Rlc1tpXSkuZml4ZWQpIHsKICAgICAgICAgICAgcS52aXNpdChyZXB1bHNlKG8pKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaSA9IC0xOwogICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgIG8gPSBub2Rlc1tpXTsKICAgICAgICBpZiAoby5maXhlZCkgewogICAgICAgICAgby54ID0gby5weDsKICAgICAgICAgIG8ueSA9IG8ucHk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG8ueCAtPSAoby5weCAtIChvLnB4ID0gby54KSkgKiBmcmljdGlvbjsKICAgICAgICAgIG8ueSAtPSAoby5weSAtIChvLnB5ID0gby55KSkgKiBmcmljdGlvbjsKICAgICAgICB9CiAgICAgIH0KICAgICAgZXZlbnQudGljayh7CiAgICAgICAgdHlwZTogInRpY2siLAogICAgICAgIGFscGhhOiBhbHBoYQogICAgICB9KTsKICAgIH07CiAgICBmb3JjZS5ub2RlcyA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gbm9kZXM7CiAgICAgIG5vZGVzID0geDsKICAgICAgcmV0dXJuIGZvcmNlOwogICAgfTsKICAgIGZvcmNlLmxpbmtzID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBsaW5rczsKICAgICAgbGlua3MgPSB4OwogICAgICByZXR1cm4gZm9yY2U7CiAgICB9OwogICAgZm9yY2Uuc2l6ZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2l6ZTsKICAgICAgc2l6ZSA9IHg7CiAgICAgIHJldHVybiBmb3JjZTsKICAgIH07CiAgICBmb3JjZS5saW5rRGlzdGFuY2UgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGxpbmtEaXN0YW5jZTsKICAgICAgbGlua0Rpc3RhbmNlID0gdHlwZW9mIHggPT09ICJmdW5jdGlvbiIgPyB4IDogK3g7CiAgICAgIHJldHVybiBmb3JjZTsKICAgIH07CiAgICBmb3JjZS5kaXN0YW5jZSA9IGZvcmNlLmxpbmtEaXN0YW5jZTsKICAgIGZvcmNlLmxpbmtTdHJlbmd0aCA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gbGlua1N0cmVuZ3RoOwogICAgICBsaW5rU3RyZW5ndGggPSB0eXBlb2YgeCA9PT0gImZ1bmN0aW9uIiA/IHggOiAreDsKICAgICAgcmV0dXJuIGZvcmNlOwogICAgfTsKICAgIGZvcmNlLmZyaWN0aW9uID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBmcmljdGlvbjsKICAgICAgZnJpY3Rpb24gPSAreDsKICAgICAgcmV0dXJuIGZvcmNlOwogICAgfTsKICAgIGZvcmNlLmNoYXJnZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gY2hhcmdlOwogICAgICBjaGFyZ2UgPSB0eXBlb2YgeCA9PT0gImZ1bmN0aW9uIiA/IHggOiAreDsKICAgICAgcmV0dXJuIGZvcmNlOwogICAgfTsKICAgIGZvcmNlLmNoYXJnZURpc3RhbmNlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBNYXRoLnNxcnQoY2hhcmdlRGlzdGFuY2UyKTsKICAgICAgY2hhcmdlRGlzdGFuY2UyID0geCAqIHg7CiAgICAgIHJldHVybiBmb3JjZTsKICAgIH07CiAgICBmb3JjZS5ncmF2aXR5ID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBncmF2aXR5OwogICAgICBncmF2aXR5ID0gK3g7CiAgICAgIHJldHVybiBmb3JjZTsKICAgIH07CiAgICBmb3JjZS50aGV0YSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gTWF0aC5zcXJ0KHRoZXRhMik7CiAgICAgIHRoZXRhMiA9IHggKiB4OwogICAgICByZXR1cm4gZm9yY2U7CiAgICB9OwogICAgZm9yY2UuYWxwaGEgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGFscGhhOwogICAgICB4ID0gK3g7CiAgICAgIGlmIChhbHBoYSkgewogICAgICAgIGlmICh4ID4gMCkgYWxwaGEgPSB4OyBlbHNlIGFscGhhID0gMDsKICAgICAgfSBlbHNlIGlmICh4ID4gMCkgewogICAgICAgIGV2ZW50LnN0YXJ0KHsKICAgICAgICAgIHR5cGU6ICJzdGFydCIsCiAgICAgICAgICBhbHBoYTogYWxwaGEgPSB4CiAgICAgICAgfSk7CiAgICAgICAgZDMudGltZXIoZm9yY2UudGljayk7CiAgICAgIH0KICAgICAgcmV0dXJuIGZvcmNlOwogICAgfTsKICAgIGZvcmNlLnN0YXJ0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBpLCBuID0gbm9kZXMubGVuZ3RoLCBtID0gbGlua3MubGVuZ3RoLCB3ID0gc2l6ZVswXSwgaCA9IHNpemVbMV0sIG5laWdoYm9ycywgbzsKICAgICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICAgIChvID0gbm9kZXNbaV0pLmluZGV4ID0gaTsKICAgICAgICBvLndlaWdodCA9IDA7CiAgICAgIH0KICAgICAgZm9yIChpID0gMDsgaSA8IG07ICsraSkgewogICAgICAgIG8gPSBsaW5rc1tpXTsKICAgICAgICBpZiAodHlwZW9mIG8uc291cmNlID09ICJudW1iZXIiKSBvLnNvdXJjZSA9IG5vZGVzW28uc291cmNlXTsKICAgICAgICBpZiAodHlwZW9mIG8udGFyZ2V0ID09ICJudW1iZXIiKSBvLnRhcmdldCA9IG5vZGVzW28udGFyZ2V0XTsKICAgICAgICArK28uc291cmNlLndlaWdodDsKICAgICAgICArK28udGFyZ2V0LndlaWdodDsKICAgICAgfQogICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgICAgbyA9IG5vZGVzW2ldOwogICAgICAgIGlmIChpc05hTihvLngpKSBvLnggPSBwb3NpdGlvbigieCIsIHcpOwogICAgICAgIGlmIChpc05hTihvLnkpKSBvLnkgPSBwb3NpdGlvbigieSIsIGgpOwogICAgICAgIGlmIChpc05hTihvLnB4KSkgby5weCA9IG8ueDsKICAgICAgICBpZiAoaXNOYU4oby5weSkpIG8ucHkgPSBvLnk7CiAgICAgIH0KICAgICAgZGlzdGFuY2VzID0gW107CiAgICAgIGlmICh0eXBlb2YgbGlua0Rpc3RhbmNlID09PSAiZnVuY3Rpb24iKSBmb3IgKGkgPSAwOyBpIDwgbTsgKytpKSBkaXN0YW5jZXNbaV0gPSArbGlua0Rpc3RhbmNlLmNhbGwodGhpcywgbGlua3NbaV0sIGkpOyBlbHNlIGZvciAoaSA9IDA7IGkgPCBtOyArK2kpIGRpc3RhbmNlc1tpXSA9IGxpbmtEaXN0YW5jZTsKICAgICAgc3RyZW5ndGhzID0gW107CiAgICAgIGlmICh0eXBlb2YgbGlua1N0cmVuZ3RoID09PSAiZnVuY3Rpb24iKSBmb3IgKGkgPSAwOyBpIDwgbTsgKytpKSBzdHJlbmd0aHNbaV0gPSArbGlua1N0cmVuZ3RoLmNhbGwodGhpcywgbGlua3NbaV0sIGkpOyBlbHNlIGZvciAoaSA9IDA7IGkgPCBtOyArK2kpIHN0cmVuZ3Roc1tpXSA9IGxpbmtTdHJlbmd0aDsKICAgICAgY2hhcmdlcyA9IFtdOwogICAgICBpZiAodHlwZW9mIGNoYXJnZSA9PT0gImZ1bmN0aW9uIikgZm9yIChpID0gMDsgaSA8IG47ICsraSkgY2hhcmdlc1tpXSA9ICtjaGFyZ2UuY2FsbCh0aGlzLCBub2Rlc1tpXSwgaSk7IGVsc2UgZm9yIChpID0gMDsgaSA8IG47ICsraSkgY2hhcmdlc1tpXSA9IGNoYXJnZTsKICAgICAgZnVuY3Rpb24gcG9zaXRpb24oZGltZW5zaW9uLCBzaXplKSB7CiAgICAgICAgaWYgKCFuZWlnaGJvcnMpIHsKICAgICAgICAgIG5laWdoYm9ycyA9IG5ldyBBcnJheShuKTsKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBuOyArK2opIHsKICAgICAgICAgICAgbmVpZ2hib3JzW2pdID0gW107CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgbTsgKytqKSB7CiAgICAgICAgICAgIHZhciBvID0gbGlua3Nbal07CiAgICAgICAgICAgIG5laWdoYm9yc1tvLnNvdXJjZS5pbmRleF0ucHVzaChvLnRhcmdldCk7CiAgICAgICAgICAgIG5laWdoYm9yc1tvLnRhcmdldC5pbmRleF0ucHVzaChvLnNvdXJjZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBjYW5kaWRhdGVzID0gbmVpZ2hib3JzW2ldLCBqID0gLTEsIG0gPSBjYW5kaWRhdGVzLmxlbmd0aCwgeDsKICAgICAgICB3aGlsZSAoKytqIDwgbSkgaWYgKCFpc05hTih4ID0gY2FuZGlkYXRlc1tqXVtkaW1lbnNpb25dKSkgcmV0dXJuIHg7CiAgICAgICAgcmV0dXJuIE1hdGgucmFuZG9tKCkgKiBzaXplOwogICAgICB9CiAgICAgIHJldHVybiBmb3JjZS5yZXN1bWUoKTsKICAgIH07CiAgICBmb3JjZS5yZXN1bWUgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGZvcmNlLmFscGhhKC4xKTsKICAgIH07CiAgICBmb3JjZS5zdG9wID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBmb3JjZS5hbHBoYSgwKTsKICAgIH07CiAgICBmb3JjZS5kcmFnID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmICghZHJhZykgZHJhZyA9IGQzLmJlaGF2aW9yLmRyYWcoKS5vcmlnaW4oZDNfaWRlbnRpdHkpLm9uKCJkcmFnc3RhcnQuZm9yY2UiLCBkM19sYXlvdXRfZm9yY2VEcmFnc3RhcnQpLm9uKCJkcmFnLmZvcmNlIiwgZHJhZ21vdmUpLm9uKCJkcmFnZW5kLmZvcmNlIiwgZDNfbGF5b3V0X2ZvcmNlRHJhZ2VuZCk7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGRyYWc7CiAgICAgIHRoaXMub24oIm1vdXNlb3Zlci5mb3JjZSIsIGQzX2xheW91dF9mb3JjZU1vdXNlb3Zlcikub24oIm1vdXNlb3V0LmZvcmNlIiwgZDNfbGF5b3V0X2ZvcmNlTW91c2VvdXQpLmNhbGwoZHJhZyk7CiAgICB9OwogICAgZnVuY3Rpb24gZHJhZ21vdmUoZCkgewogICAgICBkLnB4ID0gZDMuZXZlbnQueCwgZC5weSA9IGQzLmV2ZW50Lnk7CiAgICAgIGZvcmNlLnJlc3VtZSgpOwogICAgfQogICAgcmV0dXJuIGQzLnJlYmluZChmb3JjZSwgZXZlbnQsICJvbiIpOwogIH07CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2ZvcmNlRHJhZ3N0YXJ0KGQpIHsKICAgIGQuZml4ZWQgfD0gMjsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2ZvcmNlRHJhZ2VuZChkKSB7CiAgICBkLmZpeGVkICY9IH42OwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfZm9yY2VNb3VzZW92ZXIoZCkgewogICAgZC5maXhlZCB8PSA0OwogICAgZC5weCA9IGQueCwgZC5weSA9IGQueTsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2ZvcmNlTW91c2VvdXQoZCkgewogICAgZC5maXhlZCAmPSB+NDsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2ZvcmNlQWNjdW11bGF0ZShxdWFkLCBhbHBoYSwgY2hhcmdlcykgewogICAgdmFyIGN4ID0gMCwgY3kgPSAwOwogICAgcXVhZC5jaGFyZ2UgPSAwOwogICAgaWYgKCFxdWFkLmxlYWYpIHsKICAgICAgdmFyIG5vZGVzID0gcXVhZC5ub2RlcywgbiA9IG5vZGVzLmxlbmd0aCwgaSA9IC0xLCBjOwogICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgIGMgPSBub2Rlc1tpXTsKICAgICAgICBpZiAoYyA9PSBudWxsKSBjb250aW51ZTsKICAgICAgICBkM19sYXlvdXRfZm9yY2VBY2N1bXVsYXRlKGMsIGFscGhhLCBjaGFyZ2VzKTsKICAgICAgICBxdWFkLmNoYXJnZSArPSBjLmNoYXJnZTsKICAgICAgICBjeCArPSBjLmNoYXJnZSAqIGMuY3g7CiAgICAgICAgY3kgKz0gYy5jaGFyZ2UgKiBjLmN5OwogICAgICB9CiAgICB9CiAgICBpZiAocXVhZC5wb2ludCkgewogICAgICBpZiAoIXF1YWQubGVhZikgewogICAgICAgIHF1YWQucG9pbnQueCArPSBNYXRoLnJhbmRvbSgpIC0gLjU7CiAgICAgICAgcXVhZC5wb2ludC55ICs9IE1hdGgucmFuZG9tKCkgLSAuNTsKICAgICAgfQogICAgICB2YXIgayA9IGFscGhhICogY2hhcmdlc1txdWFkLnBvaW50LmluZGV4XTsKICAgICAgcXVhZC5jaGFyZ2UgKz0gcXVhZC5wb2ludENoYXJnZSA9IGs7CiAgICAgIGN4ICs9IGsgKiBxdWFkLnBvaW50Lng7CiAgICAgIGN5ICs9IGsgKiBxdWFkLnBvaW50Lnk7CiAgICB9CiAgICBxdWFkLmN4ID0gY3ggLyBxdWFkLmNoYXJnZTsKICAgIHF1YWQuY3kgPSBjeSAvIHF1YWQuY2hhcmdlOwogIH0KICB2YXIgZDNfbGF5b3V0X2ZvcmNlTGlua0Rpc3RhbmNlID0gMjAsIGQzX2xheW91dF9mb3JjZUxpbmtTdHJlbmd0aCA9IDEsIGQzX2xheW91dF9mb3JjZUNoYXJnZURpc3RhbmNlMiA9IEluZmluaXR5OwogIGQzLmxheW91dC5oaWVyYXJjaHkgPSBmdW5jdGlvbigpIHsKICAgIHZhciBzb3J0ID0gZDNfbGF5b3V0X2hpZXJhcmNoeVNvcnQsIGNoaWxkcmVuID0gZDNfbGF5b3V0X2hpZXJhcmNoeUNoaWxkcmVuLCB2YWx1ZSA9IGQzX2xheW91dF9oaWVyYXJjaHlWYWx1ZTsKICAgIGZ1bmN0aW9uIGhpZXJhcmNoeShyb290KSB7CiAgICAgIHZhciBzdGFjayA9IFsgcm9vdCBdLCBub2RlcyA9IFtdLCBub2RlOwogICAgICByb290LmRlcHRoID0gMDsKICAgICAgd2hpbGUgKChub2RlID0gc3RhY2sucG9wKCkpICE9IG51bGwpIHsKICAgICAgICBub2Rlcy5wdXNoKG5vZGUpOwogICAgICAgIGlmICgoY2hpbGRzID0gY2hpbGRyZW4uY2FsbChoaWVyYXJjaHksIG5vZGUsIG5vZGUuZGVwdGgpKSAmJiAobiA9IGNoaWxkcy5sZW5ndGgpKSB7CiAgICAgICAgICB2YXIgbiwgY2hpbGRzLCBjaGlsZDsKICAgICAgICAgIHdoaWxlICgtLW4gPj0gMCkgewogICAgICAgICAgICBzdGFjay5wdXNoKGNoaWxkID0gY2hpbGRzW25dKTsKICAgICAgICAgICAgY2hpbGQucGFyZW50ID0gbm9kZTsKICAgICAgICAgICAgY2hpbGQuZGVwdGggPSBub2RlLmRlcHRoICsgMTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh2YWx1ZSkgbm9kZS52YWx1ZSA9IDA7CiAgICAgICAgICBub2RlLmNoaWxkcmVuID0gY2hpbGRzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodmFsdWUpIG5vZGUudmFsdWUgPSArdmFsdWUuY2FsbChoaWVyYXJjaHksIG5vZGUsIG5vZGUuZGVwdGgpIHx8IDA7CiAgICAgICAgICBkZWxldGUgbm9kZS5jaGlsZHJlbjsKICAgICAgICB9CiAgICAgIH0KICAgICAgZDNfbGF5b3V0X2hpZXJhcmNoeVZpc2l0QWZ0ZXIocm9vdCwgZnVuY3Rpb24obm9kZSkgewogICAgICAgIHZhciBjaGlsZHMsIHBhcmVudDsKICAgICAgICBpZiAoc29ydCAmJiAoY2hpbGRzID0gbm9kZS5jaGlsZHJlbikpIGNoaWxkcy5zb3J0KHNvcnQpOwogICAgICAgIGlmICh2YWx1ZSAmJiAocGFyZW50ID0gbm9kZS5wYXJlbnQpKSBwYXJlbnQudmFsdWUgKz0gbm9kZS52YWx1ZTsKICAgICAgfSk7CiAgICAgIHJldHVybiBub2RlczsKICAgIH0KICAgIGhpZXJhcmNoeS5zb3J0ID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzb3J0OwogICAgICBzb3J0ID0geDsKICAgICAgcmV0dXJuIGhpZXJhcmNoeTsKICAgIH07CiAgICBoaWVyYXJjaHkuY2hpbGRyZW4gPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGNoaWxkcmVuOwogICAgICBjaGlsZHJlbiA9IHg7CiAgICAgIHJldHVybiBoaWVyYXJjaHk7CiAgICB9OwogICAgaGllcmFyY2h5LnZhbHVlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB2YWx1ZTsKICAgICAgdmFsdWUgPSB4OwogICAgICByZXR1cm4gaGllcmFyY2h5OwogICAgfTsKICAgIGhpZXJhcmNoeS5yZXZhbHVlID0gZnVuY3Rpb24ocm9vdCkgewogICAgICBpZiAodmFsdWUpIHsKICAgICAgICBkM19sYXlvdXRfaGllcmFyY2h5VmlzaXRCZWZvcmUocm9vdCwgZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4pIG5vZGUudmFsdWUgPSAwOwogICAgICAgIH0pOwogICAgICAgIGQzX2xheW91dF9oaWVyYXJjaHlWaXNpdEFmdGVyKHJvb3QsIGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICAgIHZhciBwYXJlbnQ7CiAgICAgICAgICBpZiAoIW5vZGUuY2hpbGRyZW4pIG5vZGUudmFsdWUgPSArdmFsdWUuY2FsbChoaWVyYXJjaHksIG5vZGUsIG5vZGUuZGVwdGgpIHx8IDA7CiAgICAgICAgICBpZiAocGFyZW50ID0gbm9kZS5wYXJlbnQpIHBhcmVudC52YWx1ZSArPSBub2RlLnZhbHVlOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiByb290OwogICAgfTsKICAgIHJldHVybiBoaWVyYXJjaHk7CiAgfTsKICBmdW5jdGlvbiBkM19sYXlvdXRfaGllcmFyY2h5UmViaW5kKG9iamVjdCwgaGllcmFyY2h5KSB7CiAgICBkMy5yZWJpbmQob2JqZWN0LCBoaWVyYXJjaHksICJzb3J0IiwgImNoaWxkcmVuIiwgInZhbHVlIik7CiAgICBvYmplY3Qubm9kZXMgPSBvYmplY3Q7CiAgICBvYmplY3QubGlua3MgPSBkM19sYXlvdXRfaGllcmFyY2h5TGlua3M7CiAgICByZXR1cm4gb2JqZWN0OwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfaGllcmFyY2h5VmlzaXRCZWZvcmUobm9kZSwgY2FsbGJhY2spIHsKICAgIHZhciBub2RlcyA9IFsgbm9kZSBdOwogICAgd2hpbGUgKChub2RlID0gbm9kZXMucG9wKCkpICE9IG51bGwpIHsKICAgICAgY2FsbGJhY2sobm9kZSk7CiAgICAgIGlmICgoY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuKSAmJiAobiA9IGNoaWxkcmVuLmxlbmd0aCkpIHsKICAgICAgICB2YXIgbiwgY2hpbGRyZW47CiAgICAgICAgd2hpbGUgKC0tbiA+PSAwKSBub2Rlcy5wdXNoKGNoaWxkcmVuW25dKTsKICAgICAgfQogICAgfQogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfaGllcmFyY2h5VmlzaXRBZnRlcihub2RlLCBjYWxsYmFjaykgewogICAgdmFyIG5vZGVzID0gWyBub2RlIF0sIG5vZGVzMiA9IFtdOwogICAgd2hpbGUgKChub2RlID0gbm9kZXMucG9wKCkpICE9IG51bGwpIHsKICAgICAgbm9kZXMyLnB1c2gobm9kZSk7CiAgICAgIGlmICgoY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuKSAmJiAobiA9IGNoaWxkcmVuLmxlbmd0aCkpIHsKICAgICAgICB2YXIgaSA9IC0xLCBuLCBjaGlsZHJlbjsKICAgICAgICB3aGlsZSAoKytpIDwgbikgbm9kZXMucHVzaChjaGlsZHJlbltpXSk7CiAgICAgIH0KICAgIH0KICAgIHdoaWxlICgobm9kZSA9IG5vZGVzMi5wb3AoKSkgIT0gbnVsbCkgewogICAgICBjYWxsYmFjayhub2RlKTsKICAgIH0KICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2hpZXJhcmNoeUNoaWxkcmVuKGQpIHsKICAgIHJldHVybiBkLmNoaWxkcmVuOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfaGllcmFyY2h5VmFsdWUoZCkgewogICAgcmV0dXJuIGQudmFsdWU7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9oaWVyYXJjaHlTb3J0KGEsIGIpIHsKICAgIHJldHVybiBiLnZhbHVlIC0gYS52YWx1ZTsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2hpZXJhcmNoeUxpbmtzKG5vZGVzKSB7CiAgICByZXR1cm4gZDMubWVyZ2Uobm9kZXMubWFwKGZ1bmN0aW9uKHBhcmVudCkgewogICAgICByZXR1cm4gKHBhcmVudC5jaGlsZHJlbiB8fCBbXSkubWFwKGZ1bmN0aW9uKGNoaWxkKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHNvdXJjZTogcGFyZW50LAogICAgICAgICAgdGFyZ2V0OiBjaGlsZAogICAgICAgIH07CiAgICAgIH0pOwogICAgfSkpOwogIH0KICBkMy5sYXlvdXQucGFydGl0aW9uID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgaGllcmFyY2h5ID0gZDMubGF5b3V0LmhpZXJhcmNoeSgpLCBzaXplID0gWyAxLCAxIF07CiAgICBmdW5jdGlvbiBwb3NpdGlvbihub2RlLCB4LCBkeCwgZHkpIHsKICAgICAgdmFyIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjsKICAgICAgbm9kZS54ID0geDsKICAgICAgbm9kZS55ID0gbm9kZS5kZXB0aCAqIGR5OwogICAgICBub2RlLmR4ID0gZHg7CiAgICAgIG5vZGUuZHkgPSBkeTsKICAgICAgaWYgKGNoaWxkcmVuICYmIChuID0gY2hpbGRyZW4ubGVuZ3RoKSkgewogICAgICAgIHZhciBpID0gLTEsIG4sIGMsIGQ7CiAgICAgICAgZHggPSBub2RlLnZhbHVlID8gZHggLyBub2RlLnZhbHVlIDogMDsKICAgICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgICAgcG9zaXRpb24oYyA9IGNoaWxkcmVuW2ldLCB4LCBkID0gYy52YWx1ZSAqIGR4LCBkeSk7CiAgICAgICAgICB4ICs9IGQ7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBkZXB0aChub2RlKSB7CiAgICAgIHZhciBjaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW4sIGQgPSAwOwogICAgICBpZiAoY2hpbGRyZW4gJiYgKG4gPSBjaGlsZHJlbi5sZW5ndGgpKSB7CiAgICAgICAgdmFyIGkgPSAtMSwgbjsKICAgICAgICB3aGlsZSAoKytpIDwgbikgZCA9IE1hdGgubWF4KGQsIGRlcHRoKGNoaWxkcmVuW2ldKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIDEgKyBkOwogICAgfQogICAgZnVuY3Rpb24gcGFydGl0aW9uKGQsIGkpIHsKICAgICAgdmFyIG5vZGVzID0gaGllcmFyY2h5LmNhbGwodGhpcywgZCwgaSk7CiAgICAgIHBvc2l0aW9uKG5vZGVzWzBdLCAwLCBzaXplWzBdLCBzaXplWzFdIC8gZGVwdGgobm9kZXNbMF0pKTsKICAgICAgcmV0dXJuIG5vZGVzOwogICAgfQogICAgcGFydGl0aW9uLnNpemUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNpemU7CiAgICAgIHNpemUgPSB4OwogICAgICByZXR1cm4gcGFydGl0aW9uOwogICAgfTsKICAgIHJldHVybiBkM19sYXlvdXRfaGllcmFyY2h5UmViaW5kKHBhcnRpdGlvbiwgaGllcmFyY2h5KTsKICB9OwogIGQzLmxheW91dC5waWUgPSBmdW5jdGlvbigpIHsKICAgIHZhciB2YWx1ZSA9IE51bWJlciwgc29ydCA9IGQzX2xheW91dF9waWVTb3J0QnlWYWx1ZSwgc3RhcnRBbmdsZSA9IDAsIGVuZEFuZ2xlID0gz4QsIHBhZEFuZ2xlID0gMDsKICAgIGZ1bmN0aW9uIHBpZShkYXRhKSB7CiAgICAgIHZhciBuID0gZGF0YS5sZW5ndGgsIHZhbHVlcyA9IGRhdGEubWFwKGZ1bmN0aW9uKGQsIGkpIHsKICAgICAgICByZXR1cm4gK3ZhbHVlLmNhbGwocGllLCBkLCBpKTsKICAgICAgfSksIGEgPSArKHR5cGVvZiBzdGFydEFuZ2xlID09PSAiZnVuY3Rpb24iID8gc3RhcnRBbmdsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogc3RhcnRBbmdsZSksIGRhID0gKHR5cGVvZiBlbmRBbmdsZSA9PT0gImZ1bmN0aW9uIiA/IGVuZEFuZ2xlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiBlbmRBbmdsZSkgLSBhLCBwID0gTWF0aC5taW4oTWF0aC5hYnMoZGEpIC8gbiwgKyh0eXBlb2YgcGFkQW5nbGUgPT09ICJmdW5jdGlvbiIgPyBwYWRBbmdsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogcGFkQW5nbGUpKSwgcGEgPSBwICogKGRhIDwgMCA/IC0xIDogMSksIGsgPSAoZGEgLSBuICogcGEpIC8gZDMuc3VtKHZhbHVlcyksIGluZGV4ID0gZDMucmFuZ2UobiksIGFyY3MgPSBbXSwgdjsKICAgICAgaWYgKHNvcnQgIT0gbnVsbCkgaW5kZXguc29ydChzb3J0ID09PSBkM19sYXlvdXRfcGllU29ydEJ5VmFsdWUgPyBmdW5jdGlvbihpLCBqKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlc1tqXSAtIHZhbHVlc1tpXTsKICAgICAgfSA6IGZ1bmN0aW9uKGksIGopIHsKICAgICAgICByZXR1cm4gc29ydChkYXRhW2ldLCBkYXRhW2pdKTsKICAgICAgfSk7CiAgICAgIGluZGV4LmZvckVhY2goZnVuY3Rpb24oaSkgewogICAgICAgIGFyY3NbaV0gPSB7CiAgICAgICAgICBkYXRhOiBkYXRhW2ldLAogICAgICAgICAgdmFsdWU6IHYgPSB2YWx1ZXNbaV0sCiAgICAgICAgICBzdGFydEFuZ2xlOiBhLAogICAgICAgICAgZW5kQW5nbGU6IGEgKz0gdiAqIGsgKyBwYSwKICAgICAgICAgIHBhZEFuZ2xlOiBwCiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgIHJldHVybiBhcmNzOwogICAgfQogICAgcGllLnZhbHVlID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB2YWx1ZTsKICAgICAgdmFsdWUgPSBfOwogICAgICByZXR1cm4gcGllOwogICAgfTsKICAgIHBpZS5zb3J0ID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzb3J0OwogICAgICBzb3J0ID0gXzsKICAgICAgcmV0dXJuIHBpZTsKICAgIH07CiAgICBwaWUuc3RhcnRBbmdsZSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc3RhcnRBbmdsZTsKICAgICAgc3RhcnRBbmdsZSA9IF87CiAgICAgIHJldHVybiBwaWU7CiAgICB9OwogICAgcGllLmVuZEFuZ2xlID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBlbmRBbmdsZTsKICAgICAgZW5kQW5nbGUgPSBfOwogICAgICByZXR1cm4gcGllOwogICAgfTsKICAgIHBpZS5wYWRBbmdsZSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gcGFkQW5nbGU7CiAgICAgIHBhZEFuZ2xlID0gXzsKICAgICAgcmV0dXJuIHBpZTsKICAgIH07CiAgICByZXR1cm4gcGllOwogIH07CiAgdmFyIGQzX2xheW91dF9waWVTb3J0QnlWYWx1ZSA9IHt9OwogIGQzLmxheW91dC5zdGFjayA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHZhbHVlcyA9IGQzX2lkZW50aXR5LCBvcmRlciA9IGQzX2xheW91dF9zdGFja09yZGVyRGVmYXVsdCwgb2Zmc2V0ID0gZDNfbGF5b3V0X3N0YWNrT2Zmc2V0WmVybywgb3V0ID0gZDNfbGF5b3V0X3N0YWNrT3V0LCB4ID0gZDNfbGF5b3V0X3N0YWNrWCwgeSA9IGQzX2xheW91dF9zdGFja1k7CiAgICBmdW5jdGlvbiBzdGFjayhkYXRhLCBpbmRleCkgewogICAgICBpZiAoIShuID0gZGF0YS5sZW5ndGgpKSByZXR1cm4gZGF0YTsKICAgICAgdmFyIHNlcmllcyA9IGRhdGEubWFwKGZ1bmN0aW9uKGQsIGkpIHsKICAgICAgICByZXR1cm4gdmFsdWVzLmNhbGwoc3RhY2ssIGQsIGkpOwogICAgICB9KTsKICAgICAgdmFyIHBvaW50cyA9IHNlcmllcy5tYXAoZnVuY3Rpb24oZCkgewogICAgICAgIHJldHVybiBkLm1hcChmdW5jdGlvbih2LCBpKSB7CiAgICAgICAgICByZXR1cm4gWyB4LmNhbGwoc3RhY2ssIHYsIGkpLCB5LmNhbGwoc3RhY2ssIHYsIGkpIF07CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB2YXIgb3JkZXJzID0gb3JkZXIuY2FsbChzdGFjaywgcG9pbnRzLCBpbmRleCk7CiAgICAgIHNlcmllcyA9IGQzLnBlcm11dGUoc2VyaWVzLCBvcmRlcnMpOwogICAgICBwb2ludHMgPSBkMy5wZXJtdXRlKHBvaW50cywgb3JkZXJzKTsKICAgICAgdmFyIG9mZnNldHMgPSBvZmZzZXQuY2FsbChzdGFjaywgcG9pbnRzLCBpbmRleCk7CiAgICAgIHZhciBtID0gc2VyaWVzWzBdLmxlbmd0aCwgbiwgaSwgaiwgbzsKICAgICAgZm9yIChqID0gMDsgaiA8IG07ICsraikgewogICAgICAgIG91dC5jYWxsKHN0YWNrLCBzZXJpZXNbMF1bal0sIG8gPSBvZmZzZXRzW2pdLCBwb2ludHNbMF1bal1bMV0pOwogICAgICAgIGZvciAoaSA9IDE7IGkgPCBuOyArK2kpIHsKICAgICAgICAgIG91dC5jYWxsKHN0YWNrLCBzZXJpZXNbaV1bal0sIG8gKz0gcG9pbnRzW2kgLSAxXVtqXVsxXSwgcG9pbnRzW2ldW2pdWzFdKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICBzdGFjay52YWx1ZXMgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHZhbHVlczsKICAgICAgdmFsdWVzID0geDsKICAgICAgcmV0dXJuIHN0YWNrOwogICAgfTsKICAgIHN0YWNrLm9yZGVyID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBvcmRlcjsKICAgICAgb3JkZXIgPSB0eXBlb2YgeCA9PT0gImZ1bmN0aW9uIiA/IHggOiBkM19sYXlvdXRfc3RhY2tPcmRlcnMuZ2V0KHgpIHx8IGQzX2xheW91dF9zdGFja09yZGVyRGVmYXVsdDsKICAgICAgcmV0dXJuIHN0YWNrOwogICAgfTsKICAgIHN0YWNrLm9mZnNldCA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gb2Zmc2V0OwogICAgICBvZmZzZXQgPSB0eXBlb2YgeCA9PT0gImZ1bmN0aW9uIiA/IHggOiBkM19sYXlvdXRfc3RhY2tPZmZzZXRzLmdldCh4KSB8fCBkM19sYXlvdXRfc3RhY2tPZmZzZXRaZXJvOwogICAgICByZXR1cm4gc3RhY2s7CiAgICB9OwogICAgc3RhY2sueCA9IGZ1bmN0aW9uKHopIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4geDsKICAgICAgeCA9IHo7CiAgICAgIHJldHVybiBzdGFjazsKICAgIH07CiAgICBzdGFjay55ID0gZnVuY3Rpb24oeikgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB5OwogICAgICB5ID0gejsKICAgICAgcmV0dXJuIHN0YWNrOwogICAgfTsKICAgIHN0YWNrLm91dCA9IGZ1bmN0aW9uKHopIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gb3V0OwogICAgICBvdXQgPSB6OwogICAgICByZXR1cm4gc3RhY2s7CiAgICB9OwogICAgcmV0dXJuIHN0YWNrOwogIH07CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3N0YWNrWChkKSB7CiAgICByZXR1cm4gZC54OwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfc3RhY2tZKGQpIHsKICAgIHJldHVybiBkLnk7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9zdGFja091dChkLCB5MCwgeSkgewogICAgZC55MCA9IHkwOwogICAgZC55ID0geTsKICB9CiAgdmFyIGQzX2xheW91dF9zdGFja09yZGVycyA9IGQzLm1hcCh7CiAgICAiaW5zaWRlLW91dCI6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgdmFyIG4gPSBkYXRhLmxlbmd0aCwgaSwgaiwgbWF4ID0gZGF0YS5tYXAoZDNfbGF5b3V0X3N0YWNrTWF4SW5kZXgpLCBzdW1zID0gZGF0YS5tYXAoZDNfbGF5b3V0X3N0YWNrUmVkdWNlU3VtKSwgaW5kZXggPSBkMy5yYW5nZShuKS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gbWF4W2FdIC0gbWF4W2JdOwogICAgICB9KSwgdG9wID0gMCwgYm90dG9tID0gMCwgdG9wcyA9IFtdLCBib3R0b21zID0gW107CiAgICAgIGZvciAoaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgICBqID0gaW5kZXhbaV07CiAgICAgICAgaWYgKHRvcCA8IGJvdHRvbSkgewogICAgICAgICAgdG9wICs9IHN1bXNbal07CiAgICAgICAgICB0b3BzLnB1c2goaik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJvdHRvbSArPSBzdW1zW2pdOwogICAgICAgICAgYm90dG9tcy5wdXNoKGopOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gYm90dG9tcy5yZXZlcnNlKCkuY29uY2F0KHRvcHMpOwogICAgfSwKICAgIHJldmVyc2U6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgcmV0dXJuIGQzLnJhbmdlKGRhdGEubGVuZ3RoKS5yZXZlcnNlKCk7CiAgICB9LAogICAgImRlZmF1bHQiOiBkM19sYXlvdXRfc3RhY2tPcmRlckRlZmF1bHQKICB9KTsKICB2YXIgZDNfbGF5b3V0X3N0YWNrT2Zmc2V0cyA9IGQzLm1hcCh7CiAgICBzaWxob3VldHRlOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgIHZhciBuID0gZGF0YS5sZW5ndGgsIG0gPSBkYXRhWzBdLmxlbmd0aCwgc3VtcyA9IFtdLCBtYXggPSAwLCBpLCBqLCBvLCB5MCA9IFtdOwogICAgICBmb3IgKGogPSAwOyBqIDwgbTsgKytqKSB7CiAgICAgICAgZm9yIChpID0gMCwgbyA9IDA7IGkgPCBuOyBpKyspIG8gKz0gZGF0YVtpXVtqXVsxXTsKICAgICAgICBpZiAobyA+IG1heCkgbWF4ID0gbzsKICAgICAgICBzdW1zLnB1c2gobyk7CiAgICAgIH0KICAgICAgZm9yIChqID0gMDsgaiA8IG07ICsraikgewogICAgICAgIHkwW2pdID0gKG1heCAtIHN1bXNbal0pIC8gMjsKICAgICAgfQogICAgICByZXR1cm4geTA7CiAgICB9LAogICAgd2lnZ2xlOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgIHZhciBuID0gZGF0YS5sZW5ndGgsIHggPSBkYXRhWzBdLCBtID0geC5sZW5ndGgsIGksIGosIGssIHMxLCBzMiwgczMsIGR4LCBvLCBvMCwgeTAgPSBbXTsKICAgICAgeTBbMF0gPSBvID0gbzAgPSAwOwogICAgICBmb3IgKGogPSAxOyBqIDwgbTsgKytqKSB7CiAgICAgICAgZm9yIChpID0gMCwgczEgPSAwOyBpIDwgbjsgKytpKSBzMSArPSBkYXRhW2ldW2pdWzFdOwogICAgICAgIGZvciAoaSA9IDAsIHMyID0gMCwgZHggPSB4W2pdWzBdIC0geFtqIC0gMV1bMF07IGkgPCBuOyArK2kpIHsKICAgICAgICAgIGZvciAoayA9IDAsIHMzID0gKGRhdGFbaV1bal1bMV0gLSBkYXRhW2ldW2ogLSAxXVsxXSkgLyAoMiAqIGR4KTsgayA8IGk7ICsraykgewogICAgICAgICAgICBzMyArPSAoZGF0YVtrXVtqXVsxXSAtIGRhdGFba11baiAtIDFdWzFdKSAvIGR4OwogICAgICAgICAgfQogICAgICAgICAgczIgKz0gczMgKiBkYXRhW2ldW2pdWzFdOwogICAgICAgIH0KICAgICAgICB5MFtqXSA9IG8gLT0gczEgPyBzMiAvIHMxICogZHggOiAwOwogICAgICAgIGlmIChvIDwgbzApIG8wID0gbzsKICAgICAgfQogICAgICBmb3IgKGogPSAwOyBqIDwgbTsgKytqKSB5MFtqXSAtPSBvMDsKICAgICAgcmV0dXJuIHkwOwogICAgfSwKICAgIGV4cGFuZDogZnVuY3Rpb24oZGF0YSkgewogICAgICB2YXIgbiA9IGRhdGEubGVuZ3RoLCBtID0gZGF0YVswXS5sZW5ndGgsIGsgPSAxIC8gbiwgaSwgaiwgbywgeTAgPSBbXTsKICAgICAgZm9yIChqID0gMDsgaiA8IG07ICsraikgewogICAgICAgIGZvciAoaSA9IDAsIG8gPSAwOyBpIDwgbjsgaSsrKSBvICs9IGRhdGFbaV1bal1bMV07CiAgICAgICAgaWYgKG8pIGZvciAoaSA9IDA7IGkgPCBuOyBpKyspIGRhdGFbaV1bal1bMV0gLz0gbzsgZWxzZSBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSBkYXRhW2ldW2pdWzFdID0gazsKICAgICAgfQogICAgICBmb3IgKGogPSAwOyBqIDwgbTsgKytqKSB5MFtqXSA9IDA7CiAgICAgIHJldHVybiB5MDsKICAgIH0sCiAgICB6ZXJvOiBkM19sYXlvdXRfc3RhY2tPZmZzZXRaZXJvCiAgfSk7CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3N0YWNrT3JkZXJEZWZhdWx0KGRhdGEpIHsKICAgIHJldHVybiBkMy5yYW5nZShkYXRhLmxlbmd0aCk7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9zdGFja09mZnNldFplcm8oZGF0YSkgewogICAgdmFyIGogPSAtMSwgbSA9IGRhdGFbMF0ubGVuZ3RoLCB5MCA9IFtdOwogICAgd2hpbGUgKCsraiA8IG0pIHkwW2pdID0gMDsKICAgIHJldHVybiB5MDsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3N0YWNrTWF4SW5kZXgoYXJyYXkpIHsKICAgIHZhciBpID0gMSwgaiA9IDAsIHYgPSBhcnJheVswXVsxXSwgaywgbiA9IGFycmF5Lmxlbmd0aDsKICAgIGZvciAoO2kgPCBuOyArK2kpIHsKICAgICAgaWYgKChrID0gYXJyYXlbaV1bMV0pID4gdikgewogICAgICAgIGogPSBpOwogICAgICAgIHYgPSBrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gajsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3N0YWNrUmVkdWNlU3VtKGQpIHsKICAgIHJldHVybiBkLnJlZHVjZShkM19sYXlvdXRfc3RhY2tTdW0sIDApOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfc3RhY2tTdW0ocCwgZCkgewogICAgcmV0dXJuIHAgKyBkWzFdOwogIH0KICBkMy5sYXlvdXQuaGlzdG9ncmFtID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgZnJlcXVlbmN5ID0gdHJ1ZSwgdmFsdWVyID0gTnVtYmVyLCByYW5nZXIgPSBkM19sYXlvdXRfaGlzdG9ncmFtUmFuZ2UsIGJpbm5lciA9IGQzX2xheW91dF9oaXN0b2dyYW1CaW5TdHVyZ2VzOwogICAgZnVuY3Rpb24gaGlzdG9ncmFtKGRhdGEsIGkpIHsKICAgICAgdmFyIGJpbnMgPSBbXSwgdmFsdWVzID0gZGF0YS5tYXAodmFsdWVyLCB0aGlzKSwgcmFuZ2UgPSByYW5nZXIuY2FsbCh0aGlzLCB2YWx1ZXMsIGkpLCB0aHJlc2hvbGRzID0gYmlubmVyLmNhbGwodGhpcywgcmFuZ2UsIHZhbHVlcywgaSksIGJpbiwgaSA9IC0xLCBuID0gdmFsdWVzLmxlbmd0aCwgbSA9IHRocmVzaG9sZHMubGVuZ3RoIC0gMSwgayA9IGZyZXF1ZW5jeSA/IDEgOiAxIC8gbiwgeDsKICAgICAgd2hpbGUgKCsraSA8IG0pIHsKICAgICAgICBiaW4gPSBiaW5zW2ldID0gW107CiAgICAgICAgYmluLmR4ID0gdGhyZXNob2xkc1tpICsgMV0gLSAoYmluLnggPSB0aHJlc2hvbGRzW2ldKTsKICAgICAgICBiaW4ueSA9IDA7CiAgICAgIH0KICAgICAgaWYgKG0gPiAwKSB7CiAgICAgICAgaSA9IC0xOwogICAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgICB4ID0gdmFsdWVzW2ldOwogICAgICAgICAgaWYgKHggPj0gcmFuZ2VbMF0gJiYgeCA8PSByYW5nZVsxXSkgewogICAgICAgICAgICBiaW4gPSBiaW5zW2QzLmJpc2VjdCh0aHJlc2hvbGRzLCB4LCAxLCBtKSAtIDFdOwogICAgICAgICAgICBiaW4ueSArPSBrOwogICAgICAgICAgICBiaW4ucHVzaChkYXRhW2ldKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGJpbnM7CiAgICB9CiAgICBoaXN0b2dyYW0udmFsdWUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHZhbHVlcjsKICAgICAgdmFsdWVyID0geDsKICAgICAgcmV0dXJuIGhpc3RvZ3JhbTsKICAgIH07CiAgICBoaXN0b2dyYW0ucmFuZ2UgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHJhbmdlcjsKICAgICAgcmFuZ2VyID0gZDNfZnVuY3Rvcih4KTsKICAgICAgcmV0dXJuIGhpc3RvZ3JhbTsKICAgIH07CiAgICBoaXN0b2dyYW0uYmlucyA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gYmlubmVyOwogICAgICBiaW5uZXIgPSB0eXBlb2YgeCA9PT0gIm51bWJlciIgPyBmdW5jdGlvbihyYW5nZSkgewogICAgICAgIHJldHVybiBkM19sYXlvdXRfaGlzdG9ncmFtQmluRml4ZWQocmFuZ2UsIHgpOwogICAgICB9IDogZDNfZnVuY3Rvcih4KTsKICAgICAgcmV0dXJuIGhpc3RvZ3JhbTsKICAgIH07CiAgICBoaXN0b2dyYW0uZnJlcXVlbmN5ID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBmcmVxdWVuY3k7CiAgICAgIGZyZXF1ZW5jeSA9ICEheDsKICAgICAgcmV0dXJuIGhpc3RvZ3JhbTsKICAgIH07CiAgICByZXR1cm4gaGlzdG9ncmFtOwogIH07CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2hpc3RvZ3JhbUJpblN0dXJnZXMocmFuZ2UsIHZhbHVlcykgewogICAgcmV0dXJuIGQzX2xheW91dF9oaXN0b2dyYW1CaW5GaXhlZChyYW5nZSwgTWF0aC5jZWlsKE1hdGgubG9nKHZhbHVlcy5sZW5ndGgpIC8gTWF0aC5MTjIgKyAxKSk7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9oaXN0b2dyYW1CaW5GaXhlZChyYW5nZSwgbikgewogICAgdmFyIHggPSAtMSwgYiA9ICtyYW5nZVswXSwgbSA9IChyYW5nZVsxXSAtIGIpIC8gbiwgZiA9IFtdOwogICAgd2hpbGUgKCsreCA8PSBuKSBmW3hdID0gbSAqIHggKyBiOwogICAgcmV0dXJuIGY7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9oaXN0b2dyYW1SYW5nZSh2YWx1ZXMpIHsKICAgIHJldHVybiBbIGQzLm1pbih2YWx1ZXMpLCBkMy5tYXgodmFsdWVzKSBdOwogIH0KICBkMy5sYXlvdXQucGFjayA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGhpZXJhcmNoeSA9IGQzLmxheW91dC5oaWVyYXJjaHkoKS5zb3J0KGQzX2xheW91dF9wYWNrU29ydCksIHBhZGRpbmcgPSAwLCBzaXplID0gWyAxLCAxIF0sIHJhZGl1czsKICAgIGZ1bmN0aW9uIHBhY2soZCwgaSkgewogICAgICB2YXIgbm9kZXMgPSBoaWVyYXJjaHkuY2FsbCh0aGlzLCBkLCBpKSwgcm9vdCA9IG5vZGVzWzBdLCB3ID0gc2l6ZVswXSwgaCA9IHNpemVbMV0sIHIgPSByYWRpdXMgPT0gbnVsbCA/IE1hdGguc3FydCA6IHR5cGVvZiByYWRpdXMgPT09ICJmdW5jdGlvbiIgPyByYWRpdXMgOiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gcmFkaXVzOwogICAgICB9OwogICAgICByb290LnggPSByb290LnkgPSAwOwogICAgICBkM19sYXlvdXRfaGllcmFyY2h5VmlzaXRBZnRlcihyb290LCBmdW5jdGlvbihkKSB7CiAgICAgICAgZC5yID0gK3IoZC52YWx1ZSk7CiAgICAgIH0pOwogICAgICBkM19sYXlvdXRfaGllcmFyY2h5VmlzaXRBZnRlcihyb290LCBkM19sYXlvdXRfcGFja1NpYmxpbmdzKTsKICAgICAgaWYgKHBhZGRpbmcpIHsKICAgICAgICB2YXIgZHIgPSBwYWRkaW5nICogKHJhZGl1cyA/IDEgOiBNYXRoLm1heCgyICogcm9vdC5yIC8gdywgMiAqIHJvb3QuciAvIGgpKSAvIDI7CiAgICAgICAgZDNfbGF5b3V0X2hpZXJhcmNoeVZpc2l0QWZ0ZXIocm9vdCwgZnVuY3Rpb24oZCkgewogICAgICAgICAgZC5yICs9IGRyOwogICAgICAgIH0pOwogICAgICAgIGQzX2xheW91dF9oaWVyYXJjaHlWaXNpdEFmdGVyKHJvb3QsIGQzX2xheW91dF9wYWNrU2libGluZ3MpOwogICAgICAgIGQzX2xheW91dF9oaWVyYXJjaHlWaXNpdEFmdGVyKHJvb3QsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgIGQuciAtPSBkcjsKICAgICAgICB9KTsKICAgICAgfQogICAgICBkM19sYXlvdXRfcGFja1RyYW5zZm9ybShyb290LCB3IC8gMiwgaCAvIDIsIHJhZGl1cyA/IDEgOiAxIC8gTWF0aC5tYXgoMiAqIHJvb3QuciAvIHcsIDIgKiByb290LnIgLyBoKSk7CiAgICAgIHJldHVybiBub2RlczsKICAgIH0KICAgIHBhY2suc2l6ZSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2l6ZTsKICAgICAgc2l6ZSA9IF87CiAgICAgIHJldHVybiBwYWNrOwogICAgfTsKICAgIHBhY2sucmFkaXVzID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiByYWRpdXM7CiAgICAgIHJhZGl1cyA9IF8gPT0gbnVsbCB8fCB0eXBlb2YgXyA9PT0gImZ1bmN0aW9uIiA/IF8gOiArXzsKICAgICAgcmV0dXJuIHBhY2s7CiAgICB9OwogICAgcGFjay5wYWRkaW5nID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBwYWRkaW5nOwogICAgICBwYWRkaW5nID0gK187CiAgICAgIHJldHVybiBwYWNrOwogICAgfTsKICAgIHJldHVybiBkM19sYXlvdXRfaGllcmFyY2h5UmViaW5kKHBhY2ssIGhpZXJhcmNoeSk7CiAgfTsKICBmdW5jdGlvbiBkM19sYXlvdXRfcGFja1NvcnQoYSwgYikgewogICAgcmV0dXJuIGEudmFsdWUgLSBiLnZhbHVlOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfcGFja0luc2VydChhLCBiKSB7CiAgICB2YXIgYyA9IGEuX3BhY2tfbmV4dDsKICAgIGEuX3BhY2tfbmV4dCA9IGI7CiAgICBiLl9wYWNrX3ByZXYgPSBhOwogICAgYi5fcGFja19uZXh0ID0gYzsKICAgIGMuX3BhY2tfcHJldiA9IGI7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9wYWNrU3BsaWNlKGEsIGIpIHsKICAgIGEuX3BhY2tfbmV4dCA9IGI7CiAgICBiLl9wYWNrX3ByZXYgPSBhOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfcGFja0ludGVyc2VjdHMoYSwgYikgewogICAgdmFyIGR4ID0gYi54IC0gYS54LCBkeSA9IGIueSAtIGEueSwgZHIgPSBhLnIgKyBiLnI7CiAgICByZXR1cm4gLjk5OSAqIGRyICogZHIgPiBkeCAqIGR4ICsgZHkgKiBkeTsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3BhY2tTaWJsaW5ncyhub2RlKSB7CiAgICBpZiAoIShub2RlcyA9IG5vZGUuY2hpbGRyZW4pIHx8ICEobiA9IG5vZGVzLmxlbmd0aCkpIHJldHVybjsKICAgIHZhciBub2RlcywgeE1pbiA9IEluZmluaXR5LCB4TWF4ID0gLUluZmluaXR5LCB5TWluID0gSW5maW5pdHksIHlNYXggPSAtSW5maW5pdHksIGEsIGIsIGMsIGksIGosIGssIG47CiAgICBmdW5jdGlvbiBib3VuZChub2RlKSB7CiAgICAgIHhNaW4gPSBNYXRoLm1pbihub2RlLnggLSBub2RlLnIsIHhNaW4pOwogICAgICB4TWF4ID0gTWF0aC5tYXgobm9kZS54ICsgbm9kZS5yLCB4TWF4KTsKICAgICAgeU1pbiA9IE1hdGgubWluKG5vZGUueSAtIG5vZGUuciwgeU1pbik7CiAgICAgIHlNYXggPSBNYXRoLm1heChub2RlLnkgKyBub2RlLnIsIHlNYXgpOwogICAgfQogICAgbm9kZXMuZm9yRWFjaChkM19sYXlvdXRfcGFja0xpbmspOwogICAgYSA9IG5vZGVzWzBdOwogICAgYS54ID0gLWEucjsKICAgIGEueSA9IDA7CiAgICBib3VuZChhKTsKICAgIGlmIChuID4gMSkgewogICAgICBiID0gbm9kZXNbMV07CiAgICAgIGIueCA9IGIucjsKICAgICAgYi55ID0gMDsKICAgICAgYm91bmQoYik7CiAgICAgIGlmIChuID4gMikgewogICAgICAgIGMgPSBub2Rlc1syXTsKICAgICAgICBkM19sYXlvdXRfcGFja1BsYWNlKGEsIGIsIGMpOwogICAgICAgIGJvdW5kKGMpOwogICAgICAgIGQzX2xheW91dF9wYWNrSW5zZXJ0KGEsIGMpOwogICAgICAgIGEuX3BhY2tfcHJldiA9IGM7CiAgICAgICAgZDNfbGF5b3V0X3BhY2tJbnNlcnQoYywgYik7CiAgICAgICAgYiA9IGEuX3BhY2tfbmV4dDsKICAgICAgICBmb3IgKGkgPSAzOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBkM19sYXlvdXRfcGFja1BsYWNlKGEsIGIsIGMgPSBub2Rlc1tpXSk7CiAgICAgICAgICB2YXIgaXNlY3QgPSAwLCBzMSA9IDEsIHMyID0gMTsKICAgICAgICAgIGZvciAoaiA9IGIuX3BhY2tfbmV4dDsgaiAhPT0gYjsgaiA9IGouX3BhY2tfbmV4dCwgczErKykgewogICAgICAgICAgICBpZiAoZDNfbGF5b3V0X3BhY2tJbnRlcnNlY3RzKGosIGMpKSB7CiAgICAgICAgICAgICAgaXNlY3QgPSAxOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaXNlY3QgPT0gMSkgewogICAgICAgICAgICBmb3IgKGsgPSBhLl9wYWNrX3ByZXY7IGsgIT09IGouX3BhY2tfcHJldjsgayA9IGsuX3BhY2tfcHJldiwgczIrKykgewogICAgICAgICAgICAgIGlmIChkM19sYXlvdXRfcGFja0ludGVyc2VjdHMoaywgYykpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGlzZWN0KSB7CiAgICAgICAgICAgIGlmIChzMSA8IHMyIHx8IHMxID09IHMyICYmIGIuciA8IGEucikgZDNfbGF5b3V0X3BhY2tTcGxpY2UoYSwgYiA9IGopOyBlbHNlIGQzX2xheW91dF9wYWNrU3BsaWNlKGEgPSBrLCBiKTsKICAgICAgICAgICAgaS0tOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZDNfbGF5b3V0X3BhY2tJbnNlcnQoYSwgYyk7CiAgICAgICAgICAgIGIgPSBjOwogICAgICAgICAgICBib3VuZChjKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHZhciBjeCA9ICh4TWluICsgeE1heCkgLyAyLCBjeSA9ICh5TWluICsgeU1heCkgLyAyLCBjciA9IDA7CiAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgIGMgPSBub2Rlc1tpXTsKICAgICAgYy54IC09IGN4OwogICAgICBjLnkgLT0gY3k7CiAgICAgIGNyID0gTWF0aC5tYXgoY3IsIGMuciArIE1hdGguc3FydChjLnggKiBjLnggKyBjLnkgKiBjLnkpKTsKICAgIH0KICAgIG5vZGUuciA9IGNyOwogICAgbm9kZXMuZm9yRWFjaChkM19sYXlvdXRfcGFja1VubGluayk7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9wYWNrTGluayhub2RlKSB7CiAgICBub2RlLl9wYWNrX25leHQgPSBub2RlLl9wYWNrX3ByZXYgPSBub2RlOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfcGFja1VubGluayhub2RlKSB7CiAgICBkZWxldGUgbm9kZS5fcGFja19uZXh0OwogICAgZGVsZXRlIG5vZGUuX3BhY2tfcHJldjsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3BhY2tUcmFuc2Zvcm0obm9kZSwgeCwgeSwgaykgewogICAgdmFyIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjsKICAgIG5vZGUueCA9IHggKz0gayAqIG5vZGUueDsKICAgIG5vZGUueSA9IHkgKz0gayAqIG5vZGUueTsKICAgIG5vZGUuciAqPSBrOwogICAgaWYgKGNoaWxkcmVuKSB7CiAgICAgIHZhciBpID0gLTEsIG4gPSBjaGlsZHJlbi5sZW5ndGg7CiAgICAgIHdoaWxlICgrK2kgPCBuKSBkM19sYXlvdXRfcGFja1RyYW5zZm9ybShjaGlsZHJlbltpXSwgeCwgeSwgayk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9wYWNrUGxhY2UoYSwgYiwgYykgewogICAgdmFyIGRiID0gYS5yICsgYy5yLCBkeCA9IGIueCAtIGEueCwgZHkgPSBiLnkgLSBhLnk7CiAgICBpZiAoZGIgJiYgKGR4IHx8IGR5KSkgewogICAgICB2YXIgZGEgPSBiLnIgKyBjLnIsIGRjID0gZHggKiBkeCArIGR5ICogZHk7CiAgICAgIGRhICo9IGRhOwogICAgICBkYiAqPSBkYjsKICAgICAgdmFyIHggPSAuNSArIChkYiAtIGRhKSAvICgyICogZGMpLCB5ID0gTWF0aC5zcXJ0KE1hdGgubWF4KDAsIDIgKiBkYSAqIChkYiArIGRjKSAtIChkYiAtPSBkYykgKiBkYiAtIGRhICogZGEpKSAvICgyICogZGMpOwogICAgICBjLnggPSBhLnggKyB4ICogZHggKyB5ICogZHk7CiAgICAgIGMueSA9IGEueSArIHggKiBkeSAtIHkgKiBkeDsKICAgIH0gZWxzZSB7CiAgICAgIGMueCA9IGEueCArIGRiOwogICAgICBjLnkgPSBhLnk7CiAgICB9CiAgfQogIGQzLmxheW91dC50cmVlID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgaGllcmFyY2h5ID0gZDMubGF5b3V0LmhpZXJhcmNoeSgpLnNvcnQobnVsbCkudmFsdWUobnVsbCksIHNlcGFyYXRpb24gPSBkM19sYXlvdXRfdHJlZVNlcGFyYXRpb24sIHNpemUgPSBbIDEsIDEgXSwgbm9kZVNpemUgPSBudWxsOwogICAgZnVuY3Rpb24gdHJlZShkLCBpKSB7CiAgICAgIHZhciBub2RlcyA9IGhpZXJhcmNoeS5jYWxsKHRoaXMsIGQsIGkpLCByb290MCA9IG5vZGVzWzBdLCByb290MSA9IHdyYXBUcmVlKHJvb3QwKTsKICAgICAgZDNfbGF5b3V0X2hpZXJhcmNoeVZpc2l0QWZ0ZXIocm9vdDEsIGZpcnN0V2FsayksIHJvb3QxLnBhcmVudC5tID0gLXJvb3QxLno7CiAgICAgIGQzX2xheW91dF9oaWVyYXJjaHlWaXNpdEJlZm9yZShyb290MSwgc2Vjb25kV2Fsayk7CiAgICAgIGlmIChub2RlU2l6ZSkgZDNfbGF5b3V0X2hpZXJhcmNoeVZpc2l0QmVmb3JlKHJvb3QwLCBzaXplTm9kZSk7IGVsc2UgewogICAgICAgIHZhciBsZWZ0ID0gcm9vdDAsIHJpZ2h0ID0gcm9vdDAsIGJvdHRvbSA9IHJvb3QwOwogICAgICAgIGQzX2xheW91dF9oaWVyYXJjaHlWaXNpdEJlZm9yZShyb290MCwgZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgaWYgKG5vZGUueCA8IGxlZnQueCkgbGVmdCA9IG5vZGU7CiAgICAgICAgICBpZiAobm9kZS54ID4gcmlnaHQueCkgcmlnaHQgPSBub2RlOwogICAgICAgICAgaWYgKG5vZGUuZGVwdGggPiBib3R0b20uZGVwdGgpIGJvdHRvbSA9IG5vZGU7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHR4ID0gc2VwYXJhdGlvbihsZWZ0LCByaWdodCkgLyAyIC0gbGVmdC54LCBreCA9IHNpemVbMF0gLyAocmlnaHQueCArIHNlcGFyYXRpb24ocmlnaHQsIGxlZnQpIC8gMiArIHR4KSwga3kgPSBzaXplWzFdIC8gKGJvdHRvbS5kZXB0aCB8fCAxKTsKICAgICAgICBkM19sYXlvdXRfaGllcmFyY2h5VmlzaXRCZWZvcmUocm9vdDAsIGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICAgIG5vZGUueCA9IChub2RlLnggKyB0eCkgKiBreDsKICAgICAgICAgIG5vZGUueSA9IG5vZGUuZGVwdGggKiBreTsKICAgICAgICB9KTsKICAgICAgfQogICAgICByZXR1cm4gbm9kZXM7CiAgICB9CiAgICBmdW5jdGlvbiB3cmFwVHJlZShyb290MCkgewogICAgICB2YXIgcm9vdDEgPSB7CiAgICAgICAgQTogbnVsbCwKICAgICAgICBjaGlsZHJlbjogWyByb290MCBdCiAgICAgIH0sIHF1ZXVlID0gWyByb290MSBdLCBub2RlMTsKICAgICAgd2hpbGUgKChub2RlMSA9IHF1ZXVlLnBvcCgpKSAhPSBudWxsKSB7CiAgICAgICAgZm9yICh2YXIgY2hpbGRyZW4gPSBub2RlMS5jaGlsZHJlbiwgY2hpbGQsIGkgPSAwLCBuID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbjsgKytpKSB7CiAgICAgICAgICBxdWV1ZS5wdXNoKChjaGlsZHJlbltpXSA9IGNoaWxkID0gewogICAgICAgICAgICBfOiBjaGlsZHJlbltpXSwKICAgICAgICAgICAgcGFyZW50OiBub2RlMSwKICAgICAgICAgICAgY2hpbGRyZW46IChjaGlsZCA9IGNoaWxkcmVuW2ldLmNoaWxkcmVuKSAmJiBjaGlsZC5zbGljZSgpIHx8IFtdLAogICAgICAgICAgICBBOiBudWxsLAogICAgICAgICAgICBhOiBudWxsLAogICAgICAgICAgICB6OiAwLAogICAgICAgICAgICBtOiAwLAogICAgICAgICAgICBjOiAwLAogICAgICAgICAgICBzOiAwLAogICAgICAgICAgICB0OiBudWxsLAogICAgICAgICAgICBpOiBpCiAgICAgICAgICB9KS5hID0gY2hpbGQpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcm9vdDEuY2hpbGRyZW5bMF07CiAgICB9CiAgICBmdW5jdGlvbiBmaXJzdFdhbGsodikgewogICAgICB2YXIgY2hpbGRyZW4gPSB2LmNoaWxkcmVuLCBzaWJsaW5ncyA9IHYucGFyZW50LmNoaWxkcmVuLCB3ID0gdi5pID8gc2libGluZ3Nbdi5pIC0gMV0gOiBudWxsOwogICAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgZDNfbGF5b3V0X3RyZWVTaGlmdCh2KTsKICAgICAgICB2YXIgbWlkcG9pbnQgPSAoY2hpbGRyZW5bMF0ueiArIGNoaWxkcmVuW2NoaWxkcmVuLmxlbmd0aCAtIDFdLnopIC8gMjsKICAgICAgICBpZiAodykgewogICAgICAgICAgdi56ID0gdy56ICsgc2VwYXJhdGlvbih2Ll8sIHcuXyk7CiAgICAgICAgICB2Lm0gPSB2LnogLSBtaWRwb2ludDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdi56ID0gbWlkcG9pbnQ7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHcpIHsKICAgICAgICB2LnogPSB3LnogKyBzZXBhcmF0aW9uKHYuXywgdy5fKTsKICAgICAgfQogICAgICB2LnBhcmVudC5BID0gYXBwb3J0aW9uKHYsIHcsIHYucGFyZW50LkEgfHwgc2libGluZ3NbMF0pOwogICAgfQogICAgZnVuY3Rpb24gc2Vjb25kV2Fsayh2KSB7CiAgICAgIHYuXy54ID0gdi56ICsgdi5wYXJlbnQubTsKICAgICAgdi5tICs9IHYucGFyZW50Lm07CiAgICB9CiAgICBmdW5jdGlvbiBhcHBvcnRpb24odiwgdywgYW5jZXN0b3IpIHsKICAgICAgaWYgKHcpIHsKICAgICAgICB2YXIgdmlwID0gdiwgdm9wID0gdiwgdmltID0gdywgdm9tID0gdmlwLnBhcmVudC5jaGlsZHJlblswXSwgc2lwID0gdmlwLm0sIHNvcCA9IHZvcC5tLCBzaW0gPSB2aW0ubSwgc29tID0gdm9tLm0sIHNoaWZ0OwogICAgICAgIHdoaWxlICh2aW0gPSBkM19sYXlvdXRfdHJlZVJpZ2h0KHZpbSksIHZpcCA9IGQzX2xheW91dF90cmVlTGVmdCh2aXApLCB2aW0gJiYgdmlwKSB7CiAgICAgICAgICB2b20gPSBkM19sYXlvdXRfdHJlZUxlZnQodm9tKTsKICAgICAgICAgIHZvcCA9IGQzX2xheW91dF90cmVlUmlnaHQodm9wKTsKICAgICAgICAgIHZvcC5hID0gdjsKICAgICAgICAgIHNoaWZ0ID0gdmltLnogKyBzaW0gLSB2aXAueiAtIHNpcCArIHNlcGFyYXRpb24odmltLl8sIHZpcC5fKTsKICAgICAgICAgIGlmIChzaGlmdCA+IDApIHsKICAgICAgICAgICAgZDNfbGF5b3V0X3RyZWVNb3ZlKGQzX2xheW91dF90cmVlQW5jZXN0b3IodmltLCB2LCBhbmNlc3RvciksIHYsIHNoaWZ0KTsKICAgICAgICAgICAgc2lwICs9IHNoaWZ0OwogICAgICAgICAgICBzb3AgKz0gc2hpZnQ7CiAgICAgICAgICB9CiAgICAgICAgICBzaW0gKz0gdmltLm07CiAgICAgICAgICBzaXAgKz0gdmlwLm07CiAgICAgICAgICBzb20gKz0gdm9tLm07CiAgICAgICAgICBzb3AgKz0gdm9wLm07CiAgICAgICAgfQogICAgICAgIGlmICh2aW0gJiYgIWQzX2xheW91dF90cmVlUmlnaHQodm9wKSkgewogICAgICAgICAgdm9wLnQgPSB2aW07CiAgICAgICAgICB2b3AubSArPSBzaW0gLSBzb3A7CiAgICAgICAgfQogICAgICAgIGlmICh2aXAgJiYgIWQzX2xheW91dF90cmVlTGVmdCh2b20pKSB7CiAgICAgICAgICB2b20udCA9IHZpcDsKICAgICAgICAgIHZvbS5tICs9IHNpcCAtIHNvbTsKICAgICAgICAgIGFuY2VzdG9yID0gdjsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGFuY2VzdG9yOwogICAgfQogICAgZnVuY3Rpb24gc2l6ZU5vZGUobm9kZSkgewogICAgICBub2RlLnggKj0gc2l6ZVswXTsKICAgICAgbm9kZS55ID0gbm9kZS5kZXB0aCAqIHNpemVbMV07CiAgICB9CiAgICB0cmVlLnNlcGFyYXRpb24gPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNlcGFyYXRpb247CiAgICAgIHNlcGFyYXRpb24gPSB4OwogICAgICByZXR1cm4gdHJlZTsKICAgIH07CiAgICB0cmVlLnNpemUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIG5vZGVTaXplID8gbnVsbCA6IHNpemU7CiAgICAgIG5vZGVTaXplID0gKHNpemUgPSB4KSA9PSBudWxsID8gc2l6ZU5vZGUgOiBudWxsOwogICAgICByZXR1cm4gdHJlZTsKICAgIH07CiAgICB0cmVlLm5vZGVTaXplID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBub2RlU2l6ZSA/IHNpemUgOiBudWxsOwogICAgICBub2RlU2l6ZSA9IChzaXplID0geCkgPT0gbnVsbCA/IG51bGwgOiBzaXplTm9kZTsKICAgICAgcmV0dXJuIHRyZWU7CiAgICB9OwogICAgcmV0dXJuIGQzX2xheW91dF9oaWVyYXJjaHlSZWJpbmQodHJlZSwgaGllcmFyY2h5KTsKICB9OwogIGZ1bmN0aW9uIGQzX2xheW91dF90cmVlU2VwYXJhdGlvbihhLCBiKSB7CiAgICByZXR1cm4gYS5wYXJlbnQgPT0gYi5wYXJlbnQgPyAxIDogMjsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3RyZWVMZWZ0KHYpIHsKICAgIHZhciBjaGlsZHJlbiA9IHYuY2hpbGRyZW47CiAgICByZXR1cm4gY2hpbGRyZW4ubGVuZ3RoID8gY2hpbGRyZW5bMF0gOiB2LnQ7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF90cmVlUmlnaHQodikgewogICAgdmFyIGNoaWxkcmVuID0gdi5jaGlsZHJlbiwgbjsKICAgIHJldHVybiAobiA9IGNoaWxkcmVuLmxlbmd0aCkgPyBjaGlsZHJlbltuIC0gMV0gOiB2LnQ7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF90cmVlTW92ZSh3bSwgd3AsIHNoaWZ0KSB7CiAgICB2YXIgY2hhbmdlID0gc2hpZnQgLyAod3AuaSAtIHdtLmkpOwogICAgd3AuYyAtPSBjaGFuZ2U7CiAgICB3cC5zICs9IHNoaWZ0OwogICAgd20uYyArPSBjaGFuZ2U7CiAgICB3cC56ICs9IHNoaWZ0OwogICAgd3AubSArPSBzaGlmdDsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3RyZWVTaGlmdCh2KSB7CiAgICB2YXIgc2hpZnQgPSAwLCBjaGFuZ2UgPSAwLCBjaGlsZHJlbiA9IHYuY2hpbGRyZW4sIGkgPSBjaGlsZHJlbi5sZW5ndGgsIHc7CiAgICB3aGlsZSAoLS1pID49IDApIHsKICAgICAgdyA9IGNoaWxkcmVuW2ldOwogICAgICB3LnogKz0gc2hpZnQ7CiAgICAgIHcubSArPSBzaGlmdDsKICAgICAgc2hpZnQgKz0gdy5zICsgKGNoYW5nZSArPSB3LmMpOwogICAgfQogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfdHJlZUFuY2VzdG9yKHZpbSwgdiwgYW5jZXN0b3IpIHsKICAgIHJldHVybiB2aW0uYS5wYXJlbnQgPT09IHYucGFyZW50ID8gdmltLmEgOiBhbmNlc3RvcjsKICB9CiAgZDMubGF5b3V0LmNsdXN0ZXIgPSBmdW5jdGlvbigpIHsKICAgIHZhciBoaWVyYXJjaHkgPSBkMy5sYXlvdXQuaGllcmFyY2h5KCkuc29ydChudWxsKS52YWx1ZShudWxsKSwgc2VwYXJhdGlvbiA9IGQzX2xheW91dF90cmVlU2VwYXJhdGlvbiwgc2l6ZSA9IFsgMSwgMSBdLCBub2RlU2l6ZSA9IGZhbHNlOwogICAgZnVuY3Rpb24gY2x1c3RlcihkLCBpKSB7CiAgICAgIHZhciBub2RlcyA9IGhpZXJhcmNoeS5jYWxsKHRoaXMsIGQsIGkpLCByb290ID0gbm9kZXNbMF0sIHByZXZpb3VzTm9kZSwgeCA9IDA7CiAgICAgIGQzX2xheW91dF9oaWVyYXJjaHlWaXNpdEFmdGVyKHJvb3QsIGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICB2YXIgY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuOwogICAgICAgIGlmIChjaGlsZHJlbiAmJiBjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgIG5vZGUueCA9IGQzX2xheW91dF9jbHVzdGVyWChjaGlsZHJlbik7CiAgICAgICAgICBub2RlLnkgPSBkM19sYXlvdXRfY2x1c3RlclkoY2hpbGRyZW4pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBub2RlLnggPSBwcmV2aW91c05vZGUgPyB4ICs9IHNlcGFyYXRpb24obm9kZSwgcHJldmlvdXNOb2RlKSA6IDA7CiAgICAgICAgICBub2RlLnkgPSAwOwogICAgICAgICAgcHJldmlvdXNOb2RlID0gbm9kZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB2YXIgbGVmdCA9IGQzX2xheW91dF9jbHVzdGVyTGVmdChyb290KSwgcmlnaHQgPSBkM19sYXlvdXRfY2x1c3RlclJpZ2h0KHJvb3QpLCB4MCA9IGxlZnQueCAtIHNlcGFyYXRpb24obGVmdCwgcmlnaHQpIC8gMiwgeDEgPSByaWdodC54ICsgc2VwYXJhdGlvbihyaWdodCwgbGVmdCkgLyAyOwogICAgICBkM19sYXlvdXRfaGllcmFyY2h5VmlzaXRBZnRlcihyb290LCBub2RlU2l6ZSA/IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICBub2RlLnggPSAobm9kZS54IC0gcm9vdC54KSAqIHNpemVbMF07CiAgICAgICAgbm9kZS55ID0gKHJvb3QueSAtIG5vZGUueSkgKiBzaXplWzFdOwogICAgICB9IDogZnVuY3Rpb24obm9kZSkgewogICAgICAgIG5vZGUueCA9IChub2RlLnggLSB4MCkgLyAoeDEgLSB4MCkgKiBzaXplWzBdOwogICAgICAgIG5vZGUueSA9ICgxIC0gKHJvb3QueSA/IG5vZGUueSAvIHJvb3QueSA6IDEpKSAqIHNpemVbMV07CiAgICAgIH0pOwogICAgICByZXR1cm4gbm9kZXM7CiAgICB9CiAgICBjbHVzdGVyLnNlcGFyYXRpb24gPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNlcGFyYXRpb247CiAgICAgIHNlcGFyYXRpb24gPSB4OwogICAgICByZXR1cm4gY2x1c3RlcjsKICAgIH07CiAgICBjbHVzdGVyLnNpemUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIG5vZGVTaXplID8gbnVsbCA6IHNpemU7CiAgICAgIG5vZGVTaXplID0gKHNpemUgPSB4KSA9PSBudWxsOwogICAgICByZXR1cm4gY2x1c3RlcjsKICAgIH07CiAgICBjbHVzdGVyLm5vZGVTaXplID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBub2RlU2l6ZSA/IHNpemUgOiBudWxsOwogICAgICBub2RlU2l6ZSA9IChzaXplID0geCkgIT0gbnVsbDsKICAgICAgcmV0dXJuIGNsdXN0ZXI7CiAgICB9OwogICAgcmV0dXJuIGQzX2xheW91dF9oaWVyYXJjaHlSZWJpbmQoY2x1c3RlciwgaGllcmFyY2h5KTsKICB9OwogIGZ1bmN0aW9uIGQzX2xheW91dF9jbHVzdGVyWShjaGlsZHJlbikgewogICAgcmV0dXJuIDEgKyBkMy5tYXgoY2hpbGRyZW4sIGZ1bmN0aW9uKGNoaWxkKSB7CiAgICAgIHJldHVybiBjaGlsZC55OwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9jbHVzdGVyWChjaGlsZHJlbikgewogICAgcmV0dXJuIGNoaWxkcmVuLnJlZHVjZShmdW5jdGlvbih4LCBjaGlsZCkgewogICAgICByZXR1cm4geCArIGNoaWxkLng7CiAgICB9LCAwKSAvIGNoaWxkcmVuLmxlbmd0aDsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2NsdXN0ZXJMZWZ0KG5vZGUpIHsKICAgIHZhciBjaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW47CiAgICByZXR1cm4gY2hpbGRyZW4gJiYgY2hpbGRyZW4ubGVuZ3RoID8gZDNfbGF5b3V0X2NsdXN0ZXJMZWZ0KGNoaWxkcmVuWzBdKSA6IG5vZGU7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9jbHVzdGVyUmlnaHQobm9kZSkgewogICAgdmFyIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbiwgbjsKICAgIHJldHVybiBjaGlsZHJlbiAmJiAobiA9IGNoaWxkcmVuLmxlbmd0aCkgPyBkM19sYXlvdXRfY2x1c3RlclJpZ2h0KGNoaWxkcmVuW24gLSAxXSkgOiBub2RlOwogIH0KICBkMy5sYXlvdXQudHJlZW1hcCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGhpZXJhcmNoeSA9IGQzLmxheW91dC5oaWVyYXJjaHkoKSwgcm91bmQgPSBNYXRoLnJvdW5kLCBzaXplID0gWyAxLCAxIF0sIHBhZGRpbmcgPSBudWxsLCBwYWQgPSBkM19sYXlvdXRfdHJlZW1hcFBhZE51bGwsIHN0aWNreSA9IGZhbHNlLCBzdGlja2llcywgbW9kZSA9ICJzcXVhcmlmeSIsIHJhdGlvID0gLjUgKiAoMSArIE1hdGguc3FydCg1KSk7CiAgICBmdW5jdGlvbiBzY2FsZShjaGlsZHJlbiwgaykgewogICAgICB2YXIgaSA9IC0xLCBuID0gY2hpbGRyZW4ubGVuZ3RoLCBjaGlsZCwgYXJlYTsKICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICBhcmVhID0gKGNoaWxkID0gY2hpbGRyZW5baV0pLnZhbHVlICogKGsgPCAwID8gMCA6IGspOwogICAgICAgIGNoaWxkLmFyZWEgPSBpc05hTihhcmVhKSB8fCBhcmVhIDw9IDAgPyAwIDogYXJlYTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc3F1YXJpZnkobm9kZSkgewogICAgICB2YXIgY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuOwogICAgICBpZiAoY2hpbGRyZW4gJiYgY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgdmFyIHJlY3QgPSBwYWQobm9kZSksIHJvdyA9IFtdLCByZW1haW5pbmcgPSBjaGlsZHJlbi5zbGljZSgpLCBjaGlsZCwgYmVzdCA9IEluZmluaXR5LCBzY29yZSwgdSA9IG1vZGUgPT09ICJzbGljZSIgPyByZWN0LmR4IDogbW9kZSA9PT0gImRpY2UiID8gcmVjdC5keSA6IG1vZGUgPT09ICJzbGljZS1kaWNlIiA/IG5vZGUuZGVwdGggJiAxID8gcmVjdC5keSA6IHJlY3QuZHggOiBNYXRoLm1pbihyZWN0LmR4LCByZWN0LmR5KSwgbjsKICAgICAgICBzY2FsZShyZW1haW5pbmcsIHJlY3QuZHggKiByZWN0LmR5IC8gbm9kZS52YWx1ZSk7CiAgICAgICAgcm93LmFyZWEgPSAwOwogICAgICAgIHdoaWxlICgobiA9IHJlbWFpbmluZy5sZW5ndGgpID4gMCkgewogICAgICAgICAgcm93LnB1c2goY2hpbGQgPSByZW1haW5pbmdbbiAtIDFdKTsKICAgICAgICAgIHJvdy5hcmVhICs9IGNoaWxkLmFyZWE7CiAgICAgICAgICBpZiAobW9kZSAhPT0gInNxdWFyaWZ5IiB8fCAoc2NvcmUgPSB3b3JzdChyb3csIHUpKSA8PSBiZXN0KSB7CiAgICAgICAgICAgIHJlbWFpbmluZy5wb3AoKTsKICAgICAgICAgICAgYmVzdCA9IHNjb3JlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcm93LmFyZWEgLT0gcm93LnBvcCgpLmFyZWE7CiAgICAgICAgICAgIHBvc2l0aW9uKHJvdywgdSwgcmVjdCwgZmFsc2UpOwogICAgICAgICAgICB1ID0gTWF0aC5taW4ocmVjdC5keCwgcmVjdC5keSk7CiAgICAgICAgICAgIHJvdy5sZW5ndGggPSByb3cuYXJlYSA9IDA7CiAgICAgICAgICAgIGJlc3QgPSBJbmZpbml0eTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHJvdy5sZW5ndGgpIHsKICAgICAgICAgIHBvc2l0aW9uKHJvdywgdSwgcmVjdCwgdHJ1ZSk7CiAgICAgICAgICByb3cubGVuZ3RoID0gcm93LmFyZWEgPSAwOwogICAgICAgIH0KICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKHNxdWFyaWZ5KTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc3RpY2tpZnkobm9kZSkgewogICAgICB2YXIgY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuOwogICAgICBpZiAoY2hpbGRyZW4gJiYgY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgdmFyIHJlY3QgPSBwYWQobm9kZSksIHJlbWFpbmluZyA9IGNoaWxkcmVuLnNsaWNlKCksIGNoaWxkLCByb3cgPSBbXTsKICAgICAgICBzY2FsZShyZW1haW5pbmcsIHJlY3QuZHggKiByZWN0LmR5IC8gbm9kZS52YWx1ZSk7CiAgICAgICAgcm93LmFyZWEgPSAwOwogICAgICAgIHdoaWxlIChjaGlsZCA9IHJlbWFpbmluZy5wb3AoKSkgewogICAgICAgICAgcm93LnB1c2goY2hpbGQpOwogICAgICAgICAgcm93LmFyZWEgKz0gY2hpbGQuYXJlYTsKICAgICAgICAgIGlmIChjaGlsZC56ICE9IG51bGwpIHsKICAgICAgICAgICAgcG9zaXRpb24ocm93LCBjaGlsZC56ID8gcmVjdC5keCA6IHJlY3QuZHksIHJlY3QsICFyZW1haW5pbmcubGVuZ3RoKTsKICAgICAgICAgICAgcm93Lmxlbmd0aCA9IHJvdy5hcmVhID0gMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChzdGlja2lmeSk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHdvcnN0KHJvdywgdSkgewogICAgICB2YXIgcyA9IHJvdy5hcmVhLCByLCBybWF4ID0gMCwgcm1pbiA9IEluZmluaXR5LCBpID0gLTEsIG4gPSByb3cubGVuZ3RoOwogICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgIGlmICghKHIgPSByb3dbaV0uYXJlYSkpIGNvbnRpbnVlOwogICAgICAgIGlmIChyIDwgcm1pbikgcm1pbiA9IHI7CiAgICAgICAgaWYgKHIgPiBybWF4KSBybWF4ID0gcjsKICAgICAgfQogICAgICBzICo9IHM7CiAgICAgIHUgKj0gdTsKICAgICAgcmV0dXJuIHMgPyBNYXRoLm1heCh1ICogcm1heCAqIHJhdGlvIC8gcywgcyAvICh1ICogcm1pbiAqIHJhdGlvKSkgOiBJbmZpbml0eTsKICAgIH0KICAgIGZ1bmN0aW9uIHBvc2l0aW9uKHJvdywgdSwgcmVjdCwgZmx1c2gpIHsKICAgICAgdmFyIGkgPSAtMSwgbiA9IHJvdy5sZW5ndGgsIHggPSByZWN0LngsIHkgPSByZWN0LnksIHYgPSB1ID8gcm91bmQocm93LmFyZWEgLyB1KSA6IDAsIG87CiAgICAgIGlmICh1ID09IHJlY3QuZHgpIHsKICAgICAgICBpZiAoZmx1c2ggfHwgdiA+IHJlY3QuZHkpIHYgPSByZWN0LmR5OwogICAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgICBvID0gcm93W2ldOwogICAgICAgICAgby54ID0geDsKICAgICAgICAgIG8ueSA9IHk7CiAgICAgICAgICBvLmR5ID0gdjsKICAgICAgICAgIHggKz0gby5keCA9IE1hdGgubWluKHJlY3QueCArIHJlY3QuZHggLSB4LCB2ID8gcm91bmQoby5hcmVhIC8gdikgOiAwKTsKICAgICAgICB9CiAgICAgICAgby56ID0gdHJ1ZTsKICAgICAgICBvLmR4ICs9IHJlY3QueCArIHJlY3QuZHggLSB4OwogICAgICAgIHJlY3QueSArPSB2OwogICAgICAgIHJlY3QuZHkgLT0gdjsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZmx1c2ggfHwgdiA+IHJlY3QuZHgpIHYgPSByZWN0LmR4OwogICAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgICBvID0gcm93W2ldOwogICAgICAgICAgby54ID0geDsKICAgICAgICAgIG8ueSA9IHk7CiAgICAgICAgICBvLmR4ID0gdjsKICAgICAgICAgIHkgKz0gby5keSA9IE1hdGgubWluKHJlY3QueSArIHJlY3QuZHkgLSB5LCB2ID8gcm91bmQoby5hcmVhIC8gdikgOiAwKTsKICAgICAgICB9CiAgICAgICAgby56ID0gZmFsc2U7CiAgICAgICAgby5keSArPSByZWN0LnkgKyByZWN0LmR5IC0geTsKICAgICAgICByZWN0LnggKz0gdjsKICAgICAgICByZWN0LmR4IC09IHY7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHRyZWVtYXAoZCkgewogICAgICB2YXIgbm9kZXMgPSBzdGlja2llcyB8fCBoaWVyYXJjaHkoZCksIHJvb3QgPSBub2Rlc1swXTsKICAgICAgcm9vdC54ID0gMDsKICAgICAgcm9vdC55ID0gMDsKICAgICAgcm9vdC5keCA9IHNpemVbMF07CiAgICAgIHJvb3QuZHkgPSBzaXplWzFdOwogICAgICBpZiAoc3RpY2tpZXMpIGhpZXJhcmNoeS5yZXZhbHVlKHJvb3QpOwogICAgICBzY2FsZShbIHJvb3QgXSwgcm9vdC5keCAqIHJvb3QuZHkgLyByb290LnZhbHVlKTsKICAgICAgKHN0aWNraWVzID8gc3RpY2tpZnkgOiBzcXVhcmlmeSkocm9vdCk7CiAgICAgIGlmIChzdGlja3kpIHN0aWNraWVzID0gbm9kZXM7CiAgICAgIHJldHVybiBub2RlczsKICAgIH0KICAgIHRyZWVtYXAuc2l6ZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2l6ZTsKICAgICAgc2l6ZSA9IHg7CiAgICAgIHJldHVybiB0cmVlbWFwOwogICAgfTsKICAgIHRyZWVtYXAucGFkZGluZyA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gcGFkZGluZzsKICAgICAgZnVuY3Rpb24gcGFkRnVuY3Rpb24obm9kZSkgewogICAgICAgIHZhciBwID0geC5jYWxsKHRyZWVtYXAsIG5vZGUsIG5vZGUuZGVwdGgpOwogICAgICAgIHJldHVybiBwID09IG51bGwgPyBkM19sYXlvdXRfdHJlZW1hcFBhZE51bGwobm9kZSkgOiBkM19sYXlvdXRfdHJlZW1hcFBhZChub2RlLCB0eXBlb2YgcCA9PT0gIm51bWJlciIgPyBbIHAsIHAsIHAsIHAgXSA6IHApOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHBhZENvbnN0YW50KG5vZGUpIHsKICAgICAgICByZXR1cm4gZDNfbGF5b3V0X3RyZWVtYXBQYWQobm9kZSwgeCk7CiAgICAgIH0KICAgICAgdmFyIHR5cGU7CiAgICAgIHBhZCA9IChwYWRkaW5nID0geCkgPT0gbnVsbCA/IGQzX2xheW91dF90cmVlbWFwUGFkTnVsbCA6ICh0eXBlID0gdHlwZW9mIHgpID09PSAiZnVuY3Rpb24iID8gcGFkRnVuY3Rpb24gOiB0eXBlID09PSAibnVtYmVyIiA/ICh4ID0gWyB4LCB4LCB4LCB4IF0sIAogICAgICBwYWRDb25zdGFudCkgOiBwYWRDb25zdGFudDsKICAgICAgcmV0dXJuIHRyZWVtYXA7CiAgICB9OwogICAgdHJlZW1hcC5yb3VuZCA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gcm91bmQgIT0gTnVtYmVyOwogICAgICByb3VuZCA9IHggPyBNYXRoLnJvdW5kIDogTnVtYmVyOwogICAgICByZXR1cm4gdHJlZW1hcDsKICAgIH07CiAgICB0cmVlbWFwLnN0aWNreSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc3RpY2t5OwogICAgICBzdGlja3kgPSB4OwogICAgICBzdGlja2llcyA9IG51bGw7CiAgICAgIHJldHVybiB0cmVlbWFwOwogICAgfTsKICAgIHRyZWVtYXAucmF0aW8gPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHJhdGlvOwogICAgICByYXRpbyA9IHg7CiAgICAgIHJldHVybiB0cmVlbWFwOwogICAgfTsKICAgIHRyZWVtYXAubW9kZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gbW9kZTsKICAgICAgbW9kZSA9IHggKyAiIjsKICAgICAgcmV0dXJuIHRyZWVtYXA7CiAgICB9OwogICAgcmV0dXJuIGQzX2xheW91dF9oaWVyYXJjaHlSZWJpbmQodHJlZW1hcCwgaGllcmFyY2h5KTsKICB9OwogIGZ1bmN0aW9uIGQzX2xheW91dF90cmVlbWFwUGFkTnVsbChub2RlKSB7CiAgICByZXR1cm4gewogICAgICB4OiBub2RlLngsCiAgICAgIHk6IG5vZGUueSwKICAgICAgZHg6IG5vZGUuZHgsCiAgICAgIGR5OiBub2RlLmR5CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfdHJlZW1hcFBhZChub2RlLCBwYWRkaW5nKSB7CiAgICB2YXIgeCA9IG5vZGUueCArIHBhZGRpbmdbM10sIHkgPSBub2RlLnkgKyBwYWRkaW5nWzBdLCBkeCA9IG5vZGUuZHggLSBwYWRkaW5nWzFdIC0gcGFkZGluZ1szXSwgZHkgPSBub2RlLmR5IC0gcGFkZGluZ1swXSAtIHBhZGRpbmdbMl07CiAgICBpZiAoZHggPCAwKSB7CiAgICAgIHggKz0gZHggLyAyOwogICAgICBkeCA9IDA7CiAgICB9CiAgICBpZiAoZHkgPCAwKSB7CiAgICAgIHkgKz0gZHkgLyAyOwogICAgICBkeSA9IDA7CiAgICB9CiAgICByZXR1cm4gewogICAgICB4OiB4LAogICAgICB5OiB5LAogICAgICBkeDogZHgsCiAgICAgIGR5OiBkeQogICAgfTsKICB9CiAgZDMucmFuZG9tID0gewogICAgbm9ybWFsOiBmdW5jdGlvbijCtSwgz4MpIHsKICAgICAgdmFyIG4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICBpZiAobiA8IDIpIM+DID0gMTsKICAgICAgaWYgKG4gPCAxKSDCtSA9IDA7CiAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgeCwgeSwgcjsKICAgICAgICBkbyB7CiAgICAgICAgICB4ID0gTWF0aC5yYW5kb20oKSAqIDIgLSAxOwogICAgICAgICAgeSA9IE1hdGgucmFuZG9tKCkgKiAyIC0gMTsKICAgICAgICAgIHIgPSB4ICogeCArIHkgKiB5OwogICAgICAgIH0gd2hpbGUgKCFyIHx8IHIgPiAxKTsKICAgICAgICByZXR1cm4gwrUgKyDPgyAqIHggKiBNYXRoLnNxcnQoLTIgKiBNYXRoLmxvZyhyKSAvIHIpOwogICAgICB9OwogICAgfSwKICAgIGxvZ05vcm1hbDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciByYW5kb20gPSBkMy5yYW5kb20ubm9ybWFsLmFwcGx5KGQzLCBhcmd1bWVudHMpOwogICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIE1hdGguZXhwKHJhbmRvbSgpKTsKICAgICAgfTsKICAgIH0sCiAgICBiYXRlczogZnVuY3Rpb24obSkgewogICAgICB2YXIgcmFuZG9tID0gZDMucmFuZG9tLmlyd2luSGFsbChtKTsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiByYW5kb20oKSAvIG07CiAgICAgIH07CiAgICB9LAogICAgaXJ3aW5IYWxsOiBmdW5jdGlvbihtKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICBmb3IgKHZhciBzID0gMCwgaiA9IDA7IGogPCBtOyBqKyspIHMgKz0gTWF0aC5yYW5kb20oKTsKICAgICAgICByZXR1cm4gczsKICAgICAgfTsKICAgIH0KICB9OwogIGQzLnNjYWxlID0ge307CiAgZnVuY3Rpb24gZDNfc2NhbGVFeHRlbnQoZG9tYWluKSB7CiAgICB2YXIgc3RhcnQgPSBkb21haW5bMF0sIHN0b3AgPSBkb21haW5bZG9tYWluLmxlbmd0aCAtIDFdOwogICAgcmV0dXJuIHN0YXJ0IDwgc3RvcCA/IFsgc3RhcnQsIHN0b3AgXSA6IFsgc3RvcCwgc3RhcnQgXTsKICB9CiAgZnVuY3Rpb24gZDNfc2NhbGVSYW5nZShzY2FsZSkgewogICAgcmV0dXJuIHNjYWxlLnJhbmdlRXh0ZW50ID8gc2NhbGUucmFuZ2VFeHRlbnQoKSA6IGQzX3NjYWxlRXh0ZW50KHNjYWxlLnJhbmdlKCkpOwogIH0KICBmdW5jdGlvbiBkM19zY2FsZV9iaWxpbmVhcihkb21haW4sIHJhbmdlLCB1bmludGVycG9sYXRlLCBpbnRlcnBvbGF0ZSkgewogICAgdmFyIHUgPSB1bmludGVycG9sYXRlKGRvbWFpblswXSwgZG9tYWluWzFdKSwgaSA9IGludGVycG9sYXRlKHJhbmdlWzBdLCByYW5nZVsxXSk7CiAgICByZXR1cm4gZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4gaSh1KHgpKTsKICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX3NjYWxlX25pY2UoZG9tYWluLCBuaWNlKSB7CiAgICB2YXIgaTAgPSAwLCBpMSA9IGRvbWFpbi5sZW5ndGggLSAxLCB4MCA9IGRvbWFpbltpMF0sIHgxID0gZG9tYWluW2kxXSwgZHg7CiAgICBpZiAoeDEgPCB4MCkgewogICAgICBkeCA9IGkwLCBpMCA9IGkxLCBpMSA9IGR4OwogICAgICBkeCA9IHgwLCB4MCA9IHgxLCB4MSA9IGR4OwogICAgfQogICAgZG9tYWluW2kwXSA9IG5pY2UuZmxvb3IoeDApOwogICAgZG9tYWluW2kxXSA9IG5pY2UuY2VpbCh4MSk7CiAgICByZXR1cm4gZG9tYWluOwogIH0KICBmdW5jdGlvbiBkM19zY2FsZV9uaWNlU3RlcChzdGVwKSB7CiAgICByZXR1cm4gc3RlcCA/IHsKICAgICAgZmxvb3I6IGZ1bmN0aW9uKHgpIHsKICAgICAgICByZXR1cm4gTWF0aC5mbG9vcih4IC8gc3RlcCkgKiBzdGVwOwogICAgICB9LAogICAgICBjZWlsOiBmdW5jdGlvbih4KSB7CiAgICAgICAgcmV0dXJuIE1hdGguY2VpbCh4IC8gc3RlcCkgKiBzdGVwOwogICAgICB9CiAgICB9IDogZDNfc2NhbGVfbmljZUlkZW50aXR5OwogIH0KICB2YXIgZDNfc2NhbGVfbmljZUlkZW50aXR5ID0gewogICAgZmxvb3I6IGQzX2lkZW50aXR5LAogICAgY2VpbDogZDNfaWRlbnRpdHkKICB9OwogIGZ1bmN0aW9uIGQzX3NjYWxlX3BvbHlsaW5lYXIoZG9tYWluLCByYW5nZSwgdW5pbnRlcnBvbGF0ZSwgaW50ZXJwb2xhdGUpIHsKICAgIHZhciB1ID0gW10sIGkgPSBbXSwgaiA9IDAsIGsgPSBNYXRoLm1pbihkb21haW4ubGVuZ3RoLCByYW5nZS5sZW5ndGgpIC0gMTsKICAgIGlmIChkb21haW5ba10gPCBkb21haW5bMF0pIHsKICAgICAgZG9tYWluID0gZG9tYWluLnNsaWNlKCkucmV2ZXJzZSgpOwogICAgICByYW5nZSA9IHJhbmdlLnNsaWNlKCkucmV2ZXJzZSgpOwogICAgfQogICAgd2hpbGUgKCsraiA8PSBrKSB7CiAgICAgIHUucHVzaCh1bmludGVycG9sYXRlKGRvbWFpbltqIC0gMV0sIGRvbWFpbltqXSkpOwogICAgICBpLnB1c2goaW50ZXJwb2xhdGUocmFuZ2VbaiAtIDFdLCByYW5nZVtqXSkpOwogICAgfQogICAgcmV0dXJuIGZ1bmN0aW9uKHgpIHsKICAgICAgdmFyIGogPSBkMy5iaXNlY3QoZG9tYWluLCB4LCAxLCBrKSAtIDE7CiAgICAgIHJldHVybiBpW2pdKHVbal0oeCkpOwogICAgfTsKICB9CiAgZDMuc2NhbGUubGluZWFyID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZDNfc2NhbGVfbGluZWFyKFsgMCwgMSBdLCBbIDAsIDEgXSwgZDNfaW50ZXJwb2xhdGUsIGZhbHNlKTsKICB9OwogIGZ1bmN0aW9uIGQzX3NjYWxlX2xpbmVhcihkb21haW4sIHJhbmdlLCBpbnRlcnBvbGF0ZSwgY2xhbXApIHsKICAgIHZhciBvdXRwdXQsIGlucHV0OwogICAgZnVuY3Rpb24gcmVzY2FsZSgpIHsKICAgICAgdmFyIGxpbmVhciA9IE1hdGgubWluKGRvbWFpbi5sZW5ndGgsIHJhbmdlLmxlbmd0aCkgPiAyID8gZDNfc2NhbGVfcG9seWxpbmVhciA6IGQzX3NjYWxlX2JpbGluZWFyLCB1bmludGVycG9sYXRlID0gY2xhbXAgPyBkM191bmludGVycG9sYXRlQ2xhbXAgOiBkM191bmludGVycG9sYXRlTnVtYmVyOwogICAgICBvdXRwdXQgPSBsaW5lYXIoZG9tYWluLCByYW5nZSwgdW5pbnRlcnBvbGF0ZSwgaW50ZXJwb2xhdGUpOwogICAgICBpbnB1dCA9IGxpbmVhcihyYW5nZSwgZG9tYWluLCB1bmludGVycG9sYXRlLCBkM19pbnRlcnBvbGF0ZSk7CiAgICAgIHJldHVybiBzY2FsZTsKICAgIH0KICAgIGZ1bmN0aW9uIHNjYWxlKHgpIHsKICAgICAgcmV0dXJuIG91dHB1dCh4KTsKICAgIH0KICAgIHNjYWxlLmludmVydCA9IGZ1bmN0aW9uKHkpIHsKICAgICAgcmV0dXJuIGlucHV0KHkpOwogICAgfTsKICAgIHNjYWxlLmRvbWFpbiA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gZG9tYWluOwogICAgICBkb21haW4gPSB4Lm1hcChOdW1iZXIpOwogICAgICByZXR1cm4gcmVzY2FsZSgpOwogICAgfTsKICAgIHNjYWxlLnJhbmdlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiByYW5nZTsKICAgICAgcmFuZ2UgPSB4OwogICAgICByZXR1cm4gcmVzY2FsZSgpOwogICAgfTsKICAgIHNjYWxlLnJhbmdlUm91bmQgPSBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiBzY2FsZS5yYW5nZSh4KS5pbnRlcnBvbGF0ZShkM19pbnRlcnBvbGF0ZVJvdW5kKTsKICAgIH07CiAgICBzY2FsZS5jbGFtcCA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gY2xhbXA7CiAgICAgIGNsYW1wID0geDsKICAgICAgcmV0dXJuIHJlc2NhbGUoKTsKICAgIH07CiAgICBzY2FsZS5pbnRlcnBvbGF0ZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gaW50ZXJwb2xhdGU7CiAgICAgIGludGVycG9sYXRlID0geDsKICAgICAgcmV0dXJuIHJlc2NhbGUoKTsKICAgIH07CiAgICBzY2FsZS50aWNrcyA9IGZ1bmN0aW9uKG0pIHsKICAgICAgcmV0dXJuIGQzX3NjYWxlX2xpbmVhclRpY2tzKGRvbWFpbiwgbSk7CiAgICB9OwogICAgc2NhbGUudGlja0Zvcm1hdCA9IGZ1bmN0aW9uKG0sIGZvcm1hdCkgewogICAgICByZXR1cm4gZDNfc2NhbGVfbGluZWFyVGlja0Zvcm1hdChkb21haW4sIG0sIGZvcm1hdCk7CiAgICB9OwogICAgc2NhbGUubmljZSA9IGZ1bmN0aW9uKG0pIHsKICAgICAgZDNfc2NhbGVfbGluZWFyTmljZShkb21haW4sIG0pOwogICAgICByZXR1cm4gcmVzY2FsZSgpOwogICAgfTsKICAgIHNjYWxlLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX3NjYWxlX2xpbmVhcihkb21haW4sIHJhbmdlLCBpbnRlcnBvbGF0ZSwgY2xhbXApOwogICAgfTsKICAgIHJldHVybiByZXNjYWxlKCk7CiAgfQogIGZ1bmN0aW9uIGQzX3NjYWxlX2xpbmVhclJlYmluZChzY2FsZSwgbGluZWFyKSB7CiAgICByZXR1cm4gZDMucmViaW5kKHNjYWxlLCBsaW5lYXIsICJyYW5nZSIsICJyYW5nZVJvdW5kIiwgImludGVycG9sYXRlIiwgImNsYW1wIik7CiAgfQogIGZ1bmN0aW9uIGQzX3NjYWxlX2xpbmVhck5pY2UoZG9tYWluLCBtKSB7CiAgICByZXR1cm4gZDNfc2NhbGVfbmljZShkb21haW4sIGQzX3NjYWxlX25pY2VTdGVwKGQzX3NjYWxlX2xpbmVhclRpY2tSYW5nZShkb21haW4sIG0pWzJdKSk7CiAgfQogIGZ1bmN0aW9uIGQzX3NjYWxlX2xpbmVhclRpY2tSYW5nZShkb21haW4sIG0pIHsKICAgIGlmIChtID09IG51bGwpIG0gPSAxMDsKICAgIHZhciBleHRlbnQgPSBkM19zY2FsZUV4dGVudChkb21haW4pLCBzcGFuID0gZXh0ZW50WzFdIC0gZXh0ZW50WzBdLCBzdGVwID0gTWF0aC5wb3coMTAsIE1hdGguZmxvb3IoTWF0aC5sb2coc3BhbiAvIG0pIC8gTWF0aC5MTjEwKSksIGVyciA9IG0gLyBzcGFuICogc3RlcDsKICAgIGlmIChlcnIgPD0gLjE1KSBzdGVwICo9IDEwOyBlbHNlIGlmIChlcnIgPD0gLjM1KSBzdGVwICo9IDU7IGVsc2UgaWYgKGVyciA8PSAuNzUpIHN0ZXAgKj0gMjsKICAgIGV4dGVudFswXSA9IE1hdGguY2VpbChleHRlbnRbMF0gLyBzdGVwKSAqIHN0ZXA7CiAgICBleHRlbnRbMV0gPSBNYXRoLmZsb29yKGV4dGVudFsxXSAvIHN0ZXApICogc3RlcCArIHN0ZXAgKiAuNTsKICAgIGV4dGVudFsyXSA9IHN0ZXA7CiAgICByZXR1cm4gZXh0ZW50OwogIH0KICBmdW5jdGlvbiBkM19zY2FsZV9saW5lYXJUaWNrcyhkb21haW4sIG0pIHsKICAgIHJldHVybiBkMy5yYW5nZS5hcHBseShkMywgZDNfc2NhbGVfbGluZWFyVGlja1JhbmdlKGRvbWFpbiwgbSkpOwogIH0KICBmdW5jdGlvbiBkM19zY2FsZV9saW5lYXJUaWNrRm9ybWF0KGRvbWFpbiwgbSwgZm9ybWF0KSB7CiAgICB2YXIgcmFuZ2UgPSBkM19zY2FsZV9saW5lYXJUaWNrUmFuZ2UoZG9tYWluLCBtKTsKICAgIGlmIChmb3JtYXQpIHsKICAgICAgdmFyIG1hdGNoID0gZDNfZm9ybWF0X3JlLmV4ZWMoZm9ybWF0KTsKICAgICAgbWF0Y2guc2hpZnQoKTsKICAgICAgaWYgKG1hdGNoWzhdID09PSAicyIpIHsKICAgICAgICB2YXIgcHJlZml4ID0gZDMuZm9ybWF0UHJlZml4KE1hdGgubWF4KGFicyhyYW5nZVswXSksIGFicyhyYW5nZVsxXSkpKTsKICAgICAgICBpZiAoIW1hdGNoWzddKSBtYXRjaFs3XSA9ICIuIiArIGQzX3NjYWxlX2xpbmVhclByZWNpc2lvbihwcmVmaXguc2NhbGUocmFuZ2VbMl0pKTsKICAgICAgICBtYXRjaFs4XSA9ICJmIjsKICAgICAgICBmb3JtYXQgPSBkMy5mb3JtYXQobWF0Y2guam9pbigiIikpOwogICAgICAgIHJldHVybiBmdW5jdGlvbihkKSB7CiAgICAgICAgICByZXR1cm4gZm9ybWF0KHByZWZpeC5zY2FsZShkKSkgKyBwcmVmaXguc3ltYm9sOwogICAgICAgIH07CiAgICAgIH0KICAgICAgaWYgKCFtYXRjaFs3XSkgbWF0Y2hbN10gPSAiLiIgKyBkM19zY2FsZV9saW5lYXJGb3JtYXRQcmVjaXNpb24obWF0Y2hbOF0sIHJhbmdlKTsKICAgICAgZm9ybWF0ID0gbWF0Y2guam9pbigiIik7CiAgICB9IGVsc2UgewogICAgICBmb3JtYXQgPSAiLC4iICsgZDNfc2NhbGVfbGluZWFyUHJlY2lzaW9uKHJhbmdlWzJdKSArICJmIjsKICAgIH0KICAgIHJldHVybiBkMy5mb3JtYXQoZm9ybWF0KTsKICB9CiAgdmFyIGQzX3NjYWxlX2xpbmVhckZvcm1hdFNpZ25pZmljYW50ID0gewogICAgczogMSwKICAgIGc6IDEsCiAgICBwOiAxLAogICAgcjogMSwKICAgIGU6IDEKICB9OwogIGZ1bmN0aW9uIGQzX3NjYWxlX2xpbmVhclByZWNpc2lvbih2YWx1ZSkgewogICAgcmV0dXJuIC1NYXRoLmZsb29yKE1hdGgubG9nKHZhbHVlKSAvIE1hdGguTE4xMCArIC4wMSk7CiAgfQogIGZ1bmN0aW9uIGQzX3NjYWxlX2xpbmVhckZvcm1hdFByZWNpc2lvbih0eXBlLCByYW5nZSkgewogICAgdmFyIHAgPSBkM19zY2FsZV9saW5lYXJQcmVjaXNpb24ocmFuZ2VbMl0pOwogICAgcmV0dXJuIHR5cGUgaW4gZDNfc2NhbGVfbGluZWFyRm9ybWF0U2lnbmlmaWNhbnQgPyBNYXRoLmFicyhwIC0gZDNfc2NhbGVfbGluZWFyUHJlY2lzaW9uKE1hdGgubWF4KGFicyhyYW5nZVswXSksIGFicyhyYW5nZVsxXSkpKSkgKyArKHR5cGUgIT09ICJlIikgOiBwIC0gKHR5cGUgPT09ICIlIikgKiAyOwogIH0KICBkMy5zY2FsZS5sb2cgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM19zY2FsZV9sb2coZDMuc2NhbGUubGluZWFyKCkuZG9tYWluKFsgMCwgMSBdKSwgMTAsIHRydWUsIFsgMSwgMTAgXSk7CiAgfTsKICBmdW5jdGlvbiBkM19zY2FsZV9sb2cobGluZWFyLCBiYXNlLCBwb3NpdGl2ZSwgZG9tYWluKSB7CiAgICBmdW5jdGlvbiBsb2coeCkgewogICAgICByZXR1cm4gKHBvc2l0aXZlID8gTWF0aC5sb2coeCA8IDAgPyAwIDogeCkgOiAtTWF0aC5sb2coeCA+IDAgPyAwIDogLXgpKSAvIE1hdGgubG9nKGJhc2UpOwogICAgfQogICAgZnVuY3Rpb24gcG93KHgpIHsKICAgICAgcmV0dXJuIHBvc2l0aXZlID8gTWF0aC5wb3coYmFzZSwgeCkgOiAtTWF0aC5wb3coYmFzZSwgLXgpOwogICAgfQogICAgZnVuY3Rpb24gc2NhbGUoeCkgewogICAgICByZXR1cm4gbGluZWFyKGxvZyh4KSk7CiAgICB9CiAgICBzY2FsZS5pbnZlcnQgPSBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiBwb3cobGluZWFyLmludmVydCh4KSk7CiAgICB9OwogICAgc2NhbGUuZG9tYWluID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBkb21haW47CiAgICAgIHBvc2l0aXZlID0geFswXSA+PSAwOwogICAgICBsaW5lYXIuZG9tYWluKChkb21haW4gPSB4Lm1hcChOdW1iZXIpKS5tYXAobG9nKSk7CiAgICAgIHJldHVybiBzY2FsZTsKICAgIH07CiAgICBzY2FsZS5iYXNlID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBiYXNlOwogICAgICBiYXNlID0gK187CiAgICAgIGxpbmVhci5kb21haW4oZG9tYWluLm1hcChsb2cpKTsKICAgICAgcmV0dXJuIHNjYWxlOwogICAgfTsKICAgIHNjYWxlLm5pY2UgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIG5pY2VkID0gZDNfc2NhbGVfbmljZShkb21haW4ubWFwKGxvZyksIHBvc2l0aXZlID8gTWF0aCA6IGQzX3NjYWxlX2xvZ05pY2VOZWdhdGl2ZSk7CiAgICAgIGxpbmVhci5kb21haW4obmljZWQpOwogICAgICBkb21haW4gPSBuaWNlZC5tYXAocG93KTsKICAgICAgcmV0dXJuIHNjYWxlOwogICAgfTsKICAgIHNjYWxlLnRpY2tzID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBleHRlbnQgPSBkM19zY2FsZUV4dGVudChkb21haW4pLCB0aWNrcyA9IFtdLCB1ID0gZXh0ZW50WzBdLCB2ID0gZXh0ZW50WzFdLCBpID0gTWF0aC5mbG9vcihsb2codSkpLCBqID0gTWF0aC5jZWlsKGxvZyh2KSksIG4gPSBiYXNlICUgMSA/IDIgOiBiYXNlOwogICAgICBpZiAoaXNGaW5pdGUoaiAtIGkpKSB7CiAgICAgICAgaWYgKHBvc2l0aXZlKSB7CiAgICAgICAgICBmb3IgKDtpIDwgajsgaSsrKSBmb3IgKHZhciBrID0gMTsgayA8IG47IGsrKykgdGlja3MucHVzaChwb3coaSkgKiBrKTsKICAgICAgICAgIHRpY2tzLnB1c2gocG93KGkpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGlja3MucHVzaChwb3coaSkpOwogICAgICAgICAgZm9yICg7aSsrIDwgajsgKSBmb3IgKHZhciBrID0gbiAtIDE7IGsgPiAwOyBrLS0pIHRpY2tzLnB1c2gocG93KGkpICogayk7CiAgICAgICAgfQogICAgICAgIGZvciAoaSA9IDA7IHRpY2tzW2ldIDwgdTsgaSsrKSB7fQogICAgICAgIGZvciAoaiA9IHRpY2tzLmxlbmd0aDsgdGlja3NbaiAtIDFdID4gdjsgai0tKSB7fQogICAgICAgIHRpY2tzID0gdGlja3Muc2xpY2UoaSwgaik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRpY2tzOwogICAgfTsKICAgIHNjYWxlLnRpY2tGb3JtYXQgPSBmdW5jdGlvbihuLCBmb3JtYXQpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gZDNfc2NhbGVfbG9nRm9ybWF0OwogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIGZvcm1hdCA9IGQzX3NjYWxlX2xvZ0Zvcm1hdDsgZWxzZSBpZiAodHlwZW9mIGZvcm1hdCAhPT0gImZ1bmN0aW9uIikgZm9ybWF0ID0gZDMuZm9ybWF0KGZvcm1hdCk7CiAgICAgIHZhciBrID0gTWF0aC5tYXgoLjEsIG4gLyBzY2FsZS50aWNrcygpLmxlbmd0aCksIGYgPSBwb3NpdGl2ZSA/IChlID0gMWUtMTIsIE1hdGguY2VpbCkgOiAoZSA9IC0xZS0xMiwgCiAgICAgIE1hdGguZmxvb3IpLCBlOwogICAgICByZXR1cm4gZnVuY3Rpb24oZCkgewogICAgICAgIHJldHVybiBkIC8gcG93KGYobG9nKGQpICsgZSkpIDw9IGsgPyBmb3JtYXQoZCkgOiAiIjsKICAgICAgfTsKICAgIH07CiAgICBzY2FsZS5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkM19zY2FsZV9sb2cobGluZWFyLmNvcHkoKSwgYmFzZSwgcG9zaXRpdmUsIGRvbWFpbik7CiAgICB9OwogICAgcmV0dXJuIGQzX3NjYWxlX2xpbmVhclJlYmluZChzY2FsZSwgbGluZWFyKTsKICB9CiAgdmFyIGQzX3NjYWxlX2xvZ0Zvcm1hdCA9IGQzLmZvcm1hdCgiLjBlIiksIGQzX3NjYWxlX2xvZ05pY2VOZWdhdGl2ZSA9IHsKICAgIGZsb29yOiBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiAtTWF0aC5jZWlsKC14KTsKICAgIH0sCiAgICBjZWlsOiBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiAtTWF0aC5mbG9vcigteCk7CiAgICB9CiAgfTsKICBkMy5zY2FsZS5wb3cgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM19zY2FsZV9wb3coZDMuc2NhbGUubGluZWFyKCksIDEsIFsgMCwgMSBdKTsKICB9OwogIGZ1bmN0aW9uIGQzX3NjYWxlX3BvdyhsaW5lYXIsIGV4cG9uZW50LCBkb21haW4pIHsKICAgIHZhciBwb3dwID0gZDNfc2NhbGVfcG93UG93KGV4cG9uZW50KSwgcG93YiA9IGQzX3NjYWxlX3Bvd1BvdygxIC8gZXhwb25lbnQpOwogICAgZnVuY3Rpb24gc2NhbGUoeCkgewogICAgICByZXR1cm4gbGluZWFyKHBvd3AoeCkpOwogICAgfQogICAgc2NhbGUuaW52ZXJ0ID0gZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4gcG93YihsaW5lYXIuaW52ZXJ0KHgpKTsKICAgIH07CiAgICBzY2FsZS5kb21haW4gPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGRvbWFpbjsKICAgICAgbGluZWFyLmRvbWFpbigoZG9tYWluID0geC5tYXAoTnVtYmVyKSkubWFwKHBvd3ApKTsKICAgICAgcmV0dXJuIHNjYWxlOwogICAgfTsKICAgIHNjYWxlLnRpY2tzID0gZnVuY3Rpb24obSkgewogICAgICByZXR1cm4gZDNfc2NhbGVfbGluZWFyVGlja3MoZG9tYWluLCBtKTsKICAgIH07CiAgICBzY2FsZS50aWNrRm9ybWF0ID0gZnVuY3Rpb24obSwgZm9ybWF0KSB7CiAgICAgIHJldHVybiBkM19zY2FsZV9saW5lYXJUaWNrRm9ybWF0KGRvbWFpbiwgbSwgZm9ybWF0KTsKICAgIH07CiAgICBzY2FsZS5uaWNlID0gZnVuY3Rpb24obSkgewogICAgICByZXR1cm4gc2NhbGUuZG9tYWluKGQzX3NjYWxlX2xpbmVhck5pY2UoZG9tYWluLCBtKSk7CiAgICB9OwogICAgc2NhbGUuZXhwb25lbnQgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGV4cG9uZW50OwogICAgICBwb3dwID0gZDNfc2NhbGVfcG93UG93KGV4cG9uZW50ID0geCk7CiAgICAgIHBvd2IgPSBkM19zY2FsZV9wb3dQb3coMSAvIGV4cG9uZW50KTsKICAgICAgbGluZWFyLmRvbWFpbihkb21haW4ubWFwKHBvd3ApKTsKICAgICAgcmV0dXJuIHNjYWxlOwogICAgfTsKICAgIHNjYWxlLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX3NjYWxlX3BvdyhsaW5lYXIuY29weSgpLCBleHBvbmVudCwgZG9tYWluKTsKICAgIH07CiAgICByZXR1cm4gZDNfc2NhbGVfbGluZWFyUmViaW5kKHNjYWxlLCBsaW5lYXIpOwogIH0KICBmdW5jdGlvbiBkM19zY2FsZV9wb3dQb3coZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuIHggPCAwID8gLU1hdGgucG93KC14LCBlKSA6IE1hdGgucG93KHgsIGUpOwogICAgfTsKICB9CiAgZDMuc2NhbGUuc3FydCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzLnNjYWxlLnBvdygpLmV4cG9uZW50KC41KTsKICB9OwogIGQzLnNjYWxlLm9yZGluYWwgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM19zY2FsZV9vcmRpbmFsKFtdLCB7CiAgICAgIHQ6ICJyYW5nZSIsCiAgICAgIGE6IFsgW10gXQogICAgfSk7CiAgfTsKICBmdW5jdGlvbiBkM19zY2FsZV9vcmRpbmFsKGRvbWFpbiwgcmFuZ2VyKSB7CiAgICB2YXIgaW5kZXgsIHJhbmdlLCByYW5nZUJhbmQ7CiAgICBmdW5jdGlvbiBzY2FsZSh4KSB7CiAgICAgIHJldHVybiByYW5nZVsoKGluZGV4LmdldCh4KSB8fCAocmFuZ2VyLnQgPT09ICJyYW5nZSIgPyBpbmRleC5zZXQoeCwgZG9tYWluLnB1c2goeCkpIDogTmFOKSkgLSAxKSAlIHJhbmdlLmxlbmd0aF07CiAgICB9CiAgICBmdW5jdGlvbiBzdGVwcyhzdGFydCwgc3RlcCkgewogICAgICByZXR1cm4gZDMucmFuZ2UoZG9tYWluLmxlbmd0aCkubWFwKGZ1bmN0aW9uKGkpIHsKICAgICAgICByZXR1cm4gc3RhcnQgKyBzdGVwICogaTsKICAgICAgfSk7CiAgICB9CiAgICBzY2FsZS5kb21haW4gPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGRvbWFpbjsKICAgICAgZG9tYWluID0gW107CiAgICAgIGluZGV4ID0gbmV3IGQzX01hcCgpOwogICAgICB2YXIgaSA9IC0xLCBuID0geC5sZW5ndGgsIHhpOwogICAgICB3aGlsZSAoKytpIDwgbikgaWYgKCFpbmRleC5oYXMoeGkgPSB4W2ldKSkgaW5kZXguc2V0KHhpLCBkb21haW4ucHVzaCh4aSkpOwogICAgICByZXR1cm4gc2NhbGVbcmFuZ2VyLnRdLmFwcGx5KHNjYWxlLCByYW5nZXIuYSk7CiAgICB9OwogICAgc2NhbGUucmFuZ2UgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHJhbmdlOwogICAgICByYW5nZSA9IHg7CiAgICAgIHJhbmdlQmFuZCA9IDA7CiAgICAgIHJhbmdlciA9IHsKICAgICAgICB0OiAicmFuZ2UiLAogICAgICAgIGE6IGFyZ3VtZW50cwogICAgICB9OwogICAgICByZXR1cm4gc2NhbGU7CiAgICB9OwogICAgc2NhbGUucmFuZ2VQb2ludHMgPSBmdW5jdGlvbih4LCBwYWRkaW5nKSB7CiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgcGFkZGluZyA9IDA7CiAgICAgIHZhciBzdGFydCA9IHhbMF0sIHN0b3AgPSB4WzFdLCBzdGVwID0gZG9tYWluLmxlbmd0aCA8IDIgPyAoc3RhcnQgPSAoc3RhcnQgKyBzdG9wKSAvIDIsIAogICAgICAwKSA6IChzdG9wIC0gc3RhcnQpIC8gKGRvbWFpbi5sZW5ndGggLSAxICsgcGFkZGluZyk7CiAgICAgIHJhbmdlID0gc3RlcHMoc3RhcnQgKyBzdGVwICogcGFkZGluZyAvIDIsIHN0ZXApOwogICAgICByYW5nZUJhbmQgPSAwOwogICAgICByYW5nZXIgPSB7CiAgICAgICAgdDogInJhbmdlUG9pbnRzIiwKICAgICAgICBhOiBhcmd1bWVudHMKICAgICAgfTsKICAgICAgcmV0dXJuIHNjYWxlOwogICAgfTsKICAgIHNjYWxlLnJhbmdlUm91bmRQb2ludHMgPSBmdW5jdGlvbih4LCBwYWRkaW5nKSB7CiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgcGFkZGluZyA9IDA7CiAgICAgIHZhciBzdGFydCA9IHhbMF0sIHN0b3AgPSB4WzFdLCBzdGVwID0gZG9tYWluLmxlbmd0aCA8IDIgPyAoc3RhcnQgPSBzdG9wID0gTWF0aC5yb3VuZCgoc3RhcnQgKyBzdG9wKSAvIDIpLCAKICAgICAgMCkgOiAoc3RvcCAtIHN0YXJ0KSAvIChkb21haW4ubGVuZ3RoIC0gMSArIHBhZGRpbmcpIHwgMDsKICAgICAgcmFuZ2UgPSBzdGVwcyhzdGFydCArIE1hdGgucm91bmQoc3RlcCAqIHBhZGRpbmcgLyAyICsgKHN0b3AgLSBzdGFydCAtIChkb21haW4ubGVuZ3RoIC0gMSArIHBhZGRpbmcpICogc3RlcCkgLyAyKSwgc3RlcCk7CiAgICAgIHJhbmdlQmFuZCA9IDA7CiAgICAgIHJhbmdlciA9IHsKICAgICAgICB0OiAicmFuZ2VSb3VuZFBvaW50cyIsCiAgICAgICAgYTogYXJndW1lbnRzCiAgICAgIH07CiAgICAgIHJldHVybiBzY2FsZTsKICAgIH07CiAgICBzY2FsZS5yYW5nZUJhbmRzID0gZnVuY3Rpb24oeCwgcGFkZGluZywgb3V0ZXJQYWRkaW5nKSB7CiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgcGFkZGluZyA9IDA7CiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMykgb3V0ZXJQYWRkaW5nID0gcGFkZGluZzsKICAgICAgdmFyIHJldmVyc2UgPSB4WzFdIDwgeFswXSwgc3RhcnQgPSB4W3JldmVyc2UgLSAwXSwgc3RvcCA9IHhbMSAtIHJldmVyc2VdLCBzdGVwID0gKHN0b3AgLSBzdGFydCkgLyAoZG9tYWluLmxlbmd0aCAtIHBhZGRpbmcgKyAyICogb3V0ZXJQYWRkaW5nKTsKICAgICAgcmFuZ2UgPSBzdGVwcyhzdGFydCArIHN0ZXAgKiBvdXRlclBhZGRpbmcsIHN0ZXApOwogICAgICBpZiAocmV2ZXJzZSkgcmFuZ2UucmV2ZXJzZSgpOwogICAgICByYW5nZUJhbmQgPSBzdGVwICogKDEgLSBwYWRkaW5nKTsKICAgICAgcmFuZ2VyID0gewogICAgICAgIHQ6ICJyYW5nZUJhbmRzIiwKICAgICAgICBhOiBhcmd1bWVudHMKICAgICAgfTsKICAgICAgcmV0dXJuIHNjYWxlOwogICAgfTsKICAgIHNjYWxlLnJhbmdlUm91bmRCYW5kcyA9IGZ1bmN0aW9uKHgsIHBhZGRpbmcsIG91dGVyUGFkZGluZykgewogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHBhZGRpbmcgPSAwOwogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDMpIG91dGVyUGFkZGluZyA9IHBhZGRpbmc7CiAgICAgIHZhciByZXZlcnNlID0geFsxXSA8IHhbMF0sIHN0YXJ0ID0geFtyZXZlcnNlIC0gMF0sIHN0b3AgPSB4WzEgLSByZXZlcnNlXSwgc3RlcCA9IE1hdGguZmxvb3IoKHN0b3AgLSBzdGFydCkgLyAoZG9tYWluLmxlbmd0aCAtIHBhZGRpbmcgKyAyICogb3V0ZXJQYWRkaW5nKSk7CiAgICAgIHJhbmdlID0gc3RlcHMoc3RhcnQgKyBNYXRoLnJvdW5kKChzdG9wIC0gc3RhcnQgLSAoZG9tYWluLmxlbmd0aCAtIHBhZGRpbmcpICogc3RlcCkgLyAyKSwgc3RlcCk7CiAgICAgIGlmIChyZXZlcnNlKSByYW5nZS5yZXZlcnNlKCk7CiAgICAgIHJhbmdlQmFuZCA9IE1hdGgucm91bmQoc3RlcCAqICgxIC0gcGFkZGluZykpOwogICAgICByYW5nZXIgPSB7CiAgICAgICAgdDogInJhbmdlUm91bmRCYW5kcyIsCiAgICAgICAgYTogYXJndW1lbnRzCiAgICAgIH07CiAgICAgIHJldHVybiBzY2FsZTsKICAgIH07CiAgICBzY2FsZS5yYW5nZUJhbmQgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHJhbmdlQmFuZDsKICAgIH07CiAgICBzY2FsZS5yYW5nZUV4dGVudCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZDNfc2NhbGVFeHRlbnQocmFuZ2VyLmFbMF0pOwogICAgfTsKICAgIHNjYWxlLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX3NjYWxlX29yZGluYWwoZG9tYWluLCByYW5nZXIpOwogICAgfTsKICAgIHJldHVybiBzY2FsZS5kb21haW4oZG9tYWluKTsKICB9CiAgZDMuc2NhbGUuY2F0ZWdvcnkxMCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzLnNjYWxlLm9yZGluYWwoKS5yYW5nZShkM19jYXRlZ29yeTEwKTsKICB9OwogIGQzLnNjYWxlLmNhdGVnb3J5MjAgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkMy5zY2FsZS5vcmRpbmFsKCkucmFuZ2UoZDNfY2F0ZWdvcnkyMCk7CiAgfTsKICBkMy5zY2FsZS5jYXRlZ29yeTIwYiA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzLnNjYWxlLm9yZGluYWwoKS5yYW5nZShkM19jYXRlZ29yeTIwYik7CiAgfTsKICBkMy5zY2FsZS5jYXRlZ29yeTIwYyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzLnNjYWxlLm9yZGluYWwoKS5yYW5nZShkM19jYXRlZ29yeTIwYyk7CiAgfTsKICB2YXIgZDNfY2F0ZWdvcnkxMCA9IFsgMjA2MjI2MCwgMTY3NDQyMDYsIDI5MjQ1ODgsIDE0MDM0NzI4LCA5NzI1ODg1LCA5MTk3MTMxLCAxNDkwNzMzMCwgODM1NTcxMSwgMTIzNjkxODYsIDE1NTYxNzUgXS5tYXAoZDNfcmdiU3RyaW5nKTsKICB2YXIgZDNfY2F0ZWdvcnkyMCA9IFsgMjA2MjI2MCwgMTE0NTQ0NDAsIDE2NzQ0MjA2LCAxNjc1OTY3MiwgMjkyNDU4OCwgMTAwMTg2OTgsIDE0MDM0NzI4LCAxNjc1MDc0MiwgOTcyNTg4NSwgMTI5NTU4NjEsIDkxOTcxMzEsIDEyODg1MTQwLCAxNDkwNzMzMCwgMTYyMzQxOTQsIDgzNTU3MTEsIDEzMDkyODA3LCAxMjM2OTE4NiwgMTQ0MDg1ODksIDE1NTYxNzUsIDEwNDEwNzI1IF0ubWFwKGQzX3JnYlN0cmluZyk7CiAgdmFyIGQzX2NhdGVnb3J5MjBiID0gWyAzNzUwNzc3LCA1Mzk1NjE5LCA3MDQwNzE5LCAxMDI2NDI4NiwgNjUxOTA5NywgOTIxNjU5NCwgMTE5MTUxMTUsIDEzNTU2NjM2LCA5MjAyOTkzLCAxMjQyNjgwOSwgMTUxODY1MTQsIDE1MTkwOTMyLCA4NjY2MTY5LCAxMTM1NjQ5MCwgMTQwNDk2NDMsIDE1MTc3MzcyLCA4MDc3NjgzLCAxMDgzNDMyNCwgMTM1Mjg1MDksIDE0NTg5NjU0IF0ubWFwKGQzX3JnYlN0cmluZyk7CiAgdmFyIGQzX2NhdGVnb3J5MjBjID0gWyAzMjQ0NzMzLCA3MDU3MTEwLCAxMDQwNjYyNSwgMTMwMzI0MzEsIDE1MDk1MDUzLCAxNjYxNjc2NCwgMTY2MjUyNTksIDE2NjM0MDE4LCAzMjUzMDc2LCA3NjUyNDcwLCAxMDYwNzAwMywgMTMxMDE1MDQsIDc2OTUyODEsIDEwMzk0MzEyLCAxMjM2OTM3MiwgMTQzNDI4OTEsIDY1MTM1MDcsIDk4Njg5NTAsIDEyNDM0ODc3LCAxNDI3NzA4MSBdLm1hcChkM19yZ2JTdHJpbmcpOwogIGQzLnNjYWxlLnF1YW50aWxlID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZDNfc2NhbGVfcXVhbnRpbGUoW10sIFtdKTsKICB9OwogIGZ1bmN0aW9uIGQzX3NjYWxlX3F1YW50aWxlKGRvbWFpbiwgcmFuZ2UpIHsKICAgIHZhciB0aHJlc2hvbGRzOwogICAgZnVuY3Rpb24gcmVzY2FsZSgpIHsKICAgICAgdmFyIGsgPSAwLCBxID0gcmFuZ2UubGVuZ3RoOwogICAgICB0aHJlc2hvbGRzID0gW107CiAgICAgIHdoaWxlICgrK2sgPCBxKSB0aHJlc2hvbGRzW2sgLSAxXSA9IGQzLnF1YW50aWxlKGRvbWFpbiwgayAvIHEpOwogICAgICByZXR1cm4gc2NhbGU7CiAgICB9CiAgICBmdW5jdGlvbiBzY2FsZSh4KSB7CiAgICAgIGlmICghaXNOYU4oeCA9ICt4KSkgcmV0dXJuIHJhbmdlW2QzLmJpc2VjdCh0aHJlc2hvbGRzLCB4KV07CiAgICB9CiAgICBzY2FsZS5kb21haW4gPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGRvbWFpbjsKICAgICAgZG9tYWluID0geC5tYXAoZDNfbnVtYmVyKS5maWx0ZXIoZDNfbnVtZXJpYykuc29ydChkM19hc2NlbmRpbmcpOwogICAgICByZXR1cm4gcmVzY2FsZSgpOwogICAgfTsKICAgIHNjYWxlLnJhbmdlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiByYW5nZTsKICAgICAgcmFuZ2UgPSB4OwogICAgICByZXR1cm4gcmVzY2FsZSgpOwogICAgfTsKICAgIHNjYWxlLnF1YW50aWxlcyA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhyZXNob2xkczsKICAgIH07CiAgICBzY2FsZS5pbnZlcnRFeHRlbnQgPSBmdW5jdGlvbih5KSB7CiAgICAgIHkgPSByYW5nZS5pbmRleE9mKHkpOwogICAgICByZXR1cm4geSA8IDAgPyBbIE5hTiwgTmFOIF0gOiBbIHkgPiAwID8gdGhyZXNob2xkc1t5IC0gMV0gOiBkb21haW5bMF0sIHkgPCB0aHJlc2hvbGRzLmxlbmd0aCA/IHRocmVzaG9sZHNbeV0gOiBkb21haW5bZG9tYWluLmxlbmd0aCAtIDFdIF07CiAgICB9OwogICAgc2NhbGUuY29weSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZDNfc2NhbGVfcXVhbnRpbGUoZG9tYWluLCByYW5nZSk7CiAgICB9OwogICAgcmV0dXJuIHJlc2NhbGUoKTsKICB9CiAgZDMuc2NhbGUucXVhbnRpemUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM19zY2FsZV9xdWFudGl6ZSgwLCAxLCBbIDAsIDEgXSk7CiAgfTsKICBmdW5jdGlvbiBkM19zY2FsZV9xdWFudGl6ZSh4MCwgeDEsIHJhbmdlKSB7CiAgICB2YXIga3gsIGk7CiAgICBmdW5jdGlvbiBzY2FsZSh4KSB7CiAgICAgIHJldHVybiByYW5nZVtNYXRoLm1heCgwLCBNYXRoLm1pbihpLCBNYXRoLmZsb29yKGt4ICogKHggLSB4MCkpKSldOwogICAgfQogICAgZnVuY3Rpb24gcmVzY2FsZSgpIHsKICAgICAga3ggPSByYW5nZS5sZW5ndGggLyAoeDEgLSB4MCk7CiAgICAgIGkgPSByYW5nZS5sZW5ndGggLSAxOwogICAgICByZXR1cm4gc2NhbGU7CiAgICB9CiAgICBzY2FsZS5kb21haW4gPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIFsgeDAsIHgxIF07CiAgICAgIHgwID0gK3hbMF07CiAgICAgIHgxID0gK3hbeC5sZW5ndGggLSAxXTsKICAgICAgcmV0dXJuIHJlc2NhbGUoKTsKICAgIH07CiAgICBzY2FsZS5yYW5nZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gcmFuZ2U7CiAgICAgIHJhbmdlID0geDsKICAgICAgcmV0dXJuIHJlc2NhbGUoKTsKICAgIH07CiAgICBzY2FsZS5pbnZlcnRFeHRlbnQgPSBmdW5jdGlvbih5KSB7CiAgICAgIHkgPSByYW5nZS5pbmRleE9mKHkpOwogICAgICB5ID0geSA8IDAgPyBOYU4gOiB5IC8ga3ggKyB4MDsKICAgICAgcmV0dXJuIFsgeSwgeSArIDEgLyBreCBdOwogICAgfTsKICAgIHNjYWxlLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX3NjYWxlX3F1YW50aXplKHgwLCB4MSwgcmFuZ2UpOwogICAgfTsKICAgIHJldHVybiByZXNjYWxlKCk7CiAgfQogIGQzLnNjYWxlLnRocmVzaG9sZCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX3NjYWxlX3RocmVzaG9sZChbIC41IF0sIFsgMCwgMSBdKTsKICB9OwogIGZ1bmN0aW9uIGQzX3NjYWxlX3RocmVzaG9sZChkb21haW4sIHJhbmdlKSB7CiAgICBmdW5jdGlvbiBzY2FsZSh4KSB7CiAgICAgIGlmICh4IDw9IHgpIHJldHVybiByYW5nZVtkMy5iaXNlY3QoZG9tYWluLCB4KV07CiAgICB9CiAgICBzY2FsZS5kb21haW4gPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGRvbWFpbjsKICAgICAgZG9tYWluID0gXzsKICAgICAgcmV0dXJuIHNjYWxlOwogICAgfTsKICAgIHNjYWxlLnJhbmdlID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiByYW5nZTsKICAgICAgcmFuZ2UgPSBfOwogICAgICByZXR1cm4gc2NhbGU7CiAgICB9OwogICAgc2NhbGUuaW52ZXJ0RXh0ZW50ID0gZnVuY3Rpb24oeSkgewogICAgICB5ID0gcmFuZ2UuaW5kZXhPZih5KTsKICAgICAgcmV0dXJuIFsgZG9tYWluW3kgLSAxXSwgZG9tYWluW3ldIF07CiAgICB9OwogICAgc2NhbGUuY29weSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZDNfc2NhbGVfdGhyZXNob2xkKGRvbWFpbiwgcmFuZ2UpOwogICAgfTsKICAgIHJldHVybiBzY2FsZTsKICB9CiAgZDMuc2NhbGUuaWRlbnRpdHkgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM19zY2FsZV9pZGVudGl0eShbIDAsIDEgXSk7CiAgfTsKICBmdW5jdGlvbiBkM19zY2FsZV9pZGVudGl0eShkb21haW4pIHsKICAgIGZ1bmN0aW9uIGlkZW50aXR5KHgpIHsKICAgICAgcmV0dXJuICt4OwogICAgfQogICAgaWRlbnRpdHkuaW52ZXJ0ID0gaWRlbnRpdHk7CiAgICBpZGVudGl0eS5kb21haW4gPSBpZGVudGl0eS5yYW5nZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gZG9tYWluOwogICAgICBkb21haW4gPSB4Lm1hcChpZGVudGl0eSk7CiAgICAgIHJldHVybiBpZGVudGl0eTsKICAgIH07CiAgICBpZGVudGl0eS50aWNrcyA9IGZ1bmN0aW9uKG0pIHsKICAgICAgcmV0dXJuIGQzX3NjYWxlX2xpbmVhclRpY2tzKGRvbWFpbiwgbSk7CiAgICB9OwogICAgaWRlbnRpdHkudGlja0Zvcm1hdCA9IGZ1bmN0aW9uKG0sIGZvcm1hdCkgewogICAgICByZXR1cm4gZDNfc2NhbGVfbGluZWFyVGlja0Zvcm1hdChkb21haW4sIG0sIGZvcm1hdCk7CiAgICB9OwogICAgaWRlbnRpdHkuY29weSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZDNfc2NhbGVfaWRlbnRpdHkoZG9tYWluKTsKICAgIH07CiAgICByZXR1cm4gaWRlbnRpdHk7CiAgfQogIGQzLnN2ZyA9IHt9OwogIGZ1bmN0aW9uIGQzX3plcm8oKSB7CiAgICByZXR1cm4gMDsKICB9CiAgZDMuc3ZnLmFyYyA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGlubmVyUmFkaXVzID0gZDNfc3ZnX2FyY0lubmVyUmFkaXVzLCBvdXRlclJhZGl1cyA9IGQzX3N2Z19hcmNPdXRlclJhZGl1cywgY29ybmVyUmFkaXVzID0gZDNfemVybywgcGFkUmFkaXVzID0gZDNfc3ZnX2FyY0F1dG8sIHN0YXJ0QW5nbGUgPSBkM19zdmdfYXJjU3RhcnRBbmdsZSwgZW5kQW5nbGUgPSBkM19zdmdfYXJjRW5kQW5nbGUsIHBhZEFuZ2xlID0gZDNfc3ZnX2FyY1BhZEFuZ2xlOwogICAgZnVuY3Rpb24gYXJjKCkgewogICAgICB2YXIgcjAgPSBNYXRoLm1heCgwLCAraW5uZXJSYWRpdXMuYXBwbHkodGhpcywgYXJndW1lbnRzKSksIHIxID0gTWF0aC5tYXgoMCwgK291dGVyUmFkaXVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpLCBhMCA9IHN0YXJ0QW5nbGUuYXBwbHkodGhpcywgYXJndW1lbnRzKSAtIGhhbGbPgCwgYTEgPSBlbmRBbmdsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIC0gaGFsZs+ALCBkYSA9IE1hdGguYWJzKGExIC0gYTApLCBjdyA9IGEwID4gYTEgPyAwIDogMTsKICAgICAgaWYgKHIxIDwgcjApIHJjID0gcjEsIHIxID0gcjAsIHIwID0gcmM7CiAgICAgIGlmIChkYSA+PSDPhM61KSByZXR1cm4gY2lyY2xlU2VnbWVudChyMSwgY3cpICsgKHIwID8gY2lyY2xlU2VnbWVudChyMCwgMSAtIGN3KSA6ICIiKSArICJaIjsKICAgICAgdmFyIHJjLCBjciwgcnAsIGFwLCBwMCA9IDAsIHAxID0gMCwgeDAsIHkwLCB4MSwgeTEsIHgyLCB5MiwgeDMsIHkzLCBwYXRoID0gW107CiAgICAgIGlmIChhcCA9ICgrcGFkQW5nbGUuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCAwKSAvIDIpIHsKICAgICAgICBycCA9IHBhZFJhZGl1cyA9PT0gZDNfc3ZnX2FyY0F1dG8gPyBNYXRoLnNxcnQocjAgKiByMCArIHIxICogcjEpIDogK3BhZFJhZGl1cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIGlmICghY3cpIHAxICo9IC0xOwogICAgICAgIGlmIChyMSkgcDEgPSBkM19hc2luKHJwIC8gcjEgKiBNYXRoLnNpbihhcCkpOwogICAgICAgIGlmIChyMCkgcDAgPSBkM19hc2luKHJwIC8gcjAgKiBNYXRoLnNpbihhcCkpOwogICAgICB9CiAgICAgIGlmIChyMSkgewogICAgICAgIHgwID0gcjEgKiBNYXRoLmNvcyhhMCArIHAxKTsKICAgICAgICB5MCA9IHIxICogTWF0aC5zaW4oYTAgKyBwMSk7CiAgICAgICAgeDEgPSByMSAqIE1hdGguY29zKGExIC0gcDEpOwogICAgICAgIHkxID0gcjEgKiBNYXRoLnNpbihhMSAtIHAxKTsKICAgICAgICB2YXIgbDEgPSBNYXRoLmFicyhhMSAtIGEwIC0gMiAqIHAxKSA8PSDPgCA/IDAgOiAxOwogICAgICAgIGlmIChwMSAmJiBkM19zdmdfYXJjU3dlZXAoeDAsIHkwLCB4MSwgeTEpID09PSBjdyBeIGwxKSB7CiAgICAgICAgICB2YXIgaDEgPSAoYTAgKyBhMSkgLyAyOwogICAgICAgICAgeDAgPSByMSAqIE1hdGguY29zKGgxKTsKICAgICAgICAgIHkwID0gcjEgKiBNYXRoLnNpbihoMSk7CiAgICAgICAgICB4MSA9IHkxID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgeDAgPSB5MCA9IDA7CiAgICAgIH0KICAgICAgaWYgKHIwKSB7CiAgICAgICAgeDIgPSByMCAqIE1hdGguY29zKGExIC0gcDApOwogICAgICAgIHkyID0gcjAgKiBNYXRoLnNpbihhMSAtIHAwKTsKICAgICAgICB4MyA9IHIwICogTWF0aC5jb3MoYTAgKyBwMCk7CiAgICAgICAgeTMgPSByMCAqIE1hdGguc2luKGEwICsgcDApOwogICAgICAgIHZhciBsMCA9IE1hdGguYWJzKGEwIC0gYTEgKyAyICogcDApIDw9IM+AID8gMCA6IDE7CiAgICAgICAgaWYgKHAwICYmIGQzX3N2Z19hcmNTd2VlcCh4MiwgeTIsIHgzLCB5MykgPT09IDEgLSBjdyBeIGwwKSB7CiAgICAgICAgICB2YXIgaDAgPSAoYTAgKyBhMSkgLyAyOwogICAgICAgICAgeDIgPSByMCAqIE1hdGguY29zKGgwKTsKICAgICAgICAgIHkyID0gcjAgKiBNYXRoLnNpbihoMCk7CiAgICAgICAgICB4MyA9IHkzID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgeDIgPSB5MiA9IDA7CiAgICAgIH0KICAgICAgaWYgKChyYyA9IE1hdGgubWluKE1hdGguYWJzKHIxIC0gcjApIC8gMiwgK2Nvcm5lclJhZGl1cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSkgPiAuMDAxKSB7CiAgICAgICAgY3IgPSByMCA8IHIxIF4gY3cgPyAwIDogMTsKICAgICAgICB2YXIgb2MgPSB4MyA9PSBudWxsID8gWyB4MiwgeTIgXSA6IHgxID09IG51bGwgPyBbIHgwLCB5MCBdIDogZDNfZ2VvbV9wb2x5Z29uSW50ZXJzZWN0KFsgeDAsIHkwIF0sIFsgeDMsIHkzIF0sIFsgeDEsIHkxIF0sIFsgeDIsIHkyIF0pLCBheCA9IHgwIC0gb2NbMF0sIGF5ID0geTAgLSBvY1sxXSwgYnggPSB4MSAtIG9jWzBdLCBieSA9IHkxIC0gb2NbMV0sIGtjID0gMSAvIE1hdGguc2luKE1hdGguYWNvcygoYXggKiBieCArIGF5ICogYnkpIC8gKE1hdGguc3FydChheCAqIGF4ICsgYXkgKiBheSkgKiBNYXRoLnNxcnQoYnggKiBieCArIGJ5ICogYnkpKSkgLyAyKSwgbGMgPSBNYXRoLnNxcnQob2NbMF0gKiBvY1swXSArIG9jWzFdICogb2NbMV0pOwogICAgICAgIGlmICh4MSAhPSBudWxsKSB7CiAgICAgICAgICB2YXIgcmMxID0gTWF0aC5taW4ocmMsIChyMSAtIGxjKSAvIChrYyArIDEpKSwgdDMwID0gZDNfc3ZnX2FyY0Nvcm5lclRhbmdlbnRzKHgzID09IG51bGwgPyBbIHgyLCB5MiBdIDogWyB4MywgeTMgXSwgWyB4MCwgeTAgXSwgcjEsIHJjMSwgY3cpLCB0MTIgPSBkM19zdmdfYXJjQ29ybmVyVGFuZ2VudHMoWyB4MSwgeTEgXSwgWyB4MiwgeTIgXSwgcjEsIHJjMSwgY3cpOwogICAgICAgICAgaWYgKHJjID09PSByYzEpIHsKICAgICAgICAgICAgcGF0aC5wdXNoKCJNIiwgdDMwWzBdLCAiQSIsIHJjMSwgIiwiLCByYzEsICIgMCAwLCIsIGNyLCAiICIsIHQzMFsxXSwgIkEiLCByMSwgIiwiLCByMSwgIiAwICIsIDEgLSBjdyBeIGQzX3N2Z19hcmNTd2VlcCh0MzBbMV1bMF0sIHQzMFsxXVsxXSwgdDEyWzFdWzBdLCB0MTJbMV1bMV0pLCAiLCIsIGN3LCAiICIsIHQxMlsxXSwgIkEiLCByYzEsICIsIiwgcmMxLCAiIDAgMCwiLCBjciwgIiAiLCB0MTJbMF0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcGF0aC5wdXNoKCJNIiwgdDMwWzBdLCAiQSIsIHJjMSwgIiwiLCByYzEsICIgMCAxLCIsIGNyLCAiICIsIHQxMlswXSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBhdGgucHVzaCgiTSIsIHgwLCAiLCIsIHkwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHgzICE9IG51bGwpIHsKICAgICAgICAgIHZhciByYzAgPSBNYXRoLm1pbihyYywgKHIwIC0gbGMpIC8gKGtjIC0gMSkpLCB0MDMgPSBkM19zdmdfYXJjQ29ybmVyVGFuZ2VudHMoWyB4MCwgeTAgXSwgWyB4MywgeTMgXSwgcjAsIC1yYzAsIGN3KSwgdDIxID0gZDNfc3ZnX2FyY0Nvcm5lclRhbmdlbnRzKFsgeDIsIHkyIF0sIHgxID09IG51bGwgPyBbIHgwLCB5MCBdIDogWyB4MSwgeTEgXSwgcjAsIC1yYzAsIGN3KTsKICAgICAgICAgIGlmIChyYyA9PT0gcmMwKSB7CiAgICAgICAgICAgIHBhdGgucHVzaCgiTCIsIHQyMVswXSwgIkEiLCByYzAsICIsIiwgcmMwLCAiIDAgMCwiLCBjciwgIiAiLCB0MjFbMV0sICJBIiwgcjAsICIsIiwgcjAsICIgMCAiLCBjdyBeIGQzX3N2Z19hcmNTd2VlcCh0MjFbMV1bMF0sIHQyMVsxXVsxXSwgdDAzWzFdWzBdLCB0MDNbMV1bMV0pLCAiLCIsIDEgLSBjdywgIiAiLCB0MDNbMV0sICJBIiwgcmMwLCAiLCIsIHJjMCwgIiAwIDAsIiwgY3IsICIgIiwgdDAzWzBdKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBhdGgucHVzaCgiTCIsIHQyMVswXSwgIkEiLCByYzAsICIsIiwgcmMwLCAiIDAgMCwiLCBjciwgIiAiLCB0MDNbMF0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwYXRoLnB1c2goIkwiLCB4MiwgIiwiLCB5Mik7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHBhdGgucHVzaCgiTSIsIHgwLCAiLCIsIHkwKTsKICAgICAgICBpZiAoeDEgIT0gbnVsbCkgcGF0aC5wdXNoKCJBIiwgcjEsICIsIiwgcjEsICIgMCAiLCBsMSwgIiwiLCBjdywgIiAiLCB4MSwgIiwiLCB5MSk7CiAgICAgICAgcGF0aC5wdXNoKCJMIiwgeDIsICIsIiwgeTIpOwogICAgICAgIGlmICh4MyAhPSBudWxsKSBwYXRoLnB1c2goIkEiLCByMCwgIiwiLCByMCwgIiAwICIsIGwwLCAiLCIsIDEgLSBjdywgIiAiLCB4MywgIiwiLCB5Myk7CiAgICAgIH0KICAgICAgcGF0aC5wdXNoKCJaIik7CiAgICAgIHJldHVybiBwYXRoLmpvaW4oIiIpOwogICAgfQogICAgZnVuY3Rpb24gY2lyY2xlU2VnbWVudChyMSwgY3cpIHsKICAgICAgcmV0dXJuICJNMCwiICsgcjEgKyAiQSIgKyByMSArICIsIiArIHIxICsgIiAwIDEsIiArIGN3ICsgIiAwLCIgKyAtcjEgKyAiQSIgKyByMSArICIsIiArIHIxICsgIiAwIDEsIiArIGN3ICsgIiAwLCIgKyByMTsKICAgIH0KICAgIGFyYy5pbm5lclJhZGl1cyA9IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gaW5uZXJSYWRpdXM7CiAgICAgIGlubmVyUmFkaXVzID0gZDNfZnVuY3Rvcih2KTsKICAgICAgcmV0dXJuIGFyYzsKICAgIH07CiAgICBhcmMub3V0ZXJSYWRpdXMgPSBmdW5jdGlvbih2KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIG91dGVyUmFkaXVzOwogICAgICBvdXRlclJhZGl1cyA9IGQzX2Z1bmN0b3Iodik7CiAgICAgIHJldHVybiBhcmM7CiAgICB9OwogICAgYXJjLmNvcm5lclJhZGl1cyA9IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gY29ybmVyUmFkaXVzOwogICAgICBjb3JuZXJSYWRpdXMgPSBkM19mdW5jdG9yKHYpOwogICAgICByZXR1cm4gYXJjOwogICAgfTsKICAgIGFyYy5wYWRSYWRpdXMgPSBmdW5jdGlvbih2KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHBhZFJhZGl1czsKICAgICAgcGFkUmFkaXVzID0gdiA9PSBkM19zdmdfYXJjQXV0byA/IGQzX3N2Z19hcmNBdXRvIDogZDNfZnVuY3Rvcih2KTsKICAgICAgcmV0dXJuIGFyYzsKICAgIH07CiAgICBhcmMuc3RhcnRBbmdsZSA9IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc3RhcnRBbmdsZTsKICAgICAgc3RhcnRBbmdsZSA9IGQzX2Z1bmN0b3Iodik7CiAgICAgIHJldHVybiBhcmM7CiAgICB9OwogICAgYXJjLmVuZEFuZ2xlID0gZnVuY3Rpb24odikgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBlbmRBbmdsZTsKICAgICAgZW5kQW5nbGUgPSBkM19mdW5jdG9yKHYpOwogICAgICByZXR1cm4gYXJjOwogICAgfTsKICAgIGFyYy5wYWRBbmdsZSA9IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gcGFkQW5nbGU7CiAgICAgIHBhZEFuZ2xlID0gZDNfZnVuY3Rvcih2KTsKICAgICAgcmV0dXJuIGFyYzsKICAgIH07CiAgICBhcmMuY2VudHJvaWQgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHIgPSAoK2lubmVyUmFkaXVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgKyArb3V0ZXJSYWRpdXMuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgLyAyLCBhID0gKCtzdGFydEFuZ2xlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgKyArZW5kQW5nbGUuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgLyAyIC0gaGFsZs+AOwogICAgICByZXR1cm4gWyBNYXRoLmNvcyhhKSAqIHIsIE1hdGguc2luKGEpICogciBdOwogICAgfTsKICAgIHJldHVybiBhcmM7CiAgfTsKICB2YXIgZDNfc3ZnX2FyY0F1dG8gPSAiYXV0byI7CiAgZnVuY3Rpb24gZDNfc3ZnX2FyY0lubmVyUmFkaXVzKGQpIHsKICAgIHJldHVybiBkLmlubmVyUmFkaXVzOwogIH0KICBmdW5jdGlvbiBkM19zdmdfYXJjT3V0ZXJSYWRpdXMoZCkgewogICAgcmV0dXJuIGQub3V0ZXJSYWRpdXM7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19hcmNTdGFydEFuZ2xlKGQpIHsKICAgIHJldHVybiBkLnN0YXJ0QW5nbGU7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19hcmNFbmRBbmdsZShkKSB7CiAgICByZXR1cm4gZC5lbmRBbmdsZTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2FyY1BhZEFuZ2xlKGQpIHsKICAgIHJldHVybiBkICYmIGQucGFkQW5nbGU7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19hcmNTd2VlcCh4MCwgeTAsIHgxLCB5MSkgewogICAgcmV0dXJuICh4MCAtIHgxKSAqIHkwIC0gKHkwIC0geTEpICogeDAgPiAwID8gMCA6IDE7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19hcmNDb3JuZXJUYW5nZW50cyhwMCwgcDEsIHIxLCByYywgY3cpIHsKICAgIHZhciB4MDEgPSBwMFswXSAtIHAxWzBdLCB5MDEgPSBwMFsxXSAtIHAxWzFdLCBsbyA9IChjdyA/IHJjIDogLXJjKSAvIE1hdGguc3FydCh4MDEgKiB4MDEgKyB5MDEgKiB5MDEpLCBveCA9IGxvICogeTAxLCBveSA9IC1sbyAqIHgwMSwgeDEgPSBwMFswXSArIG94LCB5MSA9IHAwWzFdICsgb3ksIHgyID0gcDFbMF0gKyBveCwgeTIgPSBwMVsxXSArIG95LCB4MyA9ICh4MSArIHgyKSAvIDIsIHkzID0gKHkxICsgeTIpIC8gMiwgZHggPSB4MiAtIHgxLCBkeSA9IHkyIC0geTEsIGQyID0gZHggKiBkeCArIGR5ICogZHksIHIgPSByMSAtIHJjLCBEID0geDEgKiB5MiAtIHgyICogeTEsIGQgPSAoZHkgPCAwID8gLTEgOiAxKSAqIE1hdGguc3FydChyICogciAqIGQyIC0gRCAqIEQpLCBjeDAgPSAoRCAqIGR5IC0gZHggKiBkKSAvIGQyLCBjeTAgPSAoLUQgKiBkeCAtIGR5ICogZCkgLyBkMiwgY3gxID0gKEQgKiBkeSArIGR4ICogZCkgLyBkMiwgY3kxID0gKC1EICogZHggKyBkeSAqIGQpIC8gZDIsIGR4MCA9IGN4MCAtIHgzLCBkeTAgPSBjeTAgLSB5MywgZHgxID0gY3gxIC0geDMsIGR5MSA9IGN5MSAtIHkzOwogICAgaWYgKGR4MCAqIGR4MCArIGR5MCAqIGR5MCA+IGR4MSAqIGR4MSArIGR5MSAqIGR5MSkgY3gwID0gY3gxLCBjeTAgPSBjeTE7CiAgICByZXR1cm4gWyBbIGN4MCAtIG94LCBjeTAgLSBveSBdLCBbIGN4MCAqIHIxIC8gciwgY3kwICogcjEgLyByIF0gXTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmUocHJvamVjdGlvbikgewogICAgdmFyIHggPSBkM19nZW9tX3BvaW50WCwgeSA9IGQzX2dlb21fcG9pbnRZLCBkZWZpbmVkID0gZDNfdHJ1ZSwgaW50ZXJwb2xhdGUgPSBkM19zdmdfbGluZUxpbmVhciwgaW50ZXJwb2xhdGVLZXkgPSBpbnRlcnBvbGF0ZS5rZXksIHRlbnNpb24gPSAuNzsKICAgIGZ1bmN0aW9uIGxpbmUoZGF0YSkgewogICAgICB2YXIgc2VnbWVudHMgPSBbXSwgcG9pbnRzID0gW10sIGkgPSAtMSwgbiA9IGRhdGEubGVuZ3RoLCBkLCBmeCA9IGQzX2Z1bmN0b3IoeCksIGZ5ID0gZDNfZnVuY3Rvcih5KTsKICAgICAgZnVuY3Rpb24gc2VnbWVudCgpIHsKICAgICAgICBzZWdtZW50cy5wdXNoKCJNIiwgaW50ZXJwb2xhdGUocHJvamVjdGlvbihwb2ludHMpLCB0ZW5zaW9uKSk7CiAgICAgIH0KICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICBpZiAoZGVmaW5lZC5jYWxsKHRoaXMsIGQgPSBkYXRhW2ldLCBpKSkgewogICAgICAgICAgcG9pbnRzLnB1c2goWyArZnguY2FsbCh0aGlzLCBkLCBpKSwgK2Z5LmNhbGwodGhpcywgZCwgaSkgXSk7CiAgICAgICAgfSBlbHNlIGlmIChwb2ludHMubGVuZ3RoKSB7CiAgICAgICAgICBzZWdtZW50KCk7CiAgICAgICAgICBwb2ludHMgPSBbXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHBvaW50cy5sZW5ndGgpIHNlZ21lbnQoKTsKICAgICAgcmV0dXJuIHNlZ21lbnRzLmxlbmd0aCA/IHNlZ21lbnRzLmpvaW4oIiIpIDogbnVsbDsKICAgIH0KICAgIGxpbmUueCA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4geDsKICAgICAgeCA9IF87CiAgICAgIHJldHVybiBsaW5lOwogICAgfTsKICAgIGxpbmUueSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4geTsKICAgICAgeSA9IF87CiAgICAgIHJldHVybiBsaW5lOwogICAgfTsKICAgIGxpbmUuZGVmaW5lZCA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gZGVmaW5lZDsKICAgICAgZGVmaW5lZCA9IF87CiAgICAgIHJldHVybiBsaW5lOwogICAgfTsKICAgIGxpbmUuaW50ZXJwb2xhdGUgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGludGVycG9sYXRlS2V5OwogICAgICBpZiAodHlwZW9mIF8gPT09ICJmdW5jdGlvbiIpIGludGVycG9sYXRlS2V5ID0gaW50ZXJwb2xhdGUgPSBfOyBlbHNlIGludGVycG9sYXRlS2V5ID0gKGludGVycG9sYXRlID0gZDNfc3ZnX2xpbmVJbnRlcnBvbGF0b3JzLmdldChfKSB8fCBkM19zdmdfbGluZUxpbmVhcikua2V5OwogICAgICByZXR1cm4gbGluZTsKICAgIH07CiAgICBsaW5lLnRlbnNpb24gPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRlbnNpb247CiAgICAgIHRlbnNpb24gPSBfOwogICAgICByZXR1cm4gbGluZTsKICAgIH07CiAgICByZXR1cm4gbGluZTsKICB9CiAgZDMuc3ZnLmxpbmUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM19zdmdfbGluZShkM19pZGVudGl0eSk7CiAgfTsKICB2YXIgZDNfc3ZnX2xpbmVJbnRlcnBvbGF0b3JzID0gZDMubWFwKHsKICAgIGxpbmVhcjogZDNfc3ZnX2xpbmVMaW5lYXIsCiAgICAibGluZWFyLWNsb3NlZCI6IGQzX3N2Z19saW5lTGluZWFyQ2xvc2VkLAogICAgc3RlcDogZDNfc3ZnX2xpbmVTdGVwLAogICAgInN0ZXAtYmVmb3JlIjogZDNfc3ZnX2xpbmVTdGVwQmVmb3JlLAogICAgInN0ZXAtYWZ0ZXIiOiBkM19zdmdfbGluZVN0ZXBBZnRlciwKICAgIGJhc2lzOiBkM19zdmdfbGluZUJhc2lzLAogICAgImJhc2lzLW9wZW4iOiBkM19zdmdfbGluZUJhc2lzT3BlbiwKICAgICJiYXNpcy1jbG9zZWQiOiBkM19zdmdfbGluZUJhc2lzQ2xvc2VkLAogICAgYnVuZGxlOiBkM19zdmdfbGluZUJ1bmRsZSwKICAgIGNhcmRpbmFsOiBkM19zdmdfbGluZUNhcmRpbmFsLAogICAgImNhcmRpbmFsLW9wZW4iOiBkM19zdmdfbGluZUNhcmRpbmFsT3BlbiwKICAgICJjYXJkaW5hbC1jbG9zZWQiOiBkM19zdmdfbGluZUNhcmRpbmFsQ2xvc2VkLAogICAgbW9ub3RvbmU6IGQzX3N2Z19saW5lTW9ub3RvbmUKICB9KTsKICBkM19zdmdfbGluZUludGVycG9sYXRvcnMuZm9yRWFjaChmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICB2YWx1ZS5rZXkgPSBrZXk7CiAgICB2YWx1ZS5jbG9zZWQgPSAvLWNsb3NlZCQvLnRlc3Qoa2V5KTsKICB9KTsKICBmdW5jdGlvbiBkM19zdmdfbGluZUxpbmVhcihwb2ludHMpIHsKICAgIHJldHVybiBwb2ludHMuam9pbigiTCIpOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZUxpbmVhckNsb3NlZChwb2ludHMpIHsKICAgIHJldHVybiBkM19zdmdfbGluZUxpbmVhcihwb2ludHMpICsgIloiOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZVN0ZXAocG9pbnRzKSB7CiAgICB2YXIgaSA9IDAsIG4gPSBwb2ludHMubGVuZ3RoLCBwID0gcG9pbnRzWzBdLCBwYXRoID0gWyBwWzBdLCAiLCIsIHBbMV0gXTsKICAgIHdoaWxlICgrK2kgPCBuKSBwYXRoLnB1c2goIkgiLCAocFswXSArIChwID0gcG9pbnRzW2ldKVswXSkgLyAyLCAiViIsIHBbMV0pOwogICAgaWYgKG4gPiAxKSBwYXRoLnB1c2goIkgiLCBwWzBdKTsKICAgIHJldHVybiBwYXRoLmpvaW4oIiIpOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZVN0ZXBCZWZvcmUocG9pbnRzKSB7CiAgICB2YXIgaSA9IDAsIG4gPSBwb2ludHMubGVuZ3RoLCBwID0gcG9pbnRzWzBdLCBwYXRoID0gWyBwWzBdLCAiLCIsIHBbMV0gXTsKICAgIHdoaWxlICgrK2kgPCBuKSBwYXRoLnB1c2goIlYiLCAocCA9IHBvaW50c1tpXSlbMV0sICJIIiwgcFswXSk7CiAgICByZXR1cm4gcGF0aC5qb2luKCIiKTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmVTdGVwQWZ0ZXIocG9pbnRzKSB7CiAgICB2YXIgaSA9IDAsIG4gPSBwb2ludHMubGVuZ3RoLCBwID0gcG9pbnRzWzBdLCBwYXRoID0gWyBwWzBdLCAiLCIsIHBbMV0gXTsKICAgIHdoaWxlICgrK2kgPCBuKSBwYXRoLnB1c2goIkgiLCAocCA9IHBvaW50c1tpXSlbMF0sICJWIiwgcFsxXSk7CiAgICByZXR1cm4gcGF0aC5qb2luKCIiKTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmVDYXJkaW5hbE9wZW4ocG9pbnRzLCB0ZW5zaW9uKSB7CiAgICByZXR1cm4gcG9pbnRzLmxlbmd0aCA8IDQgPyBkM19zdmdfbGluZUxpbmVhcihwb2ludHMpIDogcG9pbnRzWzFdICsgZDNfc3ZnX2xpbmVIZXJtaXRlKHBvaW50cy5zbGljZSgxLCAtMSksIGQzX3N2Z19saW5lQ2FyZGluYWxUYW5nZW50cyhwb2ludHMsIHRlbnNpb24pKTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmVDYXJkaW5hbENsb3NlZChwb2ludHMsIHRlbnNpb24pIHsKICAgIHJldHVybiBwb2ludHMubGVuZ3RoIDwgMyA/IGQzX3N2Z19saW5lTGluZWFyKHBvaW50cykgOiBwb2ludHNbMF0gKyBkM19zdmdfbGluZUhlcm1pdGUoKHBvaW50cy5wdXNoKHBvaW50c1swXSksIAogICAgcG9pbnRzKSwgZDNfc3ZnX2xpbmVDYXJkaW5hbFRhbmdlbnRzKFsgcG9pbnRzW3BvaW50cy5sZW5ndGggLSAyXSBdLmNvbmNhdChwb2ludHMsIFsgcG9pbnRzWzFdIF0pLCB0ZW5zaW9uKSk7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19saW5lQ2FyZGluYWwocG9pbnRzLCB0ZW5zaW9uKSB7CiAgICByZXR1cm4gcG9pbnRzLmxlbmd0aCA8IDMgPyBkM19zdmdfbGluZUxpbmVhcihwb2ludHMpIDogcG9pbnRzWzBdICsgZDNfc3ZnX2xpbmVIZXJtaXRlKHBvaW50cywgZDNfc3ZnX2xpbmVDYXJkaW5hbFRhbmdlbnRzKHBvaW50cywgdGVuc2lvbikpOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZUhlcm1pdGUocG9pbnRzLCB0YW5nZW50cykgewogICAgaWYgKHRhbmdlbnRzLmxlbmd0aCA8IDEgfHwgcG9pbnRzLmxlbmd0aCAhPSB0YW5nZW50cy5sZW5ndGggJiYgcG9pbnRzLmxlbmd0aCAhPSB0YW5nZW50cy5sZW5ndGggKyAyKSB7CiAgICAgIHJldHVybiBkM19zdmdfbGluZUxpbmVhcihwb2ludHMpOwogICAgfQogICAgdmFyIHF1YWQgPSBwb2ludHMubGVuZ3RoICE9IHRhbmdlbnRzLmxlbmd0aCwgcGF0aCA9ICIiLCBwMCA9IHBvaW50c1swXSwgcCA9IHBvaW50c1sxXSwgdDAgPSB0YW5nZW50c1swXSwgdCA9IHQwLCBwaSA9IDE7CiAgICBpZiAocXVhZCkgewogICAgICBwYXRoICs9ICJRIiArIChwWzBdIC0gdDBbMF0gKiAyIC8gMykgKyAiLCIgKyAocFsxXSAtIHQwWzFdICogMiAvIDMpICsgIiwiICsgcFswXSArICIsIiArIHBbMV07CiAgICAgIHAwID0gcG9pbnRzWzFdOwogICAgICBwaSA9IDI7CiAgICB9CiAgICBpZiAodGFuZ2VudHMubGVuZ3RoID4gMSkgewogICAgICB0ID0gdGFuZ2VudHNbMV07CiAgICAgIHAgPSBwb2ludHNbcGldOwogICAgICBwaSsrOwogICAgICBwYXRoICs9ICJDIiArIChwMFswXSArIHQwWzBdKSArICIsIiArIChwMFsxXSArIHQwWzFdKSArICIsIiArIChwWzBdIC0gdFswXSkgKyAiLCIgKyAocFsxXSAtIHRbMV0pICsgIiwiICsgcFswXSArICIsIiArIHBbMV07CiAgICAgIGZvciAodmFyIGkgPSAyOyBpIDwgdGFuZ2VudHMubGVuZ3RoOyBpKyssIHBpKyspIHsKICAgICAgICBwID0gcG9pbnRzW3BpXTsKICAgICAgICB0ID0gdGFuZ2VudHNbaV07CiAgICAgICAgcGF0aCArPSAiUyIgKyAocFswXSAtIHRbMF0pICsgIiwiICsgKHBbMV0gLSB0WzFdKSArICIsIiArIHBbMF0gKyAiLCIgKyBwWzFdOwogICAgICB9CiAgICB9CiAgICBpZiAocXVhZCkgewogICAgICB2YXIgbHAgPSBwb2ludHNbcGldOwogICAgICBwYXRoICs9ICJRIiArIChwWzBdICsgdFswXSAqIDIgLyAzKSArICIsIiArIChwWzFdICsgdFsxXSAqIDIgLyAzKSArICIsIiArIGxwWzBdICsgIiwiICsgbHBbMV07CiAgICB9CiAgICByZXR1cm4gcGF0aDsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmVDYXJkaW5hbFRhbmdlbnRzKHBvaW50cywgdGVuc2lvbikgewogICAgdmFyIHRhbmdlbnRzID0gW10sIGEgPSAoMSAtIHRlbnNpb24pIC8gMiwgcDAsIHAxID0gcG9pbnRzWzBdLCBwMiA9IHBvaW50c1sxXSwgaSA9IDEsIG4gPSBwb2ludHMubGVuZ3RoOwogICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgcDAgPSBwMTsKICAgICAgcDEgPSBwMjsKICAgICAgcDIgPSBwb2ludHNbaV07CiAgICAgIHRhbmdlbnRzLnB1c2goWyBhICogKHAyWzBdIC0gcDBbMF0pLCBhICogKHAyWzFdIC0gcDBbMV0pIF0pOwogICAgfQogICAgcmV0dXJuIHRhbmdlbnRzOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZUJhc2lzKHBvaW50cykgewogICAgaWYgKHBvaW50cy5sZW5ndGggPCAzKSByZXR1cm4gZDNfc3ZnX2xpbmVMaW5lYXIocG9pbnRzKTsKICAgIHZhciBpID0gMSwgbiA9IHBvaW50cy5sZW5ndGgsIHBpID0gcG9pbnRzWzBdLCB4MCA9IHBpWzBdLCB5MCA9IHBpWzFdLCBweCA9IFsgeDAsIHgwLCB4MCwgKHBpID0gcG9pbnRzWzFdKVswXSBdLCBweSA9IFsgeTAsIHkwLCB5MCwgcGlbMV0gXSwgcGF0aCA9IFsgeDAsICIsIiwgeTAsICJMIiwgZDNfc3ZnX2xpbmVEb3Q0KGQzX3N2Z19saW5lQmFzaXNCZXppZXIzLCBweCksICIsIiwgZDNfc3ZnX2xpbmVEb3Q0KGQzX3N2Z19saW5lQmFzaXNCZXppZXIzLCBweSkgXTsKICAgIHBvaW50cy5wdXNoKHBvaW50c1tuIC0gMV0pOwogICAgd2hpbGUgKCsraSA8PSBuKSB7CiAgICAgIHBpID0gcG9pbnRzW2ldOwogICAgICBweC5zaGlmdCgpOwogICAgICBweC5wdXNoKHBpWzBdKTsKICAgICAgcHkuc2hpZnQoKTsKICAgICAgcHkucHVzaChwaVsxXSk7CiAgICAgIGQzX3N2Z19saW5lQmFzaXNCZXppZXIocGF0aCwgcHgsIHB5KTsKICAgIH0KICAgIHBvaW50cy5wb3AoKTsKICAgIHBhdGgucHVzaCgiTCIsIHBpKTsKICAgIHJldHVybiBwYXRoLmpvaW4oIiIpOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZUJhc2lzT3Blbihwb2ludHMpIHsKICAgIGlmIChwb2ludHMubGVuZ3RoIDwgNCkgcmV0dXJuIGQzX3N2Z19saW5lTGluZWFyKHBvaW50cyk7CiAgICB2YXIgcGF0aCA9IFtdLCBpID0gLTEsIG4gPSBwb2ludHMubGVuZ3RoLCBwaSwgcHggPSBbIDAgXSwgcHkgPSBbIDAgXTsKICAgIHdoaWxlICgrK2kgPCAzKSB7CiAgICAgIHBpID0gcG9pbnRzW2ldOwogICAgICBweC5wdXNoKHBpWzBdKTsKICAgICAgcHkucHVzaChwaVsxXSk7CiAgICB9CiAgICBwYXRoLnB1c2goZDNfc3ZnX2xpbmVEb3Q0KGQzX3N2Z19saW5lQmFzaXNCZXppZXIzLCBweCkgKyAiLCIgKyBkM19zdmdfbGluZURvdDQoZDNfc3ZnX2xpbmVCYXNpc0JlemllcjMsIHB5KSk7CiAgICAtLWk7CiAgICB3aGlsZSAoKytpIDwgbikgewogICAgICBwaSA9IHBvaW50c1tpXTsKICAgICAgcHguc2hpZnQoKTsKICAgICAgcHgucHVzaChwaVswXSk7CiAgICAgIHB5LnNoaWZ0KCk7CiAgICAgIHB5LnB1c2gocGlbMV0pOwogICAgICBkM19zdmdfbGluZUJhc2lzQmV6aWVyKHBhdGgsIHB4LCBweSk7CiAgICB9CiAgICByZXR1cm4gcGF0aC5qb2luKCIiKTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmVCYXNpc0Nsb3NlZChwb2ludHMpIHsKICAgIHZhciBwYXRoLCBpID0gLTEsIG4gPSBwb2ludHMubGVuZ3RoLCBtID0gbiArIDQsIHBpLCBweCA9IFtdLCBweSA9IFtdOwogICAgd2hpbGUgKCsraSA8IDQpIHsKICAgICAgcGkgPSBwb2ludHNbaSAlIG5dOwogICAgICBweC5wdXNoKHBpWzBdKTsKICAgICAgcHkucHVzaChwaVsxXSk7CiAgICB9CiAgICBwYXRoID0gWyBkM19zdmdfbGluZURvdDQoZDNfc3ZnX2xpbmVCYXNpc0JlemllcjMsIHB4KSwgIiwiLCBkM19zdmdfbGluZURvdDQoZDNfc3ZnX2xpbmVCYXNpc0JlemllcjMsIHB5KSBdOwogICAgLS1pOwogICAgd2hpbGUgKCsraSA8IG0pIHsKICAgICAgcGkgPSBwb2ludHNbaSAlIG5dOwogICAgICBweC5zaGlmdCgpOwogICAgICBweC5wdXNoKHBpWzBdKTsKICAgICAgcHkuc2hpZnQoKTsKICAgICAgcHkucHVzaChwaVsxXSk7CiAgICAgIGQzX3N2Z19saW5lQmFzaXNCZXppZXIocGF0aCwgcHgsIHB5KTsKICAgIH0KICAgIHJldHVybiBwYXRoLmpvaW4oIiIpOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZUJ1bmRsZShwb2ludHMsIHRlbnNpb24pIHsKICAgIHZhciBuID0gcG9pbnRzLmxlbmd0aCAtIDE7CiAgICBpZiAobikgewogICAgICB2YXIgeDAgPSBwb2ludHNbMF1bMF0sIHkwID0gcG9pbnRzWzBdWzFdLCBkeCA9IHBvaW50c1tuXVswXSAtIHgwLCBkeSA9IHBvaW50c1tuXVsxXSAtIHkwLCBpID0gLTEsIHAsIHQ7CiAgICAgIHdoaWxlICgrK2kgPD0gbikgewogICAgICAgIHAgPSBwb2ludHNbaV07CiAgICAgICAgdCA9IGkgLyBuOwogICAgICAgIHBbMF0gPSB0ZW5zaW9uICogcFswXSArICgxIC0gdGVuc2lvbikgKiAoeDAgKyB0ICogZHgpOwogICAgICAgIHBbMV0gPSB0ZW5zaW9uICogcFsxXSArICgxIC0gdGVuc2lvbikgKiAoeTAgKyB0ICogZHkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZDNfc3ZnX2xpbmVCYXNpcyhwb2ludHMpOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZURvdDQoYSwgYikgewogICAgcmV0dXJuIGFbMF0gKiBiWzBdICsgYVsxXSAqIGJbMV0gKyBhWzJdICogYlsyXSArIGFbM10gKiBiWzNdOwogIH0KICB2YXIgZDNfc3ZnX2xpbmVCYXNpc0JlemllcjEgPSBbIDAsIDIgLyAzLCAxIC8gMywgMCBdLCBkM19zdmdfbGluZUJhc2lzQmV6aWVyMiA9IFsgMCwgMSAvIDMsIDIgLyAzLCAwIF0sIGQzX3N2Z19saW5lQmFzaXNCZXppZXIzID0gWyAwLCAxIC8gNiwgMiAvIDMsIDEgLyA2IF07CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmVCYXNpc0JlemllcihwYXRoLCB4LCB5KSB7CiAgICBwYXRoLnB1c2goIkMiLCBkM19zdmdfbGluZURvdDQoZDNfc3ZnX2xpbmVCYXNpc0JlemllcjEsIHgpLCAiLCIsIGQzX3N2Z19saW5lRG90NChkM19zdmdfbGluZUJhc2lzQmV6aWVyMSwgeSksICIsIiwgZDNfc3ZnX2xpbmVEb3Q0KGQzX3N2Z19saW5lQmFzaXNCZXppZXIyLCB4KSwgIiwiLCBkM19zdmdfbGluZURvdDQoZDNfc3ZnX2xpbmVCYXNpc0JlemllcjIsIHkpLCAiLCIsIGQzX3N2Z19saW5lRG90NChkM19zdmdfbGluZUJhc2lzQmV6aWVyMywgeCksICIsIiwgZDNfc3ZnX2xpbmVEb3Q0KGQzX3N2Z19saW5lQmFzaXNCZXppZXIzLCB5KSk7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19saW5lU2xvcGUocDAsIHAxKSB7CiAgICByZXR1cm4gKHAxWzFdIC0gcDBbMV0pIC8gKHAxWzBdIC0gcDBbMF0pOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZUZpbml0ZURpZmZlcmVuY2VzKHBvaW50cykgewogICAgdmFyIGkgPSAwLCBqID0gcG9pbnRzLmxlbmd0aCAtIDEsIG0gPSBbXSwgcDAgPSBwb2ludHNbMF0sIHAxID0gcG9pbnRzWzFdLCBkID0gbVswXSA9IGQzX3N2Z19saW5lU2xvcGUocDAsIHAxKTsKICAgIHdoaWxlICgrK2kgPCBqKSB7CiAgICAgIG1baV0gPSAoZCArIChkID0gZDNfc3ZnX2xpbmVTbG9wZShwMCA9IHAxLCBwMSA9IHBvaW50c1tpICsgMV0pKSkgLyAyOwogICAgfQogICAgbVtpXSA9IGQ7CiAgICByZXR1cm4gbTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmVNb25vdG9uZVRhbmdlbnRzKHBvaW50cykgewogICAgdmFyIHRhbmdlbnRzID0gW10sIGQsIGEsIGIsIHMsIG0gPSBkM19zdmdfbGluZUZpbml0ZURpZmZlcmVuY2VzKHBvaW50cyksIGkgPSAtMSwgaiA9IHBvaW50cy5sZW5ndGggLSAxOwogICAgd2hpbGUgKCsraSA8IGopIHsKICAgICAgZCA9IGQzX3N2Z19saW5lU2xvcGUocG9pbnRzW2ldLCBwb2ludHNbaSArIDFdKTsKICAgICAgaWYgKGFicyhkKSA8IM61KSB7CiAgICAgICAgbVtpXSA9IG1baSArIDFdID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICBhID0gbVtpXSAvIGQ7CiAgICAgICAgYiA9IG1baSArIDFdIC8gZDsKICAgICAgICBzID0gYSAqIGEgKyBiICogYjsKICAgICAgICBpZiAocyA+IDkpIHsKICAgICAgICAgIHMgPSBkICogMyAvIE1hdGguc3FydChzKTsKICAgICAgICAgIG1baV0gPSBzICogYTsKICAgICAgICAgIG1baSArIDFdID0gcyAqIGI7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpID0gLTE7CiAgICB3aGlsZSAoKytpIDw9IGopIHsKICAgICAgcyA9IChwb2ludHNbTWF0aC5taW4oaiwgaSArIDEpXVswXSAtIHBvaW50c1tNYXRoLm1heCgwLCBpIC0gMSldWzBdKSAvICg2ICogKDEgKyBtW2ldICogbVtpXSkpOwogICAgICB0YW5nZW50cy5wdXNoKFsgcyB8fCAwLCBtW2ldICogcyB8fCAwIF0pOwogICAgfQogICAgcmV0dXJuIHRhbmdlbnRzOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZU1vbm90b25lKHBvaW50cykgewogICAgcmV0dXJuIHBvaW50cy5sZW5ndGggPCAzID8gZDNfc3ZnX2xpbmVMaW5lYXIocG9pbnRzKSA6IHBvaW50c1swXSArIGQzX3N2Z19saW5lSGVybWl0ZShwb2ludHMsIGQzX3N2Z19saW5lTW9ub3RvbmVUYW5nZW50cyhwb2ludHMpKTsKICB9CiAgZDMuc3ZnLmxpbmUucmFkaWFsID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgbGluZSA9IGQzX3N2Z19saW5lKGQzX3N2Z19saW5lUmFkaWFsKTsKICAgIGxpbmUucmFkaXVzID0gbGluZS54LCBkZWxldGUgbGluZS54OwogICAgbGluZS5hbmdsZSA9IGxpbmUueSwgZGVsZXRlIGxpbmUueTsKICAgIHJldHVybiBsaW5lOwogIH07CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmVSYWRpYWwocG9pbnRzKSB7CiAgICB2YXIgcG9pbnQsIGkgPSAtMSwgbiA9IHBvaW50cy5sZW5ndGgsIHIsIGE7CiAgICB3aGlsZSAoKytpIDwgbikgewogICAgICBwb2ludCA9IHBvaW50c1tpXTsKICAgICAgciA9IHBvaW50WzBdOwogICAgICBhID0gcG9pbnRbMV0gLSBoYWxmz4A7CiAgICAgIHBvaW50WzBdID0gciAqIE1hdGguY29zKGEpOwogICAgICBwb2ludFsxXSA9IHIgKiBNYXRoLnNpbihhKTsKICAgIH0KICAgIHJldHVybiBwb2ludHM7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19hcmVhKHByb2plY3Rpb24pIHsKICAgIHZhciB4MCA9IGQzX2dlb21fcG9pbnRYLCB4MSA9IGQzX2dlb21fcG9pbnRYLCB5MCA9IDAsIHkxID0gZDNfZ2VvbV9wb2ludFksIGRlZmluZWQgPSBkM190cnVlLCBpbnRlcnBvbGF0ZSA9IGQzX3N2Z19saW5lTGluZWFyLCBpbnRlcnBvbGF0ZUtleSA9IGludGVycG9sYXRlLmtleSwgaW50ZXJwb2xhdGVSZXZlcnNlID0gaW50ZXJwb2xhdGUsIEwgPSAiTCIsIHRlbnNpb24gPSAuNzsKICAgIGZ1bmN0aW9uIGFyZWEoZGF0YSkgewogICAgICB2YXIgc2VnbWVudHMgPSBbXSwgcG9pbnRzMCA9IFtdLCBwb2ludHMxID0gW10sIGkgPSAtMSwgbiA9IGRhdGEubGVuZ3RoLCBkLCBmeDAgPSBkM19mdW5jdG9yKHgwKSwgZnkwID0gZDNfZnVuY3Rvcih5MCksIGZ4MSA9IHgwID09PSB4MSA/IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB4OwogICAgICB9IDogZDNfZnVuY3Rvcih4MSksIGZ5MSA9IHkwID09PSB5MSA/IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB5OwogICAgICB9IDogZDNfZnVuY3Rvcih5MSksIHgsIHk7CiAgICAgIGZ1bmN0aW9uIHNlZ21lbnQoKSB7CiAgICAgICAgc2VnbWVudHMucHVzaCgiTSIsIGludGVycG9sYXRlKHByb2plY3Rpb24ocG9pbnRzMSksIHRlbnNpb24pLCBMLCBpbnRlcnBvbGF0ZVJldmVyc2UocHJvamVjdGlvbihwb2ludHMwLnJldmVyc2UoKSksIHRlbnNpb24pLCAiWiIpOwogICAgICB9CiAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgaWYgKGRlZmluZWQuY2FsbCh0aGlzLCBkID0gZGF0YVtpXSwgaSkpIHsKICAgICAgICAgIHBvaW50czAucHVzaChbIHggPSArZngwLmNhbGwodGhpcywgZCwgaSksIHkgPSArZnkwLmNhbGwodGhpcywgZCwgaSkgXSk7CiAgICAgICAgICBwb2ludHMxLnB1c2goWyArZngxLmNhbGwodGhpcywgZCwgaSksICtmeTEuY2FsbCh0aGlzLCBkLCBpKSBdKTsKICAgICAgICB9IGVsc2UgaWYgKHBvaW50czAubGVuZ3RoKSB7CiAgICAgICAgICBzZWdtZW50KCk7CiAgICAgICAgICBwb2ludHMwID0gW107CiAgICAgICAgICBwb2ludHMxID0gW107CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwb2ludHMwLmxlbmd0aCkgc2VnbWVudCgpOwogICAgICByZXR1cm4gc2VnbWVudHMubGVuZ3RoID8gc2VnbWVudHMuam9pbigiIikgOiBudWxsOwogICAgfQogICAgYXJlYS54ID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB4MTsKICAgICAgeDAgPSB4MSA9IF87CiAgICAgIHJldHVybiBhcmVhOwogICAgfTsKICAgIGFyZWEueDAgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHgwOwogICAgICB4MCA9IF87CiAgICAgIHJldHVybiBhcmVhOwogICAgfTsKICAgIGFyZWEueDEgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHgxOwogICAgICB4MSA9IF87CiAgICAgIHJldHVybiBhcmVhOwogICAgfTsKICAgIGFyZWEueSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4geTE7CiAgICAgIHkwID0geTEgPSBfOwogICAgICByZXR1cm4gYXJlYTsKICAgIH07CiAgICBhcmVhLnkwID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB5MDsKICAgICAgeTAgPSBfOwogICAgICByZXR1cm4gYXJlYTsKICAgIH07CiAgICBhcmVhLnkxID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB5MTsKICAgICAgeTEgPSBfOwogICAgICByZXR1cm4gYXJlYTsKICAgIH07CiAgICBhcmVhLmRlZmluZWQgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGRlZmluZWQ7CiAgICAgIGRlZmluZWQgPSBfOwogICAgICByZXR1cm4gYXJlYTsKICAgIH07CiAgICBhcmVhLmludGVycG9sYXRlID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBpbnRlcnBvbGF0ZUtleTsKICAgICAgaWYgKHR5cGVvZiBfID09PSAiZnVuY3Rpb24iKSBpbnRlcnBvbGF0ZUtleSA9IGludGVycG9sYXRlID0gXzsgZWxzZSBpbnRlcnBvbGF0ZUtleSA9IChpbnRlcnBvbGF0ZSA9IGQzX3N2Z19saW5lSW50ZXJwb2xhdG9ycy5nZXQoXykgfHwgZDNfc3ZnX2xpbmVMaW5lYXIpLmtleTsKICAgICAgaW50ZXJwb2xhdGVSZXZlcnNlID0gaW50ZXJwb2xhdGUucmV2ZXJzZSB8fCBpbnRlcnBvbGF0ZTsKICAgICAgTCA9IGludGVycG9sYXRlLmNsb3NlZCA/ICJNIiA6ICJMIjsKICAgICAgcmV0dXJuIGFyZWE7CiAgICB9OwogICAgYXJlYS50ZW5zaW9uID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB0ZW5zaW9uOwogICAgICB0ZW5zaW9uID0gXzsKICAgICAgcmV0dXJuIGFyZWE7CiAgICB9OwogICAgcmV0dXJuIGFyZWE7CiAgfQogIGQzX3N2Z19saW5lU3RlcEJlZm9yZS5yZXZlcnNlID0gZDNfc3ZnX2xpbmVTdGVwQWZ0ZXI7CiAgZDNfc3ZnX2xpbmVTdGVwQWZ0ZXIucmV2ZXJzZSA9IGQzX3N2Z19saW5lU3RlcEJlZm9yZTsKICBkMy5zdmcuYXJlYSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX3N2Z19hcmVhKGQzX2lkZW50aXR5KTsKICB9OwogIGQzLnN2Zy5hcmVhLnJhZGlhbCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGFyZWEgPSBkM19zdmdfYXJlYShkM19zdmdfbGluZVJhZGlhbCk7CiAgICBhcmVhLnJhZGl1cyA9IGFyZWEueCwgZGVsZXRlIGFyZWEueDsKICAgIGFyZWEuaW5uZXJSYWRpdXMgPSBhcmVhLngwLCBkZWxldGUgYXJlYS54MDsKICAgIGFyZWEub3V0ZXJSYWRpdXMgPSBhcmVhLngxLCBkZWxldGUgYXJlYS54MTsKICAgIGFyZWEuYW5nbGUgPSBhcmVhLnksIGRlbGV0ZSBhcmVhLnk7CiAgICBhcmVhLnN0YXJ0QW5nbGUgPSBhcmVhLnkwLCBkZWxldGUgYXJlYS55MDsKICAgIGFyZWEuZW5kQW5nbGUgPSBhcmVhLnkxLCBkZWxldGUgYXJlYS55MTsKICAgIHJldHVybiBhcmVhOwogIH07CiAgZDMuc3ZnLmNob3JkID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgc291cmNlID0gZDNfc291cmNlLCB0YXJnZXQgPSBkM190YXJnZXQsIHJhZGl1cyA9IGQzX3N2Z19jaG9yZFJhZGl1cywgc3RhcnRBbmdsZSA9IGQzX3N2Z19hcmNTdGFydEFuZ2xlLCBlbmRBbmdsZSA9IGQzX3N2Z19hcmNFbmRBbmdsZTsKICAgIGZ1bmN0aW9uIGNob3JkKGQsIGkpIHsKICAgICAgdmFyIHMgPSBzdWJncm91cCh0aGlzLCBzb3VyY2UsIGQsIGkpLCB0ID0gc3ViZ3JvdXAodGhpcywgdGFyZ2V0LCBkLCBpKTsKICAgICAgcmV0dXJuICJNIiArIHMucDAgKyBhcmMocy5yLCBzLnAxLCBzLmExIC0gcy5hMCkgKyAoZXF1YWxzKHMsIHQpID8gY3VydmUocy5yLCBzLnAxLCBzLnIsIHMucDApIDogY3VydmUocy5yLCBzLnAxLCB0LnIsIHQucDApICsgYXJjKHQuciwgdC5wMSwgdC5hMSAtIHQuYTApICsgY3VydmUodC5yLCB0LnAxLCBzLnIsIHMucDApKSArICJaIjsKICAgIH0KICAgIGZ1bmN0aW9uIHN1Ymdyb3VwKHNlbGYsIGYsIGQsIGkpIHsKICAgICAgdmFyIHN1Ymdyb3VwID0gZi5jYWxsKHNlbGYsIGQsIGkpLCByID0gcmFkaXVzLmNhbGwoc2VsZiwgc3ViZ3JvdXAsIGkpLCBhMCA9IHN0YXJ0QW5nbGUuY2FsbChzZWxmLCBzdWJncm91cCwgaSkgLSBoYWxmz4AsIGExID0gZW5kQW5nbGUuY2FsbChzZWxmLCBzdWJncm91cCwgaSkgLSBoYWxmz4A7CiAgICAgIHJldHVybiB7CiAgICAgICAgcjogciwKICAgICAgICBhMDogYTAsCiAgICAgICAgYTE6IGExLAogICAgICAgIHAwOiBbIHIgKiBNYXRoLmNvcyhhMCksIHIgKiBNYXRoLnNpbihhMCkgXSwKICAgICAgICBwMTogWyByICogTWF0aC5jb3MoYTEpLCByICogTWF0aC5zaW4oYTEpIF0KICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIGVxdWFscyhhLCBiKSB7CiAgICAgIHJldHVybiBhLmEwID09IGIuYTAgJiYgYS5hMSA9PSBiLmExOwogICAgfQogICAgZnVuY3Rpb24gYXJjKHIsIHAsIGEpIHsKICAgICAgcmV0dXJuICJBIiArIHIgKyAiLCIgKyByICsgIiAwICIgKyArKGEgPiDPgCkgKyAiLDEgIiArIHA7CiAgICB9CiAgICBmdW5jdGlvbiBjdXJ2ZShyMCwgcDAsIHIxLCBwMSkgewogICAgICByZXR1cm4gIlEgMCwwICIgKyBwMTsKICAgIH0KICAgIGNob3JkLnJhZGl1cyA9IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gcmFkaXVzOwogICAgICByYWRpdXMgPSBkM19mdW5jdG9yKHYpOwogICAgICByZXR1cm4gY2hvcmQ7CiAgICB9OwogICAgY2hvcmQuc291cmNlID0gZnVuY3Rpb24odikgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzb3VyY2U7CiAgICAgIHNvdXJjZSA9IGQzX2Z1bmN0b3Iodik7CiAgICAgIHJldHVybiBjaG9yZDsKICAgIH07CiAgICBjaG9yZC50YXJnZXQgPSBmdW5jdGlvbih2KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRhcmdldDsKICAgICAgdGFyZ2V0ID0gZDNfZnVuY3Rvcih2KTsKICAgICAgcmV0dXJuIGNob3JkOwogICAgfTsKICAgIGNob3JkLnN0YXJ0QW5nbGUgPSBmdW5jdGlvbih2KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHN0YXJ0QW5nbGU7CiAgICAgIHN0YXJ0QW5nbGUgPSBkM19mdW5jdG9yKHYpOwogICAgICByZXR1cm4gY2hvcmQ7CiAgICB9OwogICAgY2hvcmQuZW5kQW5nbGUgPSBmdW5jdGlvbih2KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGVuZEFuZ2xlOwogICAgICBlbmRBbmdsZSA9IGQzX2Z1bmN0b3Iodik7CiAgICAgIHJldHVybiBjaG9yZDsKICAgIH07CiAgICByZXR1cm4gY2hvcmQ7CiAgfTsKICBmdW5jdGlvbiBkM19zdmdfY2hvcmRSYWRpdXMoZCkgewogICAgcmV0dXJuIGQucmFkaXVzOwogIH0KICBkMy5zdmcuZGlhZ29uYWwgPSBmdW5jdGlvbigpIHsKICAgIHZhciBzb3VyY2UgPSBkM19zb3VyY2UsIHRhcmdldCA9IGQzX3RhcmdldCwgcHJvamVjdGlvbiA9IGQzX3N2Z19kaWFnb25hbFByb2plY3Rpb247CiAgICBmdW5jdGlvbiBkaWFnb25hbChkLCBpKSB7CiAgICAgIHZhciBwMCA9IHNvdXJjZS5jYWxsKHRoaXMsIGQsIGkpLCBwMyA9IHRhcmdldC5jYWxsKHRoaXMsIGQsIGkpLCBtID0gKHAwLnkgKyBwMy55KSAvIDIsIHAgPSBbIHAwLCB7CiAgICAgICAgeDogcDAueCwKICAgICAgICB5OiBtCiAgICAgIH0sIHsKICAgICAgICB4OiBwMy54LAogICAgICAgIHk6IG0KICAgICAgfSwgcDMgXTsKICAgICAgcCA9IHAubWFwKHByb2plY3Rpb24pOwogICAgICByZXR1cm4gIk0iICsgcFswXSArICJDIiArIHBbMV0gKyAiICIgKyBwWzJdICsgIiAiICsgcFszXTsKICAgIH0KICAgIGRpYWdvbmFsLnNvdXJjZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc291cmNlOwogICAgICBzb3VyY2UgPSBkM19mdW5jdG9yKHgpOwogICAgICByZXR1cm4gZGlhZ29uYWw7CiAgICB9OwogICAgZGlhZ29uYWwudGFyZ2V0ID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB0YXJnZXQ7CiAgICAgIHRhcmdldCA9IGQzX2Z1bmN0b3IoeCk7CiAgICAgIHJldHVybiBkaWFnb25hbDsKICAgIH07CiAgICBkaWFnb25hbC5wcm9qZWN0aW9uID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBwcm9qZWN0aW9uOwogICAgICBwcm9qZWN0aW9uID0geDsKICAgICAgcmV0dXJuIGRpYWdvbmFsOwogICAgfTsKICAgIHJldHVybiBkaWFnb25hbDsKICB9OwogIGZ1bmN0aW9uIGQzX3N2Z19kaWFnb25hbFByb2plY3Rpb24oZCkgewogICAgcmV0dXJuIFsgZC54LCBkLnkgXTsKICB9CiAgZDMuc3ZnLmRpYWdvbmFsLnJhZGlhbCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGRpYWdvbmFsID0gZDMuc3ZnLmRpYWdvbmFsKCksIHByb2plY3Rpb24gPSBkM19zdmdfZGlhZ29uYWxQcm9qZWN0aW9uLCBwcm9qZWN0aW9uXyA9IGRpYWdvbmFsLnByb2plY3Rpb247CiAgICBkaWFnb25hbC5wcm9qZWN0aW9uID0gZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IHByb2plY3Rpb25fKGQzX3N2Z19kaWFnb25hbFJhZGlhbFByb2plY3Rpb24ocHJvamVjdGlvbiA9IHgpKSA6IHByb2plY3Rpb247CiAgICB9OwogICAgcmV0dXJuIGRpYWdvbmFsOwogIH07CiAgZnVuY3Rpb24gZDNfc3ZnX2RpYWdvbmFsUmFkaWFsUHJvamVjdGlvbihwcm9qZWN0aW9uKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBkID0gcHJvamVjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCByID0gZFswXSwgYSA9IGRbMV0gLSBoYWxmz4A7CiAgICAgIHJldHVybiBbIHIgKiBNYXRoLmNvcyhhKSwgciAqIE1hdGguc2luKGEpIF07CiAgICB9OwogIH0KICBkMy5zdmcuc3ltYm9sID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgdHlwZSA9IGQzX3N2Z19zeW1ib2xUeXBlLCBzaXplID0gZDNfc3ZnX3N5bWJvbFNpemU7CiAgICBmdW5jdGlvbiBzeW1ib2woZCwgaSkgewogICAgICByZXR1cm4gKGQzX3N2Z19zeW1ib2xzLmdldCh0eXBlLmNhbGwodGhpcywgZCwgaSkpIHx8IGQzX3N2Z19zeW1ib2xDaXJjbGUpKHNpemUuY2FsbCh0aGlzLCBkLCBpKSk7CiAgICB9CiAgICBzeW1ib2wudHlwZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdHlwZTsKICAgICAgdHlwZSA9IGQzX2Z1bmN0b3IoeCk7CiAgICAgIHJldHVybiBzeW1ib2w7CiAgICB9OwogICAgc3ltYm9sLnNpemUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNpemU7CiAgICAgIHNpemUgPSBkM19mdW5jdG9yKHgpOwogICAgICByZXR1cm4gc3ltYm9sOwogICAgfTsKICAgIHJldHVybiBzeW1ib2w7CiAgfTsKICBmdW5jdGlvbiBkM19zdmdfc3ltYm9sU2l6ZSgpIHsKICAgIHJldHVybiA2NDsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX3N5bWJvbFR5cGUoKSB7CiAgICByZXR1cm4gImNpcmNsZSI7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19zeW1ib2xDaXJjbGUoc2l6ZSkgewogICAgdmFyIHIgPSBNYXRoLnNxcnQoc2l6ZSAvIM+AKTsKICAgIHJldHVybiAiTTAsIiArIHIgKyAiQSIgKyByICsgIiwiICsgciArICIgMCAxLDEgMCwiICsgLXIgKyAiQSIgKyByICsgIiwiICsgciArICIgMCAxLDEgMCwiICsgciArICJaIjsKICB9CiAgdmFyIGQzX3N2Z19zeW1ib2xzID0gZDMubWFwKHsKICAgIGNpcmNsZTogZDNfc3ZnX3N5bWJvbENpcmNsZSwKICAgIGNyb3NzOiBmdW5jdGlvbihzaXplKSB7CiAgICAgIHZhciByID0gTWF0aC5zcXJ0KHNpemUgLyA1KSAvIDI7CiAgICAgIHJldHVybiAiTSIgKyAtMyAqIHIgKyAiLCIgKyAtciArICJIIiArIC1yICsgIlYiICsgLTMgKiByICsgIkgiICsgciArICJWIiArIC1yICsgIkgiICsgMyAqIHIgKyAiViIgKyByICsgIkgiICsgciArICJWIiArIDMgKiByICsgIkgiICsgLXIgKyAiViIgKyByICsgIkgiICsgLTMgKiByICsgIloiOwogICAgfSwKICAgIGRpYW1vbmQ6IGZ1bmN0aW9uKHNpemUpIHsKICAgICAgdmFyIHJ5ID0gTWF0aC5zcXJ0KHNpemUgLyAoMiAqIGQzX3N2Z19zeW1ib2xUYW4zMCkpLCByeCA9IHJ5ICogZDNfc3ZnX3N5bWJvbFRhbjMwOwogICAgICByZXR1cm4gIk0wLCIgKyAtcnkgKyAiTCIgKyByeCArICIsMCIgKyAiIDAsIiArIHJ5ICsgIiAiICsgLXJ4ICsgIiwwIiArICJaIjsKICAgIH0sCiAgICBzcXVhcmU6IGZ1bmN0aW9uKHNpemUpIHsKICAgICAgdmFyIHIgPSBNYXRoLnNxcnQoc2l6ZSkgLyAyOwogICAgICByZXR1cm4gIk0iICsgLXIgKyAiLCIgKyAtciArICJMIiArIHIgKyAiLCIgKyAtciArICIgIiArIHIgKyAiLCIgKyByICsgIiAiICsgLXIgKyAiLCIgKyByICsgIloiOwogICAgfSwKICAgICJ0cmlhbmdsZS1kb3duIjogZnVuY3Rpb24oc2l6ZSkgewogICAgICB2YXIgcnggPSBNYXRoLnNxcnQoc2l6ZSAvIGQzX3N2Z19zeW1ib2xTcXJ0MyksIHJ5ID0gcnggKiBkM19zdmdfc3ltYm9sU3FydDMgLyAyOwogICAgICByZXR1cm4gIk0wLCIgKyByeSArICJMIiArIHJ4ICsgIiwiICsgLXJ5ICsgIiAiICsgLXJ4ICsgIiwiICsgLXJ5ICsgIloiOwogICAgfSwKICAgICJ0cmlhbmdsZS11cCI6IGZ1bmN0aW9uKHNpemUpIHsKICAgICAgdmFyIHJ4ID0gTWF0aC5zcXJ0KHNpemUgLyBkM19zdmdfc3ltYm9sU3FydDMpLCByeSA9IHJ4ICogZDNfc3ZnX3N5bWJvbFNxcnQzIC8gMjsKICAgICAgcmV0dXJuICJNMCwiICsgLXJ5ICsgIkwiICsgcnggKyAiLCIgKyByeSArICIgIiArIC1yeCArICIsIiArIHJ5ICsgIloiOwogICAgfQogIH0pOwogIGQzLnN2Zy5zeW1ib2xUeXBlcyA9IGQzX3N2Z19zeW1ib2xzLmtleXMoKTsKICB2YXIgZDNfc3ZnX3N5bWJvbFNxcnQzID0gTWF0aC5zcXJ0KDMpLCBkM19zdmdfc3ltYm9sVGFuMzAgPSBNYXRoLnRhbigzMCAqIGQzX3JhZGlhbnMpOwogIGQzX3NlbGVjdGlvblByb3RvdHlwZS50cmFuc2l0aW9uID0gZnVuY3Rpb24obmFtZSkgewogICAgdmFyIGlkID0gZDNfdHJhbnNpdGlvbkluaGVyaXRJZCB8fCArK2QzX3RyYW5zaXRpb25JZCwgbnMgPSBkM190cmFuc2l0aW9uTmFtZXNwYWNlKG5hbWUpLCBzdWJncm91cHMgPSBbXSwgc3ViZ3JvdXAsIG5vZGUsIHRyYW5zaXRpb24gPSBkM190cmFuc2l0aW9uSW5oZXJpdCB8fCB7CiAgICAgIHRpbWU6IERhdGUubm93KCksCiAgICAgIGVhc2U6IGQzX2Vhc2VfY3ViaWNJbk91dCwKICAgICAgZGVsYXk6IDAsCiAgICAgIGR1cmF0aW9uOiAyNTAKICAgIH07CiAgICBmb3IgKHZhciBqID0gLTEsIG0gPSB0aGlzLmxlbmd0aDsgKytqIDwgbTsgKSB7CiAgICAgIHN1Ymdyb3Vwcy5wdXNoKHN1Ymdyb3VwID0gW10pOwogICAgICBmb3IgKHZhciBncm91cCA9IHRoaXNbal0sIGkgPSAtMSwgbiA9IGdyb3VwLmxlbmd0aDsgKytpIDwgbjsgKSB7CiAgICAgICAgaWYgKG5vZGUgPSBncm91cFtpXSkgZDNfdHJhbnNpdGlvbk5vZGUobm9kZSwgaSwgbnMsIGlkLCB0cmFuc2l0aW9uKTsKICAgICAgICBzdWJncm91cC5wdXNoKG5vZGUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZDNfdHJhbnNpdGlvbihzdWJncm91cHMsIG5zLCBpZCk7CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuaW50ZXJydXB0ID0gZnVuY3Rpb24obmFtZSkgewogICAgcmV0dXJuIHRoaXMuZWFjaChuYW1lID09IG51bGwgPyBkM19zZWxlY3Rpb25faW50ZXJydXB0IDogZDNfc2VsZWN0aW9uX2ludGVycnVwdE5TKGQzX3RyYW5zaXRpb25OYW1lc3BhY2UobmFtZSkpKTsKICB9OwogIHZhciBkM19zZWxlY3Rpb25faW50ZXJydXB0ID0gZDNfc2VsZWN0aW9uX2ludGVycnVwdE5TKGQzX3RyYW5zaXRpb25OYW1lc3BhY2UoKSk7CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uX2ludGVycnVwdE5TKG5zKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBsb2NrLCBhY3RpdmU7CiAgICAgIGlmICgobG9jayA9IHRoaXNbbnNdKSAmJiAoYWN0aXZlID0gbG9ja1tsb2NrLmFjdGl2ZV0pKSB7CiAgICAgICAgaWYgKC0tbG9jay5jb3VudCkgZGVsZXRlIGxvY2tbbG9jay5hY3RpdmVdOyBlbHNlIGRlbGV0ZSB0aGlzW25zXTsKICAgICAgICBsb2NrLmFjdGl2ZSArPSAuNTsKICAgICAgICBhY3RpdmUuZXZlbnQgJiYgYWN0aXZlLmV2ZW50LmludGVycnVwdC5jYWxsKHRoaXMsIHRoaXMuX19kYXRhX18sIGFjdGl2ZS5pbmRleCk7CiAgICAgIH0KICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX3RyYW5zaXRpb24oZ3JvdXBzLCBucywgaWQpIHsKICAgIGQzX3N1YmNsYXNzKGdyb3VwcywgZDNfdHJhbnNpdGlvblByb3RvdHlwZSk7CiAgICBncm91cHMubmFtZXNwYWNlID0gbnM7CiAgICBncm91cHMuaWQgPSBpZDsKICAgIHJldHVybiBncm91cHM7CiAgfQogIHZhciBkM190cmFuc2l0aW9uUHJvdG90eXBlID0gW10sIGQzX3RyYW5zaXRpb25JZCA9IDAsIGQzX3RyYW5zaXRpb25Jbmhlcml0SWQsIGQzX3RyYW5zaXRpb25Jbmhlcml0OwogIGQzX3RyYW5zaXRpb25Qcm90b3R5cGUuY2FsbCA9IGQzX3NlbGVjdGlvblByb3RvdHlwZS5jYWxsOwogIGQzX3RyYW5zaXRpb25Qcm90b3R5cGUuZW1wdHkgPSBkM19zZWxlY3Rpb25Qcm90b3R5cGUuZW1wdHk7CiAgZDNfdHJhbnNpdGlvblByb3RvdHlwZS5ub2RlID0gZDNfc2VsZWN0aW9uUHJvdG90eXBlLm5vZGU7CiAgZDNfdHJhbnNpdGlvblByb3RvdHlwZS5zaXplID0gZDNfc2VsZWN0aW9uUHJvdG90eXBlLnNpemU7CiAgZDMudHJhbnNpdGlvbiA9IGZ1bmN0aW9uKHNlbGVjdGlvbiwgbmFtZSkgewogICAgcmV0dXJuIHNlbGVjdGlvbiAmJiBzZWxlY3Rpb24udHJhbnNpdGlvbiA/IGQzX3RyYW5zaXRpb25Jbmhlcml0SWQgPyBzZWxlY3Rpb24udHJhbnNpdGlvbihuYW1lKSA6IHNlbGVjdGlvbiA6IGQzX3NlbGVjdGlvblJvb3QudHJhbnNpdGlvbihzZWxlY3Rpb24pOwogIH07CiAgZDMudHJhbnNpdGlvbi5wcm90b3R5cGUgPSBkM190cmFuc2l0aW9uUHJvdG90eXBlOwogIGQzX3RyYW5zaXRpb25Qcm90b3R5cGUuc2VsZWN0ID0gZnVuY3Rpb24oc2VsZWN0b3IpIHsKICAgIHZhciBpZCA9IHRoaXMuaWQsIG5zID0gdGhpcy5uYW1lc3BhY2UsIHN1Ymdyb3VwcyA9IFtdLCBzdWJncm91cCwgc3Vibm9kZSwgbm9kZTsKICAgIHNlbGVjdG9yID0gZDNfc2VsZWN0aW9uX3NlbGVjdG9yKHNlbGVjdG9yKTsKICAgIGZvciAodmFyIGogPSAtMSwgbSA9IHRoaXMubGVuZ3RoOyArK2ogPCBtOyApIHsKICAgICAgc3ViZ3JvdXBzLnB1c2goc3ViZ3JvdXAgPSBbXSk7CiAgICAgIGZvciAodmFyIGdyb3VwID0gdGhpc1tqXSwgaSA9IC0xLCBuID0gZ3JvdXAubGVuZ3RoOyArK2kgPCBuOyApIHsKICAgICAgICBpZiAoKG5vZGUgPSBncm91cFtpXSkgJiYgKHN1Ym5vZGUgPSBzZWxlY3Rvci5jYWxsKG5vZGUsIG5vZGUuX19kYXRhX18sIGksIGopKSkgewogICAgICAgICAgaWYgKCJfX2RhdGFfXyIgaW4gbm9kZSkgc3Vibm9kZS5fX2RhdGFfXyA9IG5vZGUuX19kYXRhX187CiAgICAgICAgICBkM190cmFuc2l0aW9uTm9kZShzdWJub2RlLCBpLCBucywgaWQsIG5vZGVbbnNdW2lkXSk7CiAgICAgICAgICBzdWJncm91cC5wdXNoKHN1Ym5vZGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdWJncm91cC5wdXNoKG51bGwpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGQzX3RyYW5zaXRpb24oc3ViZ3JvdXBzLCBucywgaWQpOwogIH07CiAgZDNfdHJhbnNpdGlvblByb3RvdHlwZS5zZWxlY3RBbGwgPSBmdW5jdGlvbihzZWxlY3RvcikgewogICAgdmFyIGlkID0gdGhpcy5pZCwgbnMgPSB0aGlzLm5hbWVzcGFjZSwgc3ViZ3JvdXBzID0gW10sIHN1Ymdyb3VwLCBzdWJub2Rlcywgbm9kZSwgc3Vibm9kZSwgdHJhbnNpdGlvbjsKICAgIHNlbGVjdG9yID0gZDNfc2VsZWN0aW9uX3NlbGVjdG9yQWxsKHNlbGVjdG9yKTsKICAgIGZvciAodmFyIGogPSAtMSwgbSA9IHRoaXMubGVuZ3RoOyArK2ogPCBtOyApIHsKICAgICAgZm9yICh2YXIgZ3JvdXAgPSB0aGlzW2pdLCBpID0gLTEsIG4gPSBncm91cC5sZW5ndGg7ICsraSA8IG47ICkgewogICAgICAgIGlmIChub2RlID0gZ3JvdXBbaV0pIHsKICAgICAgICAgIHRyYW5zaXRpb24gPSBub2RlW25zXVtpZF07CiAgICAgICAgICBzdWJub2RlcyA9IHNlbGVjdG9yLmNhbGwobm9kZSwgbm9kZS5fX2RhdGFfXywgaSwgaik7CiAgICAgICAgICBzdWJncm91cHMucHVzaChzdWJncm91cCA9IFtdKTsKICAgICAgICAgIGZvciAodmFyIGsgPSAtMSwgbyA9IHN1Ym5vZGVzLmxlbmd0aDsgKytrIDwgbzsgKSB7CiAgICAgICAgICAgIGlmIChzdWJub2RlID0gc3Vibm9kZXNba10pIGQzX3RyYW5zaXRpb25Ob2RlKHN1Ym5vZGUsIGssIG5zLCBpZCwgdHJhbnNpdGlvbik7CiAgICAgICAgICAgIHN1Ymdyb3VwLnB1c2goc3Vibm9kZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gZDNfdHJhbnNpdGlvbihzdWJncm91cHMsIG5zLCBpZCk7CiAgfTsKICBkM190cmFuc2l0aW9uUHJvdG90eXBlLmZpbHRlciA9IGZ1bmN0aW9uKGZpbHRlcikgewogICAgdmFyIHN1Ymdyb3VwcyA9IFtdLCBzdWJncm91cCwgZ3JvdXAsIG5vZGU7CiAgICBpZiAodHlwZW9mIGZpbHRlciAhPT0gImZ1bmN0aW9uIikgZmlsdGVyID0gZDNfc2VsZWN0aW9uX2ZpbHRlcihmaWx0ZXIpOwogICAgZm9yICh2YXIgaiA9IDAsIG0gPSB0aGlzLmxlbmd0aDsgaiA8IG07IGorKykgewogICAgICBzdWJncm91cHMucHVzaChzdWJncm91cCA9IFtdKTsKICAgICAgZm9yICh2YXIgZ3JvdXAgPSB0aGlzW2pdLCBpID0gMCwgbiA9IGdyb3VwLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICAgIGlmICgobm9kZSA9IGdyb3VwW2ldKSAmJiBmaWx0ZXIuY2FsbChub2RlLCBub2RlLl9fZGF0YV9fLCBpLCBqKSkgewogICAgICAgICAgc3ViZ3JvdXAucHVzaChub2RlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkM190cmFuc2l0aW9uKHN1Ymdyb3VwcywgdGhpcy5uYW1lc3BhY2UsIHRoaXMuaWQpOwogIH07CiAgZDNfdHJhbnNpdGlvblByb3RvdHlwZS50d2VlbiA9IGZ1bmN0aW9uKG5hbWUsIHR3ZWVuKSB7CiAgICB2YXIgaWQgPSB0aGlzLmlkLCBucyA9IHRoaXMubmFtZXNwYWNlOwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSByZXR1cm4gdGhpcy5ub2RlKClbbnNdW2lkXS50d2Vlbi5nZXQobmFtZSk7CiAgICByZXR1cm4gZDNfc2VsZWN0aW9uX2VhY2godGhpcywgdHdlZW4gPT0gbnVsbCA/IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgbm9kZVtuc11baWRdLnR3ZWVuLnJlbW92ZShuYW1lKTsKICAgIH0gOiBmdW5jdGlvbihub2RlKSB7CiAgICAgIG5vZGVbbnNdW2lkXS50d2Vlbi5zZXQobmFtZSwgdHdlZW4pOwogICAgfSk7CiAgfTsKICBmdW5jdGlvbiBkM190cmFuc2l0aW9uX3R3ZWVuKGdyb3VwcywgbmFtZSwgdmFsdWUsIHR3ZWVuKSB7CiAgICB2YXIgaWQgPSBncm91cHMuaWQsIG5zID0gZ3JvdXBzLm5hbWVzcGFjZTsKICAgIHJldHVybiBkM19zZWxlY3Rpb25fZWFjaChncm91cHMsIHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIiA/IGZ1bmN0aW9uKG5vZGUsIGksIGopIHsKICAgICAgbm9kZVtuc11baWRdLnR3ZWVuLnNldChuYW1lLCB0d2Vlbih2YWx1ZS5jYWxsKG5vZGUsIG5vZGUuX19kYXRhX18sIGksIGopKSk7CiAgICB9IDogKHZhbHVlID0gdHdlZW4odmFsdWUpLCBmdW5jdGlvbihub2RlKSB7CiAgICAgIG5vZGVbbnNdW2lkXS50d2Vlbi5zZXQobmFtZSwgdmFsdWUpOwogICAgfSkpOwogIH0KICBkM190cmFuc2l0aW9uUHJvdG90eXBlLmF0dHIgPSBmdW5jdGlvbihuYW1lTlMsIHZhbHVlKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHsKICAgICAgZm9yICh2YWx1ZSBpbiBuYW1lTlMpIHRoaXMuYXR0cih2YWx1ZSwgbmFtZU5TW3ZhbHVlXSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdmFyIGludGVycG9sYXRlID0gbmFtZU5TID09ICJ0cmFuc2Zvcm0iID8gZDNfaW50ZXJwb2xhdGVUcmFuc2Zvcm0gOiBkM19pbnRlcnBvbGF0ZSwgbmFtZSA9IGQzLm5zLnF1YWxpZnkobmFtZU5TKTsKICAgIGZ1bmN0aW9uIGF0dHJOdWxsKCkgewogICAgICB0aGlzLnJlbW92ZUF0dHJpYnV0ZShuYW1lKTsKICAgIH0KICAgIGZ1bmN0aW9uIGF0dHJOdWxsTlMoKSB7CiAgICAgIHRoaXMucmVtb3ZlQXR0cmlidXRlTlMobmFtZS5zcGFjZSwgbmFtZS5sb2NhbCk7CiAgICB9CiAgICBmdW5jdGlvbiBhdHRyVHdlZW4oYikgewogICAgICByZXR1cm4gYiA9PSBudWxsID8gYXR0ck51bGwgOiAoYiArPSAiIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLmdldEF0dHJpYnV0ZShuYW1lKSwgaTsKICAgICAgICByZXR1cm4gYSAhPT0gYiAmJiAoaSA9IGludGVycG9sYXRlKGEsIGIpLCBmdW5jdGlvbih0KSB7CiAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShuYW1lLCBpKHQpKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiBhdHRyVHdlZW5OUyhiKSB7CiAgICAgIHJldHVybiBiID09IG51bGwgPyBhdHRyTnVsbE5TIDogKGIgKz0gIiIsIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhID0gdGhpcy5nZXRBdHRyaWJ1dGVOUyhuYW1lLnNwYWNlLCBuYW1lLmxvY2FsKSwgaTsKICAgICAgICByZXR1cm4gYSAhPT0gYiAmJiAoaSA9IGludGVycG9sYXRlKGEsIGIpLCBmdW5jdGlvbih0KSB7CiAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZU5TKG5hbWUuc3BhY2UsIG5hbWUubG9jYWwsIGkodCkpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBkM190cmFuc2l0aW9uX3R3ZWVuKHRoaXMsICJhdHRyLiIgKyBuYW1lTlMsIHZhbHVlLCBuYW1lLmxvY2FsID8gYXR0clR3ZWVuTlMgOiBhdHRyVHdlZW4pOwogIH07CiAgZDNfdHJhbnNpdGlvblByb3RvdHlwZS5hdHRyVHdlZW4gPSBmdW5jdGlvbihuYW1lTlMsIHR3ZWVuKSB7CiAgICB2YXIgbmFtZSA9IGQzLm5zLnF1YWxpZnkobmFtZU5TKTsKICAgIGZ1bmN0aW9uIGF0dHJUd2VlbihkLCBpKSB7CiAgICAgIHZhciBmID0gdHdlZW4uY2FsbCh0aGlzLCBkLCBpLCB0aGlzLmdldEF0dHJpYnV0ZShuYW1lKSk7CiAgICAgIHJldHVybiBmICYmIGZ1bmN0aW9uKHQpIHsKICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShuYW1lLCBmKHQpKTsKICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIGF0dHJUd2Vlbk5TKGQsIGkpIHsKICAgICAgdmFyIGYgPSB0d2Vlbi5jYWxsKHRoaXMsIGQsIGksIHRoaXMuZ2V0QXR0cmlidXRlTlMobmFtZS5zcGFjZSwgbmFtZS5sb2NhbCkpOwogICAgICByZXR1cm4gZiAmJiBmdW5jdGlvbih0KSB7CiAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGVOUyhuYW1lLnNwYWNlLCBuYW1lLmxvY2FsLCBmKHQpKTsKICAgICAgfTsKICAgIH0KICAgIHJldHVybiB0aGlzLnR3ZWVuKCJhdHRyLiIgKyBuYW1lTlMsIG5hbWUubG9jYWwgPyBhdHRyVHdlZW5OUyA6IGF0dHJUd2Vlbik7CiAgfTsKICBkM190cmFuc2l0aW9uUHJvdG90eXBlLnN0eWxlID0gZnVuY3Rpb24obmFtZSwgdmFsdWUsIHByaW9yaXR5KSB7CiAgICB2YXIgbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICBpZiAobiA8IDMpIHsKICAgICAgaWYgKHR5cGVvZiBuYW1lICE9PSAic3RyaW5nIikgewogICAgICAgIGlmIChuIDwgMikgdmFsdWUgPSAiIjsKICAgICAgICBmb3IgKHByaW9yaXR5IGluIG5hbWUpIHRoaXMuc3R5bGUocHJpb3JpdHksIG5hbWVbcHJpb3JpdHldLCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHJpb3JpdHkgPSAiIjsKICAgIH0KICAgIGZ1bmN0aW9uIHN0eWxlTnVsbCgpIHsKICAgICAgdGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuYW1lKTsKICAgIH0KICAgIGZ1bmN0aW9uIHN0eWxlU3RyaW5nKGIpIHsKICAgICAgcmV0dXJuIGIgPT0gbnVsbCA/IHN0eWxlTnVsbCA6IChiICs9ICIiLCBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYSA9IGQzX3dpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRoaXMsIG51bGwpLmdldFByb3BlcnR5VmFsdWUobmFtZSksIGk7CiAgICAgICAgcmV0dXJuIGEgIT09IGIgJiYgKGkgPSBkM19pbnRlcnBvbGF0ZShhLCBiKSwgZnVuY3Rpb24odCkgewogICAgICAgICAgdGhpcy5zdHlsZS5zZXRQcm9wZXJ0eShuYW1lLCBpKHQpLCBwcmlvcml0eSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIGQzX3RyYW5zaXRpb25fdHdlZW4odGhpcywgInN0eWxlLiIgKyBuYW1lLCB2YWx1ZSwgc3R5bGVTdHJpbmcpOwogIH07CiAgZDNfdHJhbnNpdGlvblByb3RvdHlwZS5zdHlsZVR3ZWVuID0gZnVuY3Rpb24obmFtZSwgdHdlZW4sIHByaW9yaXR5KSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDMpIHByaW9yaXR5ID0gIiI7CiAgICBmdW5jdGlvbiBzdHlsZVR3ZWVuKGQsIGkpIHsKICAgICAgdmFyIGYgPSB0d2Vlbi5jYWxsKHRoaXMsIGQsIGksIGQzX3dpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRoaXMsIG51bGwpLmdldFByb3BlcnR5VmFsdWUobmFtZSkpOwogICAgICByZXR1cm4gZiAmJiBmdW5jdGlvbih0KSB7CiAgICAgICAgdGhpcy5zdHlsZS5zZXRQcm9wZXJ0eShuYW1lLCBmKHQpLCBwcmlvcml0eSk7CiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gdGhpcy50d2Vlbigic3R5bGUuIiArIG5hbWUsIHN0eWxlVHdlZW4pOwogIH07CiAgZDNfdHJhbnNpdGlvblByb3RvdHlwZS50ZXh0ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiBkM190cmFuc2l0aW9uX3R3ZWVuKHRoaXMsICJ0ZXh0IiwgdmFsdWUsIGQzX3RyYW5zaXRpb25fdGV4dCk7CiAgfTsKICBmdW5jdGlvbiBkM190cmFuc2l0aW9uX3RleHQoYikgewogICAgaWYgKGIgPT0gbnVsbCkgYiA9ICIiOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnRleHRDb250ZW50ID0gYjsKICAgIH07CiAgfQogIGQzX3RyYW5zaXRpb25Qcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgbnMgPSB0aGlzLm5hbWVzcGFjZTsKICAgIHJldHVybiB0aGlzLmVhY2goImVuZC50cmFuc2l0aW9uIiwgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBwOwogICAgICBpZiAodGhpc1tuc10uY291bnQgPCAyICYmIChwID0gdGhpcy5wYXJlbnROb2RlKSkgcC5yZW1vdmVDaGlsZCh0aGlzKTsKICAgIH0pOwogIH07CiAgZDNfdHJhbnNpdGlvblByb3RvdHlwZS5lYXNlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHZhciBpZCA9IHRoaXMuaWQsIG5zID0gdGhpcy5uYW1lc3BhY2U7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDEpIHJldHVybiB0aGlzLm5vZGUoKVtuc11baWRdLmVhc2U7CiAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAiZnVuY3Rpb24iKSB2YWx1ZSA9IGQzLmVhc2UuYXBwbHkoZDMsIGFyZ3VtZW50cyk7CiAgICByZXR1cm4gZDNfc2VsZWN0aW9uX2VhY2godGhpcywgZnVuY3Rpb24obm9kZSkgewogICAgICBub2RlW25zXVtpZF0uZWFzZSA9IHZhbHVlOwogICAgfSk7CiAgfTsKICBkM190cmFuc2l0aW9uUHJvdG90eXBlLmRlbGF5ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHZhciBpZCA9IHRoaXMuaWQsIG5zID0gdGhpcy5uYW1lc3BhY2U7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDEpIHJldHVybiB0aGlzLm5vZGUoKVtuc11baWRdLmRlbGF5OwogICAgcmV0dXJuIGQzX3NlbGVjdGlvbl9lYWNoKHRoaXMsIHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIiA/IGZ1bmN0aW9uKG5vZGUsIGksIGopIHsKICAgICAgbm9kZVtuc11baWRdLmRlbGF5ID0gK3ZhbHVlLmNhbGwobm9kZSwgbm9kZS5fX2RhdGFfXywgaSwgaik7CiAgICB9IDogKHZhbHVlID0gK3ZhbHVlLCBmdW5jdGlvbihub2RlKSB7CiAgICAgIG5vZGVbbnNdW2lkXS5kZWxheSA9IHZhbHVlOwogICAgfSkpOwogIH07CiAgZDNfdHJhbnNpdGlvblByb3RvdHlwZS5kdXJhdGlvbiA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICB2YXIgaWQgPSB0aGlzLmlkLCBucyA9IHRoaXMubmFtZXNwYWNlOwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAxKSByZXR1cm4gdGhpcy5ub2RlKClbbnNdW2lkXS5kdXJhdGlvbjsKICAgIHJldHVybiBkM19zZWxlY3Rpb25fZWFjaCh0aGlzLCB0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIgPyBmdW5jdGlvbihub2RlLCBpLCBqKSB7CiAgICAgIG5vZGVbbnNdW2lkXS5kdXJhdGlvbiA9IE1hdGgubWF4KDEsIHZhbHVlLmNhbGwobm9kZSwgbm9kZS5fX2RhdGFfXywgaSwgaikpOwogICAgfSA6ICh2YWx1ZSA9IE1hdGgubWF4KDEsIHZhbHVlKSwgZnVuY3Rpb24obm9kZSkgewogICAgICBub2RlW25zXVtpZF0uZHVyYXRpb24gPSB2YWx1ZTsKICAgIH0pKTsKICB9OwogIGQzX3RyYW5zaXRpb25Qcm90b3R5cGUuZWFjaCA9IGZ1bmN0aW9uKHR5cGUsIGxpc3RlbmVyKSB7CiAgICB2YXIgaWQgPSB0aGlzLmlkLCBucyA9IHRoaXMubmFtZXNwYWNlOwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSB7CiAgICAgIHZhciBpbmhlcml0ID0gZDNfdHJhbnNpdGlvbkluaGVyaXQsIGluaGVyaXRJZCA9IGQzX3RyYW5zaXRpb25Jbmhlcml0SWQ7CiAgICAgIHRyeSB7CiAgICAgICAgZDNfdHJhbnNpdGlvbkluaGVyaXRJZCA9IGlkOwogICAgICAgIGQzX3NlbGVjdGlvbl9lYWNoKHRoaXMsIGZ1bmN0aW9uKG5vZGUsIGksIGopIHsKICAgICAgICAgIGQzX3RyYW5zaXRpb25Jbmhlcml0ID0gbm9kZVtuc11baWRdOwogICAgICAgICAgdHlwZS5jYWxsKG5vZGUsIG5vZGUuX19kYXRhX18sIGksIGopOwogICAgICAgIH0pOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIGQzX3RyYW5zaXRpb25Jbmhlcml0ID0gaW5oZXJpdDsKICAgICAgICBkM190cmFuc2l0aW9uSW5oZXJpdElkID0gaW5oZXJpdElkOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBkM19zZWxlY3Rpb25fZWFjaCh0aGlzLCBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgdmFyIHRyYW5zaXRpb24gPSBub2RlW25zXVtpZF07CiAgICAgICAgKHRyYW5zaXRpb24uZXZlbnQgfHwgKHRyYW5zaXRpb24uZXZlbnQgPSBkMy5kaXNwYXRjaCgic3RhcnQiLCAiZW5kIiwgImludGVycnVwdCIpKSkub24odHlwZSwgbGlzdGVuZXIpOwogICAgICB9KTsKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH07CiAgZDNfdHJhbnNpdGlvblByb3RvdHlwZS50cmFuc2l0aW9uID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgaWQwID0gdGhpcy5pZCwgaWQxID0gKytkM190cmFuc2l0aW9uSWQsIG5zID0gdGhpcy5uYW1lc3BhY2UsIHN1Ymdyb3VwcyA9IFtdLCBzdWJncm91cCwgZ3JvdXAsIG5vZGUsIHRyYW5zaXRpb247CiAgICBmb3IgKHZhciBqID0gMCwgbSA9IHRoaXMubGVuZ3RoOyBqIDwgbTsgaisrKSB7CiAgICAgIHN1Ymdyb3Vwcy5wdXNoKHN1Ymdyb3VwID0gW10pOwogICAgICBmb3IgKHZhciBncm91cCA9IHRoaXNbal0sIGkgPSAwLCBuID0gZ3JvdXAubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgaWYgKG5vZGUgPSBncm91cFtpXSkgewogICAgICAgICAgdHJhbnNpdGlvbiA9IG5vZGVbbnNdW2lkMF07CiAgICAgICAgICBkM190cmFuc2l0aW9uTm9kZShub2RlLCBpLCBucywgaWQxLCB7CiAgICAgICAgICAgIHRpbWU6IHRyYW5zaXRpb24udGltZSwKICAgICAgICAgICAgZWFzZTogdHJhbnNpdGlvbi5lYXNlLAogICAgICAgICAgICBkZWxheTogdHJhbnNpdGlvbi5kZWxheSArIHRyYW5zaXRpb24uZHVyYXRpb24sCiAgICAgICAgICAgIGR1cmF0aW9uOiB0cmFuc2l0aW9uLmR1cmF0aW9uCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgc3ViZ3JvdXAucHVzaChub2RlKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGQzX3RyYW5zaXRpb24oc3ViZ3JvdXBzLCBucywgaWQxKTsKICB9OwogIGZ1bmN0aW9uIGQzX3RyYW5zaXRpb25OYW1lc3BhY2UobmFtZSkgewogICAgcmV0dXJuIG5hbWUgPT0gbnVsbCA/ICJfX3RyYW5zaXRpb25fXyIgOiAiX190cmFuc2l0aW9uXyIgKyBuYW1lICsgIl9fIjsKICB9CiAgZnVuY3Rpb24gZDNfdHJhbnNpdGlvbk5vZGUobm9kZSwgaSwgbnMsIGlkLCBpbmhlcml0KSB7CiAgICB2YXIgbG9jayA9IG5vZGVbbnNdIHx8IChub2RlW25zXSA9IHsKICAgICAgYWN0aXZlOiAwLAogICAgICBjb3VudDogMAogICAgfSksIHRyYW5zaXRpb24gPSBsb2NrW2lkXTsKICAgIGlmICghdHJhbnNpdGlvbikgewogICAgICB2YXIgdGltZSA9IGluaGVyaXQudGltZTsKICAgICAgdHJhbnNpdGlvbiA9IGxvY2tbaWRdID0gewogICAgICAgIHR3ZWVuOiBuZXcgZDNfTWFwKCksCiAgICAgICAgdGltZTogdGltZSwKICAgICAgICBkZWxheTogaW5oZXJpdC5kZWxheSwKICAgICAgICBkdXJhdGlvbjogaW5oZXJpdC5kdXJhdGlvbiwKICAgICAgICBlYXNlOiBpbmhlcml0LmVhc2UsCiAgICAgICAgaW5kZXg6IGkKICAgICAgfTsKICAgICAgaW5oZXJpdCA9IG51bGw7CiAgICAgICsrbG9jay5jb3VudDsKICAgICAgZDMudGltZXIoZnVuY3Rpb24oZWxhcHNlZCkgewogICAgICAgIHZhciBkZWxheSA9IHRyYW5zaXRpb24uZGVsYXksIGR1cmF0aW9uLCBlYXNlLCB0aW1lciA9IGQzX3RpbWVyX2FjdGl2ZSwgdHdlZW5lZCA9IFtdOwogICAgICAgIHRpbWVyLnQgPSBkZWxheSArIHRpbWU7CiAgICAgICAgaWYgKGRlbGF5IDw9IGVsYXBzZWQpIHJldHVybiBzdGFydChlbGFwc2VkIC0gZGVsYXkpOwogICAgICAgIHRpbWVyLmMgPSBzdGFydDsKICAgICAgICBmdW5jdGlvbiBzdGFydChlbGFwc2VkKSB7CiAgICAgICAgICBpZiAobG9jay5hY3RpdmUgPiBpZCkgcmV0dXJuIHN0b3AoKTsKICAgICAgICAgIHZhciBhY3RpdmUgPSBsb2NrW2xvY2suYWN0aXZlXTsKICAgICAgICAgIGlmIChhY3RpdmUpIHsKICAgICAgICAgICAgLS1sb2NrLmNvdW50OwogICAgICAgICAgICBkZWxldGUgbG9ja1tsb2NrLmFjdGl2ZV07CiAgICAgICAgICAgIGFjdGl2ZS5ldmVudCAmJiBhY3RpdmUuZXZlbnQuaW50ZXJydXB0LmNhbGwobm9kZSwgbm9kZS5fX2RhdGFfXywgYWN0aXZlLmluZGV4KTsKICAgICAgICAgIH0KICAgICAgICAgIGxvY2suYWN0aXZlID0gaWQ7CiAgICAgICAgICB0cmFuc2l0aW9uLmV2ZW50ICYmIHRyYW5zaXRpb24uZXZlbnQuc3RhcnQuY2FsbChub2RlLCBub2RlLl9fZGF0YV9fLCBpKTsKICAgICAgICAgIHRyYW5zaXRpb24udHdlZW4uZm9yRWFjaChmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZSA9IHZhbHVlLmNhbGwobm9kZSwgbm9kZS5fX2RhdGFfXywgaSkpIHsKICAgICAgICAgICAgICB0d2VlbmVkLnB1c2godmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGVhc2UgPSB0cmFuc2l0aW9uLmVhc2U7CiAgICAgICAgICBkdXJhdGlvbiA9IHRyYW5zaXRpb24uZHVyYXRpb247CiAgICAgICAgICBkMy50aW1lcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGltZXIuYyA9IHRpY2soZWxhcHNlZCB8fCAxKSA/IGQzX3RydWUgOiB0aWNrOwogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgIH0sIDAsIHRpbWUpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0aWNrKGVsYXBzZWQpIHsKICAgICAgICAgIGlmIChsb2NrLmFjdGl2ZSAhPT0gaWQpIHJldHVybiAxOwogICAgICAgICAgdmFyIHQgPSBlbGFwc2VkIC8gZHVyYXRpb24sIGUgPSBlYXNlKHQpLCBuID0gdHdlZW5lZC5sZW5ndGg7CiAgICAgICAgICB3aGlsZSAobiA+IDApIHsKICAgICAgICAgICAgdHdlZW5lZFstLW5dLmNhbGwobm9kZSwgZSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodCA+PSAxKSB7CiAgICAgICAgICAgIHRyYW5zaXRpb24uZXZlbnQgJiYgdHJhbnNpdGlvbi5ldmVudC5lbmQuY2FsbChub2RlLCBub2RlLl9fZGF0YV9fLCBpKTsKICAgICAgICAgICAgcmV0dXJuIHN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc3RvcCgpIHsKICAgICAgICAgIGlmICgtLWxvY2suY291bnQpIGRlbGV0ZSBsb2NrW2lkXTsgZWxzZSBkZWxldGUgbm9kZVtuc107CiAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9CiAgICAgIH0sIDAsIHRpbWUpOwogICAgfQogIH0KICBkMy5zdmcuYXhpcyA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHNjYWxlID0gZDMuc2NhbGUubGluZWFyKCksIG9yaWVudCA9IGQzX3N2Z19heGlzRGVmYXVsdE9yaWVudCwgaW5uZXJUaWNrU2l6ZSA9IDYsIG91dGVyVGlja1NpemUgPSA2LCB0aWNrUGFkZGluZyA9IDMsIHRpY2tBcmd1bWVudHNfID0gWyAxMCBdLCB0aWNrVmFsdWVzID0gbnVsbCwgdGlja0Zvcm1hdF87CiAgICBmdW5jdGlvbiBheGlzKGcpIHsKICAgICAgZy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBnID0gZDMuc2VsZWN0KHRoaXMpOwogICAgICAgIHZhciBzY2FsZTAgPSB0aGlzLl9fY2hhcnRfXyB8fCBzY2FsZSwgc2NhbGUxID0gdGhpcy5fX2NoYXJ0X18gPSBzY2FsZS5jb3B5KCk7CiAgICAgICAgdmFyIHRpY2tzID0gdGlja1ZhbHVlcyA9PSBudWxsID8gc2NhbGUxLnRpY2tzID8gc2NhbGUxLnRpY2tzLmFwcGx5KHNjYWxlMSwgdGlja0FyZ3VtZW50c18pIDogc2NhbGUxLmRvbWFpbigpIDogdGlja1ZhbHVlcywgdGlja0Zvcm1hdCA9IHRpY2tGb3JtYXRfID09IG51bGwgPyBzY2FsZTEudGlja0Zvcm1hdCA/IHNjYWxlMS50aWNrRm9ybWF0LmFwcGx5KHNjYWxlMSwgdGlja0FyZ3VtZW50c18pIDogZDNfaWRlbnRpdHkgOiB0aWNrRm9ybWF0XywgdGljayA9IGcuc2VsZWN0QWxsKCIudGljayIpLmRhdGEodGlja3MsIHNjYWxlMSksIHRpY2tFbnRlciA9IHRpY2suZW50ZXIoKS5pbnNlcnQoImciLCAiLmRvbWFpbiIpLmF0dHIoImNsYXNzIiwgInRpY2siKS5zdHlsZSgib3BhY2l0eSIsIM61KSwgdGlja0V4aXQgPSBkMy50cmFuc2l0aW9uKHRpY2suZXhpdCgpKS5zdHlsZSgib3BhY2l0eSIsIM61KS5yZW1vdmUoKSwgdGlja1VwZGF0ZSA9IGQzLnRyYW5zaXRpb24odGljay5vcmRlcigpKS5zdHlsZSgib3BhY2l0eSIsIDEpLCB0aWNrU3BhY2luZyA9IE1hdGgubWF4KGlubmVyVGlja1NpemUsIDApICsgdGlja1BhZGRpbmcsIHRpY2tUcmFuc2Zvcm07CiAgICAgICAgdmFyIHJhbmdlID0gZDNfc2NhbGVSYW5nZShzY2FsZTEpLCBwYXRoID0gZy5zZWxlY3RBbGwoIi5kb21haW4iKS5kYXRhKFsgMCBdKSwgcGF0aFVwZGF0ZSA9IChwYXRoLmVudGVyKCkuYXBwZW5kKCJwYXRoIikuYXR0cigiY2xhc3MiLCAiZG9tYWluIiksIAogICAgICAgIGQzLnRyYW5zaXRpb24ocGF0aCkpOwogICAgICAgIHRpY2tFbnRlci5hcHBlbmQoImxpbmUiKTsKICAgICAgICB0aWNrRW50ZXIuYXBwZW5kKCJ0ZXh0Iik7CiAgICAgICAgdmFyIGxpbmVFbnRlciA9IHRpY2tFbnRlci5zZWxlY3QoImxpbmUiKSwgbGluZVVwZGF0ZSA9IHRpY2tVcGRhdGUuc2VsZWN0KCJsaW5lIiksIHRleHQgPSB0aWNrLnNlbGVjdCgidGV4dCIpLnRleHQodGlja0Zvcm1hdCksIHRleHRFbnRlciA9IHRpY2tFbnRlci5zZWxlY3QoInRleHQiKSwgdGV4dFVwZGF0ZSA9IHRpY2tVcGRhdGUuc2VsZWN0KCJ0ZXh0IiksIHNpZ24gPSBvcmllbnQgPT09ICJ0b3AiIHx8IG9yaWVudCA9PT0gImxlZnQiID8gLTEgOiAxLCB4MSwgeDIsIHkxLCB5MjsKICAgICAgICBpZiAob3JpZW50ID09PSAiYm90dG9tIiB8fCBvcmllbnQgPT09ICJ0b3AiKSB7CiAgICAgICAgICB0aWNrVHJhbnNmb3JtID0gZDNfc3ZnX2F4aXNYLCB4MSA9ICJ4IiwgeTEgPSAieSIsIHgyID0gIngyIiwgeTIgPSAieTIiOwogICAgICAgICAgdGV4dC5hdHRyKCJkeSIsIHNpZ24gPCAwID8gIjBlbSIgOiAiLjcxZW0iKS5zdHlsZSgidGV4dC1hbmNob3IiLCAibWlkZGxlIik7CiAgICAgICAgICBwYXRoVXBkYXRlLmF0dHIoImQiLCAiTSIgKyByYW5nZVswXSArICIsIiArIHNpZ24gKiBvdXRlclRpY2tTaXplICsgIlYwSCIgKyByYW5nZVsxXSArICJWIiArIHNpZ24gKiBvdXRlclRpY2tTaXplKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGlja1RyYW5zZm9ybSA9IGQzX3N2Z19heGlzWSwgeDEgPSAieSIsIHkxID0gIngiLCB4MiA9ICJ5MiIsIHkyID0gIngyIjsKICAgICAgICAgIHRleHQuYXR0cigiZHkiLCAiLjMyZW0iKS5zdHlsZSgidGV4dC1hbmNob3IiLCBzaWduIDwgMCA/ICJlbmQiIDogInN0YXJ0Iik7CiAgICAgICAgICBwYXRoVXBkYXRlLmF0dHIoImQiLCAiTSIgKyBzaWduICogb3V0ZXJUaWNrU2l6ZSArICIsIiArIHJhbmdlWzBdICsgIkgwViIgKyByYW5nZVsxXSArICJIIiArIHNpZ24gKiBvdXRlclRpY2tTaXplKTsKICAgICAgICB9CiAgICAgICAgbGluZUVudGVyLmF0dHIoeTIsIHNpZ24gKiBpbm5lclRpY2tTaXplKTsKICAgICAgICB0ZXh0RW50ZXIuYXR0cih5MSwgc2lnbiAqIHRpY2tTcGFjaW5nKTsKICAgICAgICBsaW5lVXBkYXRlLmF0dHIoeDIsIDApLmF0dHIoeTIsIHNpZ24gKiBpbm5lclRpY2tTaXplKTsKICAgICAgICB0ZXh0VXBkYXRlLmF0dHIoeDEsIDApLmF0dHIoeTEsIHNpZ24gKiB0aWNrU3BhY2luZyk7CiAgICAgICAgaWYgKHNjYWxlMS5yYW5nZUJhbmQpIHsKICAgICAgICAgIHZhciB4ID0gc2NhbGUxLCBkeCA9IHgucmFuZ2VCYW5kKCkgLyAyOwogICAgICAgICAgc2NhbGUwID0gc2NhbGUxID0gZnVuY3Rpb24oZCkgewogICAgICAgICAgICByZXR1cm4geChkKSArIGR4OwogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgaWYgKHNjYWxlMC5yYW5nZUJhbmQpIHsKICAgICAgICAgIHNjYWxlMCA9IHNjYWxlMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGlja0V4aXQuY2FsbCh0aWNrVHJhbnNmb3JtLCBzY2FsZTEsIHNjYWxlMCk7CiAgICAgICAgfQogICAgICAgIHRpY2tFbnRlci5jYWxsKHRpY2tUcmFuc2Zvcm0sIHNjYWxlMCwgc2NhbGUxKTsKICAgICAgICB0aWNrVXBkYXRlLmNhbGwodGlja1RyYW5zZm9ybSwgc2NhbGUxLCBzY2FsZTEpOwogICAgICB9KTsKICAgIH0KICAgIGF4aXMuc2NhbGUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNjYWxlOwogICAgICBzY2FsZSA9IHg7CiAgICAgIHJldHVybiBheGlzOwogICAgfTsKICAgIGF4aXMub3JpZW50ID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBvcmllbnQ7CiAgICAgIG9yaWVudCA9IHggaW4gZDNfc3ZnX2F4aXNPcmllbnRzID8geCArICIiIDogZDNfc3ZnX2F4aXNEZWZhdWx0T3JpZW50OwogICAgICByZXR1cm4gYXhpczsKICAgIH07CiAgICBheGlzLnRpY2tzID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRpY2tBcmd1bWVudHNfOwogICAgICB0aWNrQXJndW1lbnRzXyA9IGFyZ3VtZW50czsKICAgICAgcmV0dXJuIGF4aXM7CiAgICB9OwogICAgYXhpcy50aWNrVmFsdWVzID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB0aWNrVmFsdWVzOwogICAgICB0aWNrVmFsdWVzID0geDsKICAgICAgcmV0dXJuIGF4aXM7CiAgICB9OwogICAgYXhpcy50aWNrRm9ybWF0ID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB0aWNrRm9ybWF0XzsKICAgICAgdGlja0Zvcm1hdF8gPSB4OwogICAgICByZXR1cm4gYXhpczsKICAgIH07CiAgICBheGlzLnRpY2tTaXplID0gZnVuY3Rpb24oeCkgewogICAgICB2YXIgbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIGlmICghbikgcmV0dXJuIGlubmVyVGlja1NpemU7CiAgICAgIGlubmVyVGlja1NpemUgPSAreDsKICAgICAgb3V0ZXJUaWNrU2l6ZSA9ICthcmd1bWVudHNbbiAtIDFdOwogICAgICByZXR1cm4gYXhpczsKICAgIH07CiAgICBheGlzLmlubmVyVGlja1NpemUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGlubmVyVGlja1NpemU7CiAgICAgIGlubmVyVGlja1NpemUgPSAreDsKICAgICAgcmV0dXJuIGF4aXM7CiAgICB9OwogICAgYXhpcy5vdXRlclRpY2tTaXplID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBvdXRlclRpY2tTaXplOwogICAgICBvdXRlclRpY2tTaXplID0gK3g7CiAgICAgIHJldHVybiBheGlzOwogICAgfTsKICAgIGF4aXMudGlja1BhZGRpbmcgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRpY2tQYWRkaW5nOwogICAgICB0aWNrUGFkZGluZyA9ICt4OwogICAgICByZXR1cm4gYXhpczsKICAgIH07CiAgICBheGlzLnRpY2tTdWJkaXZpZGUgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggJiYgYXhpczsKICAgIH07CiAgICByZXR1cm4gYXhpczsKICB9OwogIHZhciBkM19zdmdfYXhpc0RlZmF1bHRPcmllbnQgPSAiYm90dG9tIiwgZDNfc3ZnX2F4aXNPcmllbnRzID0gewogICAgdG9wOiAxLAogICAgcmlnaHQ6IDEsCiAgICBib3R0b206IDEsCiAgICBsZWZ0OiAxCiAgfTsKICBmdW5jdGlvbiBkM19zdmdfYXhpc1goc2VsZWN0aW9uLCB4MCwgeDEpIHsKICAgIHNlbGVjdGlvbi5hdHRyKCJ0cmFuc2Zvcm0iLCBmdW5jdGlvbihkKSB7CiAgICAgIHZhciB2MCA9IHgwKGQpOwogICAgICByZXR1cm4gInRyYW5zbGF0ZSgiICsgKGlzRmluaXRlKHYwKSA/IHYwIDogeDEoZCkpICsgIiwwKSI7CiAgICB9KTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2F4aXNZKHNlbGVjdGlvbiwgeTAsIHkxKSB7CiAgICBzZWxlY3Rpb24uYXR0cigidHJhbnNmb3JtIiwgZnVuY3Rpb24oZCkgewogICAgICB2YXIgdjAgPSB5MChkKTsKICAgICAgcmV0dXJuICJ0cmFuc2xhdGUoMCwiICsgKGlzRmluaXRlKHYwKSA/IHYwIDogeTEoZCkpICsgIikiOwogICAgfSk7CiAgfQogIGQzLnN2Zy5icnVzaCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGV2ZW50ID0gZDNfZXZlbnREaXNwYXRjaChicnVzaCwgImJydXNoc3RhcnQiLCAiYnJ1c2giLCAiYnJ1c2hlbmQiKSwgeCA9IG51bGwsIHkgPSBudWxsLCB4RXh0ZW50ID0gWyAwLCAwIF0sIHlFeHRlbnQgPSBbIDAsIDAgXSwgeEV4dGVudERvbWFpbiwgeUV4dGVudERvbWFpbiwgeENsYW1wID0gdHJ1ZSwgeUNsYW1wID0gdHJ1ZSwgcmVzaXplcyA9IGQzX3N2Z19icnVzaFJlc2l6ZXNbMF07CiAgICBmdW5jdGlvbiBicnVzaChnKSB7CiAgICAgIGcuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZyA9IGQzLnNlbGVjdCh0aGlzKS5zdHlsZSgicG9pbnRlci1ldmVudHMiLCAiYWxsIikuc3R5bGUoIi13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvciIsICJyZ2JhKDAsMCwwLDApIikub24oIm1vdXNlZG93bi5icnVzaCIsIGJydXNoc3RhcnQpLm9uKCJ0b3VjaHN0YXJ0LmJydXNoIiwgYnJ1c2hzdGFydCk7CiAgICAgICAgdmFyIGJhY2tncm91bmQgPSBnLnNlbGVjdEFsbCgiLmJhY2tncm91bmQiKS5kYXRhKFsgMCBdKTsKICAgICAgICBiYWNrZ3JvdW5kLmVudGVyKCkuYXBwZW5kKCJyZWN0IikuYXR0cigiY2xhc3MiLCAiYmFja2dyb3VuZCIpLnN0eWxlKCJ2aXNpYmlsaXR5IiwgImhpZGRlbiIpLnN0eWxlKCJjdXJzb3IiLCAiY3Jvc3NoYWlyIik7CiAgICAgICAgZy5zZWxlY3RBbGwoIi5leHRlbnQiKS5kYXRhKFsgMCBdKS5lbnRlcigpLmFwcGVuZCgicmVjdCIpLmF0dHIoImNsYXNzIiwgImV4dGVudCIpLnN0eWxlKCJjdXJzb3IiLCAibW92ZSIpOwogICAgICAgIHZhciByZXNpemUgPSBnLnNlbGVjdEFsbCgiLnJlc2l6ZSIpLmRhdGEocmVzaXplcywgZDNfaWRlbnRpdHkpOwogICAgICAgIHJlc2l6ZS5leGl0KCkucmVtb3ZlKCk7CiAgICAgICAgcmVzaXplLmVudGVyKCkuYXBwZW5kKCJnIikuYXR0cigiY2xhc3MiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICByZXR1cm4gInJlc2l6ZSAiICsgZDsKICAgICAgICB9KS5zdHlsZSgiY3Vyc29yIiwgZnVuY3Rpb24oZCkgewogICAgICAgICAgcmV0dXJuIGQzX3N2Z19icnVzaEN1cnNvcltkXTsKICAgICAgICB9KS5hcHBlbmQoInJlY3QiKS5hdHRyKCJ4IiwgZnVuY3Rpb24oZCkgewogICAgICAgICAgcmV0dXJuIC9bZXddJC8udGVzdChkKSA/IC0zIDogbnVsbDsKICAgICAgICB9KS5hdHRyKCJ5IiwgZnVuY3Rpb24oZCkgewogICAgICAgICAgcmV0dXJuIC9eW25zXS8udGVzdChkKSA/IC0zIDogbnVsbDsKICAgICAgICB9KS5hdHRyKCJ3aWR0aCIsIDYpLmF0dHIoImhlaWdodCIsIDYpLnN0eWxlKCJ2aXNpYmlsaXR5IiwgImhpZGRlbiIpOwogICAgICAgIHJlc2l6ZS5zdHlsZSgiZGlzcGxheSIsIGJydXNoLmVtcHR5KCkgPyAibm9uZSIgOiBudWxsKTsKICAgICAgICB2YXIgZ1VwZGF0ZSA9IGQzLnRyYW5zaXRpb24oZyksIGJhY2tncm91bmRVcGRhdGUgPSBkMy50cmFuc2l0aW9uKGJhY2tncm91bmQpLCByYW5nZTsKICAgICAgICBpZiAoeCkgewogICAgICAgICAgcmFuZ2UgPSBkM19zY2FsZVJhbmdlKHgpOwogICAgICAgICAgYmFja2dyb3VuZFVwZGF0ZS5hdHRyKCJ4IiwgcmFuZ2VbMF0pLmF0dHIoIndpZHRoIiwgcmFuZ2VbMV0gLSByYW5nZVswXSk7CiAgICAgICAgICByZWRyYXdYKGdVcGRhdGUpOwogICAgICAgIH0KICAgICAgICBpZiAoeSkgewogICAgICAgICAgcmFuZ2UgPSBkM19zY2FsZVJhbmdlKHkpOwogICAgICAgICAgYmFja2dyb3VuZFVwZGF0ZS5hdHRyKCJ5IiwgcmFuZ2VbMF0pLmF0dHIoImhlaWdodCIsIHJhbmdlWzFdIC0gcmFuZ2VbMF0pOwogICAgICAgICAgcmVkcmF3WShnVXBkYXRlKTsKICAgICAgICB9CiAgICAgICAgcmVkcmF3KGdVcGRhdGUpOwogICAgICB9KTsKICAgIH0KICAgIGJydXNoLmV2ZW50ID0gZnVuY3Rpb24oZykgewogICAgICBnLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGV2ZW50XyA9IGV2ZW50Lm9mKHRoaXMsIGFyZ3VtZW50cyksIGV4dGVudDEgPSB7CiAgICAgICAgICB4OiB4RXh0ZW50LAogICAgICAgICAgeTogeUV4dGVudCwKICAgICAgICAgIGk6IHhFeHRlbnREb21haW4sCiAgICAgICAgICBqOiB5RXh0ZW50RG9tYWluCiAgICAgICAgfSwgZXh0ZW50MCA9IHRoaXMuX19jaGFydF9fIHx8IGV4dGVudDE7CiAgICAgICAgdGhpcy5fX2NoYXJ0X18gPSBleHRlbnQxOwogICAgICAgIGlmIChkM190cmFuc2l0aW9uSW5oZXJpdElkKSB7CiAgICAgICAgICBkMy5zZWxlY3QodGhpcykudHJhbnNpdGlvbigpLmVhY2goInN0YXJ0LmJydXNoIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHhFeHRlbnREb21haW4gPSBleHRlbnQwLmk7CiAgICAgICAgICAgIHlFeHRlbnREb21haW4gPSBleHRlbnQwLmo7CiAgICAgICAgICAgIHhFeHRlbnQgPSBleHRlbnQwLng7CiAgICAgICAgICAgIHlFeHRlbnQgPSBleHRlbnQwLnk7CiAgICAgICAgICAgIGV2ZW50Xyh7CiAgICAgICAgICAgICAgdHlwZTogImJydXNoc3RhcnQiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkudHdlZW4oImJydXNoOmJydXNoIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciB4aSA9IGQzX2ludGVycG9sYXRlQXJyYXkoeEV4dGVudCwgZXh0ZW50MS54KSwgeWkgPSBkM19pbnRlcnBvbGF0ZUFycmF5KHlFeHRlbnQsIGV4dGVudDEueSk7CiAgICAgICAgICAgIHhFeHRlbnREb21haW4gPSB5RXh0ZW50RG9tYWluID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgICB4RXh0ZW50ID0gZXh0ZW50MS54ID0geGkodCk7CiAgICAgICAgICAgICAgeUV4dGVudCA9IGV4dGVudDEueSA9IHlpKHQpOwogICAgICAgICAgICAgIGV2ZW50Xyh7CiAgICAgICAgICAgICAgICB0eXBlOiAiYnJ1c2giLAogICAgICAgICAgICAgICAgbW9kZTogInJlc2l6ZSIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0pLmVhY2goImVuZC5icnVzaCIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICB4RXh0ZW50RG9tYWluID0gZXh0ZW50MS5pOwogICAgICAgICAgICB5RXh0ZW50RG9tYWluID0gZXh0ZW50MS5qOwogICAgICAgICAgICBldmVudF8oewogICAgICAgICAgICAgIHR5cGU6ICJicnVzaCIsCiAgICAgICAgICAgICAgbW9kZTogInJlc2l6ZSIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGV2ZW50Xyh7CiAgICAgICAgICAgICAgdHlwZTogImJydXNoZW5kIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBldmVudF8oewogICAgICAgICAgICB0eXBlOiAiYnJ1c2hzdGFydCIKICAgICAgICAgIH0pOwogICAgICAgICAgZXZlbnRfKHsKICAgICAgICAgICAgdHlwZTogImJydXNoIiwKICAgICAgICAgICAgbW9kZTogInJlc2l6ZSIKICAgICAgICAgIH0pOwogICAgICAgICAgZXZlbnRfKHsKICAgICAgICAgICAgdHlwZTogImJydXNoZW5kIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CiAgICBmdW5jdGlvbiByZWRyYXcoZykgewogICAgICBnLnNlbGVjdEFsbCgiLnJlc2l6ZSIpLmF0dHIoInRyYW5zZm9ybSIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICByZXR1cm4gInRyYW5zbGF0ZSgiICsgeEV4dGVudFsrL2UkLy50ZXN0KGQpXSArICIsIiArIHlFeHRlbnRbKy9ecy8udGVzdChkKV0gKyAiKSI7CiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gcmVkcmF3WChnKSB7CiAgICAgIGcuc2VsZWN0KCIuZXh0ZW50IikuYXR0cigieCIsIHhFeHRlbnRbMF0pOwogICAgICBnLnNlbGVjdEFsbCgiLmV4dGVudCwubj5yZWN0LC5zPnJlY3QiKS5hdHRyKCJ3aWR0aCIsIHhFeHRlbnRbMV0gLSB4RXh0ZW50WzBdKTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlZHJhd1koZykgewogICAgICBnLnNlbGVjdCgiLmV4dGVudCIpLmF0dHIoInkiLCB5RXh0ZW50WzBdKTsKICAgICAgZy5zZWxlY3RBbGwoIi5leHRlbnQsLmU+cmVjdCwudz5yZWN0IikuYXR0cigiaGVpZ2h0IiwgeUV4dGVudFsxXSAtIHlFeHRlbnRbMF0pOwogICAgfQogICAgZnVuY3Rpb24gYnJ1c2hzdGFydCgpIHsKICAgICAgdmFyIHRhcmdldCA9IHRoaXMsIGV2ZW50VGFyZ2V0ID0gZDMuc2VsZWN0KGQzLmV2ZW50LnRhcmdldCksIGV2ZW50XyA9IGV2ZW50Lm9mKHRhcmdldCwgYXJndW1lbnRzKSwgZyA9IGQzLnNlbGVjdCh0YXJnZXQpLCByZXNpemluZyA9IGV2ZW50VGFyZ2V0LmRhdHVtKCksIHJlc2l6aW5nWCA9ICEvXihufHMpJC8udGVzdChyZXNpemluZykgJiYgeCwgcmVzaXppbmdZID0gIS9eKGV8dykkLy50ZXN0KHJlc2l6aW5nKSAmJiB5LCBkcmFnZ2luZyA9IGV2ZW50VGFyZ2V0LmNsYXNzZWQoImV4dGVudCIpLCBkcmFnUmVzdG9yZSA9IGQzX2V2ZW50X2RyYWdTdXBwcmVzcygpLCBjZW50ZXIsIG9yaWdpbiA9IGQzLm1vdXNlKHRhcmdldCksIG9mZnNldDsKICAgICAgdmFyIHcgPSBkMy5zZWxlY3QoZDNfd2luZG93KS5vbigia2V5ZG93bi5icnVzaCIsIGtleWRvd24pLm9uKCJrZXl1cC5icnVzaCIsIGtleXVwKTsKICAgICAgaWYgKGQzLmV2ZW50LmNoYW5nZWRUb3VjaGVzKSB7CiAgICAgICAgdy5vbigidG91Y2htb3ZlLmJydXNoIiwgYnJ1c2htb3ZlKS5vbigidG91Y2hlbmQuYnJ1c2giLCBicnVzaGVuZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdy5vbigibW91c2Vtb3ZlLmJydXNoIiwgYnJ1c2htb3ZlKS5vbigibW91c2V1cC5icnVzaCIsIGJydXNoZW5kKTsKICAgICAgfQogICAgICBnLmludGVycnVwdCgpLnNlbGVjdEFsbCgiKiIpLmludGVycnVwdCgpOwogICAgICBpZiAoZHJhZ2dpbmcpIHsKICAgICAgICBvcmlnaW5bMF0gPSB4RXh0ZW50WzBdIC0gb3JpZ2luWzBdOwogICAgICAgIG9yaWdpblsxXSA9IHlFeHRlbnRbMF0gLSBvcmlnaW5bMV07CiAgICAgIH0gZWxzZSBpZiAocmVzaXppbmcpIHsKICAgICAgICB2YXIgZXggPSArL3ckLy50ZXN0KHJlc2l6aW5nKSwgZXkgPSArL15uLy50ZXN0KHJlc2l6aW5nKTsKICAgICAgICBvZmZzZXQgPSBbIHhFeHRlbnRbMSAtIGV4XSAtIG9yaWdpblswXSwgeUV4dGVudFsxIC0gZXldIC0gb3JpZ2luWzFdIF07CiAgICAgICAgb3JpZ2luWzBdID0geEV4dGVudFtleF07CiAgICAgICAgb3JpZ2luWzFdID0geUV4dGVudFtleV07CiAgICAgIH0gZWxzZSBpZiAoZDMuZXZlbnQuYWx0S2V5KSBjZW50ZXIgPSBvcmlnaW4uc2xpY2UoKTsKICAgICAgZy5zdHlsZSgicG9pbnRlci1ldmVudHMiLCAibm9uZSIpLnNlbGVjdEFsbCgiLnJlc2l6ZSIpLnN0eWxlKCJkaXNwbGF5IiwgbnVsbCk7CiAgICAgIGQzLnNlbGVjdCgiYm9keSIpLnN0eWxlKCJjdXJzb3IiLCBldmVudFRhcmdldC5zdHlsZSgiY3Vyc29yIikpOwogICAgICBldmVudF8oewogICAgICAgIHR5cGU6ICJicnVzaHN0YXJ0IgogICAgICB9KTsKICAgICAgYnJ1c2htb3ZlKCk7CiAgICAgIGZ1bmN0aW9uIGtleWRvd24oKSB7CiAgICAgICAgaWYgKGQzLmV2ZW50LmtleUNvZGUgPT0gMzIpIHsKICAgICAgICAgIGlmICghZHJhZ2dpbmcpIHsKICAgICAgICAgICAgY2VudGVyID0gbnVsbDsKICAgICAgICAgICAgb3JpZ2luWzBdIC09IHhFeHRlbnRbMV07CiAgICAgICAgICAgIG9yaWdpblsxXSAtPSB5RXh0ZW50WzFdOwogICAgICAgICAgICBkcmFnZ2luZyA9IDI7CiAgICAgICAgICB9CiAgICAgICAgICBkM19ldmVudFByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGtleXVwKCkgewogICAgICAgIGlmIChkMy5ldmVudC5rZXlDb2RlID09IDMyICYmIGRyYWdnaW5nID09IDIpIHsKICAgICAgICAgIG9yaWdpblswXSArPSB4RXh0ZW50WzFdOwogICAgICAgICAgb3JpZ2luWzFdICs9IHlFeHRlbnRbMV07CiAgICAgICAgICBkcmFnZ2luZyA9IDA7CiAgICAgICAgICBkM19ldmVudFByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGJydXNobW92ZSgpIHsKICAgICAgICB2YXIgcG9pbnQgPSBkMy5tb3VzZSh0YXJnZXQpLCBtb3ZlZCA9IGZhbHNlOwogICAgICAgIGlmIChvZmZzZXQpIHsKICAgICAgICAgIHBvaW50WzBdICs9IG9mZnNldFswXTsKICAgICAgICAgIHBvaW50WzFdICs9IG9mZnNldFsxXTsKICAgICAgICB9CiAgICAgICAgaWYgKCFkcmFnZ2luZykgewogICAgICAgICAgaWYgKGQzLmV2ZW50LmFsdEtleSkgewogICAgICAgICAgICBpZiAoIWNlbnRlcikgY2VudGVyID0gWyAoeEV4dGVudFswXSArIHhFeHRlbnRbMV0pIC8gMiwgKHlFeHRlbnRbMF0gKyB5RXh0ZW50WzFdKSAvIDIgXTsKICAgICAgICAgICAgb3JpZ2luWzBdID0geEV4dGVudFsrKHBvaW50WzBdIDwgY2VudGVyWzBdKV07CiAgICAgICAgICAgIG9yaWdpblsxXSA9IHlFeHRlbnRbKyhwb2ludFsxXSA8IGNlbnRlclsxXSldOwogICAgICAgICAgfSBlbHNlIGNlbnRlciA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGlmIChyZXNpemluZ1ggJiYgbW92ZTEocG9pbnQsIHgsIDApKSB7CiAgICAgICAgICByZWRyYXdYKGcpOwogICAgICAgICAgbW92ZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAocmVzaXppbmdZICYmIG1vdmUxKHBvaW50LCB5LCAxKSkgewogICAgICAgICAgcmVkcmF3WShnKTsKICAgICAgICAgIG1vdmVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKG1vdmVkKSB7CiAgICAgICAgICByZWRyYXcoZyk7CiAgICAgICAgICBldmVudF8oewogICAgICAgICAgICB0eXBlOiAiYnJ1c2giLAogICAgICAgICAgICBtb2RlOiBkcmFnZ2luZyA/ICJtb3ZlIiA6ICJyZXNpemUiCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbW92ZTEocG9pbnQsIHNjYWxlLCBpKSB7CiAgICAgICAgdmFyIHJhbmdlID0gZDNfc2NhbGVSYW5nZShzY2FsZSksIHIwID0gcmFuZ2VbMF0sIHIxID0gcmFuZ2VbMV0sIHBvc2l0aW9uID0gb3JpZ2luW2ldLCBleHRlbnQgPSBpID8geUV4dGVudCA6IHhFeHRlbnQsIHNpemUgPSBleHRlbnRbMV0gLSBleHRlbnRbMF0sIG1pbiwgbWF4OwogICAgICAgIGlmIChkcmFnZ2luZykgewogICAgICAgICAgcjAgLT0gcG9zaXRpb247CiAgICAgICAgICByMSAtPSBzaXplICsgcG9zaXRpb247CiAgICAgICAgfQogICAgICAgIG1pbiA9IChpID8geUNsYW1wIDogeENsYW1wKSA/IE1hdGgubWF4KHIwLCBNYXRoLm1pbihyMSwgcG9pbnRbaV0pKSA6IHBvaW50W2ldOwogICAgICAgIGlmIChkcmFnZ2luZykgewogICAgICAgICAgbWF4ID0gKG1pbiArPSBwb3NpdGlvbikgKyBzaXplOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoY2VudGVyKSBwb3NpdGlvbiA9IE1hdGgubWF4KHIwLCBNYXRoLm1pbihyMSwgMiAqIGNlbnRlcltpXSAtIG1pbikpOwogICAgICAgICAgaWYgKHBvc2l0aW9uIDwgbWluKSB7CiAgICAgICAgICAgIG1heCA9IG1pbjsKICAgICAgICAgICAgbWluID0gcG9zaXRpb247CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtYXggPSBwb3NpdGlvbjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGV4dGVudFswXSAhPSBtaW4gfHwgZXh0ZW50WzFdICE9IG1heCkgewogICAgICAgICAgaWYgKGkpIHlFeHRlbnREb21haW4gPSBudWxsOyBlbHNlIHhFeHRlbnREb21haW4gPSBudWxsOwogICAgICAgICAgZXh0ZW50WzBdID0gbWluOwogICAgICAgICAgZXh0ZW50WzFdID0gbWF4OwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGJydXNoZW5kKCkgewogICAgICAgIGJydXNobW92ZSgpOwogICAgICAgIGcuc3R5bGUoInBvaW50ZXItZXZlbnRzIiwgImFsbCIpLnNlbGVjdEFsbCgiLnJlc2l6ZSIpLnN0eWxlKCJkaXNwbGF5IiwgYnJ1c2guZW1wdHkoKSA/ICJub25lIiA6IG51bGwpOwogICAgICAgIGQzLnNlbGVjdCgiYm9keSIpLnN0eWxlKCJjdXJzb3IiLCBudWxsKTsKICAgICAgICB3Lm9uKCJtb3VzZW1vdmUuYnJ1c2giLCBudWxsKS5vbigibW91c2V1cC5icnVzaCIsIG51bGwpLm9uKCJ0b3VjaG1vdmUuYnJ1c2giLCBudWxsKS5vbigidG91Y2hlbmQuYnJ1c2giLCBudWxsKS5vbigia2V5ZG93bi5icnVzaCIsIG51bGwpLm9uKCJrZXl1cC5icnVzaCIsIG51bGwpOwogICAgICAgIGRyYWdSZXN0b3JlKCk7CiAgICAgICAgZXZlbnRfKHsKICAgICAgICAgIHR5cGU6ICJicnVzaGVuZCIKICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgYnJ1c2gueCA9IGZ1bmN0aW9uKHopIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4geDsKICAgICAgeCA9IHo7CiAgICAgIHJlc2l6ZXMgPSBkM19zdmdfYnJ1c2hSZXNpemVzWyF4IDw8IDEgfCAheV07CiAgICAgIHJldHVybiBicnVzaDsKICAgIH07CiAgICBicnVzaC55ID0gZnVuY3Rpb24oeikgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB5OwogICAgICB5ID0gejsKICAgICAgcmVzaXplcyA9IGQzX3N2Z19icnVzaFJlc2l6ZXNbIXggPDwgMSB8ICF5XTsKICAgICAgcmV0dXJuIGJydXNoOwogICAgfTsKICAgIGJydXNoLmNsYW1wID0gZnVuY3Rpb24oeikgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB4ICYmIHkgPyBbIHhDbGFtcCwgeUNsYW1wIF0gOiB4ID8geENsYW1wIDogeSA/IHlDbGFtcCA6IG51bGw7CiAgICAgIGlmICh4ICYmIHkpIHhDbGFtcCA9ICEhelswXSwgeUNsYW1wID0gISF6WzFdOyBlbHNlIGlmICh4KSB4Q2xhbXAgPSAhIXo7IGVsc2UgaWYgKHkpIHlDbGFtcCA9ICEhejsKICAgICAgcmV0dXJuIGJydXNoOwogICAgfTsKICAgIGJydXNoLmV4dGVudCA9IGZ1bmN0aW9uKHopIHsKICAgICAgdmFyIHgwLCB4MSwgeTAsIHkxLCB0OwogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgICBpZiAoeCkgewogICAgICAgICAgaWYgKHhFeHRlbnREb21haW4pIHsKICAgICAgICAgICAgeDAgPSB4RXh0ZW50RG9tYWluWzBdLCB4MSA9IHhFeHRlbnREb21haW5bMV07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB4MCA9IHhFeHRlbnRbMF0sIHgxID0geEV4dGVudFsxXTsKICAgICAgICAgICAgaWYgKHguaW52ZXJ0KSB4MCA9IHguaW52ZXJ0KHgwKSwgeDEgPSB4LmludmVydCh4MSk7CiAgICAgICAgICAgIGlmICh4MSA8IHgwKSB0ID0geDAsIHgwID0geDEsIHgxID0gdDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHkpIHsKICAgICAgICAgIGlmICh5RXh0ZW50RG9tYWluKSB7CiAgICAgICAgICAgIHkwID0geUV4dGVudERvbWFpblswXSwgeTEgPSB5RXh0ZW50RG9tYWluWzFdOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgeTAgPSB5RXh0ZW50WzBdLCB5MSA9IHlFeHRlbnRbMV07CiAgICAgICAgICAgIGlmICh5LmludmVydCkgeTAgPSB5LmludmVydCh5MCksIHkxID0geS5pbnZlcnQoeTEpOwogICAgICAgICAgICBpZiAoeTEgPCB5MCkgdCA9IHkwLCB5MCA9IHkxLCB5MSA9IHQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB4ICYmIHkgPyBbIFsgeDAsIHkwIF0sIFsgeDEsIHkxIF0gXSA6IHggPyBbIHgwLCB4MSBdIDogeSAmJiBbIHkwLCB5MSBdOwogICAgICB9CiAgICAgIGlmICh4KSB7CiAgICAgICAgeDAgPSB6WzBdLCB4MSA9IHpbMV07CiAgICAgICAgaWYgKHkpIHgwID0geDBbMF0sIHgxID0geDFbMF07CiAgICAgICAgeEV4dGVudERvbWFpbiA9IFsgeDAsIHgxIF07CiAgICAgICAgaWYgKHguaW52ZXJ0KSB4MCA9IHgoeDApLCB4MSA9IHgoeDEpOwogICAgICAgIGlmICh4MSA8IHgwKSB0ID0geDAsIHgwID0geDEsIHgxID0gdDsKICAgICAgICBpZiAoeDAgIT0geEV4dGVudFswXSB8fCB4MSAhPSB4RXh0ZW50WzFdKSB4RXh0ZW50ID0gWyB4MCwgeDEgXTsKICAgICAgfQogICAgICBpZiAoeSkgewogICAgICAgIHkwID0gelswXSwgeTEgPSB6WzFdOwogICAgICAgIGlmICh4KSB5MCA9IHkwWzFdLCB5MSA9IHkxWzFdOwogICAgICAgIHlFeHRlbnREb21haW4gPSBbIHkwLCB5MSBdOwogICAgICAgIGlmICh5LmludmVydCkgeTAgPSB5KHkwKSwgeTEgPSB5KHkxKTsKICAgICAgICBpZiAoeTEgPCB5MCkgdCA9IHkwLCB5MCA9IHkxLCB5MSA9IHQ7CiAgICAgICAgaWYgKHkwICE9IHlFeHRlbnRbMF0gfHwgeTEgIT0geUV4dGVudFsxXSkgeUV4dGVudCA9IFsgeTAsIHkxIF07CiAgICAgIH0KICAgICAgcmV0dXJuIGJydXNoOwogICAgfTsKICAgIGJydXNoLmNsZWFyID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmICghYnJ1c2guZW1wdHkoKSkgewogICAgICAgIHhFeHRlbnQgPSBbIDAsIDAgXSwgeUV4dGVudCA9IFsgMCwgMCBdOwogICAgICAgIHhFeHRlbnREb21haW4gPSB5RXh0ZW50RG9tYWluID0gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gYnJ1c2g7CiAgICB9OwogICAgYnJ1c2guZW1wdHkgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICEheCAmJiB4RXh0ZW50WzBdID09IHhFeHRlbnRbMV0gfHwgISF5ICYmIHlFeHRlbnRbMF0gPT0geUV4dGVudFsxXTsKICAgIH07CiAgICByZXR1cm4gZDMucmViaW5kKGJydXNoLCBldmVudCwgIm9uIik7CiAgfTsKICB2YXIgZDNfc3ZnX2JydXNoQ3Vyc29yID0gewogICAgbjogIm5zLXJlc2l6ZSIsCiAgICBlOiAiZXctcmVzaXplIiwKICAgIHM6ICJucy1yZXNpemUiLAogICAgdzogImV3LXJlc2l6ZSIsCiAgICBudzogIm53c2UtcmVzaXplIiwKICAgIG5lOiAibmVzdy1yZXNpemUiLAogICAgc2U6ICJud3NlLXJlc2l6ZSIsCiAgICBzdzogIm5lc3ctcmVzaXplIgogIH07CiAgdmFyIGQzX3N2Z19icnVzaFJlc2l6ZXMgPSBbIFsgIm4iLCAiZSIsICJzIiwgInciLCAibnciLCAibmUiLCAic2UiLCAic3ciIF0sIFsgImUiLCAidyIgXSwgWyAibiIsICJzIiBdLCBbXSBdOwogIHZhciBkM190aW1lX2Zvcm1hdCA9IGQzX3RpbWUuZm9ybWF0ID0gZDNfbG9jYWxlX2VuVVMudGltZUZvcm1hdDsKICB2YXIgZDNfdGltZV9mb3JtYXRVdGMgPSBkM190aW1lX2Zvcm1hdC51dGM7CiAgdmFyIGQzX3RpbWVfZm9ybWF0SXNvID0gZDNfdGltZV9mb3JtYXRVdGMoIiVZLSVtLSVkVCVIOiVNOiVTLiVMWiIpOwogIGQzX3RpbWVfZm9ybWF0LmlzbyA9IERhdGUucHJvdG90eXBlLnRvSVNPU3RyaW5nICYmICtuZXcgRGF0ZSgiMjAwMC0wMS0wMVQwMDowMDowMC4wMDBaIikgPyBkM190aW1lX2Zvcm1hdElzb05hdGl2ZSA6IGQzX3RpbWVfZm9ybWF0SXNvOwogIGZ1bmN0aW9uIGQzX3RpbWVfZm9ybWF0SXNvTmF0aXZlKGRhdGUpIHsKICAgIHJldHVybiBkYXRlLnRvSVNPU3RyaW5nKCk7CiAgfQogIGQzX3RpbWVfZm9ybWF0SXNvTmF0aXZlLnBhcnNlID0gZnVuY3Rpb24oc3RyaW5nKSB7CiAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKHN0cmluZyk7CiAgICByZXR1cm4gaXNOYU4oZGF0ZSkgPyBudWxsIDogZGF0ZTsKICB9OwogIGQzX3RpbWVfZm9ybWF0SXNvTmF0aXZlLnRvU3RyaW5nID0gZDNfdGltZV9mb3JtYXRJc28udG9TdHJpbmc7CiAgZDNfdGltZS5zZWNvbmQgPSBkM190aW1lX2ludGVydmFsKGZ1bmN0aW9uKGRhdGUpIHsKICAgIHJldHVybiBuZXcgZDNfZGF0ZShNYXRoLmZsb29yKGRhdGUgLyAxZTMpICogMWUzKTsKICB9LCBmdW5jdGlvbihkYXRlLCBvZmZzZXQpIHsKICAgIGRhdGUuc2V0VGltZShkYXRlLmdldFRpbWUoKSArIE1hdGguZmxvb3Iob2Zmc2V0KSAqIDFlMyk7CiAgfSwgZnVuY3Rpb24oZGF0ZSkgewogICAgcmV0dXJuIGRhdGUuZ2V0U2Vjb25kcygpOwogIH0pOwogIGQzX3RpbWUuc2Vjb25kcyA9IGQzX3RpbWUuc2Vjb25kLnJhbmdlOwogIGQzX3RpbWUuc2Vjb25kcy51dGMgPSBkM190aW1lLnNlY29uZC51dGMucmFuZ2U7CiAgZDNfdGltZS5taW51dGUgPSBkM190aW1lX2ludGVydmFsKGZ1bmN0aW9uKGRhdGUpIHsKICAgIHJldHVybiBuZXcgZDNfZGF0ZShNYXRoLmZsb29yKGRhdGUgLyA2ZTQpICogNmU0KTsKICB9LCBmdW5jdGlvbihkYXRlLCBvZmZzZXQpIHsKICAgIGRhdGUuc2V0VGltZShkYXRlLmdldFRpbWUoKSArIE1hdGguZmxvb3Iob2Zmc2V0KSAqIDZlNCk7CiAgfSwgZnVuY3Rpb24oZGF0ZSkgewogICAgcmV0dXJuIGRhdGUuZ2V0TWludXRlcygpOwogIH0pOwogIGQzX3RpbWUubWludXRlcyA9IGQzX3RpbWUubWludXRlLnJhbmdlOwogIGQzX3RpbWUubWludXRlcy51dGMgPSBkM190aW1lLm1pbnV0ZS51dGMucmFuZ2U7CiAgZDNfdGltZS5ob3VyID0gZDNfdGltZV9pbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgICB2YXIgdGltZXpvbmUgPSBkYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkgLyA2MDsKICAgIHJldHVybiBuZXcgZDNfZGF0ZSgoTWF0aC5mbG9vcihkYXRlIC8gMzZlNSAtIHRpbWV6b25lKSArIHRpbWV6b25lKSAqIDM2ZTUpOwogIH0sIGZ1bmN0aW9uKGRhdGUsIG9mZnNldCkgewogICAgZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpICsgTWF0aC5mbG9vcihvZmZzZXQpICogMzZlNSk7CiAgfSwgZnVuY3Rpb24oZGF0ZSkgewogICAgcmV0dXJuIGRhdGUuZ2V0SG91cnMoKTsKICB9KTsKICBkM190aW1lLmhvdXJzID0gZDNfdGltZS5ob3VyLnJhbmdlOwogIGQzX3RpbWUuaG91cnMudXRjID0gZDNfdGltZS5ob3VyLnV0Yy5yYW5nZTsKICBkM190aW1lLm1vbnRoID0gZDNfdGltZV9pbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgICBkYXRlID0gZDNfdGltZS5kYXkoZGF0ZSk7CiAgICBkYXRlLnNldERhdGUoMSk7CiAgICByZXR1cm4gZGF0ZTsKICB9LCBmdW5jdGlvbihkYXRlLCBvZmZzZXQpIHsKICAgIGRhdGUuc2V0TW9udGgoZGF0ZS5nZXRNb250aCgpICsgb2Zmc2V0KTsKICB9LCBmdW5jdGlvbihkYXRlKSB7CiAgICByZXR1cm4gZGF0ZS5nZXRNb250aCgpOwogIH0pOwogIGQzX3RpbWUubW9udGhzID0gZDNfdGltZS5tb250aC5yYW5nZTsKICBkM190aW1lLm1vbnRocy51dGMgPSBkM190aW1lLm1vbnRoLnV0Yy5yYW5nZTsKICBmdW5jdGlvbiBkM190aW1lX3NjYWxlKGxpbmVhciwgbWV0aG9kcywgZm9ybWF0KSB7CiAgICBmdW5jdGlvbiBzY2FsZSh4KSB7CiAgICAgIHJldHVybiBsaW5lYXIoeCk7CiAgICB9CiAgICBzY2FsZS5pbnZlcnQgPSBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiBkM190aW1lX3NjYWxlRGF0ZShsaW5lYXIuaW52ZXJ0KHgpKTsKICAgIH07CiAgICBzY2FsZS5kb21haW4gPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGxpbmVhci5kb21haW4oKS5tYXAoZDNfdGltZV9zY2FsZURhdGUpOwogICAgICBsaW5lYXIuZG9tYWluKHgpOwogICAgICByZXR1cm4gc2NhbGU7CiAgICB9OwogICAgZnVuY3Rpb24gdGlja01ldGhvZChleHRlbnQsIGNvdW50KSB7CiAgICAgIHZhciBzcGFuID0gZXh0ZW50WzFdIC0gZXh0ZW50WzBdLCB0YXJnZXQgPSBzcGFuIC8gY291bnQsIGkgPSBkMy5iaXNlY3QoZDNfdGltZV9zY2FsZVN0ZXBzLCB0YXJnZXQpOwogICAgICByZXR1cm4gaSA9PSBkM190aW1lX3NjYWxlU3RlcHMubGVuZ3RoID8gWyBtZXRob2RzLnllYXIsIGQzX3NjYWxlX2xpbmVhclRpY2tSYW5nZShleHRlbnQubWFwKGZ1bmN0aW9uKGQpIHsKICAgICAgICByZXR1cm4gZCAvIDMxNTM2ZTY7CiAgICAgIH0pLCBjb3VudClbMl0gXSA6ICFpID8gWyBkM190aW1lX3NjYWxlTWlsbGlzZWNvbmRzLCBkM19zY2FsZV9saW5lYXJUaWNrUmFuZ2UoZXh0ZW50LCBjb3VudClbMl0gXSA6IG1ldGhvZHNbdGFyZ2V0IC8gZDNfdGltZV9zY2FsZVN0ZXBzW2kgLSAxXSA8IGQzX3RpbWVfc2NhbGVTdGVwc1tpXSAvIHRhcmdldCA/IGkgLSAxIDogaV07CiAgICB9CiAgICBzY2FsZS5uaWNlID0gZnVuY3Rpb24oaW50ZXJ2YWwsIHNraXApIHsKICAgICAgdmFyIGRvbWFpbiA9IHNjYWxlLmRvbWFpbigpLCBleHRlbnQgPSBkM19zY2FsZUV4dGVudChkb21haW4pLCBtZXRob2QgPSBpbnRlcnZhbCA9PSBudWxsID8gdGlja01ldGhvZChleHRlbnQsIDEwKSA6IHR5cGVvZiBpbnRlcnZhbCA9PT0gIm51bWJlciIgJiYgdGlja01ldGhvZChleHRlbnQsIGludGVydmFsKTsKICAgICAgaWYgKG1ldGhvZCkgaW50ZXJ2YWwgPSBtZXRob2RbMF0sIHNraXAgPSBtZXRob2RbMV07CiAgICAgIGZ1bmN0aW9uIHNraXBwZWQoZGF0ZSkgewogICAgICAgIHJldHVybiAhaXNOYU4oZGF0ZSkgJiYgIWludGVydmFsLnJhbmdlKGRhdGUsIGQzX3RpbWVfc2NhbGVEYXRlKCtkYXRlICsgMSksIHNraXApLmxlbmd0aDsKICAgICAgfQogICAgICByZXR1cm4gc2NhbGUuZG9tYWluKGQzX3NjYWxlX25pY2UoZG9tYWluLCBza2lwID4gMSA/IHsKICAgICAgICBmbG9vcjogZnVuY3Rpb24oZGF0ZSkgewogICAgICAgICAgd2hpbGUgKHNraXBwZWQoZGF0ZSA9IGludGVydmFsLmZsb29yKGRhdGUpKSkgZGF0ZSA9IGQzX3RpbWVfc2NhbGVEYXRlKGRhdGUgLSAxKTsKICAgICAgICAgIHJldHVybiBkYXRlOwogICAgICAgIH0sCiAgICAgICAgY2VpbDogZnVuY3Rpb24oZGF0ZSkgewogICAgICAgICAgd2hpbGUgKHNraXBwZWQoZGF0ZSA9IGludGVydmFsLmNlaWwoZGF0ZSkpKSBkYXRlID0gZDNfdGltZV9zY2FsZURhdGUoK2RhdGUgKyAxKTsKICAgICAgICAgIHJldHVybiBkYXRlOwogICAgICAgIH0KICAgICAgfSA6IGludGVydmFsKSk7CiAgICB9OwogICAgc2NhbGUudGlja3MgPSBmdW5jdGlvbihpbnRlcnZhbCwgc2tpcCkgewogICAgICB2YXIgZXh0ZW50ID0gZDNfc2NhbGVFeHRlbnQoc2NhbGUuZG9tYWluKCkpLCBtZXRob2QgPSBpbnRlcnZhbCA9PSBudWxsID8gdGlja01ldGhvZChleHRlbnQsIDEwKSA6IHR5cGVvZiBpbnRlcnZhbCA9PT0gIm51bWJlciIgPyB0aWNrTWV0aG9kKGV4dGVudCwgaW50ZXJ2YWwpIDogIWludGVydmFsLnJhbmdlICYmIFsgewogICAgICAgIHJhbmdlOiBpbnRlcnZhbAogICAgICB9LCBza2lwIF07CiAgICAgIGlmIChtZXRob2QpIGludGVydmFsID0gbWV0aG9kWzBdLCBza2lwID0gbWV0aG9kWzFdOwogICAgICByZXR1cm4gaW50ZXJ2YWwucmFuZ2UoZXh0ZW50WzBdLCBkM190aW1lX3NjYWxlRGF0ZSgrZXh0ZW50WzFdICsgMSksIHNraXAgPCAxID8gMSA6IHNraXApOwogICAgfTsKICAgIHNjYWxlLnRpY2tGb3JtYXQgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGZvcm1hdDsKICAgIH07CiAgICBzY2FsZS5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkM190aW1lX3NjYWxlKGxpbmVhci5jb3B5KCksIG1ldGhvZHMsIGZvcm1hdCk7CiAgICB9OwogICAgcmV0dXJuIGQzX3NjYWxlX2xpbmVhclJlYmluZChzY2FsZSwgbGluZWFyKTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9zY2FsZURhdGUodCkgewogICAgcmV0dXJuIG5ldyBEYXRlKHQpOwogIH0KICB2YXIgZDNfdGltZV9zY2FsZVN0ZXBzID0gWyAxZTMsIDVlMywgMTVlMywgM2U0LCA2ZTQsIDNlNSwgOWU1LCAxOGU1LCAzNmU1LCAxMDhlNSwgMjE2ZTUsIDQzMmU1LCA4NjRlNSwgMTcyOGU1LCA2MDQ4ZTUsIDI1OTJlNiwgNzc3NmU2LCAzMTUzNmU2IF07CiAgdmFyIGQzX3RpbWVfc2NhbGVMb2NhbE1ldGhvZHMgPSBbIFsgZDNfdGltZS5zZWNvbmQsIDEgXSwgWyBkM190aW1lLnNlY29uZCwgNSBdLCBbIGQzX3RpbWUuc2Vjb25kLCAxNSBdLCBbIGQzX3RpbWUuc2Vjb25kLCAzMCBdLCBbIGQzX3RpbWUubWludXRlLCAxIF0sIFsgZDNfdGltZS5taW51dGUsIDUgXSwgWyBkM190aW1lLm1pbnV0ZSwgMTUgXSwgWyBkM190aW1lLm1pbnV0ZSwgMzAgXSwgWyBkM190aW1lLmhvdXIsIDEgXSwgWyBkM190aW1lLmhvdXIsIDMgXSwgWyBkM190aW1lLmhvdXIsIDYgXSwgWyBkM190aW1lLmhvdXIsIDEyIF0sIFsgZDNfdGltZS5kYXksIDEgXSwgWyBkM190aW1lLmRheSwgMiBdLCBbIGQzX3RpbWUud2VlaywgMSBdLCBbIGQzX3RpbWUubW9udGgsIDEgXSwgWyBkM190aW1lLm1vbnRoLCAzIF0sIFsgZDNfdGltZS55ZWFyLCAxIF0gXTsKICB2YXIgZDNfdGltZV9zY2FsZUxvY2FsRm9ybWF0ID0gZDNfdGltZV9mb3JtYXQubXVsdGkoWyBbICIuJUwiLCBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gZC5nZXRNaWxsaXNlY29uZHMoKTsKICB9IF0sIFsgIjolUyIsIGZ1bmN0aW9uKGQpIHsKICAgIHJldHVybiBkLmdldFNlY29uZHMoKTsKICB9IF0sIFsgIiVJOiVNIiwgZnVuY3Rpb24oZCkgewogICAgcmV0dXJuIGQuZ2V0TWludXRlcygpOwogIH0gXSwgWyAiJUkgJXAiLCBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gZC5nZXRIb3VycygpOwogIH0gXSwgWyAiJWEgJWQiLCBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gZC5nZXREYXkoKSAmJiBkLmdldERhdGUoKSAhPSAxOwogIH0gXSwgWyAiJWIgJWQiLCBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gZC5nZXREYXRlKCkgIT0gMTsKICB9IF0sIFsgIiVCIiwgZnVuY3Rpb24oZCkgewogICAgcmV0dXJuIGQuZ2V0TW9udGgoKTsKICB9IF0sIFsgIiVZIiwgZDNfdHJ1ZSBdIF0pOwogIHZhciBkM190aW1lX3NjYWxlTWlsbGlzZWNvbmRzID0gewogICAgcmFuZ2U6IGZ1bmN0aW9uKHN0YXJ0LCBzdG9wLCBzdGVwKSB7CiAgICAgIHJldHVybiBkMy5yYW5nZShNYXRoLmNlaWwoc3RhcnQgLyBzdGVwKSAqIHN0ZXAsICtzdG9wLCBzdGVwKS5tYXAoZDNfdGltZV9zY2FsZURhdGUpOwogICAgfSwKICAgIGZsb29yOiBkM19pZGVudGl0eSwKICAgIGNlaWw6IGQzX2lkZW50aXR5CiAgfTsKICBkM190aW1lX3NjYWxlTG9jYWxNZXRob2RzLnllYXIgPSBkM190aW1lLnllYXI7CiAgZDNfdGltZS5zY2FsZSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX3RpbWVfc2NhbGUoZDMuc2NhbGUubGluZWFyKCksIGQzX3RpbWVfc2NhbGVMb2NhbE1ldGhvZHMsIGQzX3RpbWVfc2NhbGVMb2NhbEZvcm1hdCk7CiAgfTsKICB2YXIgZDNfdGltZV9zY2FsZVV0Y01ldGhvZHMgPSBkM190aW1lX3NjYWxlTG9jYWxNZXRob2RzLm1hcChmdW5jdGlvbihtKSB7CiAgICByZXR1cm4gWyBtWzBdLnV0YywgbVsxXSBdOwogIH0pOwogIHZhciBkM190aW1lX3NjYWxlVXRjRm9ybWF0ID0gZDNfdGltZV9mb3JtYXRVdGMubXVsdGkoWyBbICIuJUwiLCBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gZC5nZXRVVENNaWxsaXNlY29uZHMoKTsKICB9IF0sIFsgIjolUyIsIGZ1bmN0aW9uKGQpIHsKICAgIHJldHVybiBkLmdldFVUQ1NlY29uZHMoKTsKICB9IF0sIFsgIiVJOiVNIiwgZnVuY3Rpb24oZCkgewogICAgcmV0dXJuIGQuZ2V0VVRDTWludXRlcygpOwogIH0gXSwgWyAiJUkgJXAiLCBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gZC5nZXRVVENIb3VycygpOwogIH0gXSwgWyAiJWEgJWQiLCBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gZC5nZXRVVENEYXkoKSAmJiBkLmdldFVUQ0RhdGUoKSAhPSAxOwogIH0gXSwgWyAiJWIgJWQiLCBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gZC5nZXRVVENEYXRlKCkgIT0gMTsKICB9IF0sIFsgIiVCIiwgZnVuY3Rpb24oZCkgewogICAgcmV0dXJuIGQuZ2V0VVRDTW9udGgoKTsKICB9IF0sIFsgIiVZIiwgZDNfdHJ1ZSBdIF0pOwogIGQzX3RpbWVfc2NhbGVVdGNNZXRob2RzLnllYXIgPSBkM190aW1lLnllYXIudXRjOwogIGQzX3RpbWUuc2NhbGUudXRjID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZDNfdGltZV9zY2FsZShkMy5zY2FsZS5saW5lYXIoKSwgZDNfdGltZV9zY2FsZVV0Y01ldGhvZHMsIGQzX3RpbWVfc2NhbGVVdGNGb3JtYXQpOwogIH07CiAgZDMudGV4dCA9IGQzX3hoclR5cGUoZnVuY3Rpb24ocmVxdWVzdCkgewogICAgcmV0dXJuIHJlcXVlc3QucmVzcG9uc2VUZXh0OwogIH0pOwogIGQzLmpzb24gPSBmdW5jdGlvbih1cmwsIGNhbGxiYWNrKSB7CiAgICByZXR1cm4gZDNfeGhyKHVybCwgImFwcGxpY2F0aW9uL2pzb24iLCBkM19qc29uLCBjYWxsYmFjayk7CiAgfTsKICBmdW5jdGlvbiBkM19qc29uKHJlcXVlc3QpIHsKICAgIHJldHVybiBKU09OLnBhcnNlKHJlcXVlc3QucmVzcG9uc2VUZXh0KTsKICB9CiAgZDMuaHRtbCA9IGZ1bmN0aW9uKHVybCwgY2FsbGJhY2spIHsKICAgIHJldHVybiBkM194aHIodXJsLCAidGV4dC9odG1sIiwgZDNfaHRtbCwgY2FsbGJhY2spOwogIH07CiAgZnVuY3Rpb24gZDNfaHRtbChyZXF1ZXN0KSB7CiAgICB2YXIgcmFuZ2UgPSBkM19kb2N1bWVudC5jcmVhdGVSYW5nZSgpOwogICAgcmFuZ2Uuc2VsZWN0Tm9kZShkM19kb2N1bWVudC5ib2R5KTsKICAgIHJldHVybiByYW5nZS5jcmVhdGVDb250ZXh0dWFsRnJhZ21lbnQocmVxdWVzdC5yZXNwb25zZVRleHQpOwogIH0KICBkMy54bWwgPSBkM194aHJUeXBlKGZ1bmN0aW9uKHJlcXVlc3QpIHsKICAgIHJldHVybiByZXF1ZXN0LnJlc3BvbnNlWE1MOwogIH0pOwogIGlmICh0eXBlb2YgZGVmaW5lID09PSAiZnVuY3Rpb24iICYmIGRlZmluZS5hbWQpIGRlZmluZShkMyk7IGVsc2UgaWYgKHR5cGVvZiBtb2R1bGUgPT09ICJvYmplY3QiICYmIG1vZHVsZS5leHBvcnRzKSBtb2R1bGUuZXhwb3J0cyA9IGQzOwogIHRoaXMuZDMgPSBkMzsKfSgpOw=="></script>
<script src="data:application/x-javascript;base64,SFRNTFdpZGdldHMud2lkZ2V0KHsKCiAgbmFtZTogJ2J1YmJsZXMnLAoKICB0eXBlOiAnb3V0cHV0JywKICAKICByZW5kZXJPbk51bGxWYWx1ZTogdHJ1ZSwKCiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQpIHsKCiAgICB2YXIgYnViYmxlID0gZDMubGF5b3V0LnBhY2soKQogICAgICAgIC5zb3J0KG51bGwpCiAgICAgICAgLnBhZGRpbmcoMS41KTsKICAgIAogICAgdmFyIHN2ZyA9IGQzLnNlbGVjdChlbCkuYXBwZW5kKCJzdmciKQogICAgICAgIC5hdHRyKCJjbGFzcyIsICJidWJibGUiKTsKICAgICAgICAKICAgIHJldHVybiB7CiAgICAgIHN2Zzogc3ZnLAogICAgICBidWJibGU6IGJ1YmJsZQogICAgfQoKICB9LAoKICByZW5kZXJWYWx1ZTogZnVuY3Rpb24oZWwsIHgsIGluc3RhbmNlKSB7CgogICAgLy8gU3RvcmUgdGhlIGN1cnJlbnQgdmFsdWUgc28gd2UgY2FuIGVhc2lseSBjYWxsIHJlbmRlclZhbHVlCiAgICAvLyBmcm9tIHRoZSByZXNpemUgbWV0aG9kIGJlbG93LCB3aGljaCBkb2Vzbid0IGdpdmUgdXMgYW4geAogICAgLy8gdmFsdWUKICAgIGluc3RhbmNlLmxhc3RWYWx1ZSA9IHg7CgogICAgLy8gUmV0cmlldmUgb3VyIHN2ZyBhbmQgYnViYmxlIG9iamVjdHMgdGhhdCB3ZXJlIGNyZWF0ZWQgaW4KICAgIC8vIHRoZSBpbml0aWFsaXplIG1ldGhvZCBhYm92ZQogICAgdmFyIHN2ZyA9IGluc3RhbmNlLnN2ZzsKICAgIHZhciBidWJibGUgPSBpbnN0YW5jZS5idWJibGU7CiAgICAKICAgIC8vIFJlc2l6ZSBvdXIgc3ZnIGVsZW1lbnQgYW5kIGJ1YmJsZSBsYXlvdXQgYWNjb3JkaW5nIHRvIHRoZQogICAgLy8gc2l6ZSBvZiB0aGUgYWN0dWFsIERPTSBlbGVtZW50CiAgICB2YXIgd2lkdGggPSBlbC5vZmZzZXRXaWR0aDsKICAgIHZhciBoZWlnaHQgPSBlbC5vZmZzZXRIZWlnaHQ7CiAgICBzdmcuYXR0cigid2lkdGgiLCB3aWR0aCkuYXR0cigiaGVpZ2h0IiwgaGVpZ2h0KTsKICAgIGJ1YmJsZS5zaXplKFt3aWR0aCwgaGVpZ2h0XSk7CgogICAgdmFyIGRmID0gSFRNTFdpZGdldHMuZGF0YWZyYW1lVG9EMyh4KTsKCiAgICAvLyBTZXQgdXAgb3VyIG1haW4gc2VsZWN0aW9uCiAgICB2YXIgbm9kZSA9IHN2Zy5zZWxlY3RBbGwoIi5ub2RlIikKICAgICAgICAuZGF0YShidWJibGUubm9kZXMoe2NoaWxkcmVuOiBkZiwgY29sb3I6ICJ0cmFuc3BhcmVudCJ9KSwKICAgICAgICAgICgheCB8fCAheC5rZXkpID8gbnVsbCA6IGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQua2V5OyB9CiAgICAgICAgKTsKCiAgICAvLyBDcmVhdGUgbmV3IG5vZGVzLCBhbmQgc2V0IHRoZWlyIHN0YXJ0aW5nIHN0YXRlIHNvIHRoZXkgbG9vawogICAgLy8gZ29vZCB3aGVuIHRoZXkgdHJhbnNpdGlvbiB0byB0aGVpciBuZXcgc3RhdGUKICAgIHZhciBuZXdOb2RlID0gbm9kZS5lbnRlcigpCiAgICAgICAgLmFwcGVuZCgiZyIpLmF0dHIoImNsYXNzIiwgIm5vZGUiKQogICAgICAgIC5zdHlsZSgib3BhY2l0eSIsIDApCiAgICAgICAgLmF0dHIoInRyYW5zZm9ybSIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgIHJldHVybiAidHJhbnNsYXRlKCIgKyB3aWR0aC8yICsgIiwiICsgaGVpZ2h0LzIgKyAiKSI7CiAgICAgICAgfSk7CgogICAgbmV3Tm9kZS5hcHBlbmQoInRpdGxlIik7CiAgICBuZXdOb2RlLmFwcGVuZCgiY2lyY2xlIikKICAgICAgICAuc3R5bGUoImZpbGwiLCAiI0ZGRkZGRiIpOwogICAgbmV3Tm9kZS5hcHBlbmQoInRleHQiKQogICAgICAgIC5hdHRyKCJkeSIsICIuM2VtIikKICAgICAgICAuc3R5bGUoInRleHQtYW5jaG9yIiwgIm1pZGRsZSIpOwoKICAgIC8vIFJlbW92ZSBvbGQgbm9kZXMKICAgIG5vZGUuZXhpdCgpLnRyYW5zaXRpb24oKQogICAgICAgIC5yZW1vdmUoKQogICAgICAgIC5zdHlsZSgib3BhY2l0eSIsIDApOwoKICAgIC8vIFVwZGF0ZSBhbGwgbmV3IGFuZCByZW1haW5pbmcgbm9kZXMKCiAgICBub2RlLnRyYW5zaXRpb24oKQogICAgICAgIC5zdHlsZSgib3BhY2l0eSIsIDEpCiAgICAgICAgLmF0dHIoInRyYW5zZm9ybSIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgIHJldHVybiAidHJhbnNsYXRlKCIgKyBkLnggKyAiLCIgKyBkLnkgKyAiKSI7CiAgICAgICAgfSk7CgogICAgbm9kZS5zZWxlY3QoInRpdGxlIikKICAgICAgICAudGV4dChmdW5jdGlvbihkKSB7IHJldHVybiBkLnRvb2x0aXA7IH0pOwoKICAgIG5vZGUuc2VsZWN0KCJjaXJjbGUiKS50cmFuc2l0aW9uKCkKICAgICAgICAuYXR0cigiciIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQucjsgfSkKICAgICAgICAuc3R5bGUoImZpbGwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLmNvbG9yOyB9KTsKCiAgICBub2RlLnNlbGVjdCgidGV4dCIpCiAgICAgICAgLnRleHQoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sYWJlbDsgfSkKICAgICAgICAuc3R5bGUoImZpbGwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLnRleHRDb2xvcjsgfSk7CiAgfSwKCiAgcmVzaXplOiBmdW5jdGlvbihlbCwgd2lkdGgsIGhlaWdodCwgaW5zdGFuY2UpIHsKICAgIC8vIFJlLXJlbmRlciB0aGUgcHJldmlvdXMgdmFsdWUsIGlmIGFueQogICAgaWYgKGluc3RhbmNlLmxhc3RWYWx1ZSkgewogICAgICB0aGlzLnJlbmRlclZhbHVlKGVsLCBpbnN0YW5jZS5sYXN0VmFsdWUsIGluc3RhbmNlKTsKICAgIH0KICB9Cgp9KTsK"></script>
</head>
<body style="background-color:white;">
<div id="htmlwidget_container">
<div id="htmlwidget-6215" class="bubbles html-widget" style="width:100%;height:500px;">

</div>
</div>
<script type="application/json" data-for="htmlwidget-6215">{"x":{"value":[4759,1609,497,492,416,405,339,303,151,109,66,40],"label":["Administration (-4759)","Manufacture (-1609)","Construction (-497)","Finance (+492)","Management (+416)","Informatique (+405)","Ingénieurie (+339)","Ventes (+303)","Arts & Media (-151)","Juridique (-109)","Education (+66)","Machine (-40)"],"tooltip":["Administration (-4759)","Manufacture (-1609)","Construction (-497)","Finance (+492)","Management (+416)","Informatique (+405)","Ingénieurie (+339)","Ventes (+303)","Arts & Media (-151)","Juridique (-109)","Education (+66)","Machine (-40)"],"color":["#404040","#404040","#404040","#669999","#669999","#669999","#669999","#669999","#404040","#404040","#669999","#404040"],"textColor":["#a3c2c2","#a3c2c2","#a3c2c2","#a3c2c2","#a3c2c2","#a3c2c2","#a3c2c2","#a3c2c2","#a3c2c2","#a3c2c2","#a3c2c2","#a3c2c2"]},"evals":[],"jsHooks":[]}</script>
<script type="application/htmlwidget-sizing" data-for="htmlwidget-6215">{"viewer":{"width":"100%","height":"500","padding":15,"fill":false},"browser":{"width":"100%","height":"500","padding":40,"fill":false}}</script>
</body>
</html>
